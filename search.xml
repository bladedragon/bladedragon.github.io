<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[æˆ‘ä»¬ä¾ç„¶éœ€è¦ä»°æœ›å¤©ç©º]]></title>
    <url>%2F2022%2F04%2F08%2Fboy-and-girl-and-earth%2F</url>
    <content type="text"><![CDATA[åœ¨ã€Šåœ°çƒå¤–å°‘å¹´å°‘å¥³ã€‹çš„æ­£ç‰‡ä¸­ï¼Œå¦‚æœå•çº¯è®ºè§‚æ„Ÿï¼Œæœ€åç»“å±€çš„æ¼”å‡ºå’Œè®¾è®¡ç¡®å®ä¼šè®©äººè§‰å¾—å¹³åº¸ç”šè‡³ç²—ç³™ï¼Œæœ‰æ—¶æˆ‘ä¹Ÿä¼šè§‰å¾—æœ‰äº›æ¡¥æ®µæ—¢è§†æ„Ÿè¿‡äºå¼ºçƒˆã€‚ä½†æ˜¯ä¸å¯å¦è®¤çš„æ˜¯ï¼Œåœ¨å…¶ä¸­ç¡®å®èƒ½å‘æ˜ä¸€äº›å€¼å¾—æ€è€ƒçš„é—ªå…‰ç‚¹ï¼ŒåŠ ä¹‹è¿™éƒ¨ä½œå“å¯¹ä¸–ç•Œçš„æ¶æ„å’Œç§‘å­¦å¹»æƒ³éƒ¨åˆ†æ·±å¾—æˆ‘å¿ƒï¼Œä»¥åŠå‰åŠæ®µçš„â€œå¤ªç©ºæ±‚ç”Ÿâ€ç›¸å¯¹å‡ºè‰²ï¼Œå› æ­¤æˆ‘ä¾ç„¶è®¤ä¸ºè¿™éƒ¨ç•ªçœ‹äº†ä¸äºã€‚é—æ†¾çš„æ˜¯ä¹…ä»°çŸ¶å…‰é›„å¤§åï¼Œåˆå› ä¸ºå…¶å¤„å¥³ä½œã€Šç”µè„‘çº¿åœˆã€‹æ‹¥æœ‰è¾ƒé«˜å£ç¢‘ï¼Œè¿™æ ·çš„ä½œå“ç¡®å®æœ‰äº›ä¸ç¬¦åˆé¢„æœŸï¼Œæœ€åè¿˜æ˜¯éœ€è¦æ„Ÿæ…¨ä¸€ä¸‹é€å»çš„æ—¥æœ¬ç§‘å¹»åŠ¨ç”»é»„é‡‘æ—¶ä»£ï¼Œä¸çŸ¥ä½•æ—¶ï¼Œæˆ‘ä»¬è¿˜èƒ½å†æ¬¡ä»°æœ›æ˜Ÿç©ºå‘¢ã€‚ ä»‹ç»ä»Šå¤©æˆ‘ä»¬æ¥è®²è®²ä¸€éƒ¨å†·é—¨çš„ç•ªå‰§ã€Šåœ°çƒå¤–å°‘å¹´å°‘å¥³ã€‹ï¼Œ 1æœˆç•ªåˆšå‡ºçš„æ—¶å€™ï¼Œå…¶å®å°±æœ‰å…³æ³¨è¿‡è¿™éƒ¨ç•ªå‰§ï¼Œä½†æ˜¯æ²¡æƒ³åœ¨çƒ­åº¦æ–¹é¢ç«Ÿç„¶å¦‚æ­¤ä¹‹ä½ï¼Œå¯¼è‡´æˆ‘åœ¨1æœˆç•ªå¿«å®Œç»“çš„æ—¶å€™æ‰æƒ³åˆ°æœ‰è¿™æ ·ä¸€éƒ¨ä½œå“ã€‚çƒ­åº¦ä½ä¹Ÿç¡®å®æœ‰å®ƒçš„åŸå› ï¼Œæ¯•ç«Ÿè¿™éƒ¨ä½œå“çš„é¢˜ææ˜¯ç°åœ¨å°‘æœ‰çš„è¿‘ç°å®å¤ªç©ºç§‘å¹»ä½œå“ï¼Œæ•´ä½“çš„å™äº‹ç´§å‡‘ä¸”è®¾å®šä¸¥å¯†ï¼Œæ²¡æœ‰æ¯«æ— é€»è¾‘çš„æ€ªåŠ›ä¹±ç¥ï¼ˆè‡³å°‘å‰æœŸæ²¡æœ‰ï¼‰ï¼Œå› æ­¤åœ¨å½“å‰å¼‚ä¸–ç•Œå¤§è¡Œå…¶é“çš„å®…æ–‡åŒ–é£æ ¼ä¸­ç‹¬æ ‘ä¸€å¸œï¼Œä¸å…¶è¯´è¿™ä¸ªä½œå“æ˜¯å±äº2022å¹´ï¼Œå€’æ›´åƒæ˜¯å±äºåå¹´å‰æˆ–è€…äºŒåå¹´å‰ç§‘å¹»é£è¿˜å°šå­˜ä¸€å¸­ä¹‹åœ°çš„æ—¶ä»£ã€‚ä¹Ÿæˆ–è®¸æ­£æ˜¯å› ä¸ºè¿™ä¸ªåŸå› ï¼Œæˆ‘æ‰å¯¹è¿™éƒ¨ä½œå“é’çæœ‰åŠ ã€‚ å½“ç„¶ï¼Œè™½ç„¶ä»è¿™éƒ¨ä½œå“ä¸­æˆ‘ä»¬èƒ½çª¥æ¢ä¸€ä¸å½“å¹´ç§‘å¹»é»„é‡‘æ—¶ä»£çš„é—é£ï¼Œä½†æ˜¯å®ƒç»ˆç©¶è¿˜æ˜¯å’Œå®ƒçš„å‰è¾ˆå­˜åœ¨ç›¸å½“å¤§çš„å·®è·ï¼Œå…­é›†çš„ç¯‡å¹…ä¹Ÿæ— æ³•è®©æˆ‘ä»¬å¯¹è¿™ä¸ªç²¾å¿ƒæ„å»ºçš„ä¸–ç•Œæœ‰æ›´åŠ æ·±å…¥çš„äº†è§£ï¼Œç»“å±€æ›´æ˜¯è¤’è´¬ä¸ä¸€ï¼Œå­˜åœ¨ä¸€å®šçš„äº‰è®®ã€‚å› æ­¤ï¼Œæˆ‘ä¸èƒ½è¯´è¿™éƒ¨ä½œå“èƒ½å¸¦ç»™å¤§å®¶å¤šå°‘å‘äººæ·±çœæˆ–è€…é…£ç•…æ·‹æ¼“çš„ä½“éªŒï¼Œæ€»çš„æ¥è¯´ï¼Œå®ƒè¿˜æ˜¯å±äºä¸€é“å·®å¼ºäººæ„çš„å¿«é¤å¼ä½œå“ã€‚ä½†æ˜¯å¦‚æœä½ å–œæ¬¢ä¼ ç»Ÿç§‘å¹»æ–‡å­¦ï¼Œé‚£æˆ‘ä¾ç„¶ä¼šæ¨èè¿™éƒ¨ä½œå“ï¼Œæ¯•ç«Ÿï¼Œè¿™æ ·çš„ä½œå“ç¡®å®çœ‹ä¸€éƒ¨å°‘ä¸€éƒ¨äº†ã€‚ å‰§æƒ…æŠŠæ¡ä¸ºäº†æ–¹ä¾¿ä¸‹é¢å¯¹ä¸€äº›å…³é”®å‰§æƒ…çš„é˜è¿°ï¼Œè¿™é‡Œè¿˜æ˜¯ç®€å•ä»‹ç»ä¸€ä¸‹è¿™éƒ¨ä½œå“ã€‚ã€Šåœ°çƒå¤–å°‘å¹´å°‘å¥³ã€‹æ˜¯çŸ¶å…‰é›„ç›‘ç£çš„ç¬¬äºŒéƒ¨åŸåˆ›ä½œå“ï¼Œä»–ä½œä¸ºçŸ¥åçš„åŸç”»å¸ˆï¼Œå‡ºç°åœ¨äº†è®¸å¤šä¸ºäººç†ŸçŸ¥çš„ä½œå“å¦‚ã€ŠæœºåŠ¨æˆ˜å£«é«˜è¾¾Zã€‹ã€ã€Šæ–°ä¸–çºªç¦éŸ³æˆ˜å£«ã€‹ã€ã€ŠæœºåŠ¨æˆ˜å£«é«˜è¾¾0080 å£è¢‹ä¸­çš„æˆ˜äº‰ã€‹ã€ã€Šæµªå®¢å‰‘å¿ƒã€‹ç­‰ç­‰ï¼Œå°½ç®¡ä»–ä½œä¸ºç›‘ç£çš„ä½œå“ä¸å¤šï¼Œä½†æ‰€è°“è¿‘æœ±è€…èµ¤ï¼Œåœ¨ä»–çš„ä½œå“ä¸­ä¾ç„¶èƒ½åæ˜ å‡ºé‚£äº›ç»å…¸ä½œå“çš„å½±å­ã€‚å› æ­¤ï¼ŒåŸºäºè¿™äº›ç†ç”±ï¼Œæˆ‘ä»¬å¯ä»¥æ”¾å¿ƒæœŸå¾…ä»–çš„ä½œå“ï¼Œå“ªæ€•æœ€ç»ˆä½œå“æ˜¯ä¸ªçƒ‚ä½œï¼Œä¹Ÿä¸€å®šæœ‰å€¼å¾—è§£è¯»çš„åœ°æ–¹ã€‚ æ•…äº‹å‘ç”Ÿåœ¨è¿‘æœªæ¥ï¼Œäººç±»çš„ç§‘æŠ€æ°´å¹³å·²ç»è¾¾åˆ°äº†èƒ½åœ¨å¤ªç©ºå±…ä½çš„ç¨‹åº¦ï¼Œå¹¶æœ‰ç›¸å½“ä¸€éƒ¨åˆ†äººç§»å±…åˆ°äº†æœˆçƒï¼Œå¹¶ç”Ÿè‚²äº†ç¬¬ä¸€æ‰¹åä»£ã€‚ä½†æ˜¯ï¼Œäººä»¬å‘ç°åœ¨æœˆçƒè¯ç”Ÿçš„åä»£æ— æ³•é€‚åº”æœˆçƒç¯å¢ƒï¼Œéƒ½å­˜åœ¨å…ˆå¤©æ€§ç¼ºé™·ï¼Œåªèƒ½é é›¶ä¸ƒç§‘æŠ€å…¬å¸å¼€å‘çš„æ¤å…¥ç‰©æ¥æ§åˆ¶æ¿€ç´ åˆ†æ³Œå¾—ä»¥å­˜æ´»ã€‚é›¶ä¸ƒæ˜¯äººç±»å†å²ä¸Šæ™ºèƒ½æœ€é«˜çš„AIï¼Œä»–ä¸ºäººç±»çš„ç§‘æŠ€å‘å±•åšå‡ºäº†å·¨å¤§è´¡çŒ®ï¼Œä½†ä¸å‡ºæ„å¤–çš„ï¼ŒAIå› ä¸ºé«˜åº¦è¿›åŒ–ï¼Œç”šè‡³è¶…è¿‡äº†äººç±»å¯ä»¥æŒæ§çš„èŒƒå›´ï¼Œæ‰€ä»¥å’Œæ‰€æœ‰ç”µè§†å‰§ä¸­çš„æ¡¥æ®µä¸€æ ·ï¼Œäººç±»å†å²ä¸Šæœ€é«˜æ™ºèƒ½çš„AI é›¶ä¸ƒ åˆåŒ å•æš´èµ°äº†ã€‚äºæ˜¯äººç±»å¯¹é›¶ä¸ƒè¿›è¡Œäº†å®‰ä¹æ­»ï¼Œå¹¶äºæ­¤åŒæ—¶é™åˆ¶äº†äººå·¥æ™ºèƒ½çš„å‘å±•ã€‚åŒæ—¶ç”±äºæœˆçƒä¸Šçš„ç¬¬äºŒä»£ç¹è‚²å¸¦æ¥çš„ç”Ÿå­˜å›°å¢ƒå’Œä¼¦ç†é—®é¢˜ï¼Œç§»æ°‘è®¡åˆ’ä¹Ÿå—åˆ°äº†å¤§å¤šæ•°äººçš„åå¯¹ï¼Œäºæ˜¯ç§»å±…æœˆçƒçš„äººç±»ä¹Ÿå¼€å§‹å›å½’åœ°çƒã€‚æ•…äº‹ä¸»äººå…¬å¤±é‡å’Œä»–çš„é’æ¢…ç«¹é©¬èœå¶å°±æ˜¯åœ¨æœˆçƒè¯ç”Ÿçš„å­©å­ä¹‹ä¸€ï¼Œä½œä¸ºç¬¬ä¸€ä»£ä¹Ÿæ˜¯æœ€åä¸€ä»£çœŸæ­£è¯ç”Ÿäºåœ°çƒå¤–çš„å­©å­ï¼Œä»–ä»¬å³å°†å›åˆ°åœ°çƒï¼Œå¹¶åœ¨å®‰å¿ƒç©ºé—´ç«™åšæœ€åçš„é€‚åº”è®­ç»ƒã€‚ä¸æ­¤åŒæ—¶ï¼Œåœ°çƒä¸Šä¹Ÿæœ‰ä¸‰ä½å°‘å¹´å°‘å¥³å› ä¸ºè¢«æ´»åŠ¨é€‰ä¸­è€Œå‰å¾€å®‰å¿ƒç©ºé—´ç«™å‚è§‚ã€‚å°±åœ¨å°‘å¹´å°‘å¥³ç›¸é‡ä¹‹æ—¶ï¼Œä»–ä»¬å·å…¥äº†å½—æ˜Ÿæ’å‡»äº‹ä»¶ï¼Œæ•…äº‹ä¹Ÿç”±æ­¤å±•å¼€ã€‚ æ•…äº‹å…¶å®å¯ä»¥åˆ†æˆä¸Šä¸‹éƒ¨åˆ†ï¼Œå‰ä¸‰é›†å®Œå…¨å¯ä»¥çœ‹æˆä¸€éƒ¨åˆæ ¼çš„å¤ªç©ºç¾éš¾ç‰‡ï¼Œå°‘å¹´å°‘å¥³åœ¨æ‘‡æ‘‡æ¬²å çš„å¤ªç©ºç«™ä¸æ–­åˆ©ç”¨èº«è¾¹èµ„æºå’Œç§‘å­¦çŸ¥è¯†æ±‚ç”Ÿã€‚å¾—ç›Šäºæœ¬å‰§ç›¸å½“ç¿”å®çš„ä¸–ç•Œè§‚è®¾å®šå’Œä¸°å¯Œçš„ç»†èŠ‚ä½œç”»ï¼Œä½¿å¾—è§‚ä¼—éå¸¸å®¹æ˜“æ²‰æµ¸è¿›å»ï¼Œç»™æˆ‘çš„æ„Ÿè§‰å°±åƒæ˜¯åœ¨çœ‹å¤ªç©ºç‰ˆã€Šè’é‡æ±‚ç”Ÿã€‹æˆ–è€…ã€Šåœ°å¿ƒå¼•åŠ›ã€‹ï¼Œå¦‚æœä½ æ˜¯ç»†èŠ‚æ§æˆ–è€…ç§‘å¹»çˆ±å¥½è€…ï¼Œçœ‹åˆ°å‰§ä¸­çš„å„ç§æ–°å¥‡ä½†åˆç¬¦åˆé€»è¾‘çš„è®¾å®šä¸€å®šä¼šä¸€æœ¬æ»¡è¶³ã€‚ äº‹å®ä¸Šï¼Œä»å„å¤§è¯„åˆ†ç½‘ç«™ä¸Šï¼Œä¹Ÿæ˜æ˜¾èƒ½çœ‹å‡ºå‰åŠéƒ¨åˆ†çš„è¯„åˆ†è¦ä¼˜äºååŠéƒ¨åˆ†ï¼Œå¦‚æœæ²¡æœ‰ååŠéƒ¨åˆ†ï¼Œå…‰çœ‹å‰åŠéƒ¨åˆ†ï¼Œè§‚ä¼—ä¸éœ€è¦äº†è§£éå¸¸å¤šä¸–ç•Œè§‚èƒŒæ™¯ï¼Œå½“åšä¼ ç»Ÿçš„çˆ†ç±³èŠ±çˆ½ç‰‡å…¶å®ä¹Ÿæœªå°ä¸å¯ã€‚ä½†å¦‚æœçœŸæˆè¿™æ ·ï¼Œè¿™éƒ¨ä½œå“æˆ–è®¸å¤§ä¼—è¯„ä»·ä¼šé«˜ä¸€ç‚¹ï¼Œä½†æ˜¯ä¹Ÿå°±æ²¡æœ‰å“é‰´çš„ä»·å€¼äº†ã€‚å½“æ•…äº‹æ¥åˆ°ååŠéƒ¨åˆ†ï¼Œå‰§æƒ…å‘å±•è™½è¯´ä¸ä¹åè½¬å’Œçˆ†ç‚¹ï¼Œä½†æ˜¯ç”±äºå¤§é‡ä¸–ç•Œè§‚è®¾å®šå’Œå¸¦æœ‰ä½œè€…æ€§çš„æ€æƒ³ç†è®ºæ¶Œå…¥ï¼Œç›¸ä¿¡å¾ˆå¤šè§‚ä¼—éƒ½ä¼šè§‰å¾—æœ‰ç‚¹è¿·æƒ‘ã€‚åŠ¨ç”»è¿™è¿™ä¸€æ–¹é¢çš„è¡¨ç°ç¡®å®ä¸ç®—å¤ªå¥½ï¼Œå¾ˆå¤šæ€æƒ³çš„é˜è¿°éƒ½æ˜¯ä»¥è¯´æ•™æˆ–è€…ç«™æ¡©å¯¹è¯çš„å½¢å¼è¿›è¡Œï¼Œä¸€å¥—çœ‹ä¸‹æ¥ç¡®å®æœ‰ç‚¹åƒåŠ›ã€‚ä¸è¿‡ä¹Ÿä¸èƒ½å®Œå…¨å½’å’äºåŠ¨ç”»åˆ¶ä½œï¼Œå¾ˆå¤šæ¦‚å¿µå’Œç†è®ºæœ¬èº«å°±å¸¦æœ‰å¾ˆå¼ºçš„å­¦æœ¯æ€§è´¨ï¼Œåœ¨åŠ ä¸Šè¿™äº›ä¿¡æ¯ç›¸å½“é›†ä¸­é¥±å’Œï¼Œå› æ­¤åœ¨åˆæ¬¡è§‚çœ‹çš„æ—¶å€™éš¾å…ä¼šè§‰å¾—äº‘é‡Œé›¾é‡Œã€‚ å¯ä»¥çœ‹å‡ºä½œè€…æƒ³è¦åœ¨å‰§ä¸­è¡¨è¾¾çš„ä¸œè¥¿å¾ˆå¤šï¼Œä½†å¯èƒ½æ˜¯åŸºäºå‰§æƒ…å®¹é‡æˆ–è€…ç¼–æ’ï¼Œå¾ˆå¤šéƒ½æ˜¯ä¸€å¸¦è€Œè¿‡ï¼Œå¦‚æœæœ‰å¿ƒï¼Œå¯ä»¥å»ä¸€ä¸€è€ƒç©¶ã€‚æˆ‘ä¹Ÿæ˜¯åŸºäºç¯‡å¹…ï¼Œåªèƒ½å»ä¸»è§‚å±•å¼€ä¸€äºŒï¼Œå¦‚æœçœŸçš„æœ‰å–œæ¬¢è¯¥ä½œå“çš„ç²‰ä¸ï¼ŒæœŸå¾…å¯ä»¥åšå‡ºæ›´å¤šæ›´ä¸“ä¸šçš„è§£é‡Šã€‚ ä¸–ç•Œè§‚çš„æ„å»ºå‰§ä¸­æœ€è®©æˆ‘æƒŠå–œçš„åœ°æ–¹ï¼Œè«è¿‡äºå¯¹æœªæ¥ç§‘æŠ€ç¤¾ä¼šçš„æƒ³è±¡å’Œè¿˜åŸã€‚ç›‘ç£å¹¶æ²¡æœ‰å»å®Œå…¨å¤©é©¬è¡Œç©ºçš„è®¾è®¡ä¸€ä¸ªæ¶ç©ºä¸–ç•Œï¼Œè€Œæ˜¯åŸºäºç°å®çš„ç§‘æŠ€ï¼Œå»åˆç†æƒ³è±¡å’Œé¢„æµ‹æœªæ¥çš„ç¤¾ä¼šå½¢æ€ã€‚å…¶å®è¿™æ ·çš„è®¾è®¡æ›´è€ƒéªŒè®¾è®¡è€…çš„ä¸“ä¸šåŠŸåº•å’ŒçŸ¥è¯†å¹¿åº¦ã€‚å› ä¸ºæ¶ç©ºçš„ç¤¾ä¼šå¾€å¾€å­˜åœ¨ä¸€ç§â€œæ— é™çš„èƒ½æºâ€ä½œä¸ºä¸–ç•Œå­˜åœ¨çš„åŸºåº•ï¼ŒåŠ¡å®ä¸€ç‚¹å°±æ˜¯å°å‹æ ¸èšå˜ï¼Œå¤§èƒ†ä¸€ç‚¹å°±æ˜¯ä¾‹å¦‚ä»€ä¹ˆâ€œXXç‚‰â€ã€â€œXXåŠ›â€ï¼Œ â€œXXç²’å­â€ï¼Œä¸€æ—¦å‡ºç°äº†æŸç§è¿èƒŒå¸¸è¯†çš„é»‘ç§‘æŠ€ï¼Œä¼¼ä¹éƒ½å¯ä»¥ç”¨è¿™ç§ä¸œè¥¿æ¥è§£é‡Šã€‚å…¶å®è¿™å°±æ˜¯è®¾è®¡ä¸Šçš„å·æ‡’ï¼Œæˆ–è€…è¯´â€œå–å·§â€ï¼Œæ¯•ç«Ÿç¤¾ä¼šçš„å¤æ‚æ€§å°±æ˜¯å»ºç«‹åœ¨å¦‚ä½•åˆ©ç”¨å„ç§æœ‰é™çš„èµ„æºä¸Šï¼ŒçœŸæ­£å»ç»†ç©¶è¿™ä¸ªä¸–ç•Œçš„æ¯ä¸€å¤„ç»†èŠ‚ï¼Œä¼šå‘ç°æˆ‘ä»¬çš„ä¸–ç•ŒçœŸçš„æ˜¯ååˆ†å¤æ‚å’Œç²¾å·§ã€‚å› æ­¤çŸ¶å…‰é›„é€‰æ‹©æ„æƒ³ä¸€ä¸ªè¿‘æœªæ¥çš„ç°å®ä¸–ç•Œæ—¶ï¼Œä»–æ‰€é¢ä¸´çš„è®¾è®¡éš¾åº¦æ˜¯éå¸¸å¤§çš„ï¼Œæ¯ä¸€å¤„ç»†èŠ‚è®¾è®¡éƒ½éœ€è¦åŸºæœ¬ç¬¦åˆç°å®çš„ç‰©ç†è§„åˆ™ï¼Œè¿™éœ€è¦è®¾è®¡è€…å……åˆ†äº†è§£ç›¸å…³è¡Œä¸šçš„å„ç±»äº§å“è®¾è®¡ï¼Œè€Œè¿™æ ·åšå¸¦æ¥çš„å¥½å¤„ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œé‚£å°±æ˜¯çœŸå®æ„Ÿï¼Œè§‚ä¼—èƒ½æ›´åŠ è‡ªç„¶åœ°èå…¥åˆ°è¿™ä¸ªæ„æƒ³çš„è™šæ‹Ÿä¸–ç•Œï¼Œä»£å…¥å‰§æƒ…ã€‚äº‹å®ä¸Šï¼Œæˆ‘è®¤ä¸ºã€Šå°‘å¹´å°‘å¥³ã€‹ä¸­å¯¹äºè¿‘æœªæ¥çš„æç»˜æ˜¯ç›¸å½“æˆåŠŸçš„ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¾ˆå¤šç°å®ä¸å­˜åœ¨ä½†æ˜¯å¾ˆç†Ÿæ‚‰çš„ä¸œè¥¿ï¼Œæ¯”å¦‚å¤§è„‘æ¤å…¥ç‰©ã€è§¦æ§æ‰‹å¥—æˆ–è€…ä¸»è§’æ—çš„å“ˆç½—ï¼›åˆæˆ–è€…æ˜¯åœ¨ä¸ç†Ÿæ‚‰çš„ä¸œåœºæ™¯çœ‹åˆ°ç†Ÿæ‚‰çš„ä¸œè¥¿ï¼Œæ¯”å¦‚åœ¨ç©ºé—´ç«™ä¸Šæœ‰å•†åœºä¸€æ ·çš„è£…é¥°å¸ƒç½®ï¼Œæœ‰è‡ªåŠ©å”®å–æœºç­‰ï¼Œè™½ç„¶åªæ˜¯å¯¹ç°å®å…ƒç´ çš„æ’åˆ—ç»„åˆä»¥åŠç¨ç¨æ”¹è¿›ï¼Œä½†æ˜¯è¦æŠŠè¿™äº›å…ƒç´ æ„å»ºæˆä¸€ä¸ªåˆç†å¯ä¿¡çš„ç¤¾ä¼šï¼Œä¾ç„¶éœ€è¦å¡«å……ä¸å°‘çš„ç»†èŠ‚ã€‚æ›´ä½•å†µï¼Œä½œè€…æ˜æ˜¾åœ¨èˆªå¤©é¢†åŸŸæ–¹é¢æœ‰ç€ç›¸å½“çš„çŸ¥è¯†å‚¨å¤‡ï¼Œä¾‹å¦‚åœ¨ç©¿è¶Šç©ºé—´ç«™åŒºåŸŸè¿›è¡ŒEVAï¼ˆå¤ªç©ºè¡Œèµ°ï¼‰é‚£æ®µï¼Œå¯ä»¥çœ‹å‡ºæœ‰ç›¸å½“çš„ä¸“ä¸šæ€§ã€‚æ­£æ˜¯è¿™äº›å¯¹åœºæ™¯ç»†èŠ‚çš„æ„å»ºï¼Œæ‰è®©æˆ‘ä»¬èƒ½æ›´åŠ æ²‰æµ¸å¼åœ°å¸¦å…¥åˆ°å‰§æƒ…ä¸­ã€‚ å½“ç„¶ä½œè€…é€‰æ‹©æ„å»ºè¿™ä¹ˆä¸€ä¸ªå’Œç°å®å¦‚æ­¤æ¥è¿‘çš„ç¤¾ä¼šï¼Œä¹Ÿæ˜¯æƒ³å€ŸåŠ©è¿™ä¸ªè™šæ„åœ°ç¤¾ä¼šå»æ˜ å°„ç°å®å­˜åœ¨çš„é—®é¢˜ã€‚æ¯”å¦‚ç¾è¡£å¥ˆè¿™ä¸ªè§’è‰²ï¼Œåœ¨å‚è§‚ä¸‰äººç»„ä¸­ï¼Œå¥¹çš„å¡‘é€ æ˜¯æœ€å®Œæ•´çš„ï¼Œä»å¤´åˆ°å°¾å®Œæˆäº†ä¸€ä¸ªvtuberçš„æœ¬èŒå·¥ä½œï¼Œä½œä¸ºä¸€ä¸ªç¬¬ä¸‰è€…è®°å½•äº†å¤ªç©ºä¸­å‘ç”Ÿçš„ä¸€åˆ‡ã€‚åè§‚å…¶ä»–ä¸¤ä½ï¼Œç™½å®¢å¤§æ´‹è™½ç„¶å‰æœŸè¿˜èƒ½å’Œä¸»è§’æ¼”æ¼”å¯¹æ‰‹æˆï¼Œæ¨åŠ¨å‰§æƒ…å‘å±•ï¼Œä½†æ˜¯åé¢äº¤äº†Brightåå°±æ²¡äº†æˆä»½ï¼Œå……å½“äº†èƒŒæ™¯æ¿ï¼Œå¦å¤–ä¸€ä½å¼Ÿå¼Ÿåšå£«ï¼ˆäººåï¼‰åˆ™æ›´æ˜¯ä»å¤´åˆ°å°¾èƒŒæ™¯æ¿ã€‚ä¸è¿‡å°±ç®—æ˜¯ç¾è¡£å¥ˆä¹Ÿå¾ˆæ˜æ˜¾è¢«ç äº†å¾ˆå¤šå‰§æƒ…ã€‚ç¾è¡£å¥ˆä½œä¸ºvtuberå‘åœ°çƒè§‚ä¼—ç›´æ’­çš„è¿™æ¡çº¿å®é™…ä¸Šåæ˜ ä½œè€…å¯¹æ¶ˆè´¹ä¸»ä¹‰å’Œå¨±ä¹ä¹‹ä¸Šæ–‡åŒ–çš„æ€åº¦ã€‚å‰§ä¸­è¿˜æ˜¯æ˜æ˜¾å‹ç¼©äº†åœ°çƒè§‚ä¼—èˆ†è®ºçš„å‰§æƒ…ï¼Œå½“åˆšç™»ä¸Šç©ºé—´ç«™åˆ°ä¸»è§’ç™»çŸ¢çš„è¨€è®ºç‰‡æ®µè¢«ä¸Šä¼ ç½‘ä¸Šå¼•å‘è¯¯è§£ï¼Œå†åˆ°ä¸­é€”å„ç§æ–­ç½‘åˆ¶é€ ä¿¡æ¯å·®ï¼Œæœ€åäº§ç”Ÿçš„å„ç§åŒ–å­¦ååº”ï¼Œå¯ä»¥è¯´åœ¨ä¸»çº¿ä¹‹å¤–ï¼Œå¦å¤–å¼€è¾Ÿäº†ä¸€ä¸ªç›¸å½“ç°å®å’Œè®½åˆºçš„èˆå°ã€‚ä½†æ˜¯æœ‰è¶£çš„æ˜¯ï¼Œå¦‚æœè¯´è¿™äº›åªæ˜¯ç§‘å¹»æ˜ å°„ç°å®çš„è¯ï¼Œ åˆ©ç”¨å¤§æ•°æ®ç­›é€‰è§‚ä¼—å–œå¥½çš„ç½‘é£å¯¹è¯¥å‰§çš„æ³¨èµ„ä»¥åŠå‰§ä¸­å¯¹ä¼˜è¡£åº“çš„å•†ä¸šæ¤å…¥å¯ä»¥è¯´æ˜¯ç°å®ä¸ç§‘å¹»ç›¸äº’æ˜ å°„äº†ï¼Œå¦‚æœå†æ­é…é¥­åœˆå¼¹å¹•é£Ÿç”¨é‚£æ›´æ˜¯çœŸäººä½“éªŒäº†ã€‚è¢«å¨±ä¹åŒ–çš„æœªæ¥å¹¶éå…¨æ˜¯æ‚²æƒ¨å’Œé»‘æš—çš„ï¼Œåªæ˜¯åœ¨è¢«ä¿¡æ¯è£¹æŒŸçš„æ—¶ä»£ï¼Œæˆ‘ä»¬ç­›é€‰ä¿¡æ¯å’Œåšå‡ºæ­£ç¡®åˆ¤æ–­çš„æˆæœ¬æ›´é«˜äº†ï¼Œå¤§ä¼—çš„é›†ä½“æ„å¿—ä¹Ÿæ›´å®¹æ˜“è¢«è½¬å˜å’Œå¼•å¯¼ï¼Œå…¶å®æˆ‘ä»¬ä¸æ˜¯å¿…é¡»è¦ç»™å‡ºè¿™ç§å­˜åœ¨æ–¹å¼çš„å¯¹ä¸é”™ï¼Œè€Œæ˜¯é€‰æ‹©æ¥å—å¹¶æ­£è§†è¿™ç§å­˜åœ¨çš„å¿…ç„¶ï¼Œå¹¶ä¸ºæ­¤è€Œåšå‡ºæ”¹å˜ã€‚ å‰§æƒ…èµæå‰§ä¸­çš„ä¸»çº¿å…¶å®æ˜¯éå¸¸ç»å…¸çš„AIä¸äººä¹‹é—´çš„ç«‹åœºé—®é¢˜ã€‚ç°åœ¨å¤§å®¶éƒ½è®¨è®ºAIä¸äººï¼Œå®è´¨ä¸Šå°±æ˜¯è¿‡å»æœºå™¨äººä¸äººè¯é¢˜çš„å»¶ä¼¸ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå¯ä»¥å¼•å‡ºäº†å¾ˆå¤šæ–°çš„é—®é¢˜ï¼Œæˆ‘ä»¬æ˜¯å¦èƒ½è®¤å¯æˆ‘ä»¬åˆ›é€ çš„ç‰©ä½“å…·æœ‰è‡ªç”±æ„å¿—ï¼Ÿæ˜¯å¦è®¤å¯åˆ›é€ ç‰©æˆä¸ºä¸äººç±»åŒç­‰åœ°ä½çš„ç‰©ç§ï¼Ÿå¦‚æœè¿™äº›åˆ›é€ ç‰©çœŸçš„å…·æœ‰äº†è‡ªç”±æ„å¿—ï¼Œä»–ä»¬æ˜¯å¦ä¼šåå™¬ç”šè‡³å–ä»£é€ ç‰©ä¸»ï¼Ÿå®é™…ä¸Šï¼Œæ ¹æ®ç›®å‰ä¸»æµçš„è§‚ç‚¹ï¼Œå¤§å®¶éƒ½é»˜è®¤è®¤åŒå­˜åœ¨å³åˆç†ï¼Œå¦‚æœçœŸçš„å‡ºç°å…·æœ‰è‡ªç”±æ„å¿—çš„AIï¼Œæˆ‘ä»¬å°Šé‡å¹¶è®¤å¯å…¶ç‹¬ç«‹ç‰©ç§çš„åœ°ä½ï¼Œä½†æ˜¯å…¶ä¸­ä¼šä¸€ä¸ªå…³é”®ç‚¹ï¼Œæ€æ ·çš„åŒºåˆ†åˆ›é€ ç‰©æ˜¯å¦æœ‰è‡ªç”±æ„å¿—ï¼Ÿåœ¨å‰§ä¸­å¯¹AIçš„æ™ºèƒ½ç¨‹åº¦è¿›è¡Œäº†é‡åŒ–ï¼Œâ€œå“ˆç½—â€å’Œâ€œpodâ€ä¸€å±‚å±‚çªç ´æ™ºèƒ½é™åˆ¶ï¼Œæœ€ç»ˆè¾¾åˆ°å¹¶è¶…è¿‡é›¶ä¸ƒçš„è¿‡ç¨‹çœ‹ä¸Šå»å°±åƒæ‰“æ€ªå‡çº§ä¸€æ ·ç®€å•ï¼Œå®é™…ä¸Šå…¶ä¸­éšå«äº†ä¸€ä¸ªå®Œæ•´çš„ç‰©ç§è¿›åŒ–çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬çŸ¥é“æœ€ç»ˆçš„é›¶ä¸ƒ2å·æ˜¯å…·æœ‰è‡ªç”±æ„å¿—çš„ï¼Œå¹¶è®¤å¯å…¶æˆä¸ºæ–°çš„ç‰©ç§ï¼Œä½†æ˜¯æ™ºèƒ½ç¨‹åº¦å¤„äºä¹‹é—´çš„åäºŒï¼Œblackå’Œbrightè¿™äº›å‘¢ï¼Ÿå¦‚ä½•è¯æ˜ä»–ä»¬æ²¡æœ‰è‡ªç”±æ„å¿—ï¼Ÿå¦‚æœä»–ä»¬æœ‰è‡ªç”±æ„å¿—ï¼Œæˆ‘ä»¬è¿˜èƒ½çº¦æŸå’Œæ§åˆ¶ä»–ä»¬å—ï¼Ÿè™½ç„¶ç°åœ¨äººç±»å·²ç»æœ‰å›¾çµæµ‹è¯•å»æ£€æµ‹AIæ˜¯å¦å…·æœ‰äººç±»æ™ºèƒ½ï¼Œä½†æ˜¯è¿™ä¾ç„¶åªæ˜¯äººç±»çš„æ ‡å‡†ï¼Œæ›´ä½•å†µç›®å‰ä¹Ÿæœ‰ä¸å°‘AIé€šè¿‡äº†å›¾çµæµ‹è¯•ï¼Œä½†æ˜¯æˆ‘ä»¬è®¤å¯ä»–ä»¬çš„æ™ºèƒ½æ°´å¹³è¾¾åˆ°äº†äººç±»çº§åˆ«å—ï¼Ÿæ·±æŒ–ä¸‹æ¥å…¶å®æœ‰å¾ˆå¤šå€¼å¾—æ€è€ƒçš„è¯é¢˜ï¼Œè¿™äº›è¯é¢˜å‰§ä¸­æ²¡æœ‰ç»™å‡ºç­”æ¡ˆï¼Œå¯èƒ½æˆ‘ä»¬è‡³ä»Šè¿˜æ— æ³•ç»™å‡ºå®Œç¾çš„è§£é‡Šï¼Œä¹Ÿè®¸åªæœ‰ç­‰åˆ°é—®é¢˜çœŸæ­£å‡ºç°åœ¨çœ¼å‰ï¼Œæˆ‘ä»¬æ‰èƒ½æ­æ™“ç­”æ¡ˆã€‚ æ¯•ç«Ÿæ¢æ±‚è‡ªç”±æ„å¿—å­˜åœ¨è¿™ä¸ªæ¦‚å¿µæœ¬èº«æ˜¯ä¸€ä¸ªå­¦æœ¯çš„é—®é¢˜ï¼Œæˆ‘ä»¬ä¹Ÿä¸å¸Œæ±‚åœ¨ä¸€éƒ¨å½±è§†ä½œå“ä¸­è¿½æ±‚å¾—åˆ°ç»“æœã€‚äºæ˜¯å¾ˆå¤šä½œå“ä¾¿æŠŠäººä¸AIçš„å†²çªæ”¾åœ¨æ²Ÿé€šä¸Šï¼Œæ¯•ç«Ÿå¦‚æœAIèƒ½è®¤åŒäººç±»å¹¶ä¸æƒ³æ¯ç­äººç±»ï¼Œé‚£ä¾ç„¶èƒ½è¾¾æˆä¸€ä¸ªHAPPYENDçš„ç»“å±€ã€‚è€Œæœ¬ä½œçš„AI é›¶ä¸ƒäºŒå·åœ¨ä¸äººç±»æ²Ÿé€šï¼Œç†è§£äººç±»çš„è¿‡ç¨‹ä¸­ï¼ŒæŠ›å‡ºäº†è¿™æ ·ä¸€ä¸ªè¯é¢˜ï¼Œäººä½œä¸ºé›†ä½“å’Œç‹¬ç«‹ä¸ªäººçš„æ¦‚å¿µï¼Œæ˜¯ä¸æ˜¯ä¸€è‡´ã€‚è¿™ä¸ªè¯é¢˜è«åè®©äººæ„Ÿè§‰è”æƒ³åˆ°EVAçš„æ©™æ±ç»“å±€ï¼ŒåŒæ ·æ˜¯åœ¨äººè¦ä¿æŒç‹¬ç«‹ä¸ªä½“çš„å­˜åœ¨è¿˜æ˜¯æ‰“ç ´å¿ƒä¹‹å£ï¼Œä½œä¸ºé›†ä½“çš„æ¦‚å¿µå­˜æ´»ä¸Šè¿›è¡Œé€‰æ‹©ã€‚å½“ç„¶ï¼Œå­¦è¿‡é©¬å“²çš„å¤§å®¶éƒ½æ˜ç™½ï¼Œç‰©è´¨å†³å®šæ„è¯†ï¼ŒæŠ›å¼€äººå®ä½“å­˜åœ¨è€Œå…‰è®ºé›†ä½“æ„è¯†çš„å­˜åœ¨æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚ ä½†æ˜¯å›½å¤–çš„äººä»¬æœ‰ä¸åŒçš„ä»·å€¼è§‚ï¼Œè‡ªç„¶å¯¹æ­¤æœ‰ä¸åŒçš„ç†è§£ã€‚å› æ­¤æˆ‘ä»¬ä¹Ÿä¸å¿…è¿‡äºæ·±ç©¶æ¦‚å¿µï¼Œæ¯•ç«Ÿåœ¨åšé•¿æ—¶é—´æ€æƒ³åšå¼ˆçš„è¿‡ç¨‹ä¸­ï¼Œå°±æœ‰å¯èƒ½ä¼šä¸è‡ªè§‰åœ°æ‰å…¥è™šæ— ä¸»ä¹‰çš„æ³¥æ½­ï¼Œå®é™…ä¸Šï¼Œæˆ‘è®¤ä¸ºå¯¹ç”Ÿæ´»çœŸæ­£æœ‰æŒ‡å¯¼æ„ä¹‰çš„æ˜¯åŒºåˆ†ä¸ªäººæ„å¿—å’Œé›†ä½“æ„å¿—çš„è¾¹ç•Œã€‚å‰§ä¸­äººç‰©çš„è¡¨ç°åœ¨æˆ‘çœ‹åˆ°å°±æ˜¯åœ¨æ¼”ç»ä¸ªäººç‹¬ç«‹æ„å¿—ä¸é›†ä½“æ„å¿—å¦‚ä½•å†²çªå’Œè°ƒå’Œçš„è¿‡ç¨‹ã€‚åœ¨ç™»çŸ¢ä¸ºäº†æ‹¯æ•‘èœå¶å’Œé›¶ä¸ƒ2å·ç›´æ¥å¯¹è¯çš„è¿‡ç¨‹ä¸­ï¼Œé›¶ä¸ƒ2å·æ›´å¤šæ˜¯åœ¨æ•´ä½“çš„è§’åº¦çš„æ€è€ƒå­˜äº¡é—®é¢˜ï¼Œä½†æ˜¯ç™»çŸ¢å´åªå…³å¿ƒèœå¶ä¸ªäººçš„ç”Ÿæ­»ï¼Œå¹¶åœ¨å¯¹è¯ä¸­é¢‘é¢‘è¡¨ç¤ºå‡ºå¼ºçƒˆçš„ä¸ªä½“ä¸»è§‚æ„å¿—ï¼Œä¸ä¹‹ç›¸åï¼Œèœå¶å´æ—©æ—©æ¥å—æ‰€è°“çš„å®¿å‘½ï¼Œæ¥å—äººç±»ç¾¤ä½“é™ä¸‹çš„æ„å¿—ï¼Œè€Œä¸æ›¾åšç‹¬ç«‹çš„æ€è€ƒï¼Œç›´åˆ°ç™»çŸ¢çš„è¨€è¡Œé‡æ–°å”¤é†’èœå¶å†…å¿ƒå¯¹ç”Ÿå­˜çš„æ¸´æœ›ï¼Œè¿™å°±æ˜¯èœå¶çš„ç‹¬ç«‹æ„å¿—ï¼Œå› æ­¤ï¼ŒäºŒäººæ‰æˆåŠŸå¾—ä»¥æ‹¯æ•‘ã€‚å½“ç„¶å‰§ä¸­å¯¹è¿™æ®µçš„æ¼”å‡ºè¯´ä¸ä¸Šå¤ªå¥½ï¼Œå¾ˆå¤šæ¦‚å¿µä¸€æ‰«è€Œè¿‡ï¼Œç¼ºä¹åˆç†è§£é‡Šï¼Œå¯¼è‡´æœ€ååƒæ˜¯æœºæ¢°é™ç¥ï¼Œä¸»è§’å‡­å€Ÿè‡ªå¸¦å…‰ç¯è§£å†³ä¸€åˆ‡é—®é¢˜ã€‚è™½ç„¶å¯èƒ½å­˜åœ¨è¿‡åº¦è§£è¯»çš„å¯èƒ½ï¼Œä½†æˆ‘æ›´å€¾å‘ä½œè€…ä¸€å®šæœ‰åŸºäºæ€æƒ³å±‚é¢çš„è€ƒé‡å»è®¾è®¡æœ€åçš„æ‹¯æ•‘æ¡¥æ®µã€‚ ã€Šå°‘å¹´å°‘å¥³ã€‹çš„æ­£ç‰‡ä¸­ï¼Œå¦‚æœå•çº¯è®ºè§‚æ„Ÿï¼Œæœ€åç»“å±€çš„æ¼”å‡ºå’Œè®¾è®¡ç¡®å®ä¼šè®©äººè§‰å¾—å¹³åº¸ç”šè‡³ç²—ç³™ï¼Œæœ‰æ—¶æˆ‘ä¹Ÿä¼šè§‰å¾—æœ‰äº›æ¡¥æ®µæ—¢è§†æ„Ÿè¿‡äºå¼ºçƒˆã€‚ä½†æ˜¯ä¸å¯å¦è®¤çš„æ˜¯ï¼Œåœ¨å…¶ä¸­ç¡®å®èƒ½å‘æ˜ä¸€äº›å€¼å¾—æ€è€ƒçš„é—ªå…‰ç‚¹ï¼ŒåŠ ä¹‹è¿™éƒ¨ä½œå“å¯¹ä¸–ç•Œçš„æ¶æ„å’Œç§‘å­¦å¹»æƒ³éƒ¨åˆ†æ·±å¾—æˆ‘å¿ƒï¼Œä»¥åŠå‰åŠæ®µçš„â€œé€ƒç”Ÿçºªå®â€ç›¸å¯¹å‡ºè‰²ï¼Œå› æ­¤æˆ‘ä¾ç„¶è®¤ä¸ºè¿™éƒ¨ç•ªçœ‹äº†ä¸äºã€‚é—æ†¾çš„æ˜¯ä¹…ä»°çŸ¶å…‰é›„å¤§åï¼Œä»¥åŠå…¶å¤„å¥³ä½œã€Šç”µè„‘çº¿åœˆã€‹çš„é«˜å£ç¢‘ï¼Œè¿™æ ·çš„ä½œå“ç¡®å®æœ‰äº›ä¸ç¬¦åˆé¢„æœŸï¼Œæ€»çš„æ¥è¯´ï¼Œè™½ç„¶è¿™éƒ¨ä½œå“ä¸ç®—ç‰¹åˆ«å®Œç¾ï¼Œä½†åœ¨å½“ä»Šå½±è§†ä½œå“é¢˜ææ„ˆå‘åŒè´¨åŒ–çš„å½¢åŠ¿ä¸‹ï¼Œè¿˜èƒ½æœ‰å……æ»¡æ€æƒ³æ€§å’Œæ€è€ƒä»·å€¼çš„ä½œå“å‡ºç°å®å±éš¾å¾—ï¼Œå¯¹äºä¸€èˆ¬è§‚ä¼—è€Œè¨€ï¼Œç®—æ˜¯ä¸€éƒ¨åˆæ ¼æ°´å¹³è‰¯ä½œï¼Œå¯¹äºç§‘å¹»çˆ±å¥½è€…æ¥è¯´ï¼Œåˆ™æ›´æœ‰ç†ç”±å»æ”¯æŒè¿™ç§å°ä¼—é¢˜æçš„ä½œå“ ã€‚ æœ€åè¿˜æ˜¯éœ€è¦æ„Ÿæ…¨ä¸€ä¸‹é€å»çš„æ—¥æœ¬ç§‘å¹»åŠ¨ç”»é»„é‡‘æ—¶ä»£ï¼Œæˆ–è®¸å†°å†·çš„æœºå™¨ï¼Œæ·±é‚ƒæœªçŸ¥çš„å¤ªç©ºå·²ç»æ— æ³•å†æ¿€å‘äººä»¬çš„å…´è¶£ï¼Œä½†åœ¨ç§‘æŠ€é£é€Ÿå‘å±•çš„ç°å®ï¼Œå¦‚æœå¨±ä¹ä½œå“ç¼ºä¹å¯¹ç§‘å­¦æŠ€æœ¯çš„æ™®åŠï¼Œå¯¹å‰æ²¿æ€æƒ³çš„è§£æ„ï¼Œæ²‰é»˜çš„å¤§å¤šæ•°ï¼Œæ˜¯å¦æ‹¥æœ‰è¶³å¤Ÿçš„ç‹¬ç«‹æ„å¿—åšå¥½äº†è¿æ¥æœªæ¥çš„å‡†å¤‡? è¿˜æ˜¯ä¼šæˆä¸ºè¢«ä¿¡æ¯è£¹æŒŸï¼Œè¢«è¨€è¯­æ“æ§çš„ä¹Œåˆä¹‹ä¼—ï¼Ÿ æˆ–è®¸æœ‰ä¸€å¤©æˆ‘ä»¬æƒ³èµ·æ¥ä»°æœ›æ˜Ÿç©ºï¼Œä¼šå‘ç°åŸæ¥æˆ‘ä»¬æ—©å·²ç½®äºæ˜Ÿç©ºä¹‹ä¸­]]></content>
      <categories>
        <category>ä¸€å¦‚æ—¢å¾€ï¼Œåªæ˜¯æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>å½±è¯„</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ¸…æ˜æ‚è®°]]></title>
    <url>%2F2022%2F03%2F30%2Fanxious%2F</url>
    <content type="text"><![CDATA[æ‚è®°ç»“æŸäº†æ·…æ·…æ²¥æ²¥çš„é˜´é›¨å¤©ï¼Œ4æœˆçš„ç¬¬ä¸€ä¸ªå‘¨æœ«ï¼Œæ€»ç®—è¿æ¥äº†é˜³å…‰æ˜åªšçš„æ—©æ™¨ã€‚ä¹…è¿åœ°åœ¨èµ·åºŠåæ²æµ´ç€æ™¨é£ï¼Œå®‰é™åœ°æ€è€ƒï¼Œæ‰å‘è§‰ï¼Œå› ä¸ºç–«æƒ…å’Œå·¥ä½œï¼Œ è®©æ—¶é—´æµé€å¾—å¦‚æ­¤ä¹‹å¿«ã€‚è½¬çœ¼é—´ï¼Œè¿™ä¸€å¹´ï¼Œå°±è¦è¿‡å»ä¸‰åˆ†ä¹‹ä¸€äº†ã€‚è™½ç„¶æ—¥å­ä¸€å¤©å¤©æ­£å¸¸è¿‡ï¼Œä½†æ˜¯è„‘æµ·ä¸­æ€»æ˜¯å¸ƒæ»¡å„ç§å„æ ·é˜´éƒçš„æƒ…ç»ªï¼Œæ„Ÿè§‰æ— è®ºèµ°ä»€ä¹ˆäº‹æƒ…éƒ½æœ‰ä¸€ç§ç„¦èºçš„å¿ƒæƒ…ï¼Œæ€»æƒ³åšå‡ºæ”¹å˜ä½†æ€»æ˜¯æ— èƒ½ä¸ºåŠ›ï¼Œæ˜¯è°“ä¹‹ç„¦è™‘ã€‚ ä¸ºä»€ä¹ˆä¼šç„¦è™‘å‘¢ï¼Ÿ ä¸€ä¸ªåŸå› æ˜¯å¯¹ç°çŠ¶ä¸æ»¡è€Œå¯¹æœªæ¥è¿˜å……æ»¡ç–‘æƒ‘å§ï¼Œå¦å¤–ä¸€ä¸ªåŸå› æ˜¯ç¼ºä¹ç§¯ç´¯å’Œæˆé•¿çš„æ»¡è¶³ã€‚å‰è€…ä¹Ÿæ¥è‡ªäºæµ®èºå¸¦æ¥çš„æƒ³ä¸€è¹´è€Œå°±çš„å¿ƒæ€ï¼Œåè€…åˆ™æ˜¯å®‰äºç°çŠ¶çš„ä¸€ç§åå™¬å§ã€‚ è¯´åˆ°åº•ï¼Œç°åœ¨éœ€è¦çš„ä¸“æ³¨å’ŒæŒç»­çš„æŠ•å…¥ï¼Œæ²¡æœ‰ä»€ä¹ˆäº‹æƒ…æ˜¯å¯ä»¥ä¸€ç°‡è€Œå°±çš„ï¼Œæ—¶é—´ä¼šåŸºäºä½ åº”æœ‰å¾—åˆ°å›æŠ¥]]></content>
  </entry>
  <entry>
    <title><![CDATA[2021å¹´ç»ˆæ€»ç»“]]></title>
    <url>%2F2021%2F12%2F31%2F2021-year-end-summary%2F</url>
    <content type="text"><![CDATA[var ap = new APlayer({ element: document.getElementById("aplayer-hNHRGFEj"), narrow: false, autoplay: false, showlrc: false, music: { title: "One Last Kiss", author: "å®‡å¤šç”°ãƒ’ã‚«ãƒ«", url: "http://music.163.com/song/media/outer/url?id=1824020871.mp3", pic: "http://p1.music.126.net/l3G4LigZnOxFE9lB4bz_LQ==/109951165791860501.jpg?param=130y130", lrc: "" } }); window.aplayers || (window.aplayers = []); window.aplayers.push(ap); ç»§ç»­åšæ¢¦ï¼Œç»§ç»­åšå¯¹çš„äº‹æƒ…ï¼Œç»§ç»­æœŸå¾…ã€‚ Do Dream, Do Right, Do Expect æ—¶é—´è¿‡å¾—é£å¿«ï¼Œå¾ˆéš¾æƒ³è±¡åœ¨åœ£è¯èŠ‚ä¹‹åï¼Œ2021å¹´å°†ä¼šæˆä¸ºè¿‡å»å¼ã€‚ä¸€å¹´å‰çš„æˆ‘ï¼Œåœ¨åšä»€ä¹ˆï¼Ÿä¸€å¹´åçš„æˆ‘ï¼Œå°†åšä»€ä¹ˆï¼Ÿ è¿™ä¸€å¹´ï¼Œæ— ç–‘ä¼šæ˜¯æˆ‘ä¸€ç”Ÿä¸­æœ€é‡è¦çš„ä¸€å¹´ä¹‹ä¸€ã€‚ æˆ‘å°å°½äº†æ ¡å›­çš„ä½™å‘³ï¼Œè¿ˆå…¥äº†åå«ç¤¾ä¼šçš„åœˆå­ã€‚ç”¨ä¸€æ®µæ— å¿§æ— è™‘çš„ç”Ÿæ´»ï¼Œè¿æ¥äº†ä¸€ä¸ªé˜¶æ®µæ€§çš„è°¢å¹•ã€‚ä¸çŸ¥ä¸è§‰å·²ç»åˆ°è¿™æ ·çš„å¹´çºªï¼Œæ›¾ç»çš„ç†æƒ³ç”Ÿæ´»éƒ½å·²å˜æˆäº†æ—¢å®šçš„ç°å®ã€‚è™½ç„¶è¿™ä¸ªç°å®å’Œæœ€åˆçš„æ¢¦æƒ³æœ‰äº†ä¸å°çš„åå·®ï¼Œä½†æ˜¯æ€»å½’æ¥è¯´è¿˜æ˜¯æ„æ–™ä¹‹ä¸­çš„ç»“å±€ã€‚ æˆ‘æ˜¯ä¸€ä¸ªä¸è‡ªå¾‹çš„äººï¼Œå› æ­¤æˆ‘å¿…é¡»ç»™è‡ªå·±é™å®šçº¦æŸï¼Œæ‰èƒ½å¾—åˆ°æˆ‘æœ€å¤§çš„æ»¡è¶³ã€‚è¿™æ˜¯æˆ‘20å¹´ä¸æ–­éªŒè¯çš„äº‹å®ã€‚å¿è€æ˜¯æˆ‘çš„ä¼˜ç‚¹ï¼Œæ— æ³•ä¸“æ³¨æ˜¯æˆ‘çš„ç¼ºç‚¹ã€‚æˆ‘çŸ¥é“è‡ªå·±çš„æ˜æš—é¢ï¼Œä¹Ÿä¸ä¼šç»™æœªæ¥è¿‡é«˜çš„æœŸè®¸ï¼Œä½†æ˜¯ï¼Œè¿™ä¸æ˜¯ç»™æˆ‘è®¾é™çš„ç†ç”±ã€‚è¿‡å»çš„æˆ‘æ€»æ˜¯å°é—­è‡ªå·±ï¼Œå› æ­¤æˆ‘æ— æ³•è·³å‡ºè‡ªå·±ç»™è‡ªå·±è®¾è®¡çš„é€»è¾‘æ€ªåœˆï¼Œå…¶å®åªè¦åšæŒï¼ŒåšæŒåšå¯¹çš„äº‹æƒ…ï¼Œæˆ‘ä¾ç„¶æœ‰æ— é™çš„å¯èƒ½æ€§ã€‚ ä»Šå¤©çœ‹äº†å†°å†°çš„è§†é¢‘ï¼Œå¹³æ—¶å…¶å®éƒ½ä¸ä¼šå»å…³æ³¨ï¼Œä½†ä¸å¾—ä¸æ‰¿è®¤ï¼Œæœ‰çš„æ—¶å€™äººè¿˜æ˜¯éœ€è¦ä¸€ç‚¹æ­£èƒ½é‡çš„ï¼Œä¹Ÿä¸æ˜¯è™šä¼ªï¼Œä¸æ˜¯é€ƒé¿ç°å®ï¼Œæ°æ°ç›¸åï¼Œè¿™äº›æ­£èƒ½é‡æ­£æ˜¯é©±åŠ¨æˆ‘ä»¬è¿›æ­¥çš„ç°å®ä¹‹ä¸€ã€‚æˆ‘ä»¬è‡ªä»¥ä¸ºç†æ€§ï¼Œçœ‹é€äº†ç°å®çš„é˜´æš—é¢ï¼Œä½†æ˜¯å´æ— æ³•æ‰¿è®¤ç°å®ä¸­ä¾ç„¶å­˜åœ¨çš„ç¾å¥½çš„ä¸œè¥¿ï¼Œè¿™ä½•å°ä¸æ˜¯ä¸€ç§éç†æ€§çš„æƒ³æ³•ï¼Ÿä¸æ˜¯æ‰€æœ‰äººçš„äººç”Ÿï¼Œéƒ½æ˜¯å»è¾©é©³ï¼Œå»è¯ä¼ªï¼Œæ¯ä¸ªäººéƒ½åº”è¯¥æœ‰è‡ªå·±è¿½æ±‚çš„ç›®æ ‡ï¼Œè¿™æ ·ï¼Œç”Ÿæ´»æ‰ä¸å­¤å•ï¼Œæˆ–è€…è¯´ï¼Œåªè¦ä½ å¿ƒé‡Œè¿˜æœ‰å¯¹æœªæ¥çš„æœŸè®¸ï¼Œé‚£æ ·ä¸ºä¹‹ä»˜å‡ºçš„æ¯ä¸€æ­¥ï¼Œéƒ½å¯Œæœ‰æ„ä¹‰ã€‚ å› æ­¤ï¼Œæ–°çš„ä¸€å¹´ï¼Œä¾ç„¶è¦ç»§ç»­ç«‹flagï¼Œç»§ç»­åšå¯¹çš„äº‹æƒ…ï¼Œç»§ç»­è¿‡ç€è®©è‡ªå·±æ»¡æ„çš„ç”Ÿæ´»ã€‚ å°†è¿‡å»å½’æ¡£ï¼Œå­˜ä¸€ä»½å¿µæƒ³ç¿»çœ‹ç›¸å†Œï¼Œæ‰æ˜ç™½ä»€ä¹ˆå«å…‰é˜´ä¼¼ç®­ï¼Œæ—¥æœˆå¦‚æ¢­ã€‚çœŸçš„è¿™äº›æƒ…æ™¯ä»¿ä½›å°±åœ¨æ˜¨å¤©å±•ç°ï¼Œç„¶è€Œå´å¿«è¦è·¨è¿‡ä¸€å¹´ã€‚ 4æœˆï¼Œç»“æŸäº†æˆ‘å¯èƒ½æ˜¯äººç”Ÿæœ€åä¸€æ¬¡è¿åŠ¨ä¼šï¼Œæˆ‘ä»»å‡­å¿ƒé‡Œæ„Ÿæƒ…å®£æ³„ï¼Œå°†å…¶åŒ–æˆè¾è—»ï¼Œæœ€åæ´‹æ´‹æ´’æ´’å†™äº†ä¸€å †å¿ƒé‡Œè¯ã€‚è™½ç„¶ä¸€å¦‚æ—¢å¾€ä½¶å±ˆè±ç‰™ï¼Œå……æ»¡äº†ä¸­äºŒæ°”æ¯ï¼Œä½†æ˜¯è¿™æ‰æ˜¯æˆ‘å˜›ã€‚è¿™ä»½å­¤é«˜çš„æ°”è´¨ï¼Œç°åœ¨è¿˜ç•™æœ‰å‡ åˆ†å‘¢? 4æœˆåº•ï¼Œæˆ‘çªç„¶æœ‰äº†ä¸€ä¸ªæœºä¼šåšä¸´æ—¶å®éªŒï¼Œè¿™å¯æ–°é²œã€‚æˆ‘ç”šè‡³å¼€å§‹æœŸå¾…è¿™æ˜¯ä¸æ˜¯ä»£è¡¨å¯ä»¥æ ¹æ²»æˆ‘è¿™æ¯›ç—…åˆèƒ½çœé’±ï¼Ÿï¼ˆè™½ç„¶äº‹å®è¯æ˜å‘½è¿åªæ˜¯æ“¦è‚©è€Œè¿‡ï¼‰ 5æœˆ5æ—¥ï¼Œçºªå¿µæˆ‘çš„ç¬¬äºŒéƒ¨æ‰‹æœºï¼Œè™½ç„¶ä¸€å¼€å§‹åªæ˜¯å€”å¼ºå¾—è¯´åªæ˜¯ä¸´æ—¶æœºï¼Œä½†è¿˜æ˜¯ç”¨çš„æŒºçˆ½çš„ã€‚ æˆ‘æœ€åè¿˜æ˜¯æ¥åˆ°äº†ä¸€ä¸ªä¸ä¸Šä¸ä¸‹çš„å…¬å¸ï¼Œè¿™è®©æˆ‘å¯¹æ•°ç äº§å“ä¹Ÿå…³æ³¨å¾—å¤šäº†ä¸€äº›ï¼Œæˆ‘ä¹Ÿæ›¾åŒæ ·çš„å¿ƒæƒ…ä¸‹è¯´å‡ºäº†åªæ˜¯ä¸€å¼€å§‹åœ¨è¿™é‡Œï¼Œåé¢ä¸€å®šä¼šè·³æ§½çš„ã€‚ä½†è€å®è®²ï¼Œå¿ƒé‡Œè¿˜æ˜¯æ²¡æœ‰åº•ã€‚ä½†æ˜¯çš„ä½†æ˜¯ï¼Œç”Ÿæ´»å¹¶ä¸æ˜¯ä¸€æˆä¸å˜çš„ï¼Œè¿™æ¬¡å¦‚æ­¤ï¼Œä¸ä»£è¡¨ä¸‹æ¬¡ä¸€å®šã€‚å…·ä½“æˆ‘ä¼šå˜æˆä»€ä¹ˆæ ·å­ï¼Œçœ‹ä»Šå¹´è¡¨ç°ã€‚ æœ€åçš„æš‘å‡ï¼Œè®°å½•ä¸€ä¸‹å¤§é¥¼ã€‚ æ˜¯å»è€Œä¸è¿”çš„æ ¡å›­:( æ˜¯æ­¦éš†ï¼è¿™é‡Œæœ‰æˆ‘ç¬¬ä¸€æ¬¡ç”¨å¿ƒçš„vlogï¼Œæœ‰æˆ‘æœ€å¥½çš„æœ‹å‹ã€‚ è¿™é‡Œæœ‰ç€å¯¹å­¦æ ¡æœ€åçš„ç•™å¿µå’Œè‡´æ„ã€‚ æœ€åçš„ç­”è¾©ã€‚ è¿™é‡Œè·³è¿‡éå¸¸å¤šçš„æ¯•ä¸šçºªå¿µç…§ç‰‡â€¦è¿˜æ˜¯æ²¡æœ‰æ•¢æ”¾å‡ºæ¥çš„å‹‡æ°”..ï¼ˆæ”¾ä¸€å¼ æˆ‘å¾ˆå–œæ¬¢çš„å¥‘ä¸¹ç‰©è¯­ï¼‰ æ¹–å—è¡Œï¼ä¸æœ‹å‹å’Œæœ‹å‹çš„å¥³æœ‹å‹ä»¬â€¦ä¸è¿‡ä¸å¦¨ç¢è¿™æ˜¯ä¸€æ®µéå¸¸å¼€å¿ƒçš„æ—…ç¨‹~ ï¼ˆèŒ¶é¢œyydsï¼‰ ä¸€å¼ èƒŒå½±ï¼Œä»£è¡¨æœ€å¥½çš„æˆ‘ä»¬ ç¤¾ä¼šäººçš„å¼€å§‹ï¼ŒäºŒåº¦è¿›å‚ï¼Œåšæœºçš„æ—¶å…‰ å¹´è½»äººçš„ç¬¬ä¸€é¡¿é¥­â€¦ å¹´è½»äººçš„ç¬¬ä¸€æ¬¡è£…æœº.. RGBå°±æ˜¯ä¿¡ä»°ï¼ï¼ ç¤¾ç•œçš„äººç”Ÿå¼€å§‹å˜æˆæ¸¸æˆçš„æ¨¡æ ·â€¦. å¹´è½»äººçš„ç¬¬ä¸€æ¬¡å›¢å»ºâ€¦ å¿ƒæƒ…æ˜¯æ„å¤–çš„å¥½ ä¸€å¹´å°±è¿™æ ·èµ°å‘ç»“æŸ.. è¿™æ—¶ä»Šå¹´æœ€åä¸€å¼ ç…§ç‰‡. END ä½ å®Œæˆäº†å“ªäº›è®¡åˆ’? å›çœ‹å»ä¸¤å¹´å‰çš„æ€»ç»“ï¼Œæ„Ÿè§‰è‡ªå·±å°±åƒæ–­å±‚ä¸€æ ·ï¼Œæœç„¶ï¼Œä¸è®°å½•ä¸€ç‚¹ä»€ä¹ˆï¼Œè‡ªå·±å°±æ— æ³•çŸ¥é“è‡ªå·±åˆ°åº•æ´»æˆäº†ä»€ä¹ˆæ ·å­ã€‚ä»¥å‰çš„æˆ‘è¿˜æ˜¯æœ‰å¾ˆå¤šå¿µæƒ³ï¼Œç°åœ¨ï¼Œæˆ‘å…·å¤‡äº†ä¸€åˆ‡çš„æ¡ä»¶ï¼Œæƒ³åšä»€ä¹ˆå°±å¿…é¡»å»åšå§ è‡´æœªæ¥å¯¹äºæœªæ¥ï¼Œæˆ‘ä¸çœ‹å¥½ï¼Œä½†æˆ‘å……æ»¡æœŸå¾…ã€‚æˆ‘æ´»æˆä»€ä¹ˆæ ·å­ï¼Œå–å†³äºæˆ‘çš„æ‰§è¡ŒåŠ›å¦‚ä½•ã€‚ ä»ä»Šå¹´èµ·ï¼Œæˆ‘è¦å¼€å§‹ç«‹flagäº†ã€‚ç°åœ¨çš„æˆ‘è¿˜å¹´è½»ï¼Œæ¯”èµ·ç ”ç©¶ç”Ÿä»¬ï¼Œæˆ‘è¿˜æœ‰3å¹´æ—¶é—´ã€‚æˆ‘ä¹Ÿåªæœ‰ä¸‰å¹´æ—¶é—´ï¼Œå¿…é¡»è®©æˆ‘èƒ½éª„å‚²åœ°ç«‹è¶³äºè¿™ä¸ªç¤¾ä¼šä¸Šã€‚å› æ­¤æ˜å¹´çš„ä¸»é¢˜ï¼Œæ˜¯å®šè°ƒï¼Œæ½œå¿ƒç ”ç©¶ã€‚ é¦–å…ˆæ˜¯å·¥ä½œçš„flagï¼š æ˜å¹´çš„è¿°èŒï¼Œä¸€å®šæ˜¯è¦è‡ªä¿¡å’Œç¨³æ“èƒœåˆ¸çš„ã€‚ æŠ€æœ¯ä¸Š æ˜å¹´è‡³å°‘è¦æœ‰ä¸€ä¸ªè‡ªå·±çš„å¼€æºç©å…· çœ‹å®Œè‡³å°‘3æœ¬æŠ€æœ¯ä¹¦ åšå®¢æ•°é‡ä¸å°‘äº6ç¯‡å§ï¼ˆæ„Ÿè§‰æœ‰ç‚¹è™šè¿˜æ˜¯ï¼Œæ–°å¹´å°±æ˜¯è¦ç¡¬æ°”ç‚¹ï¼ï¼‰ ç”Ÿæ´»ä¸Š åšæŒåšé¥­çš„è‰¯å¥½ä¼ ç»Ÿ æ¯ä¸ªæœˆéƒ½è¦å‡ºé—¨æ¢æ¢æ°” åšæŒé”»ç‚¼ï¼Œè¦ä¿æŒè‚Œè‚‰max ä¹ æƒ¯ä¸Š è‡³å°‘çœ‹å®Œä¸‰æœ¬ä¹¦ï¼ˆéæŠ€æœ¯ç±»ï¼‰ å­¦ä¼šAEï¼Œè‡³å°‘å‰ªä¸€ä¸ªè§†é¢‘ æœªæ¥å·²æ¥ã€‚ä¹‹åçš„æ¯ä¸€å¹´éƒ½ä¼šä¸€å¦‚æ—¢å¾€ï¼Œä½†æ˜¯æ¯ä¸€å¹´ä¸€å®šéƒ½æœ‰ä¸ä¸€æ ·çš„ç²¾å½©ã€‚äººç”Ÿæœ‰ç»ˆç‚¹ï¼Œä½†å¥”èµ´ç»ˆç‚¹ä¸æ˜¯æˆ‘ä»¬çš„ç›®æ ‡ã€‚å¤šæŠ¬å¤´ï¼Œå››å‘¨æœ›ï¼Œå»å‘ç°æ›´åŠ ç¾ä¸½çš„é£æ™¯ã€‚ ç»§ç»­åšæ¢¦ï¼Œç»§ç»­åšå¯¹çš„äº‹æƒ…ï¼Œä¸ç•™é—æ†¾ã€‚]]></content>
      <categories>
        <category>ä¸€å¦‚æ—¢å¾€ï¼Œåªæ˜¯æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>æ€»ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[airflowæºç è§£æâ€”â€”è°ƒåº¦å™¨ç¯‡]]></title>
    <url>%2F2021%2F11%2F27%2Fairflow-01%2F</url>
    <content type="text"><![CDATA[å› ä¸ºairflow1.0å’Œ2.0å˜æ›´äº†è®¸å¤š æ¥ä¸‹æ¥ä¼šé€šè¿‡åˆ†æairflow1.0å’Œairflow2.0çš„æºç æ¥åŠ æ·±å¯¹airflowçš„ç†è§£ airflowç®€ä»‹airflowæ˜¯ä¸€ä¸ªå·¥ä½œæµæ¨¡å¼çš„åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦æ¡†æ¶ï¼Œå¯ä»¥å®ç°å¤æ‚çš„å·¥ä½œæµè°ƒåº¦ã€‚å› ä¸ºå·¥ä½œåŸå› éœ€è¦å¯¹airflowè¿›è¡Œè°ƒç ”ï¼Œå› æ­¤è¿™é‡Œè®°å½•ä¸€ä¸‹å­¦ä¹ airflowè¿‡ç¨‹é‡åˆ°çš„é—®é¢˜å¹¶å¸æ”¶ä¸€äº›å®ç°æŠ€å·§ã€‚æ¥ä¸‹æ¥ä¼šæ ¹æ®airflowçš„å„ç§ç»„ä»¶ï¼Œæ·±å…¥airflowçš„æºç è¿›è¡Œè®²è§£ã€‚airflowä»1.0åˆ°2.0ï¼Œå®ç°çš„æ¶æ„è¿›è¡Œäº†ä¸€æ¬¡è¾ƒå¤§çš„æ”¹å˜ï¼Œå› æ­¤ï¼Œæˆ‘åœ¨è¿™é‡ŒåŒæ—¶åˆ†æä¸¤ä¸ªå¤§ç‰ˆæœ¬çš„æºç ï¼Œé€šè¿‡åˆ†æå…¶ä¸­çš„å¼‚åŒï¼Œä¹Ÿå¯ä»¥ä¸€çª¥å¼€å‘è€…çš„è®¾è®¡æ€è·¯å’Œä¼˜åŒ–æ–¹å‘ã€‚ é¦–å…ˆæ”¾ä¸€å¼ æ•´ä½“çš„airflowæ¶æ„å›¾ 2.0å’Œ1.0åœ¨æ•´ä½“ç»“æ„ç›¸ä¼¼ï¼Œè¿™é‡Œå¤§æ¦‚ä¼šå°†airflowçš„è§£æåˆ†ä¸ºè°ƒåº¦å™¨ç¯‡ worker(executor)ç¯‡ dagå¤„ç†å™¨ç¯‡ webserverç¯‡ æ¥ä¸‹æ¥çš„å†…å®¹é»˜è®¤è¯»è€…å¯¹airflowçš„åŸºæœ¬æ¦‚å¿µæœ‰ä¸€å®šçš„äº†è§£ï¼Œå¦‚æœå°šæœªäº†è§£ç›¸å…³å†…å®¹ï¼Œä¹‹åæœ‰æ—¶é—´æˆ‘å†è€ƒè™‘å†™ä¸€ç¯‡æ¦‚å¿µç›¸å…³å†…å®¹ airflowåˆ›å»ºå·¥ä½œæµçš„è¿‡ç¨‹ä¸»è¦å¦‚ä¸‹ï¼Œæ³¨æ„airflowæ˜¯ä¸€ä¸ªå‘½ä»¤é©±åŠ¨çš„æ¡†æ¶ï¼Œå‡ ä¹æ‰€æœ‰çš„æœºåˆ¶éƒ½æ˜¯ä»å‘é€å‘½ä»¤è¡Œå¼€å§‹çš„ é€šè¿‡å‘½ä»¤è¡Œåˆ›å»ºdagå’Œoperatorï¼Œ é…ç½®airflowçš„åŸºæœ¬é…ç½®ï¼ŒåŒ…æ‹¬æ•°æ®åº“è¿æ¥ï¼Œwebserverç«¯å£ï¼Œè¿æ¥æ¿å¹¶å‘æ•°ï¼Œè¯»å–çš„å­˜æ”¾dagæ–‡ä»¶å¤¹çš„ä½ç½®ç­‰ç­‰ å¯åŠ¨è°ƒåº¦å™¨ï¼Œwebserverä»¥åŠexecutorï¼Œè¿™æ—¶æ¡†æ¶ä¼šè‡ªåŠ¨ä»è®¾ç½®å¥½çš„çš„dagæ–‡ä»¶å¤¹ä½ç½®è¯»å–dagå’Œoperatorçš„é…ç½®æ–‡ä»¶å¹¶ç”Ÿæˆdagå’Œtaskå­˜æ”¾è¿›æ•°æ®åº“ æ¥ç€å°±å¯ä»¥ç™»é™†airflowçš„webserveræŸ¥çœ‹å„ä¸ªdagçš„è¿è¡Œæƒ…å†µl airflow1.0 è°ƒåº¦å™¨éƒ¨åˆ†è¿™é‡Œæˆ‘ä»¬é€‰æ‹©çš„ç‰ˆæœ¬æ˜¯1.8.2 é¦–å…ˆè§‚å¯Ÿä¸€ä¸‹airflowçš„ä¸»è¦ç»“æ„ å¤§è‡´è§£é‡Šä¸€ä¸‹å„ä¸ªç›®å½•çš„ä½œç”¨ api: æ”¾ç½®äº†ä¸€äº›ç”¨äºä»£ç å†…æ¥å£è°ƒç”¨çš„æ–¹æ³• binï¼šå¯åŠ¨æ–¹æ³• contribï¼šåº”è¯¥æ˜¯ä¸€äº›ç¬¬ä¸‰æ–¹æ’ä»¶çš„å®šåˆ¶æ–¹æ³•ï¼ŒåŒ…æ‹¬sensorï¼Œexecutorï¼Œhookç­‰ dagï¼šdagçš„åŸºç±» example_dag: ä¸€äº›dagçš„æ ·ä¾‹æ¨¡æ¿ executorï¼šå…·ä½“çš„executor hooksï¼šç”¨äºæ–¹æ³•å†…è°ƒç”¨çš„hookï¼Œä½¿å¾—å¯ä»¥é™ä½éæ ¸å¿ƒåŠŸã€èƒ½çš„è€¦åˆç¨‹åº¦ macrosï¼šåªæœ‰hiveçš„ä¸€äº›æ–¹æ³•ï¼Œæˆ‘è¿˜ä¸æ˜¯ç‰¹åˆ«äº†è§£ migrationsï¼š ç•¥ operatorsï¼šå®šåˆ¶çš„ä¸€äº›operatorï¼Œå³taskçš„æ¨¡æ¿ securityï¼šæœ‰å…³ç”¨æˆ·è®¤è¯å’Œç™»å½•çš„æ–¹æ³• task_runner: æ‰§è¡Œairflowå‘½ä»¤è¡Œå·¥å…·ï¼Œæœ‰ç‚¹åƒbash ti_dep: taskinstance çš„ä¸€äº›ä¾èµ–çŠ¶æ€ utils: å·¥å…·ç±» www: é¡µé¢ç›¸å…³ å¯ä»¥çœ‹åˆ°ç›®å½•ç»“æ„éå¸¸ä¹‹å¤šï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æŠ“ä½ä¸€æ¡ä¸»çº¿æ¥æ¢³ç†ã€‚æœ¬ç¯‡é€‰æ‹©ä»¥è°ƒåº¦å™¨ä½œä¸ºåˆ‡å…¥å£ï¼Œæˆ‘ä»¬å°±ä»è°ƒåº¦å™¨çš„åˆ›å»ºå¼€å§‹å§ã€‚ airflowæ‰€æœ‰æœºåˆ¶çš„è¿è¡Œå…¥å£å‡ ä¹éƒ½æ˜¯ä»å‘½ä»¤è¡Œå¼€å§‹çš„ï¼Œå› æ­¤æˆ‘ä»¬ç›´æ¥ä»å‘½ä»¤è¡Œçš„å…¥å£æ–¹æ³•æŸ¥çœ‹ï¼Œè¿™é‡Œæˆ‘ä»¬æŸ¥çœ‹/bin/cli.py å¯ä»¥çœ‹åˆ°å†cli.pyçš„CLIFactoryç±»ä¸­å­˜åœ¨å¤§é‡çš„å‘½ä»¤å®šä¹‰ï¼Œè¿™é‡Œåœ¨ä¹‹åçš„å­¦ä¹ ä¸­è¿˜ä¼šç»å¸¸å›åˆ°è¿™é‡Œã€‚æˆ‘ä»¬ç›´æ¥æŸ¥çœ‹schedulerçš„å¯åŠ¨ 123456789101112131415161718192021222324252627282930313233def scheduler(args): print(settings.HEADER) # è°ƒåº¦å™¨çš„æ ¸å¿ƒ job = jobs.SchedulerJob( dag_id=args.dag_id, subdir=process_subdir(args.subdir), run_duration=args.run_duration, num_runs=args.num_runs, do_pickle=args.do_pickle)# å¦‚æœæŒ‚åå°ï¼Œå°±å°†è¿›ç¨‹æŒ‚åˆ°daemonContextä¸Š if args.daemon: pid, stdout, stderr, log_file = setup_locations("scheduler", args.pid, args.stdout, args.stderr, args.log_file) handle = setup_logging(log_file) stdout = open(stdout, 'w+') stderr = open(stderr, 'w+') ctx = daemon.DaemonContext( pidfile=TimeoutPIDLockFile(pid, -1), files_preserve=[handle], stdout=stdout, stderr=stderr, ) with ctx: job.run() stdout.close() stderr.close() # é€šè¿‡ä¿¡å·ç›´æ¥å¯åŠ¨è¿›ç¨‹ else: signal.signal(signal.SIGINT, sigint_handler) signal.signal(signal.SIGTERM, sigint_handler) signal.signal(signal.SIGQUIT, sigquit_handler) job.run() å¯ä»¥çœ‹è§ï¼Œæ ¸å¿ƒåœ¨äºåˆ›å»ºschuedulerJobç±»ï¼ŒåŒæ—¶ä¼ å…¥dag_id, æŒç»­æ—¶é—´ï¼Œå¹¶å‘æ•°ç­‰åŸºæœ¬å‚æ•° ç»§ç»­è¿›å…¥ï¼Œå¯ä»¥å‘ç°æˆ‘ä»¬è·³è½¬åˆ°äº†job.py æˆ‘ä»¬å…ˆæŸ¥çœ‹ä¸€ä¸‹schedulerJobçš„çˆ¶ç±»ï¼ŒbaseJob.py 1234567891011121314151617181920212223242526272829303132333435363738394041class BaseJob(Base, LoggingMixin): __tablename__ = "job" id = Column(Integer, primary_key=True) dag_id = Column(String(ID_LEN),) state = Column(String(20)) job_type = Column(String(30)) start_date = Column(DateTime()) end_date = Column(DateTime()) latest_heartbeat = Column(DateTime()) executor_class = Column(String(500)) hostname = Column(String(500)) unixname = Column(String(1000)) def __init__( pass ) def kill(self): pass def on_kill(self): pass def heartbeat_callback(self, session=None): pass def heartbeat(self): pass def run(self): pass def _execute(self): pass @provide_session def reset_state_for_orphaned_tasks(self, dag_run, session=None): pass å¯ä»¥å‘ç°ï¼Œè¿™é‡Œjobé¦–å…ˆæ˜¯ä½œä¸ºä¸€å¼ è¡¨ä¿å­˜äº†jobçš„çŠ¶æ€ï¼Œæ‰§è¡Œæƒ…å†µï¼ˆè¿™é‡Œæ˜¯sqlalchemyçš„ç›¸å…³çŸ¥è¯†ï¼‰ ä¸»è¦çš„æ–¹æ³•æœ‰ is_alive: é€šè¿‡heartbeatåˆ¤æ–­æ˜¯å¦å­˜æ´» killï¼šé€šè¿‡åˆ é™¤æ•°æ®åº“è®°å½•çš„æ–¹å¼æ¥ç»“æŸä»»åŠ¡ on_killï¼šç­‰å¾…å­ç±»é‡å†™ï¼Œç”¨äºåˆ é™¤ä»»åŠ¡çš„æ—¶å€™åšä¸€äº›é¢å¤–å¤„ç† heartbeat_callbackï¼šå¿ƒè·³çš„å›è°ƒï¼Œç­‰å¾…å­ç±»é‡å†™ heartbeatï¼šå‘é€å¿ƒè·³ï¼Œä¸‹é¢è¯¦ç»†ä»‹ç» runï¼šä¿®æ”¹è¡¨ä¸­jobçš„çŠ¶æ€ï¼Œæ¥è¡¨ç¤ºjobæ­£åœ¨è¿›è¡Œï¼ŒåŒæ—¶æ‰§è¡Œ_exexute _executeï¼š ç­‰å¾…å­ç±»é‡å†™ï¼Œå¦‚ä½•æ‰§è¡Œjob reset_state_for_orphaned_tasksï¼šé‡ç½®å­¤å„¿ä»»åŠ¡ ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹heartbeat 12345678910111213141516171819202122232425262728293031def heartbeat(self): session = settings.Session() job = session.query(BaseJob).filter_by(id=self.id).one() make_transient(job) session.commit() session.close() if job.state == State.SHUTDOWN: self.kill() # Figure out how long to sleep for sleep_for = 0 if job.latest_heartbeat: sleep_for = max( 0, self.heartrate - (datetime.now() - job.latest_heartbeat).total_seconds()) # Don't keep session open while sleeping as it leaves a connection open session.close() sleep(sleep_for) # Update last heartbeat time session = settings.Session() job = session.query(BaseJob).filter(BaseJob.id == self.id).first() job.latest_heartbeat = datetime.now() session.merge(job) session.commit() self.heartbeat_callback(session=session) session.close() self.logger.debug('[heart] Boom.') å¿ƒè·³åœ¨è°ƒåº¦å™¨è¿è¡ŒæœŸé—´å®šæœŸå‘é€ï¼Œé€šè¿‡æŸ¥è¡¨åˆ¤æ–­è°ƒåº¦å™¨çŠ¶æ€æ˜¯å¦æ­£å¸¸ 1234567891011121314151617@provide_session def reset_state_for_orphaned_tasks(self, dag_run, session=None):# ä»æ‰§è¡Œå™¨ä¸­è·å–ç­‰å¾…å…¥é˜Ÿçš„ä»»åŠ¡ queued_tis = self.executor.queued_tasks # åŒæ ·è€ƒè™‘æ­£åœ¨æ‰§è¡Œå™¨ä¸­æ‰§è¡Œçš„ä»»åŠ¡ running = self.executor.running tis = list() tis.extend(dag_run.get_task_instances(state=State.SCHEDULED, session=session)) tis.extend(dag_run.get_task_instances(state=State.QUEUED, session=session)) # ç­‰å¾…å…¥é˜Ÿå’Œæ­£åœ¨æ‰§è¡Œå™¨æ‰§è¡Œçš„ä»»åŠ¡å±äºæ­£å¸¸æƒ…å†µä¸ä¼šå¤„ç† for ti in tis: if ti.key not in queued_tis and ti.key not in running: self.logger.debug("Rescheduling orphaned task &#123;&#125;".format(ti)) ti.state = State.NONE session.commit() é‡ç½®å­¤å„¿ä»»åŠ¡åˆ™æ˜¯è€ƒè™‘åœ¨è°ƒåº¦è¿‡ç¨‹å¯èƒ½å› ä¸ºå„ç§å¼‚å¸¸æƒ…å†µï¼Œå¦‚è°ƒåº¦å™¨è¿›ç¨‹çªç„¶ä¸­æ­¢æˆ–è€…æ²¡æœ‰æ²¡æœ‰æ‰§è¡Œå™¨æ‰§è¡Œä»»åŠ¡ï¼Œå°±ä¼šäº§ç”Ÿæ— æ³•ç»§ç»­æ‰§è¡Œçš„å­¤å„¿ä»»åŠ¡ï¼Œè¿™ç§ä»»åŠ¡å°†ä¼šåœ¨ä¸‹ä¸€æ¬¡è°ƒåº¦å‰è¿›è¡Œå›æ”¶å¹¶å†æ¬¡è°ƒåº¦ æ¥ä¸‹æ¥å°±è¿›å…¥schedulerJobäº†ï¼Œæˆ‘ä»¬ç›´æ¥æ¥çœ‹æ ¸å¿ƒæ–¹æ³• 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778 def _execute(self): self.logger.info("Starting the scheduler") # æ‰“å¼€é”ï¼Œå¯¹è¡¨è¿æ¥è¿›è¡Œç‹¬å  pessimistic_connection_handling() logging.basicConfig(level=logging.DEBUG) # dagå¯ä»¥è¢«ä¸€äº›æ‰§è¡Œå™¨pickleåºåˆ—åŒ–ï¼Œä»¥ä¾¿æ›´å®¹æ˜“åœ°è¿œç¨‹æ‰§è¡Œ pickle_dags = False if self.do_pickle and self.executor.__class__ not in \ (executors.LocalExecutor, executors.SequentialExecutor): pickle_dags = True # Use multiple processes to parse and generate tasks for the # DAGs in parallel. By processing them in separate processes, # we can get parallelism and isolation from potentially harmful # user code. # some log # Build up a list of Python files that could contain DAGs self.logger.info("Searching for files in &#123;&#125;".format(self.subdir)) # éå†ç›®å½•å¹¶æŸ¥æ‰¾pythonæ–‡ä»¶ known_file_paths = list_py_file_paths(self.subdir) self.logger.info("There are &#123;&#125; files in &#123;&#125;" .format(len(known_file_paths), self.subdir)) def processor_factory(file_path, log_file_path): return DagFileProcessor(file_path, pickle_dags, self.dag_ids, log_file_path)# æ ¸å¿ƒçš„æ–¹æ³•ï¼Œå¤„ç†dagï¼Œå°†æ–‡ä»¶è½¬æ¢æˆdag processor_manager = DagFileProcessorManager(self.subdir, known_file_paths, self.max_threads, self.file_process_interval, self.child_process_log_directory, self.num_runs, processor_factory) # æ‰§è¡Œè°ƒåº¦ try: self._execute_helper(processor_manager) finally: self.logger.info("Exited execute loop") # åˆ°è¿™é‡Œè°ƒåº¦ç»“æŸï¼Œæ€æ­»å­è¿›ç¨‹å¹¶é€€å‡º pids_to_kill = processor_manager.get_all_pids() if len(pids_to_kill) &gt; 0: # First try SIGTERM this_process = psutil.Process(os.getpid()) # åªæ£€æŸ¥å­è¿›ç¨‹ä»¥ç¡®ä¿å› ä¸ºå­è¿›ç¨‹æ­»äº¡ä½†æ˜¯è¿›ç¨‹IDè¢«é‡ç”¨å¯¼è‡´æ€æ­»é”™è¯¯è¿›ç¨‹çš„æƒ…å†µ child_processes = [x for x in this_process.children(recursive=True) if x.is_running() and x.pid in pids_to_kill] for child in child_processes: self.logger.info("Terminating child PID: &#123;&#125;".format(child.pid)) child.terminate() timeout = 5 self.logger.info("Waiting up to &#123;&#125;s for processes to exit..." .format(timeout)) # ç­‰å¾…è¿›ç¨‹è¢«ä¸­æ­¢ try: psutil.wait_procs(child_processes, timeout) except psutil.TimeoutExpired: self.logger.debug("Ran out of time while waiting for " "processes to exit") # Then SIGKILL child_processes = [x for x in this_process.children(recursive=True) if x.is_running() and x.pid in pids_to_kill] if len(child_processes) &gt; 0: for child in child_processes: self.logger.info("Killing child PID: &#123;&#125;".format(child.pid)) child.kill() child.wait() å¯ä»¥çœ‹åˆ°è°ƒåº¦çš„æµç¨‹æ˜¯ åŠ é”-&gt; è·å–è§£æåçš„dag -&gt; è°ƒåº¦ -&gt;è°ƒåº¦ç»“æŸæ€æ­»è¿›ç¨‹ å…³äºè§£ædagæˆ‘ä»¬å•ç‹¬æ”¾ä¸€ç¯‡å‡ºæ¥è®²ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥è¿›å…¥execute_helperä¸€æ¢ç©¶ç«Ÿ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146def _execute_helper(self, processor_manager): self.executor.start() session = settings.Session() self.logger.info("Resetting state for orphaned tasks") # grab orphaned tasks and make sure to reset their state active_runs = DagRun.find( state=State.RUNNING, external_trigger=False, session=session, no_backfills=True, ) for dr in active_runs: self.logger.info("Resetting &#123;&#125; &#123;&#125;".format(dr.dag_id, dr.execution_date)) self.reset_state_for_orphaned_tasks(dr, session=session) session.close() execute_start_time = datetime.now() # Last time stats were printed last_stat_print_time = datetime(2000, 1, 1) # Last time that self.heartbeat() was called. last_self_heartbeat_time = datetime.now() # Last time that the DAG dir was traversed to look for files last_dag_dir_refresh_time = datetime.now() # Use this value initially known_file_paths = processor_manager.file_paths # For the execute duration, parse and schedule DAGs while (datetime.now() - execute_start_time).total_seconds() &lt; \ self.run_duration or self.run_duration &lt; 0: self.logger.debug("Starting Loop...") loop_start_time = time.time() # Traverse the DAG directory for Python files containing DAGs # periodically elapsed_time_since_refresh = (datetime.now() - last_dag_dir_refresh_time).total_seconds() if elapsed_time_since_refresh &gt; self.dag_dir_list_interval: # Build up a list of Python files that could contain DAGs self.logger.info("Searching for files in &#123;&#125;".format(self.subdir)) known_file_paths = list_py_file_paths(self.subdir) last_dag_dir_refresh_time = datetime.now() self.logger.info("There are &#123;&#125; files in &#123;&#125;" .format(len(known_file_paths), self.subdir)) processor_manager.set_file_paths(known_file_paths) self.logger.debug("Removing old import errors") self.clear_nonexistent_import_errors(known_file_paths=known_file_paths) # Kick of new processes and collect results from finished ones self.logger.info("Heartbeating the process manager") simple_dags = processor_manager.heartbeat() if self.using_sqlite: # For the sqlite case w/ 1 thread, wait until the processor # is finished to avoid concurrent access to the DB. self.logger.debug("Waiting for processors to finish since we're " "using sqlite") processor_manager.wait_until_finished() # Send tasks for execution if available if len(simple_dags) &gt; 0: simple_dag_bag = SimpleDagBag(simple_dags) # Handle cases where a DAG run state is set (perhaps manually) to # a non-running state. Handle task instances that belong to # DAG runs in those states # If a task instance is up for retry but the corresponding DAG run # isn't running, mark the task instance as FAILED so we don't try # to re-run it. self._change_state_for_tis_without_dagrun(simple_dag_bag, [State.UP_FOR_RETRY], State.FAILED) # If a task instance is scheduled or queued, but the corresponding # DAG run isn't running, set the state to NONE so we don't try to # re-run it. self._change_state_for_tis_without_dagrun(simple_dag_bag, [State.QUEUED, State.SCHEDULED], State.NONE) self._execute_task_instances(simple_dag_bag, (State.SCHEDULED,)) # Call hearbeats self.logger.info("Heartbeating the executor") self.executor.heartbeat() # Process events from the executor self._process_executor_events() # Heartbeat the scheduler periodically time_since_last_heartbeat = (datetime.now() - last_self_heartbeat_time).total_seconds() if time_since_last_heartbeat &gt; self.heartrate: self.logger.info("Heartbeating the scheduler") self.heartbeat() last_self_heartbeat_time = datetime.now() # Occasionally print out stats about how fast the files are getting processed if ((datetime.now() - last_stat_print_time).total_seconds() &gt; self.print_stats_interval): if len(known_file_paths) &gt; 0: self._log_file_processing_stats(known_file_paths, processor_manager) last_stat_print_time = datetime.now() loop_end_time = time.time() self.logger.debug("Ran scheduling loop in &#123;:.2f&#125;s" .format(loop_end_time - loop_start_time)) self.logger.debug("Sleeping for &#123;:.2f&#125;s" .format(self._processor_poll_interval)) time.sleep(self._processor_poll_interval) # Exit early for a test mode if processor_manager.max_runs_reached(): self.logger.info("Exiting loop as all files have been processed " "&#123;&#125; times".format(self.num_runs)) break # Stop any processors processor_manager.terminate() # Verify that all files were processed, and if so, deactivate DAGs that # haven't been touched by the scheduler as they likely have been # deleted. all_files_processed = True for file_path in known_file_paths: if processor_manager.get_last_finish_time(file_path) is None: all_files_processed = False break if all_files_processed: self.logger.info("Deactivating DAGs that haven't been touched since &#123;&#125;" .format(execute_start_time.isoformat())) models.DAG.deactivate_stale_dags(execute_start_time) self.executor.end() settings.Session.remove() å†…å®¹æœ‰ç‚¹é•¿ï¼Œä¸»è¦å¯ä»¥åˆ†æˆè¿™å‡ éƒ¨åˆ† å¤„ç†å‰è°ƒåº¦çš„ç‰¹æ®Šæƒ…å†µ è°ƒåº¦å’Œè§£ædag æ‰§è¡Œtask-instance è°ƒåº¦ç»“æŸåå¤„ç† å…ˆçœ‹è°ƒåº¦å‰ 1234567891011121314151617181920212223242526272829self.executor.start() session = settings.Session() self.logger.info("Resetting state for orphaned tasks") # grab orphaned tasks and make sure to reset their state active_runs = DagRun.find( state=State.RUNNING, external_trigger=False, session=session, no_backfills=True, ) for dr in active_runs: self.logger.info("Resetting &#123;&#125; &#123;&#125;".format(dr.dag_id, dr.execution_date)) self.reset_state_for_orphaned_tasks(dr, session=session) session.close() execute_start_time = datetime.now() # Last time stats were printed last_stat_print_time = datetime(2000, 1, 1) # Last time that self.heartbeat() was called. last_self_heartbeat_time = datetime.now() # Last time that the DAG dir was traversed to look for files last_dag_dir_refresh_time = datetime.now() # Use this value initially known_file_paths = processor_manager.file_paths è¿™é‡Œä¼šé¦–å…ˆå¯»æ‰¾dag-runï¼Œdag-runæ˜¯dagæ¯æ¬¡æ‰§è¡Œç”Ÿæˆçš„å®ä¾‹ï¼Œé€šè¿‡dag-runæ¸…ç†ä¹‹å‰è°ƒåº¦å™¨é—ç•™ä¸‹æ¥çš„å­¤å„¿ä»»åŠ¡ é™¤äº†å­¤å„¿ä»»åŠ¡ï¼Œé¦–å…ˆçœ‹è°ƒåº¦å‰æœ‰å“ªäº›ä¾ç„¶æ­£å¸¸è¿è¡Œçš„ä»»åŠ¡ dag-runæœ‰æ•ˆåŒæ—¶task-instanceè¿˜åœ¨è°ƒåº¦ä¸­ï¼ˆschedueï¼‰ï¼Œè¿™äº›å¯ä»¥ç›´æ¥è¢«æœ¬æ¬¡è°ƒåº¦å›æ”¶ dag-runæœ‰æ•ˆåŒæ—¶task-instanceè¿˜åœ¨è¿›å…¥é˜Ÿåˆ—ä¸­ï¼ˆqueuedï¼‰ï¼Œè¿™äº›ä¼šè¢«é˜Ÿåˆ—å›æ”¶ å› ä¸º airflow2.0è°ƒåº¦å™¨éƒ¨åˆ†airflow2.0å› ä¸ºä½¿ç”¨python3ä½œä¸ºå¼€å‘è¯­è¨€ï¼Œå› æ­¤åœ¨æ¶æ„ä¸Šä½¿ç”¨äº†è®¸å¤šæ–°çš„ç‰¹æ€§ï¼ŒåŒæ—¶æ•´ä½“çš„æ–‡ä»¶ç»„ç»‡ç»“æ„ä¹Ÿå‘ç”Ÿäº†è¾ƒå¤§çš„å˜åŒ–]]></content>
      <categories>
        <category>æŠ€æœ¯æ¢ç´¢</category>
      </categories>
      <tags>
        <tag>airflow</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[nvmå®‰è£…è®°å½•]]></title>
    <url>%2F2021%2F11%2F21%2Fnvmfirst%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘æ–°è£…äº†ä¸€å°PCï¼Œå› æ­¤éœ€è¦åŒæ­¥åšå®¢æ¡†æ¶ã€‚ç„¶è€Œæ—¶é—´è¿‡å»å¤ªä¹…ï¼Œæ–°å®‰è£…çš„nodejs16ç‰ˆæœ¬å¤ªé«˜ï¼Œhexoæš‚æ—¶æ— æ³•æ”¯æŒï¼Œæ²¡åŠæ³•ï¼Œåªèƒ½é€‰æ‹©å¯»æ‰¾ä¸€ä¸ªnodejsçš„ç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼Œæ¥å®ç°nodejsçš„ç‰ˆæœ¬åˆ‡æ¢ã€‚ å®‰è£…ä»‹ç»é¦–å…ˆä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯nvm: nvmå…¨ånode.js version managementï¼Œæ˜¯ä¸€ä¸ªnodejsçš„ç‰ˆæœ¬ç®¡ç†å·¥å…·ã€‚è¿™é‡Œæ˜¯ä¸‹è½½åœ°å€,windowså°±ç›´æ¥ç”¨setupç‰ˆæœ¬æœ€æ–¹ä¾¿äº†ï¼Œä¼šè‡ªåŠ¨æ³¨å…¥ç¯å¢ƒå˜é‡ã€‚ å¦‚æœä½ çš„ç”µè„‘é‡Œå·²ç»è£…äº†nodejsï¼Œä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œè‡³å°‘æœ€æ–°ç‰ˆçš„nvmä¼šè‡ªåŠ¨æ£€æµ‹å¹¶å°†ä½ ç”µè„‘é‡Œçš„nodejsåŠ å…¥è‡ªå·±çš„ç®¡ç†èŒƒå›´å†…ï¼Œä½†æ˜¯è€ƒè™‘åˆ°ç¯å¢ƒå˜é‡å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæœ€å¥½è¿˜æ˜¯åœ¨å¹²å‡€çš„ç¯å¢ƒä¸Šä»é›¶å¼€å§‹è£…ã€‚ æ³¨æ„nvmç®¡ç†çš„æ˜¯nodejsç‰ˆæœ¬ï¼Œnpmä¾ç„¶ä¼šä½¿ç”¨é»˜è®¤çš„ã€‚å¦‚æœæ˜¯ä»nvmä¸­å®‰è£…çš„nodejsï¼Œé»˜è®¤çš„npmå°†æ˜¯ä½ ç¬¬ä¸€ä¸ªå®‰è£…çš„nodejsé™„å¸¦ å®‰è£…è¿‡ç¨‹éå¸¸ç®€å• è¿™é‡Œæ˜¯nvmä¸»è¦çš„å®‰è£…ä½ç½®ï¼Œä¼šæ”¾ç½®æ ¸å¿ƒçš„ç»„ä»¶å’Œå®‰è£…çš„nodejsåŒ… è¿™é‡Œçš„è·¯å¾„æ˜¯é€‰æ‹©å¯åŠ¨çš„nodejsåŒ…ï¼Œå®é™…ä¸Šé€šè¿‡ä¸€ä¸ªå¿«æ·æ–¹å¼é“¾æ¥å¾—åˆ°ã€‚ å®‰è£…å®Œæˆä¹‹åè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œå¦‚æœè·å¾—æ­£ç¡®ç‰ˆæœ¬å·è¯´æ˜å®‰è£…æˆåŠŸ 1nvm --version å®‰è£…å®Œånvmçš„ç›®å½•ç»“æ„å¦‚å›¾ æ³¨æ„ä¸Šé¢çš„æ–‡ä»¶å¤¹å°±æ˜¯å…·ä½“ä¸‹è½½å®‰è£…çš„nodejsåŒ… å†æ¬¡æé†’å¦‚æœä½ åœ¨nvmå®‰è£…ä¹‹å‰å·²ç»å®‰è£…nodejsï¼Œä»–çš„ä¸»ä½“å°±ä¼šè¢«ç§»åŠ¨åˆ°è¿™é‡Œï¼Œè¿™æ—¶æœ€å¥½å†æ¬¡æ£€æŸ¥ä¸€ä¸‹ç¯å¢ƒå˜é‡æ˜¯å¦è¿˜èƒ½æ­£å¸¸ç”Ÿæ•ˆ æ¥ä¸‹æ¥å°±æ˜¯ç®€å•çš„å®‰è£…é…ç½®ç¯å¢ƒï¼Œåˆ—ä¸€ä¸‹å‘½ä»¤æ¸…å•å³å¯ 1234567891011121314151617181920212223# è¿™é‡Œæ˜¯å¸¸è§å‘½ä»¤nvm list #æŸ¥çœ‹å·²ç»å®‰è£…çš„ç‰ˆæœ¬nvm list installed # æŸ¥çœ‹å·²ç»å®‰è£…çš„ç‰ˆæœ¬nvm list available # æŸ¥çœ‹ç½‘ç»œå¯ä»¥å®‰è£…çš„ç‰ˆæœ¬nvm version # æŸ¥çœ‹å½“å‰çš„ç‰ˆæœ¬nvm install # å®‰è£…æœ€æ–°ç‰ˆæœ¬nvmnvm use &lt;version&gt; ## åˆ‡æ¢ä½¿ç”¨æŒ‡å®šçš„ç‰ˆæœ¬nodenvm ls # åˆ—å‡ºæ‰€æœ‰ç‰ˆæœ¬nvm current #æ˜¾ç¤ºå½“å‰ç‰ˆæœ¬nvm uninstall &lt;version&gt; # å¸è½½åˆ¶å®šçš„ç‰ˆæœ¬# è¿™é‡Œæ˜¯å…¶ä»–çš„å‘½ä»¤nvm alias &lt;name&gt; &lt;version&gt; ## ç»™ä¸åŒçš„ç‰ˆæœ¬å·æ·»åŠ åˆ«ånvm unalias &lt;name&gt; ## åˆ é™¤å·²å®šä¹‰çš„åˆ«ånvm reinstall-packages &lt;version&gt; ## åœ¨å½“å‰ç‰ˆæœ¬nodeç¯å¢ƒä¸‹ï¼Œé‡æ–°å…¨å±€å®‰è£…æŒ‡å®šç‰ˆæœ¬å·çš„npmåŒ…nvm on # æ‰“å¼€`nodejs`æ§åˆ¶nvm off # å…³é—­`nodejs`æ§åˆ¶nvm proxy # æŸ¥çœ‹è®¾ç½®ä¸ä»£ç†nvm node_mirror [url] # è®¾ç½®æˆ–è€…æŸ¥çœ‹setting.txtä¸­çš„node_mirrorï¼Œå¦‚æœä¸è®¾ç½®çš„é»˜è®¤æ˜¯ https://`nodejs`.org/dist/nvm npm_mirror [url] # è®¾ç½®æˆ–è€…æŸ¥çœ‹setting.txtä¸­çš„npm_mirror,å¦‚æœä¸è®¾ç½®çš„è¯é»˜è®¤çš„æ˜¯ï¼š https://github.com/npm/npm/archive/.nvm use [version] [arch] # åˆ‡æ¢åˆ¶å®šçš„nodeç‰ˆæœ¬å’Œä½æ•°nvm root [path] # è®¾ç½®å’ŒæŸ¥çœ‹rootè·¯å¾„ å¦‚æœæ­£å¸¸å®‰è£…ç”Ÿæ•ˆçš„é€šè¿‡nvm ls å°±å¯ä»¥çœ‹åˆ°æ•ˆæœï¼š å¸¸è§é—®é¢˜1.ä¹‹å‰å·²å­˜åœ¨çš„nodejså®‰è£…nvmä¹‹åæ— æ³•ä½¿ç”¨ä¸€èˆ¬éƒ½æ˜¯è·¯å¾„é—®é¢˜ï¼Œå¸¸è§æ–¹æ³• æ£€æŸ¥ç¯å¢ƒå˜é‡ åœ¨Cç›˜çš„ç”¨æˆ·åæ–‡ä»¶å¤¹ä¸‹åˆ é™¤.npmrcï¼Œå®é™…å°±æ˜¯ç±»ä¼¼äºåˆ é™¤ç¼“å­˜ å¦‚æœæ— æ³•è§£å†³é—®é¢˜å†å…·ä½“çœ‹æŠ¥é”™ä¿¡æ¯å…·ä½“åˆ†æ 2.nvmè¿è¡Œuseå‘½ä»¤æ—¶æŠ¥é”™exit status 1: ï¿½ï¿½Ã»ï¿½ï¿½ï¿½ã¹»ï¿½ï¿½È¨ï¿½ï¿½Ö´ï¿½Ğ´Ë²ï¿½ï¿½ï¿½ï¿½ï¿½ ä¸»è¦æ˜¯ç®¡ç†å‘˜æƒé™çš„é—®é¢˜ï¼Œå¦‚æœå®‰è£…æ–‡ä»¶å¤¹éœ€è¦ç®¡ç†å‘˜æƒé™ï¼Œæ‰§è¡Œçš„cmdåˆæ²¡æœ‰ç®¡ç†å‘˜æ¨¡å¼ï¼Œå°±ä¼šå‡ºç°è¿™æ ·çš„é—®é¢˜ è§£å†³æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œç”¨ç®¡ç†å‘˜æ–¹å¼æ‰§è¡Œcmdæˆ–è€…å®‰è£…çš„æ—¶å€™æ³¨æ„ä¸è¦å®‰è£…åˆ°ç®¡ç†å‘˜æƒé™çš„ç›®å½•ä¸­å³å¯]]></content>
      <categories>
        <category>å­¦ä¹ ç¬”è®°</category>
      </categories>
      <tags>
        <tag>nvm</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ­å»ºä¸€ä¸ªå…³ç¯ç¥å™¨]]></title>
    <url>%2F2021%2F11%2F21%2Fsmart-switch%2F</url>
    <content type="text"><![CDATA[è‡ªä»ç§Ÿæˆ¿ä¹‹åï¼Œç”Ÿæ´»ç¯å¢ƒå‘ç”Ÿäº†å¾ˆå¤§çš„å˜åŒ–ã€‚å…¶å®å¤§éƒ¨åˆ†çš„å˜åŒ–æˆ‘å°šä¸”è¿˜ç®—æ»¡æ„ï¼Œä½†æ¯å½“æ™šä¸Šèººåœ¨åºŠä¸Šç©æ‰‹æœºçš„æ—¶å€™ï¼Œå½“å›°æ„è¢­æ¥æ—¶ï¼Œå¿ƒé‡Œæ€»æ˜¯éå¸¸éƒé—·ï¼šæˆ‘åœ¨è¿™è¾¹ï¼Œç¯çš„å¼€å…³åœ¨åºŠçš„é‚£è¾¹ã€‚æ²¡åŠæ³•ï¼Œåªå¾—å†åº¦ä¸‹åºŠå…³ç¯ï¼Œå†æ‘¸é»‘çˆ¬ä¸ŠåºŠâ€”â€”æ­¤æ—¶ç¡æ„æ—©å·²æ¶ˆå¤±ï¼ˆå¤§å“­ äºæ˜¯ï¼Œæˆ‘æƒ³åˆ°äº†å…³ç¯ç¥å™¨â€”â€”è¿œç¨‹æ“æ§å¼€å…³å…³ç¯ã€‚ æ–¹æ¡ˆè®¾è®¡å› ä¸ºåªæ˜¯æƒ³åšä¸€ä¸ªè§£æ”¾åŒæ‰‹çš„å°ç©å…·ï¼Œè‡ªç„¶æ²¡æœ‰æ‰“ç®—åšçš„éå¸¸å¤æ‚ã€‚é‰´äºå®¶é‡Œçš„å¼€å…³è®¾è®¡ï¼ˆå¦‚ä¸‹å›¾ï¼‰ï¼Œåªéœ€è¦ä¸€ä¸ªå¯ä»¥é€šç”µå·¦å³æ‘‡æ‘†çš„èˆµæœºå³å¯ï¼Œç»™äºˆä¸€å®šçš„ç”µä¿¡å·ï¼Œå°±ç‰©ç†æ§åˆ¶å¼€å…³ä¸Šä¸‹æ‹¨åŠ¨ æ–¹æ¡ˆå¾ˆç®€å•ï¼Œåªéœ€è¦ä¸€å—å•ç‰‡æœºå’Œä¸€ä¸ªèˆµæœºå°±å¯ä»¥ï¼Œè€ƒè™‘åˆ°æ‹¨åŠ¨å¼€å…³æ‰€éœ€çš„å¼ºåº¦ï¼Œå¦‚æœå¼€å…³å¾ˆç¡¬å¯ä»¥è€ƒè™‘æä¾›é¢å¤–çš„ç”µæºä¾›ç”µæ¥ä¿æŒèˆµæœºè¾“å‡ºåŠŸç‡ã€‚å¥½åœ¨å®¶é‡Œçš„å¼€å…³è¿˜ç®—å¬è¯ï¼ˆå‹‰å¼ºåˆšåˆšå¥½ï¼Œé¬¼çŸ¥é“æˆ‘è°ƒæ•´äº†å¤šå°‘æ¬¡è§’åº¦å’Œé«˜åº¦ï¼‰ï¼Œè¿™æ¬¡å°±ä¸é¢å¤–æ·»åŠ é…ä»¶äº†ã€‚ å‚è€ƒBç«™çš„è¯¸å¤šâ€å…³ç¯ç¥å™¨â€è§†é¢‘, è¿™é‡Œå•ç‰‡æœºé€‰ç”¨äº†esp8266ï¼Œç±»ä¼¼ä¸‹å›¾ èˆµæœºåˆ™æ˜¯ä½¿ç”¨äº†sg90ï¼š æ€»æˆæœ¬ä¸åˆ°20å…ƒâ€¦ (Ps:ç½‘ä¸Šæ·˜å®ç°æˆçš„å¼€å…³ç¥å™¨æ¢ä¸ªé©¬ç”²ï¼Œå¤šè£…ä¸ªæ¨¡å—å°±èƒ½å–ç™¾æ¥å—â€¦å¯è§å…¶ä¸­çš„åˆ©æ¶¦ç©ºé—´ï¼Œå’±ä»¬ç†å·¥ç”·å¯ä¸èƒ½è¢«è¿™ç§éª—äº†é’±å»~) å‰©ä¸‹å°±æ˜¯æ§åˆ¶æ–¹æ¡ˆ å¸¸è§çš„å¿…ç„¶æ˜¯æ‰‹æœºappæ§åˆ¶ï¼Œè¿™é‡Œå¿…é¡»å€ŸåŠ©ç¬¬ä¸‰æ–¹æä¾›ï¼Œè‡ªå·±å†™appä¹Ÿä¸æ˜¯ä¸å¯ä»¥ï¼Œä¸»è¦æ˜¯ä¸æƒ³å¾’å¢å­¦ä¹ æˆæœ¬ï¼ˆè¯´ç™½äº†è¿˜æ˜¯æ‡’ğŸ˜‚ï¼‰ï¼Œè¿æ¥æ–¹æ³•æœ‰è“ç‰™ã€WiFiï¼Œè¿™é‡Œå¯ä»¥çœ‹è‡ªå·±çš„å¼€å‘æ¿éœ€æ±‚ã€‚ å…·ä½“å®ç°æ—¢ç„¶æå®šäº†æ–¹æ¡ˆï¼Œæ¥ä¸‹æ¥è¿›è¡Œå®è·µç¯èŠ‚ï¼ ç¡¬ä»¶å®ç°ç¡¬ä»¶æ–¹é¢å¾ˆç®€å•ï¼Œæ³¨æ„çœ‹å–å®¶ç»™çš„å¼•è„šå›¾ä¸è¦æ’é”™å³å¯ã€‚ æ³¨æ„è§‚å¯Ÿï¼Œå¦‚æœå‘ç°çº¿åºä¸å¯¹ï¼Œå¯èƒ½éœ€è¦è‡ªå·±æ‹†ä¸‹èˆµæœºçš„çº¿æå›ºå®šå™¨æ›´æ”¹çº¿åºã€‚è¿æ°”å¾ˆå¥½ï¼Œæˆ‘ä¹°çš„ä¸éœ€è¦ï¼Œå°±ç›´æ¥æ’ä¸Šè¿PCå°±è¡Œäº† è½¯ä»¶å®ç°è¿™é‡Œéœ€è¦ç”¨åˆ°è½¯ä»¶å’Œå®‰è£…åŒ…å¦‚ä¸‹ 8266å¼€å‘æ¿çš„é…ç½®åŒ… å¼€å‘æ¿å¼€å‘è½¯ä»¶ blinkç”µç¯ç§‘æŠ€ç¬¬ä¸‰æ–¹åº”ç”¨çš„é€‚é…åº“æ–‡ä»¶ COMä¸²å£é©±åŠ¨ å®‰è£…arduinoé¦–å…ˆå®‰è£…arduinoï¼Œç›´æ¥æ— è„‘nextå³å¯ å®‰è£…å®Œæˆåæ‰“å¼€arduinoï¼Œç•Œé¢å¦‚å›¾ï¼š å¯¼å…¥ESP8266é…ç½®åŒ…é¦–å…ˆæ‰“å¼€Arduino IDEèœå• &gt; æ–‡ä»¶ &gt;é¦–é€‰é¡¹ï¼Œåœ¨ é™„åŠ å¼€å‘æ¿ç®¡ç†å™¨ç½‘å€ è¾“å…¥æ¡†ä¸­ï¼Œå¡«å…¥ä»¥ä¸‹ç½‘å€ï¼šhttps://www.arduino.cn/package_esp8266com_index.json ç„¶åç‚¹å‡»æ–‡ä»¶å¤¹ä¸­çš„é…ç½®åŒ…ï¼š å¯¼å…¥é…ç½®ã€‚ å®‰è£…ä¸‰æ–¹åº“æ–‡ä»¶ æ·»åŠ åº“ä¸­æ·»åŠ blinker-library-0.3.80210803.zip é…ç½®å¼€å‘æ¿æ¥ä¸‹æ¥æ–°å»ºæ–‡ä»¶-&gt; ä¿å­˜ä¸€ä¸‹ -&gt;å¦‚ä¸‹å›¾é…ç½®å¼€å‘æ¿ä¿¡æ¯ å¦‚æœæ²¡æœ‰8266å¼€å‘é€‰é¡¹ï¼Œå¦‚ä¸‹å›¾ï¼Œæœç´¢8266ï¼Œå®‰è£…ä¸Šå›¾å¯¹åº”module æ¥ä¸‹æ¥å°±æ˜¯ç¼–å†™ä»£ç ,è¿™è¾¹å·²ç»æä¾›å¥½äº†ä¸€ä¸ªæ¨¡æ¿ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394#define BLINKER_WIFI#define BLINKER_MIOT_LIGHT#include &lt;Blinker.h&gt;#include &lt;Servo.h&gt;Servo myservo;//å®šä¹‰èˆµæœºchar auth[] = "xxxxxxxx"; //ç‚¹ç¯Keychar ssid[] = "SELF-WIFI"; //wifiåç§°char pswd[] = "password"; //wifiå¯†ç // æ–°å»ºç»„ä»¶å¯¹è±¡ï¼Œæ³¨æ„è¿™é‡Œçš„åç§°è¦å’Œç”µç¯ç§‘æŠ€appé‡Œä¿æŒä¸€è‡´BlinkerButton Button1("test");int counter = 0;//æ³¨æ„å¦‚æœæ¥å…¥å°çˆ±åŒå­¦ï¼Œå…¶ç›‘å¬çš„å°±æ˜¯è¿™ä¸ªç”µæºäº‹ä»¶void miotPowerState(const String &amp; state)//ç”µæºç±»æ“ä½œ&#123; BLINKER_LOG("need set power state: ", state); if (state == BLINKER_CMD_ON) &#123; myservo.write(150);//æ”¶åˆ°â€œonâ€çš„æŒ‡ä»¤åèˆµæœºæ—‹è½¬150åº¦ BlinkerMIOT.powerState("on"); BlinkerMIOT.print();//åé¦ˆçŠ¶æ€ delay(1000);//å»¶æ—¶1ç§’ myservo.write(90);//èˆµæœºå½’é›¶ï¼Œå›åˆ°å‚ç›´çŠ¶æ€ &#125; else if (state == BLINKER_CMD_OFF) &#123; myservo.write(30); //èˆµæœºåè½¬30Â° BlinkerMIOT.powerState("off"); BlinkerMIOT.print(); delay(1000); myservo.write(90); &#125;&#125;// æŒ‰ä¸‹æŒ‰é”®å³ä¼šæ‰§è¡Œè¯¥å‡½æ•°void button1_callback(const String &amp; state)&#123; BLINKER_LOG("get button state: ", state); if (state=="on") &#123; myservo.write(170);//æ”¶åˆ°â€œonâ€çš„æŒ‡ä»¤åèˆµæœºæ—‹è½¬150 delay(1000);//å»¶æ—¶ myservo.write(90);//èˆµæœºå½’é›¶å‚ç›´ &#125; else if(state=="press"||state=="tap") &#123; myservo.write(10);//é•¿æŒ‰å¼€å…³æŒ‰é”®åèˆµæœºæ—‹è½¬10 delay(1000);//å»¶æ—¶ myservo.write(90);//èˆµæœºå½’é›¶å‚ç›´(90åº¦) &#125; &#125;// å¦‚æœæœªç»‘å®šçš„ç»„ä»¶è¢«è§¦å‘ï¼Œåˆ™ä¼šæ‰§è¡Œå…¶ä¸­å†…å®¹void dataRead(const String &amp; data)&#123; BLINKER_LOG("Blinker readString: ", data); counter++; &#125;void setup()&#123; // åˆå§‹åŒ–ä¸²å£ Serial.begin(115200); BLINKER_DEBUG.stream(Serial); // åˆå§‹åŒ–èˆµæœº myservo.attach(2);//èˆµæœºçš„IOå£ï¼Œnodemcuçš„D4å£ myservo.write(90);//ä¸Šç”µæ—¶èˆµæœºå½’é›¶å‚ç›´ BlinkerMIOT.attachPowerState(miotPowerState); // åˆå§‹åŒ–blinker Blinker.begin(auth, ssid, pswd); Blinker.attachData(dataRead); Button1.attach(button1_callback);&#125;void loop() &#123; BLINKER_LOG("Blinked running..."); Blinker.run();&#125; æ¥ä¸‹æ¥ï¼Œåªéœ€è¦ç‚¹å‡»å·¦ä¸Šè§’ç¼–è¯‘é€šè¿‡å°±å®Œæˆäº†ã€‚ å¦‚æœç¼–è¯‘æ²¡æœ‰é—®é¢˜ï¼Œæ¥ä¸‹æ¥å°±éœ€è¦å°†ç¨‹åºä¸Šä¼ åˆ°å¼€å‘æ¿ä¸Šã€‚é¦–å…ˆæ³¨æ„ä¸‹å›¾ç«¯å£ï¼Œç»è¿‡ä¹‹å‰å®‰è£…comç«¯å£é©±åŠ¨ï¼Œç†è®ºä¸Šè¿™è¾¹ç«¯å£å¯ä»¥æ­£å¸¸æ˜¾ç¤º å¦‚æœä¸èƒ½ï¼ŒæŸ¥çœ‹è®¾å¤‡ç®¡ç†å™¨çœ‹æ˜¯å¦ç«¯å£æ­£å¸¸æ˜¾ç¤ºã€‚ å®‰è£…APPè¿˜è®°å¾—ä»£ç é‡Œçš„keyå—ï¼Ÿæ¥ä¸‹æ¥å°±æ˜¯ä¸‹è½½ç”µç¯ç§‘æŠ€APPå¹¶ç”³è¯·key ä¸€èˆ¬åº”ç”¨å¸‚åœºéƒ½æœ‰ï¼Œå¦‚æœæ²¡æœ‰çš„è¯å¯ä»¥å»å®˜ç½‘ä¸‹. æ³¨å†Œè®¾å¤‡ä¸‹è½½å¹¶æ³¨å†Œç‚¹ç¯ç§‘æŠ€è´¦å·ä¹‹åï¼Œåœ¨å³ä¸Šè§’åŠ å·-&gt;ç‹¬ç«‹è®¾å¤‡-&gt; ç½‘ç»œæ¥å…¥ ä¸€èˆ¬æ¨èé˜¿é‡Œäº‘ æ¥å…¥ï¼Œä½†æ˜¯æˆ‘ç›®å‰çš„ç‰ˆæœ¬åªèƒ½æ¥å…¥ç‚¹ç¯ç§‘æŠ€æœåŠ¡ï¼Œå®æµ‹æ— è®ºæ˜¯æ§åˆ¶è¿˜æ˜¯æ¥å…¥å°çˆ±åŒå­¦éƒ½æ²¡æœ‰å½±å“ï¼Œè¿™é‡Œå°±çœ‹å¤§å®¶é€‰æ‹©ã€‚ å®Œæˆè®¾å¤‡æ³¨å†Œåå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè¿™æ—¶ä½ ä¼šè·å–ä¸€ä¸ªkeyï¼Œå¡«å…¥ä»£ç ä¸­å³å¯ã€‚ å¼€å‘ç•Œé¢è¿™é‡Œå¤§å®¶å°±å¯ä»¥æŒ‰ç…§ä»£ç ä¸­å‘ä¿¡æŒ‡å¼•è‡ªå·±åˆ¶ä½œå¼€å…³ç•Œé¢ã€‚æˆ‘è¿™è¾¹åœ¨ç½‘ä¸Šæ‰¾åˆ°ä¸€ä»½ç®€å•çš„ç•Œé¢é…ç½®æ–‡ä»¶ 1&#123;Â¨configÂ¨&#123;Â¨headerColorÂ¨Â¨transparentÂ¨Â¨headerStyleÂ¨Â¨darkÂ¨Â¨backgroundÂ¨&#123;Â¨imgÂ¨Â¨assets/img/headerbg.jpgÂ¨Â¨isFullÂ¨Â«&#125;&#125;Â¨dashboardÂ¨|&#123;Â¨typeÂ¨Â¨btnÂ¨Â¨icoÂ¨Â¨fad fa-lightbulb-onÂ¨Â¨modeÂ¨ÃŠÂ¨t0Â¨Â¨å¼€ç¯Â¨Â¨t1Â¨Â¨æ–‡æœ¬2Â¨Â¨bgÂ¨ÃŒÂ¨colsÂ¨ÃÂ¨rowsÂ¨ÃÂ¨keyÂ¨Â¨testÂ¨Â´xÂ´Ã‹Â´yÂ´ÃŒÂ¨speechÂ¨|Ã·Â¨cusÂ¨Â¨onÂ¨Â¨lstyleÂ¨Ã‹Â¨clrÂ¨Â¨#076EEFÂ¨&#125;&#123;ÃŸAÃŸBÃŸCÂ¨fad fa-lightbulbÂ¨ÃŸEÃ‰ÃŸFÂ¨å…³ç¯Â¨ÃŸHÃŸIÃŸJÃŒÃŸKÃÃŸLÃÃŸMÃŸNÂ´xÂ´Ã‹Â´yÂ´Ã‘ÃŸO|Ã·ÃŸRÃ‹ÃŸSÃŸT&#125;&#123;ÃŸAÂ¨debÂ¨ÃŸEÃ‰ÃŸJÃ‰ÃŸKÃ‘ÃŸLÃŒÃŸMÂ¨debugÂ¨Â´xÂ´Ã‰Â´yÂ´Â¤D&#125;Ã·Â¨actionsÂ¨|Â¦Â¨cmdÂ¨Â¦Â¨switchÂ¨â€¡Â¨textÂ¨â€¡ÃŸQÂ¨æ‰“å¼€?nameÂ¨Â¨offÂ¨Â¨å…³é—­?nameÂ¨â€”Ã·Â¨triggersÂ¨|&#123;Â¨sourceÂ¨ÃŸaÂ¨source_zhÂ¨Â¨å¼€å…³çŠ¶æ€Â¨Â¨stateÂ¨|ÃŸQÃŸdÃ·Â¨state_zhÂ¨|Â¨æ‰“å¼€Â¨Â¨å…³é—­Â¨Ã·&#125;Ã·&#125; å°†è¿™ä»½æ–‡ä»¶å¯¼å…¥åˆ°é…ç½®ä¿¡æ¯å³å¯ã€‚ï¼ˆä¸Šé¢çš„ä¹±ç æ˜¯çœŸçš„ï¼ˆæ±—ï¼‰ï¼‰ å¯¼å…¥åé…ç½®å¦‚ä¸‹ï¼š æ¥ä¸‹æ¥å°±å¯ä»¥è‡ªå·±æ“æ§æŸ¥çœ‹é…ç½®æƒ…å†µäº†ã€‚ æ¥å…¥å°çˆ±åŒå­¦æ¥å…¥å°çˆ±åŒå­¦å…¶å®å¾ˆç®€å•ï¼Œå°±çœ‹ç¬¬ä¸‰æ–¹æœåŠ¡æ–¹æä¸æä¾›æ”¯æŒ ç±³å®¶-&gt;æ¥å…¥å…¶ä»–è®¾å¤‡-&gt;ç‚¹ç¯ç§‘æŠ€-&gt;åŒæ­¥é…ç½®å³å¯ è®¾å¤‡å®‰è£…è¿™ä¸€æ­¥åœ¨å®é™…æ“ä½œä¸­åå€’æ˜¯æœ€éš¾çš„ï¼Œå› ä¸ºæ¯ä¸ªäººæƒ…å†µä¸åŒï¼ŒæŒ‰é’®çš„å¼ºåº¦ä¹Ÿä¸ä¸€æ ·ï¼Œæˆ‘ä¸€å¼€å§‹è¿˜æ˜¯éå¸¸æ‹…å¿ƒèˆµæœºçš„åŠŸç‡å¯èƒ½ä¸è¶³ä»¥æ‹¨åŠ¨å¼€å…³çš„ã€‚å®é™…ä¸Šç¡®å®åœ¨å°è¯•äº†å¾ˆå¤šè§’åº¦ä¹‹åæ€»æ˜¯æ— æ³•æˆåŠŸå®ç°ã€‚ æ›¾ç»å°è¯•è¿‡ç»™èˆµæœºæ‰‡å¶è¿›è¡Œå»¶é•¿å¢å¤§æ¥è§¦é¢ç§¯ï¼Œä½†æ˜¯è¿™äº›æ–¹æ¡ˆæœ€ç»ˆæ²¡æœ‰ä¸€ä¸ªå¾ˆå¥½çš„å®ç°ã€‚æœ€åæˆ‘å°è¯•å›å½’èµ·ç‚¹ï¼Œé€šè¿‡å«é«˜èˆµæœºï¼Œä½¿å¾—æ‰‡å¶å’Œå¼€å…³äº§ç”Ÿä¸€å®šçš„é—´éš”ï¼Œè¿™æ ·åœ¨æ‰‡å¶æ—‹è½¬çš„æ—¶å€™ï¼Œä¼šæœ‰ä¸€ä¸ªæƒ¯æ€§è¾…åŠ©ç”¨åŠ›ã€‚æ¥ç€ä½¿ç”¨çº¸æ¿å’Œ502å°†èˆµæœºå›ºå®šï¼Œå¹¶ç”¨é€æ˜èƒ¶åœ¨å¤–å±‚è¿›è¡ŒäºŒæ¬¡è¾…åŠ©å›ºå®šï¼Œæœ€ç»ˆæ€»ç®—å®ç°äº†å¼€å…³çš„æ­£å¸¸æ‹¨åŠ¨ï¼ˆè™½ç„¶æœ‰çš„æ—¶å€™è¿˜æ˜¯ä¸å¤ªçµæ•ï¼‰ æœ€ç»ˆå®ç°å›¾å¦‚ä¸‹ï¼š æ•ˆæœè¿™é‡Œç»™å‡ºä¸€ä¸ªé“¾æ¥]]></content>
      <categories>
        <category>ä¸€å¦‚æ—¢å¾€ï¼Œåªæ˜¯æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>å•ç‰‡æœº</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JVMè°ƒè¯•çš„ä¸€æ¬¡ç»å†]]></title>
    <url>%2F2021%2F11%2F07%2Fjvm-commands%2F</url>
    <content type="text"><![CDATA[var ap = new APlayer({ element: document.getElementById("aplayer-elXEyvbp"), narrow: false, autoplay: false, showlrc: false, music: { title: "å°‘å¹´å°‘å¥³", author: "é“¶æBOYZ", url: "https://sharefs.ali.kugou.com/202111211220/2e649d44aa9f0a556b475deead519772/KGTX/CLTX001/9073bdd808ac142de731f73d28aa9f74.mp3", pic: "http://y.qq.com/music/photo_new/T002R300x300M000002fLaUt1Pydsn_2.jpg?max_age=2592000", lrc: "" } }); window.aplayers || (window.aplayers = []); window.aplayers.push(ap); åƒæ˜¯ç»å†äº†ä¸€æ¬¡æ¼‚æµï¼Œæœ€ç»ˆä¾ç„¶è¦é€‰æ‹©å›å½’ç°å® è®°å½•ä¸€æ¬¡å·¥ä½œä¸­é‡åˆ°çš„GCåˆ†é…å¤±è´¥é—®é¢˜ ä¹‹å‰åœ¨å·¥ä½œä¸­é‡åˆ°ä¸€æ¬¡IOå ç”¨å¼‚å¸¸çš„æƒ…å†µï¼Œé€šè¿‡iotopæŸ¥çœ‹IOå ç”¨æœ€é«˜çš„è¿›ç¨‹ï¼Œå‘ç°éƒ½æ˜¯ä¸šåŠ¡ç›¸å…³çš„javaè¿›ç¨‹,äºæ˜¯é€šè¿‡æŸ¥é˜…gc.logå‘ç°äº†ç±»ä¼¼å¦‚ä¸‹çš„å¼‚å¸¸ï¼ˆå›¾æºç½‘ç»œï¼Œå½“åœºåœºæ™¯å·²ä¸å¯å¤ç°, å½“æ—¶åœºæ™¯ä¸ä¸‹å›¾å‡ ä¹ç±»ä¼¼ï¼‰ é—®é¢˜æœ€å…³é”®çš„æ˜¯å¼‚å¸¸ä¸€ç›´åœ¨è¾“å‡ºï¼Œè¿™è®©äººä¸ç”±å¾—æ€€ç–‘ä¸šåŠ¡é€»è¾‘ä¸­å­˜åœ¨çš„é—®é¢˜ï¼Œäº‹å®ä¸Šï¼Œé€šè¿‡è¿™äº›ï¼Œå¯¼è‡´é—®é¢˜çš„åŸå› å…¶å®å·²ç»èƒ½æ¯”è¾ƒå®¹æ˜“å°±èƒ½è”æƒ³åˆ°ï¼Œä½†æ˜¯ï¼Œæœ¬ç€åŠ¡å®æ±‚çœŸï¼ˆå¤§é›¾ï¼‰çš„æ€åº¦ï¼Œè¿˜æ˜¯è¦ç»†ç»†äº†è§£å…¶ä¸­å‡ºç°çš„ä¸ªä¸­ç¼˜ç”± åŸºç¡€æ¦‚å¿µæ—¢ç„¶çœ‹åˆ°äº†å†…å­˜åˆ†é…çš„å­—æ ·ï¼Œæˆ‘ä»¬é¦–å…ˆè‡ªç„¶å¾—å…ˆå¤ä¹ ä¸€ä¸‹JVMå†…å­˜åˆ†é…çš„åŸºç¡€æ¦‚å¿µã€‚ æˆ‘ä»¬çŸ¥é“ï¼ŒJVMä¸­é‡‡ç”¨åˆ†ä»£çš„å†…å­˜åˆ†é…ç­–ç•¥ï¼Œå°†javaå †åˆ†æˆäº†æ–°ç”Ÿä»£ï¼Œè€å¹´ä»£ã€‚ä»”ç»†åˆ†çš„è¯ï¼Œæ–°ç”Ÿä»£åˆèƒ½åˆ†æˆedenåŒºå’ŒsurvivoråŒºï¼ˆåˆ†ä¸º0å’Œ1ä¸¤ä¸ªåŒºåŸŸï¼Œè¿™ä¹Ÿæ˜¯ä¸ºäº†æ›´å¥½çš„è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œæ¯”å¦‚ä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼‰ ä¸€ä¸ªå¯¹è±¡ä»åˆ›å»ºä¹‹åˆå°±æœ‰ä¸¤ç§é€‰æ‹© å°å¯¹è±¡è¿›å…¥æ–°ç”Ÿä»£ å¤§å¯¹è±¡è¿›å…¥è€å¹´ä»£ æˆ‘ä»¬ä»¥å°å¯¹è±¡ä¸¾ä¾‹ï¼Œåœ¨è¿›å…¥æ–°ç”Ÿä»£åï¼Œå¯¹è±¡é¦–å…ˆä¼šè¢«åˆ†é…åˆ°edenåŒºï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå°±ä¼šç»å†åˆ°åƒåœ¾å›æ”¶ï¼ˆGCï¼‰ã€‚GCåˆåˆ†ä¸ºminor GCå’ŒfullGCï¼ˆè¿˜æœ‰major GCï¼Œè¿™é‡Œä¸ä½œè§£é‡Šï¼Œé€šå¸¸å¯ä»¥è®¤ä¸ºæ˜¯fullGCç­‰ä»·ï¼‰minorGCä»…è¿›è¡Œæ–°ç”Ÿä»£èŒƒå›´çš„åƒåœ¾å›æ”¶ï¼Œå› ä¸ºèŒƒå›´å°‘ï¼Œæ‰€ä»¥å›æ”¶å¿«ï¼Œä¸€èˆ¬ä¸ä¼šå¯¹æ‰§è¡Œä¸­çš„è¿›ç¨‹ é€ æˆå¾ˆå¤§å½±å“ï¼ˆè§†æ”¶é›†å™¨ç®—æ³•è€Œä¸åŒï¼Œminor GCä¹Ÿä¼šæš‚åœçº¿ç¨‹å·¥ä½œï¼Œå¯¼è‡´STWï¼‰ï¼Œå½“edenåŒºæ»¡åï¼Œå°±ä¼šæ‰§è¡Œä¸€æ¬¡minorGCï¼Œ ç»è¿‡ä¸€æ¬¡minorGCä¹‹åï¼Œå¦‚æœå¯¹è±¡å­˜æ´»ï¼Œå°±ä¼šè¿›å…¥survivoråŒº survivoråŒºçš„å¯¹è±¡å­˜æ´»æ—¶é—´ä¼šç¨é•¿ï¼Œå› ä¸ºå½“å­˜æ´»å¯¹è±¡ç»å†äº†æ•°æ¬¡GCä¹‹åï¼ˆé»˜è®¤æ˜¯15æ¬¡ï¼Œæ¯è¿›è¡Œä¸€æ¬¡å¯¹è±¡å¹´é¾„+1ï¼‰ï¼Œå¯¹è±¡æ‰ä¼šè¿›å…¥è€å¹´ä»£ã€‚ å¤§å¯¹è±¡å’Œç»å†æ•°æ¬¡å›æ”¶çš„å¯¹è±¡å­˜æ´»åœ¨è€å¹´ä»£ï¼Œè¿™é‡ŒåŒºåŸŸå¾ˆå¤§ï¼Œæ•°æ®å˜åŠ¨ä¹Ÿä¸é¢‘ç¹ï¼Œä»£ä»·å°±æ˜¯åƒåœ¾å›æ”¶çš„æ—¶å€™å½±å“å¾ˆå¤§ã€‚å¦‚æœè€å¹´ä»£åŒºåŸŸç©ºé—´å æ»¡å¯¼è‡´full GCï¼Œå°±ä¼šstop the worldï¼ˆæš‚åœå½“å‰æ‰€æœ‰çº¿ç¨‹å·¥ä½œï¼Œä¼šå½±å“ä»»åŠ¡æ‰§è¡Œï¼‰ è‡³æ­¤ï¼Œä¸€ä¸ªå¯¹è±¡ä»å‡ºç”Ÿåˆ°æ­»äº¡çš„æ•´ä¸ªè¿‡ç¨‹å°±ç»“æŸäº†ã€‚ç°åœ¨å›åˆ°å¼€å§‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹gc.logæ¥è§‚å¯Ÿå¯¹è±¡å†…å­˜åˆ†é…æƒ…å†µ 1[GC (Allocation Failure) [ParNew: 367523K-&gt;1293K(410432K), 0.0023988 secs] 522739K-&gt;156516K(1322496K), 0.0025301 secs] [Times: user=0.04 sys=0.00, real=0.01 secs] è¿™æ˜¯å…¶ä¸­ä¸€æ¡è®°å½•ã€‚æˆ‘ä»¬åˆ†åˆ«çœ‹çœ‹è¿™äº›å‚æ•°ä»£è¡¨ä»€ä¹ˆå«ä¹‰ï¼š GCï¼šä»£è¡¨è¿›è¡Œäº†ä¸€æ¬¡åƒåœ¾å›æ”¶ï¼Œå‰é¢æ²¡æœ‰fullä¿®é¥°ï¼Œè¯´æ˜æ˜¯minor GCï¼Œå› æ­¤å•è®ºè¿™æ¬¡GCï¼Œæœ¬èº«ä¸ä¼šå¯¹ä»»åŠ¡é€ æˆå¤ªå¤§å½±å“Â· Allocation Failure: ç»“åˆä¸Šé¢çš„minor GCå¯ä»¥å¾—å‡ºæ­¤æ¬¡å†…å­˜åˆ†é…å¤±è´¥æ˜¯æ–°ç”Ÿä»£æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´å¯¼è‡´çš„ï¼Œå› æ­¤ä¼šè§¦å‘minor GCï¼Œè®©éƒ¨åˆ†å¯¹è±¡è¿›å…¥è€å¹´ä»£ parNew è¯´æ˜è¿™æ¬¡GCå‘ç”Ÿåœ¨æ–°ç”Ÿä»£ï¼ŒåŒæ—¶ä½¿ç”¨çš„æ”¶é›†å™¨æ˜¯parNewæ”¶é›†å™¨ï¼ŒParNewæ˜¯ä¸€ä¸ªSerialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œä¼šä½¿ç”¨å¤šä¸ªCPUå’Œçº¿ç¨‹å®Œæˆåƒåœ¾æ”¶é›†å·¥ä½œï¼Œè¯¥æ”¶é›†å™¨é‡‡ç”¨å¤åˆ¶ç®—æ³•å›æ”¶å†…å­˜ï¼ŒæœŸé—´ä¼šåœæ­¢å…¶ä»–å·¥ä½œçº¿ç¨‹,é€ æˆSTWã€‚ ä¹‹åçš„å‚æ•°ä»£è¡¨ GCå‰å†…å­˜åŒºåŸŸä½¿ç”¨å®¹é‡-&gt;GCåå†…å­˜åŒºåŸŸä½¿ç”¨å®¹é‡(å†…å­˜åŒºæ€»å®¹é‡) åé¢çš„æ—¶é—´ä»£è¡¨è€—æ—¶ æ¥ç€åˆæ˜¯ä¸€ç»„æ•°æ®ï¼Œä»£è¡¨å †åŒºåƒåœ¾å›æ”¶å‰çš„å¤§å°-&gt;å †åŒºåƒåœ¾å›æ”¶åçš„å¤§å°(å †åŒºæ€»å¤§å°) ä»¥åŠè¯¥å†…å­˜åŒºåŸŸGCè€—æ—¶ æœ€åçš„Timesåˆ™æ˜¯æ€»è€—æ—¶ï¼Œåˆ†åˆ«ä»£è¡¨ ç”¨æˆ·æ€è€—æ—¶ å†…æ ¸æ€è€—æ—¶ æ€»è€—æ—¶ åˆ†æä¸‹å¯ä»¥å¾—å‡ºç»“è®ºï¼š è¯¥æ¬¡GCæ–°ç”Ÿä»£å‡å°‘äº†367523-1293=366239K HeapåŒºæ€»å…±å‡å°‘äº†522739-156516=366223K 366239 â€“ 366223 =16Kï¼Œè¯´æ˜è¯¥æ¬¡å…±æœ‰16Kå†…å­˜ä»å¹´è½»ä»£ç§»åˆ°äº†è€å¹´ä»£ï¼Œå¯ä»¥çœ‹å‡ºæ¥æ•°é‡å¹¶ä¸å¤šï¼Œè¯´æ˜éƒ½æ˜¯ç”Ÿå‘½å‘¨æœŸçŸ­çš„å¯¹è±¡ï¼Œåªæ˜¯è¿™ç§å¯¹è±¡æœ‰å¾ˆå¤šã€‚ æˆ‘ä»¬éœ€è¦çš„æ˜¯å°½é‡é¿å…Full GCçš„å‘ç”Ÿï¼Œè®©å¯¹è±¡å°½å¯èƒ½çš„åœ¨å¹´è½»ä»£å°±å›æ”¶æ‰ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥ç¨å¾®å¢åŠ ä¸€ç‚¹å¹´è½»ä»£çš„å¤§å°ï¼Œè®©é‚£17Kçš„æ•°æ®ä¹Ÿä¿å­˜åœ¨å¹´è½»ä»£ä¸­ã€‚ (è¿™é‡Œä»‹ç»å‡ ä¸ªä¿®æ”¹JVMçš„å‚æ•°) æ’æŸ¥æ–¹æ³•è¿™é‡Œé’ˆå¯¹æ’æŸ¥javaå‡ºç°çš„å¼‚å¸¸ï¼Œåšä¸€ä¸‹ç®€å•çš„å‘½ä»¤è¡Œè®°å½•ã€‚ jdkå†…ç½®äº†è‹¥å¹²å‘½ä»¤è¡Œå·¥å…·ï¼Œè¿™äº›å‘½ä»¤åœ¨ JDKå®‰è£…ç›®å½•ä¸‹çš„ binç›®å½•ä¸‹ï¼š jps (JVM Process Statusï¼‰: ç±»ä¼¼ UNIXçš„ ps å‘½ä»¤ã€‚ç”¨æˆ·æŸ¥çœ‹æ‰€æœ‰ Java è¿›ç¨‹çš„å¯åŠ¨ç±»ã€ä¼ å…¥å‚æ•°å’Œ Java è™šæ‹Ÿæœºå‚æ•°ç­‰ä¿¡æ¯ï¼› jstatï¼ˆ JVM Statistics Monitoring Toolï¼‰: ç”¨äºæ”¶é›† HotSpotè™šæ‹Ÿæœºå„æ–¹é¢çš„è¿è¡Œæ•°æ®; jinfo (Configuration Info for Java) : æ˜¾ç¤ºè™šæ‹Ÿæœºé…ç½®ä¿¡æ¯; jmap (Memory Map for Java) :ç”Ÿæˆå †è½¬å‚¨å¿«ç…§; jhat (JVM Heap Dump Browser ) : ç”¨äºåˆ†æ heapdumpæ–‡ä»¶ï¼Œå®ƒä¼šå»ºç«‹ä¸€ä¸ª HTTP/HTML æœåŠ¡å™¨ï¼Œè®©ç”¨æˆ·å¯ä»¥åœ¨æµè§ˆå™¨ä¸ŠæŸ¥çœ‹åˆ†æç»“æœ; jstack (Stack Trace for Java):ç”Ÿæˆè™šæ‹Ÿæœºå½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§ï¼Œçº¿ç¨‹å¿«ç…§å°±æ˜¯å½“å‰è™šæ‹Ÿæœºå†…æ¯ä¸€æ¡çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•å †æ ˆçš„é›†åˆã€‚ jpsæ˜¾ç¤ºè™šæ‹Ÿæœºæ‰§è¡Œä¸»ç±»åç§°ä»¥åŠè¿™äº›è¿›ç¨‹çš„æœ¬åœ°è™šæ‹Ÿæœºå”¯ä¸€ IDï¼ˆLocal Virtual Machine Identifier,LVMIDï¼‰ *æ³¨æ„ï¼šå¿…é¡»è¦åœ¨è¿›ç¨‹æ‰§è¡Œçš„å¯¹åº”ç”¨æˆ·æƒé™ä¸‹æ“ä½œ 123456C:\Users\SnailClimb&gt;jps7360 NettyClient2173967972 Launcher16504 Jps17340 NettyServer å‚æ•° jps -lï¼šè¾“å‡ºä¸»ç±»çš„å…¨åï¼Œå¦‚æœè¿›ç¨‹æ‰§è¡Œçš„æ˜¯ JaråŒ…ï¼Œè¾“å‡º Jarè·¯å¾„ jps -qï¼šåªè¾“å‡ºè¿›ç¨‹çš„æœ¬åœ°è™šæ‹Ÿæœºå”¯ä¸€ ID jps -v : è¾“å‡ºè™šæ‹Ÿæœºè¿›ç¨‹å¯åŠ¨æ—¶å€™JVMå‚æ•° jps -mï¼š è¾“å‡ºä¼ é€’ç»™mainå‡½æ•°çš„å‚æ•°Â· jstatä½¿ç”¨äºç›‘è§†è™šæ‹Ÿæœºå„ç§è¿è¡ŒçŠ¶æ€ä¿¡æ¯çš„å‘½ä»¤è¡Œå·¥å…· 1jstat -&lt;option&gt; [-t] [-h&lt;lines&gt;] &lt;vmid&gt; [&lt;interval&gt; [&lt;count&gt;]] jstat -class vmid ï¼šæ˜¾ç¤º ClassLoaderçš„ç›¸å…³ä¿¡æ¯ï¼› jstat -compiler vmid ï¼šæ˜¾ç¤º JITç¼–è¯‘çš„ç›¸å…³ä¿¡æ¯ï¼› jstat -gc vmid ï¼šæ˜¾ç¤ºä¸ GC ç›¸å…³çš„å †ä¿¡æ¯ï¼› jstat -gccapacity vmid ï¼šæ˜¾ç¤ºå„ä¸ªä»£çš„å®¹é‡åŠä½¿ç”¨æƒ…å†µï¼› jstat -gcnew vmid ï¼šæ˜¾ç¤ºæ–°ç”Ÿä»£ä¿¡æ¯ï¼› jstat -gcnewcapcacity vmid ï¼šæ˜¾ç¤ºæ–°ç”Ÿä»£å¤§å°ä¸ä½¿ç”¨æƒ…å†µï¼› jstat -gcold vmid ï¼šæ˜¾ç¤ºè€å¹´ä»£å’Œæ°¸ä¹…ä»£çš„ä¿¡æ¯ï¼› jstat -gcoldcapacity vmid ï¼šæ˜¾ç¤ºè€å¹´ä»£çš„å¤§å°ï¼› jstat -gcpermcapacity vmid ï¼šæ˜¾ç¤ºæ°¸ä¹…ä»£å¤§å°ï¼› jstat -gcutil vmid ï¼šæ˜¾ç¤ºåƒåœ¾æ”¶é›†ä¿¡æ¯ï¼› jstat -t : åœ¨è¾“å‡ºä¿¡æ¯ä¸ŠåŠ ä¸€ä¸ª Timestampåˆ—ï¼Œæ˜¾ç¤ºç¨‹åºçš„è¿è¡Œæ—¶é—´ã€‚ jinfoè¾“å‡ºå½“å‰ jvm è¿›ç¨‹çš„å…¨éƒ¨å‚æ•°å’Œç³»ç»Ÿå±æ€§ (ç¬¬ä¸€éƒ¨åˆ†æ˜¯ç³»ç»Ÿçš„å±æ€§ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯ JVM çš„å‚æ•°)ã€‚ *ä½¿ç”¨ jinfo å¯ä»¥åœ¨ä¸é‡å¯è™šæ‹Ÿæœºçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥åŠ¨æ€çš„ä¿®æ”¹ jvm çš„å‚æ•° 1234C:\Users\SnailClimb&gt;jinfo -flag MaxHeapSize 17340-XX:MaxHeapSize=2124414976C:\Users\SnailClimb&gt;jinfo -flag PrintGC 17340-XX:-PrintGC jinfo -flag [+|-]name vmid : å¼€å¯æˆ–è€…å…³é—­å¯¹åº”åç§°çš„å‚æ•°ã€‚ 1234567C:\Users\SnailClimb&gt;jinfo -flag PrintGC 17340-XX:-PrintGCC:\Users\SnailClimb&gt;jinfo -flag +PrintGC 17340C:\Users\SnailClimb&gt;jinfo -flag PrintGC 17340-XX:+PrintGC jmapç”¨äºç”Ÿæˆå †è½¬å‚¨å¿«ç…§.dumpæ–‡ä»¶ï¼Œé™¤æ­¤ä¹‹å¤–ç”Ÿæˆdumpæ–‡ä»¶çš„æ–¹æ³•è¿˜æœ‰ -XX:+HeapDumpOnOutOfMemoryError å‚æ•°è®©è™šæ‹Ÿæœºåœ¨ OOMå¼‚å¸¸å‡ºç°ä¹‹åè‡ªåŠ¨ç”Ÿæˆ dumpæ–‡ä»¶ Linuxå‘½ä»¤ä¸‹å¯ä»¥é€šè¿‡ kill -3 å‘é€è¿›ç¨‹é€€å‡ºä¿¡å·ä¹Ÿèƒ½æ‹¿åˆ° dumpæ–‡ä»¶ 123C:\Users\SnailClimb&gt;jmap -dump:format=b,file=C:\Users\SnailClimb\Desktop\heap.hprof 17340Dumping heap to C:\Users\SnailClimb\Desktop\heap.hprof ...Heap dump file created jhatç”¨äºåˆ†æ heapdumpæ–‡ä»¶ï¼Œå®ƒä¼šå»ºç«‹ä¸€ä¸ªHTTP/HTMLæœåŠ¡å™¨ï¼Œè®©ç”¨æˆ·å¯ä»¥åœ¨æµè§ˆå™¨ä¸ŠæŸ¥çœ‹åˆ†æç»“æœã€‚ 12345678910C:\Users\SnailClimb&gt;jhat C:\Users\SnailClimb\Desktop\heap.hprofReading from C:\Users\SnailClimb\Desktop\heap.hprof...Dump file created Sat May 04 12:30:31 CST 2019Snapshot read, resolving...Resolving 131419 objects...Chasing references, expect 26 dots..........................Eliminating duplicate references..........................Snapshot resolved.Started HTTP server on port 7000Server is ready. jstackç”¨äºç”Ÿæˆè™šæ‹Ÿæœºå½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§ã€‚çº¿ç¨‹å¿«ç…§å°±æ˜¯å½“å‰è™šæ‹Ÿæœºå†…æ¯ä¸€æ¡çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•å †æ ˆçš„é›†åˆ. Â·æŸ¥æ‰¾è€—æ—¶æ—¶é—´é•¿çš„çº¿ç¨‹çš„é€šç”¨æ–¹æ³•ï¼š ä½¿ç”¨jpsæŸ¥æ‰¾å‡ºjavaè¿›ç¨‹çš„pidï¼Œå¦‚7777æˆ–ps -ef | grep java ä½¿ç”¨top -p 7777è§‚å¯Ÿè¿›ç¨‹æƒ…å†µï¼Œç„¶åShift+h,æ˜¾ç¤ºè¯¥è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹ã€‚ æ‰¾å‡ºCPUæ¶ˆè€—è¾ƒå¤šçš„çº¿ç¨‹``idï¼Œå¦‚7788ï¼Œå°†7788è½¬æ¢ä¸º16è¿›åˆ¶0x1e6c`ï¼Œæ³¨æ„æ˜¯å°å†™ã€‚ ä½¿ç”¨jstack 7777 | grep -A 10 0x1e6cæ¥æŸ¥è¯¢å‡ºå…·ä½“çš„çº¿ç¨‹çŠ¶æ€ã€‚-A 10è¡¨ç¤ºæŸ¥æ‰¾åˆ°æ‰€åœ¨è¡Œçš„å10è¡Œ ç»“è¯­ç°åœ¨æœ‰äº†è¿™äº›çŸ¥è¯†å‚¨å¤‡ï¼Œç›¸ä¿¡è§£å†³ä¸€äº›å¸¸è§é—®é¢˜åº”è¯¥ä¸ä¼šæ— ä»ä¸‹æ‰‹äº†ã€‚ç°åœ¨è¿”å›åˆ°æœ€ä¸Šé¢çš„é—®é¢˜ã€‚å½“æ—¶å‡ºç°äº†ä¸€ç›´æ‰“å°å†…å­˜å¤±è´¥çš„ä¿¡æ¯ï¼Œé¦–å…ˆåˆ¤æ–­å‡ºè¿™æ˜¯minor ``GCï¼Œå¦‚æœå‡ºç°é¢‘ç‡ä½é‚£å¯ä»¥æš‚æ—¶ä¸ç”¨è€ƒè™‘ï¼Œå±äºæ­£å¸¸ç°è±¡ï¼›ä½†æ˜¯ä¾ç„¶éœ€è¦å»æ€è€ƒä¼˜åŒ–å¦‚ä½•å‡å°‘GCã€‚è¿™æ¬¡çš„é—®é¢˜åœ¨äºä¸€ç›´åœ¨æœ‰å¯¹è±¡è¿›å…¥è€å¹´ä»£ï¼Œå¯è§å¦‚æœæŒç»­iä¸‹å»ï¼Œå†…å­˜å¿…ç„¶å æ»¡ã€‚å› æ­¤ï¼Œå¾ˆå¯èƒ½æ˜¯ä»£ç é€»è¾‘å‡ºç°äº†é—®é¢˜ï¼Œä¾‹å¦‚æ­»å¾ªç¯ç­‰ï¼Œè®©ä»»åŠ¡ä¸€ç›´ä¸æ–­æ‰§è¡Œï¼Œä¸æ–­ç”Ÿæˆæ–°å¯¹è±¡ï¼Œæ¶ˆç­è€å¯¹è±¡ã€‚æœ€åæŸ¥çœ‹ä»£ç é€»è¾‘ï¼Œæœç„¶å®šä½åˆ°äº†é—®é¢˜æ‰€åœ¨ã€‚ å½“ç„¶ï¼Œå¦‚æœæ˜¯ç»éªŒä¸°å¯Œçš„è€æ‰‹ä¸€å®šèƒ½åœ¨ç¬¬ä¸€æ—¶é—´åˆ¤æ–­å‡ºé—®é¢˜çš„æ ¹æºã€‚ä½†æ˜¯æˆ‘ä¾ç„¶è¿˜åœ¨ä¸æ–­å­¦ä¹ ï¼Œè¿˜æ˜¯éœ€è¦é€šè¿‡è®°å½•çš„æ–¹å¼ï¼Œæ€»ç»“ç»éªŒï¼Œæå‡èƒ½åŠ›ã€‚]]></content>
      <categories>
        <category>æŠ€æœ¯æ¢ç´¢</category>
      </categories>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åä¸€å›å®¶å°è®°]]></title>
    <url>%2F2021%2F10%2F04%2Foctober_first%2F</url>
    <content type="text"><![CDATA[æ„Ÿè§‰å°±åƒä¸€åœºæ¢¦ã€‚ è‡ªå·±æ¨ç®±å­å‡ºé—¨çš„è®°å¿†ä»¿ä½›å°±åœ¨æ˜¨å¤©ï¼Œè€Œè¿™ä¸¤å¤©åœ¨å®¶é‡Œå’Œå®¶äººå›¢èšçš„æ„Ÿè§‰å´æ˜¯é‚£æ ·æœ¦èƒ§ï¼Œç¼ºä¹å®æ„Ÿã€‚ æ¯äº²çš„å” å¨ä¸€å¦‚æ—¢å¾€ï¼Œçˆ¶äº²çš„åèƒŒä¾ç„¶å¯é ï¼Œå›åˆ°å®¶ï¼Œæ„Ÿè§‰è‡ªå·±æ¯«æ— é•¿å¤§ï¼Œä¾ç„¶æ˜¯ä¸ªéœ€è¦ä¾èµ–çš„å­©å­ æœ‰çš„æ—¶å€™ï¼Œè¿˜æ˜¯éœ€è¦åœä¸‹æ¥ï¼Œæ€è€ƒä¸€ä¸‹ç°å®ï¼Œå›å‘³ä¸€ä¼šå„¿è¿‡å»ï¼Œè®©å¤±å»ç†æ™ºçš„å¤§è„‘é‡æ–°å†·é™ä¸‹æ¥ï¼Œç„¶åæ‰èƒ½æ˜ç™½è‡ªå·±æƒ³è¦åšä»€ä¹ˆï¼Œå°†è¦åšä»€ä¹ˆï¼Œæ‰ä¸ä¼šåœ¨æœ€å…³é”®çš„æ—¶åˆ»ï¼Œå¤±å»äº†æœºä¼šï¼Œè¿·å¤±äº†æ–¹å‘ã€‚]]></content>
      <categories>
        <category>ä¸€å¦‚æ—¢å¾€ï¼Œåªæ˜¯æ—¥å¸¸</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[å…³äºjsè¿è¡Œæœºåˆ¶çš„ç®€å•ç†è§£]]></title>
    <url>%2F2020%2F06%2F01%2Fjs-runtime%2F</url>
    <content type="text"><![CDATA[var ap = new APlayer({ element: document.getElementById("aplayer-HFFIyvxr"), narrow: false, autoplay: false, showlrc: false, music: { title: "é’ã„æ ", author: "Galileo Galilei", url: "http://music.163.com/song/media/outer/url?id=417613399.mp3", pic: "http://p1.music.126.net/IMAMMCzMU7InvJhLD7U4xA==/3393092891197502.jpg?param=130y130", lrc: "" } }); window.aplayers || (window.aplayers = []); window.aplayers.push(ap); æœ€è¿‘åœ¨å­¦å‰ç«¯åŸºç¡€ï¼Œä»Šå¤©æ¢³ç†ä¸€ä¸‹javascriptçš„è¿è¡Œæœºåˆ¶ åªæ˜¯ç®€å•ç†è§£ï¼Œå®Œå…¨æ²¡å…¥é—¨é‚£ç§~ é¦–å…ˆå¿…é¡»è®°å½•çš„äº‹Javascriptæ˜¯å•çº¿ç¨‹çš„ï¼Œç›®çš„æ˜¯ç®€åŒ–å’Œç”¨æˆ·çš„äº¤äº’é€»è¾‘ï¼Œä»è€Œä¸ä¼šå‡ºç°ä¸¥é‡çš„å¹¶å‘é—®é¢˜ã€‚ ä½†æ˜¯jsè„šæœ¬å¯ä»¥åˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯åˆ›å»ºçš„å­çº¿ç¨‹å—åˆ°ä¸»çº¿ç¨‹æ§åˆ¶ï¼ŒåŒæ—¶ä¸èƒ½æ“ä½œDOMã€‚ ç›¸å…³è¿›ç¨‹å’Œçº¿ç¨‹åœ¨æµè§ˆå™¨ä¸­åŠ è½½é¡µé¢ä¸»è¦ç”¨åˆ°4ä¸ªè¿›ç¨‹ï¼š ä¸»è¿›ç¨‹ï¼šï¼ˆBrowserè¿›ç¨‹ï¼‰è´Ÿè´£é¡µé¢å±•ç¤ºå’Œèµ„æºä¸‹è½½ç­‰ GPUè¿›ç¨‹ï¼šè´Ÿè´£3Då›¾ç¤ºç»˜å›¾ ç¬¬ä¸‰æ–¹æ’ä»¶è¿›ç¨‹ï¼šè´Ÿè´£ç¬¬ä¸‰æ–¹æ’ä»¶çš„å¤„ç† æ¸²æŸ“è¿›ç¨‹ï¼šï¼ˆRenderè¿›ç¨‹ï¼‰ï¼Œè´Ÿè´£jsæ‰§è¡Œï¼Œé¡µé¢æ¸²æŸ“ç­‰åŠŸèƒ½ å…¶ä¸­æ¸²æŸ“è¿›ç¨‹ä¸­åˆåŒ…æ‹¬ï¼š GUIæ¸²æŸ“è¿›ç¨‹ Jså¼•æ“çº¿ç¨‹ äº‹ä»¶å¾ªç¯çº¿ç¨‹ å®šæ—¶å™¨çº¿ç¨‹ httpå¼‚æ­¥çº¿ç¨‹ â€¦ è¿™é‡Œä¸»è¦çœ‹æ¸²æŸ“è¿›ç¨‹çš„ç›¸å…³çº¿ç¨‹ GUIæ¸²æŸ“çº¿ç¨‹ä¸»è¦å¤„ç†çš„äº‹æƒ…åŒ…æ‹¬ï¼š é¦–å…ˆæµè§ˆå™¨ä¼šè§£æhtmlä»£ç ï¼ˆå®é™…ä¸Šhtmlä»£ç æœ¬è´¨æ˜¯å­—ç¬¦ä¸²ï¼‰è½¬åŒ–ä¸ºæµè§ˆå™¨è®¤è¯†çš„èŠ‚ç‚¹ï¼Œç”ŸæˆDOMæ ‘ï¼Œä¹Ÿå°±æ˜¯DOM Tree ç„¶åè§£æcssï¼Œç”ŸæˆCSSOMï¼ˆCSSè§„åˆ™æ ‘ï¼‰ æŠŠDOM Tree å’ŒCSSOMç»“åˆï¼Œç”ŸæˆRendering Tree(æ¸²æŸ“æ ‘) æ³¨æ„å…¶ä¸­å­˜åœ¨é‡ç»˜å’Œå›æµï¼š å¦‚æœä¿®æ”¹äº†ä¸€äº›å…ƒç´ çš„é¢œè‰²æˆ–è€…èƒŒæ™¯è‰²ï¼Œé¡µé¢å°±ä¼šé‡ç»˜ï¼ˆRepaintï¼‰ï¼Œå¦‚æœä¿®æ”¹å…ƒç´ çš„å°ºå¯¸ï¼Œé¡µé¢å°±ä¼šå›æµï¼ˆReflowï¼‰ï¼Œå½“é¡µé¢éœ€è¦Repaingå’ŒReflowæ—¶GUIå¤šä¼šæ‰§è¡Œï¼Œè¿›è¡Œé¡µé¢ç»˜åˆ¶ã€‚ Jså¼•æ“çº¿ç¨‹è´Ÿè´£è§£æå’Œæ‰§è¡Œjsä»£ç ï¼Œæµè§ˆå™¨åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªJSå¼•æ“çº¿ç¨‹åœ¨è¿è¡ŒJSç¨‹åºï¼Œæ‰€ä»¥jsæ˜¯å•çº¿ç¨‹è¿è¡Œçš„ã€‚ Jsçº¿ç¨‹ä¼šé˜»å¡æ¸²æŸ“çº¿ç¨‹ï¼Œå› æ­¤&lt;script&gt;æ ‡ç­¾å’Œå…¶ä»–DOMæ ‡ç­¾æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼Œä¸€æ—¦æ‰§è¡Œåˆ°&lt;script&gt;æ ‡ç­¾å°±ä¼šç«‹å³æ‰§è¡Œ,æ‰€ä»¥ä¸€èˆ¬æˆ‘ä»¬æŠŠ&lt;script&gt;æ ‡ç­¾æ”¾åœ¨Â·bodyçš„æœ€å äº‹ä»¶å¾ªç¯çº¿ç¨‹ç”¨æ¥æ§åˆ¶äº‹ä»¶çš„å¾ªç¯ï¼Œç»´æŠ¤å’Œç®¡ç†ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼ˆtask queueï¼‰ã€‚ ä¸‹é¢ä¼šè®²åˆ°å…³äºäº‹ä»¶é˜Ÿåˆ—çš„ç”¨æ³• å®šæ—¶å™¨çº¿ç¨‹å•ç‹¬ç”¨æ¥è®¡æ—¶ï¼Œè®¡æ—¶å®Œæˆå°†å®šæ—¶å™¨æ‰§è¡Œçš„æ“ä½œæ·»åŠ åˆ°äº‹ä»¶ä»»åŠ¡é˜Ÿåˆ—å°¾ã€‚ å¼‚æ­¥è¯·æ±‚çº¿ç¨‹æ‰§è¡Œåˆ°ä¸€ä¸ªhttpå¼‚æ­¥è¯·æ±‚æ—¶ï¼Œä¾¿æŠŠå¼‚æ­¥è¯·æ±‚äº‹ä»¶æ·»åŠ åˆ°å¼‚æ­¥è¯·æ±‚çº¿ç¨‹ï¼Œç­‰å¾…å“åº”ï¼›å¹¶æŠŠå›è°ƒå‡½æ•°æ·»åŠ åˆ°äº‹ä»¶é˜Ÿåˆ—ï¼Œç­‰å¾…jså¼•æ“çº¿ç¨‹æ‰§è¡Œ EventloopEventloopå…¶å®æ˜¯Jsçš„æ‰§è¡Œæœºåˆ¶ï¼Œè¡¨ç¤ºäº†çº¿ç¨‹ä¹‹é—´çš„åä½œå…³ç³» å› ä¸ºjsæ˜¯å•çº¿ç¨‹ï¼Œå› æ­¤ä»»åŠ¡çš„æ‰§è¡Œåªèƒ½é¡ºåºæ‰§è¡Œï¼Œä¸ºäº†å°†è€—æ—¶çš„ä»»åŠ¡åˆ†ç¦»å‡ºæ¥ï¼Œåœ¨jsä¸­å®ç°äº†ä¸¤ç§ä»»åŠ¡ç±»å‹ï¼ŒåŒæ­¥ä»»åŠ¡å’Œå¼‚æ­¥ä»»åŠ¡ã€‚ æ‰€æœ‰åŒæ­¥ä»»åŠ¡åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œå½¢æˆæ‰§è¡Œæ ˆ ä»»åŠ¡é˜Ÿåˆ—ï¼ˆtask queueï¼Œå°±æ˜¯ç”±äº‹ä»¶å¾ªç¯çº¿ç¨‹ç»´æŠ¤ï¼‰è´Ÿè´£å­˜æ”¾å¼‚æ­¥ä»»åŠ¡çš„è¿è¡Œç»“æœ æ‰§è¡Œæ ˆçš„åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œæˆåä¼šè¯»å–ä»»åŠ¡é˜Ÿåˆ—ï¼Œå°†å¯¹åº”çš„å¼‚æ­¥ä»»åŠ¡åŠ å…¥æ‰§è¡Œæ ˆæ‰§è¡Œ ä¸Šè¿°æ“ä½œä¸æ–­å¾ªç¯å¾€å¤ è¯¸å¦‚æ­¤å›¾ æ³¨æ„ä¸€å¥è¯: javascriptçš„æ‰§è¡Œå’Œè¿è¡Œæœ‰å¾ˆå¤§çš„åŒºåˆ«ï¼Œjavascriptåœ¨ä¸åŒçš„ç¯å¢ƒä¸‹ï¼Œæ¯”å¦‚nodeï¼Œæµè§ˆå™¨ï¼ŒRingoç­‰ç­‰ï¼Œæ‰§è¡Œæ–¹å¼æ˜¯ä¸åŒçš„ã€‚è€Œè¿è¡Œå¤§å¤šæŒ‡javascriptè§£æå¼•æ“ï¼Œæ˜¯ç»Ÿä¸€çš„ã€‚ å®šæ—¶å™¨å®šæ—¶å™¨æ˜¯ä¸€ä¸ªç›¸å½“ç‰¹æ®Šçš„å­˜åœ¨ï¼Œä»»åŠ¡é˜Ÿåˆ—ä¸­ä¸ä»…å¯ä»¥æ”¾æ™®é€šäº‹ä»¶ï¼Œä¹Ÿå¯ä»¥æ”¾å®šæ—¶äº‹ä»¶ã€‚ ä¸»è¦ç”±setTimeout()å’ŒsetInterval()ä¸¤ä¸ªå‡½æ•°å®Œæˆ å€¼å¾—æ³¨æ„çš„æ˜¯ å®šæ—¶å™¨ä¸ä¼šå®Œå…¨æŒ‰ç…§è§„å®šæ—¶é—´æ‰§è¡Œ W3Cæ ‡å‡†è§„å®šsetTimeoutä¸­æœ€å°çš„æ—¶é—´å‘¨æœŸæ˜¯4æ¯«ç§’ï¼Œå‡¡æ˜¯ä½äº4msçš„æ—¶é—´é—´éš”éƒ½æŒ‰ç…§4msæ¥å¤„ç†ã€‚å› æ­¤ä»£ç ä¸ä¼šå®Œå…¨ç²¾ç¡®æŒ‰ç…§æ‰€å®šæ—¶é—´æ‰§è¡Œ ä¸»çº¿ç¨‹æ‰§è¡Œåˆ°å®šæ—¶å™¨åï¼Œä¼šæŠŠå®šæ—¶ä»»åŠ¡äº¤ç»™å®šæ—¶å™¨çº¿ç¨‹æ‰§è¡Œï¼Œç­‰åˆ°æ—¶é—´äº†ï¼Œå®šæ—¶å™¨æ‰€è¦æ‰§è¡Œçš„æ“ä½œä¼šæ”¾åˆ°ä»»åŠ¡é˜Ÿåˆ—æœ«å°¾ï¼Œå› æ­¤ä¸ä¸€å®šç«‹å³æ‰§è¡Œ setIntervalå­˜åœ¨ç´¯è®¡æ•ˆåº”ï¼šå¦‚æœå®šæ—¶å™¨é‡Œé¢çš„ä»£ç æ‰§è¡Œæ‰€éœ€çš„æ—¶é—´å¤§äºå®šæ—¶å™¨çš„æ‰§è¡Œå‘¨æœŸï¼Œä¼šå¯¼è‡´æœ‰äº›äº‹ä»¶ä¸¢å¤± å¯ä»¥ä½¿ç”¨setTimeout()ä»£æ›¿setInterval() 123456var say = function() &#123; setTimeout(say, 1000) console.log('hello world')&#125;setTimeout(say, 1000) å‰©ä¸‹çš„ä»¥åå†æ€»ç»“â€¦ å‚è€ƒé“¾æ¥JavaScript è¿è¡Œæœºåˆ¶è¯¦è§£ï¼šå†è°ˆEvent Loop jsè¿è¡ŒåŸç†ä¸æœºåˆ¶]]></content>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®°å½•ä¸€æ¬¡è·¨åŸŸé—®é¢˜]]></title>
    <url>%2F2020%2F06%2F01%2Fcors%2F</url>
    <content type="text"><![CDATA[var ap = new APlayer({ element: document.getElementById("aplayer-PJJnecwK"), narrow: false, autoplay: false, showlrc: false, music: { title: "æ²¡é‚£ä¹ˆç®€å•", author: "é»„å°ç¥", url: "http://music.163.com/song/media/outer/url?id=478384.mp3", pic: "http://cdn.zblade.top/qiniu_img/image-20200601171805737.png", lrc: "" } }); window.aplayers || (window.aplayers = []); window.aplayers.push(ap); æœ€è¿‘åœ¨åšå‰åç«¯äº¤äº’çš„æ—¶å€™é‡åˆ°äº†ç‰¹æ®Šçš„è·¨åŸŸé—®é¢˜ã€‚å…¶å®è‡ªå·±å¹³æ—¶åšé¡¹ç›®çš„æ—¶å€™ä¹Ÿå¤šå¤šå°‘å°‘å¤„ç†è¿‡è·¨åŸŸé—®é¢˜ï¼Œä½†æ˜¯è¿™æ¬¡æƒ…å†µç‰¹æ®Šã€‚æ­£å¥½å€Ÿæ­¤æœºä¼šå°†è·¨åŸŸé—®é¢˜çš„è§£å†³æ–¹æ³•åšä¸€ä¸‹æ€»ç»“ï¼Œä»¥å¤‡ä¸æ—¶ä¹‹éœ€ã€‚ æƒ…æ™¯è‡ªå·±å‰æ®µæ—¶é—´åœ¨å­¦ä¹ å‰ç«¯ï¼Œæ‰€ä»¥æƒ³è¶ç€è¿™ä¸ªæœºä¼šè‡ªå·±æä¸ªå°å·¥å…·ç©ç©ã€‚æ‰€ä»¥å°±æœ‰äº†å¦‚ä¸‹è¿™ä¸ªæå…¶ç®€é™‹çš„å¼¹å¹•ç½‘ç«™ã€‚ ä¸ºäº†å®ç°å¼¹å¹•çš„æŒä¹…ä¿å­˜ï¼Œè‡ªå·±å°è¯•å‰åç«¯äº¤äº’å°†å¼¹å¹•å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œç„¶åå‰ç«¯æ¯é—´éš”ä¸€æ®µæ—¶é—´å°±ä»åå°æ‹‰å–ä¸€æ¬¡æ•°æ®ã€‚ å®ç°å…¶å®æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯å½“æˆ‘åœ¨æœ¬åœ°å¼€å§‹æµ‹è¯•å‘åå°å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œé—®é¢˜å‡ºç°äº†ï¼š å¾ˆæ˜æ˜¾è¿™æ˜¯ä¸€ä¸ªè·¨åŸŸé—®é¢˜ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦åŠ¨ç”¨æˆ‘ä»¬æ‰€å­¦çš„çŸ¥è¯†å»è§£å†³å®ƒã€‚ é¦–å…ˆç¬¬ä¸€æ­¥ï¼Œåˆ†æé—®é¢˜åŸå› ï¼šä»€ä¹ˆæ˜¯è·¨åŸŸï¼Ÿ ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Ÿ è·¨åŸŸæ˜¯æŒ‡ä¸€ä¸ªåŸŸä¸‹çš„æ–‡æ¡£æˆ–è„šæœ¬è¯•å›¾å»è¯·æ±‚å¦ä¸€ä¸ªåŸŸä¸‹çš„èµ„æº è·¨åŸŸå…¶å®ä¸æ˜¯ä»€ä¹ˆbugï¼Œè€Œæ˜¯ç”±äºæµè§ˆå™¨ä¸ºäº†å®‰å…¨èµ·è§æŒ‡å®šäº†ä¸€ç³»åˆ—â€œåŒæºç­–ç•¥â€ï¼Œè¿™äº›åŒæºç­–ç•¥å¯ä»¥ä¿è¯ç”¨æˆ·ä¿¡æ¯çš„å®‰å…¨ï¼Œé˜²æ­¢è¢«æ¶æ„çš„ç½‘ç«™çªƒå–æ•°æ®ã€‚ è¯¥æ”¿ç­–é™åˆ¶ç½‘é¡µçš„æŸäº›è¡Œä¸ºå¿…é¡»é™åˆ¶åœ¨ä¸è‡ªå·±â€œåŒæºâ€çš„ç½‘é¡µä¸­æ‰èƒ½è¿›è¡Œï¼Œå¦‚æœä¸æ˜¯åŒæºï¼Œå°±ä¼šå¯¼è‡´è¯¥è¡Œä¸ºæ— æ³•ç”Ÿæ•ˆï¼Œä¹Ÿå°±æ˜¯è·¨åŸŸå¤±è´¥ã€‚ è¿™é‡Œå‡ºç°äº†ä¸¤ä¸ªæ¦‚å¿µï¼Œä¸€ä¸ªæ˜¯åŒæºï¼Œä¸€ä¸ªæ˜¯è·¨åŸŸè¡Œä¸º åŒæºçš„å®šä¹‰åŒ…å«ä¸‰ä¸ªæ–¹é¢ åè®®ç›¸åŒ åŸŸåç›¸åŒ ç«¯å£ç›¸åŒ åªæœ‰ä¸‰ä¸ªæ¡ä»¶éƒ½æ»¡è¶³ï¼Œæ‰èƒ½è®¤å®šä¸¤ä¸ªç½‘é¡µæ˜¯â€åŒæºâ€œ è·¨åŸŸè¡Œä¸ºï¼ˆè‡ªå·±å®šä¹‰çš„åè¯ï¼Œå¤§æ¦‚å°±æ˜¯æˆ‘ä»¬ä¼šè¢«åŒæºæ”¿ç­–å½±å“åˆ°çš„æ“ä½œï¼‰éšç€äº’è”ç½‘çš„å‘å±•ï¼ŒèŒƒå›´å˜å¾—è¶Šæ¥è¶Šå®½æ³›ï¼Œä¸€èˆ¬æˆ‘ä»¬å¸¸è§çš„è·¨åŸŸè¡Œä¸ºåŒ…æ‹¬ è·å– Cookieã€LocalStorage å’Œ IndexDB è·å¾—DOMå’ŒJSå¯¹è±¡ AJAXè¯·æ±‚ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨å‰åç«¯äº¤äº’ä¸­æœ€å¸¸è§çš„AJAXè¯·æ±‚ä¹Ÿèµ«ç„¶åœ¨åˆ—ï¼Œåœ¨å‰åç«¯äº¤äº’ä¸­è§£å†³è·¨åŸŸé—®é¢˜çš„ä¸å¯é¿å…çš„ã€‚ é‚£ä¸ºä»€ä¹ˆè¦å®šä¹‰åŒæºç­–ç•¥å‘¢ï¼Ÿæ²¡æœ‰è·¨åŸŸé™åˆ¶ä¸æ˜¯æ›´å¥½å—ï¼Ÿ å¦‚æœæ²¡æœ‰è·¨åŸŸé™åˆ¶ï¼Œç½‘é¡µå°†å¾ˆå®¹æ˜“å—åˆ°XSSã€CSRFç­‰æ”»å‡»ï¼Œå› ä¸ºæ²¡æœ‰é™åˆ¶ï¼Œæ¶æ„ç½‘ç«™åŒæ ·å¯ä»¥è‡ªç”±åœ°å‘èµ·æ”»å‡»ï¼Œè¿™å°†å¤§å¤§æé«˜ç½‘ç«™çš„ç»´æŠ¤æˆæœ¬ã€‚å› æ­¤ï¼ŒåŒæºç­–ç•¥å…¶å®æ˜¯ä¸€æŠŠåŒåˆƒå‰‘ï¼Œåªæ˜¯åœ¨ä¿æŠ¤ç½‘é¡µçš„åŒæ—¶ï¼Œå¶å°”æ€»ä¼šè¯¯ä¼¤å‹å†›ã€‚ çŸ¥é“äº†é—®é¢˜çš„æ ¹æºï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹ç—‡ä¸‹è¯ï¼Œå¯»æ‰¾è§£å†³æ–¹æ¡ˆ è§£å†³æ–¹æ¡ˆæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè·¨åŸŸé—®é¢˜çš„å…³é”®åœ¨äºæˆ‘ä»¬çš„Mè¯·æ±‚å¤„äºé™åˆ¶èŒƒå›´å†…ï¼Œæ²¡æœ‰åšåˆ°åŒæº&gt;ï¼Œä»è€Œå¯¼è‡´çš„ã€‚ é‡ç‚¹å·²ç»æ ‡å‡ºæ¥äº†ï¼Œå…¶å®æˆ‘ä»¬è§£å†³çš„æ–¹æ³•ä¹Ÿå°±æ˜¯ä»è¿™ä¸¤ä¸ªæ€è·¯ç€æ‰‹ é‡‡ç”¨ä¸åœ¨åŒæºç­–ç•¥çš„è¡Œä¸ºæ“ä½œ æƒ³åŠæ³•è®©è¡Œä¸ºå¤„äºåŒæºçŠ¶æ€ è¿™é‡Œæˆ‘ä»¬æŒ‡é’ˆå¯¹AJAXè¯·æ±‚ï¼Œå¯¹äºå…¶ä»–è¯¸å¦‚cookieã€iframeç­‰çš„è·¨åŸŸæ–¹æ¡ˆï¼Œå…¶å®å‚è€ƒç›¸å…³çš„åšå®¢ç›¸ä¿¡ä¸€å®šèƒ½å¾—åˆ°ç­”æ¡ˆ 1.JSONPè·¨åŸŸæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨AJAXè¯·æ±‚ä¸­å®šä¹‰JSONPç±»å‹å®ç°è·¨åŸŸï¼Œè™½è¯´å¦‚æ­¤ï¼Œä½†JSONPæœ¬è´¨ä¸Šé‡‡ç”¨çš„æ˜¯å’ŒAJAXå®Œå…¨ä¸åŒçš„è¯·æ±‚æ–¹å¼ã€‚ ä¼ ç»Ÿçš„AJAXè¯·æ±‚å…¶å®æ˜¯xhrçš„å¼‚æ­¥è¯·æ±‚ï¼Œè€ŒJSONPæœ¬è´¨ä¸Šæ˜¯å»æ„å»ºä¸€ä¸ª&lt;script&gt;æ ‡ç­¾ï¼Œåˆ©ç”¨scriptæ ‡ç­¾ä¸­çš„srcä¸å—åŒæºæ”¿ç­–çš„é™åˆ¶ï¼Œåœ¨srcä¸­å¡«å†™åç«¯URLå¹¶æ·»åŠ å›è°ƒå‡½æ•°ï¼Œè·å–åˆ°çš„æ•°æ®å°±é€šè¿‡å›è°ƒå‡½æ•°å¤„ç†ã€‚ å‚è€ƒé˜®ä¸€å³°çš„åšå®¢,å®ç°æ€æƒ³å¤§è‡´å¦‚æ­¤ï¼š 1234567891011121314function addScriptTag(src) &#123; var script = document.createElement('script'); script.setAttribute("type","text/javascript"); script.src = src; document.body.appendChild(script);&#125;window.onload = function () &#123; addScriptTag('http://example.com/ip?callback=foo');&#125;function foo(data) &#123; console.log('response data: ' + JSON.stringify(data));&#125;; ç”±äº&lt;script&gt;å…ƒç´ è¯·æ±‚çš„è„šæœ¬ï¼Œç›´æ¥ä½œä¸ºä»£ç è¿è¡Œã€‚è¿™æ—¶ï¼Œåªè¦æµè§ˆå™¨å®šä¹‰äº†fooå‡½æ•°ï¼Œè¯¥å‡½æ•°å°±ä¼šç«‹å³è°ƒç”¨ã€‚ä½œä¸ºå‚æ•°çš„JSONæ•°æ®è¢«è§†ä¸ºJavaScriptå¯¹è±¡ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²ï¼Œå› æ­¤é¿å…äº†ä½¿ç”¨JSON.parseçš„æ­¥éª¤ã€‚ å¦‚ä½•åœ¨AJAXå®ç°ï¼š 1234567$.ajax(&#123; url: 'http://www.domain2.com:8080/login', type: 'get', dataType: 'jsonp', // è¯·æ±‚æ–¹å¼ä¸ºjsonp jsonpCallback: "handleCallback", // è‡ªå®šä¹‰å›è°ƒå‡½æ•°å data: &#123;&#125;&#125;); å¦‚ä½•åœ¨vueä¸Šå®ç°ï¼š 123456this.$http.jsonp('http://www.domain2.com:8080/login', &#123; params: &#123;&#125;, jsonp: 'handleCallback'&#125;).then((res) =&gt; &#123; console.log(res); &#125;) ä»å®ç°åŸç†ä¸Šå¯ä»¥çœ‹å‡ºJSONPè¿˜æ˜¯å­˜åœ¨å¼Šç«¯ï¼Œé‚£å°±æ˜¯ä½¿ç”¨JSONPå¿…é¡»æ˜¯GETè¯·æ±‚ï¼Œå¦‚æœè¦POSTè¯·æ±‚å®ç°è·¨åŸŸï¼Œè¿˜æ˜¯éœ€è¦ä½¿ç”¨å…¶ä»–æ–¹æ³• 2.WebSocketwebsocketæœ¬èº«å°±æ˜¯ä¸€ç§é€šä¿¡åè®®ï¼Œé€šè¿‡websocketé€šä¿¡ï¼Œå®é™…ä¸Šå°±å¯ä»¥è·¨è¿‡åŒæºç­–ç•¥ï¼Œ å®ç°æŸç§æ„ä¹‰ä¸Šçš„â€åŒæºâ€ã€‚ ä¸‹é¢æ˜¯websocketè¯·æ±‚çš„HTTPå¤´ä¿¡æ¯ï¼Œé‡ç‚¹å…³æ³¨Originå­—æ®µï¼Œè¿™æ˜¯å®ç°è·¨åŸŸçš„å…³é”® 12345678GET /chat HTTP/1.1Host: server.example.comUpgrade: websocketConnection: UpgradeSec-WebSocket-Key: x3JJHMbDL1EzLkh9GBhXDw==Sec-WebSocket-Protocol: chat, superchatSec-WebSocket-Version: 13Origin: http://example.com Originå­—æ®µè¡¨ç¤ºè¯¥è¯·æ±‚çš„è¯·æ±‚æºï¼Œåªè¦Originå­—æ®µä¸­çš„æºåŸŸåå’Œè¯·æ±‚çš„ç›®çš„åŸŸåæ˜¯åŒä¸€ä¸ªï¼Œå°±å¯ä»¥é€šè¿‡åŒæºç­–ç•¥ä¸­çš„åŸŸåä¸€è‡´ï¼Œå®ç°è·¨åŸŸã€‚ å¦‚æœå…è®¸é€šä¿¡ï¼ŒWebSocketçš„å“åº”å¤´å¦‚ä¸‹ 12345HTTP/1.1 101 Switching ProtocolsUpgrade: websocketConnection: UpgradeSec-WebSocket-Accept: HSmrc0sMlYUkAGmm5OPpG2HaGWk=Sec-WebSocket-Protocol: chat 3.CORS CORSå³è·¨åŸŸèµ„æºå…±äº«â€ï¼ˆCross-origin resource sharingï¼‰ï¼Œå®ƒå…è®¸æµè§ˆå™¨å‘è·¨æºæœåŠ¡å™¨ï¼Œå‘å‡ºXMLHttpRequestè¯·æ±‚ï¼Œä»è€Œå…‹æœäº†AJAXåªèƒ½åŒæºä½¿ç”¨çš„é™åˆ¶ã€‚ è¿™æ˜¯è§£å†³è·¨åŸŸé—®é¢˜çš„å¸¸ç”¨æ–¹æ³•ã€‚ å®ç°åŸç†å…¶å®ç°åŸç†å¦‚å›¾ CORSè¯·æ±‚ä¸»è¦åˆ†æˆä¸¤ç±»ï¼šç®€å•è¯·æ±‚å’Œéç®€å•è¯·æ±‚ã€‚ æ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„å°±æ˜¯ç®€å•è¯·æ±‚ï¼Œå¦åˆ™å°±æ˜¯éç®€å•è¯·æ±‚ ï¼ˆ1) è¯·æ±‚æ–¹æ³•æ˜¯ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ä¹‹ä¸€ï¼š HEAD GET POST ï¼ˆ2ï¼‰HTTPçš„å¤´ä¿¡æ¯ä¸è¶…å‡ºä»¥ä¸‹å‡ ç§å­—æ®µï¼š Accept Accept-Language Content-Language Last-Event-ID Content-Typeï¼šåªé™äºä¸‰ä¸ªå€¼application/x-www-form-urlencodedã€multipart/form-dataã€text/plain ç®€å•CORSè¯·æ±‚åªæ˜¯åœ¨è¯·æ±‚çš„æ—¶å€™åœ¨httpå¤´ä¸­åŠ å…¥Originå­—æ®µ éç®€å•CORSè¯·æ±‚çš„è¯ï¼Œæµè§ˆå™¨ä¼šåœ¨æ­£å¼é€šä¿¡åå…ˆå‘é€é¢„æ£€è¯·æ±‚ï¼Œå…ˆè¯¢é—®æœåŠ¡å™¨æ˜¯å¦å…è®¸è¯·æ±‚ï¼Œå¾—åˆ°å“åº”ï¼Œæ£€æŸ¥ç›¸å…³å­—æ®µåå°±å¯ä»¥åšå‡ºå›åº”ï¼Œå‘èµ·æ­£å¼è¯·æ±‚ å‡è®¾ç°åœ¨å‘èµ·ä¸€æ®µjsè„šæœ¬ 12345var url = 'http://api.alice.com/cors';var xhr = new XMLHttpRequest();xhr.open('PUT', url, true);xhr.setRequestHeader('X-Custom-Header', 'value');xhr.send(); å…¶ä¸­é¢„æ£€è¯·æ±‚çš„è¯·æ±‚æ–¹æ³•æ˜¯OPTIONSï¼Œå…·ä½“è¯·æ±‚å¤´ç±»ä¼¼å¦‚ä¸‹ 12345678OPTIONS /cors HTTP/1.1Origin: http://api.bob.comAccess-Control-Request-Method: PUTAccess-Control-Request-Headers: X-Custom-HeaderHost: api.alice.comAccept-Language: en-USConnection: keep-aliveUser-Agent: Mozilla/5.0... ä¸»è¦å…³æ³¨ä¸‰ä¸ªå­—æ®µ Origin è¡¨ç¤ºè¯·æ±‚æ¥è‡ªå“ªä¸ªæº Access-Control-Request-Method è¯¥å­—æ®µæ˜¯å¿…é¡»çš„ï¼Œç”¨æ¥åˆ—å‡ºæµè§ˆå™¨çš„CORSè¯·æ±‚ä¼šç”¨åˆ°å“ªäº›HTTPæ–¹æ³•ï¼Œä¸Šä¾‹æ˜¯PUTã€‚ Access-Control-Request-Headers è¯¥å­—æ®µæ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼ŒæŒ‡å®šæµè§ˆå™¨CORSè¯·æ±‚ä¼šé¢å¤–å‘é€çš„å¤´ä¿¡æ¯å­—æ®µï¼Œä¸Šä¾‹æ˜¯X-Custom-Headerã€‚ å¾—åˆ°å“åº”å¦‚ä¸‹ä¹‹åå°±èƒ½ç¡®è®¤å…è®¸è·¨åŸŸè¯·æ±‚ 123456789101112HTTP/1.1 200 OKDate: Mon, 01 Dec 2008 01:15:39 GMTServer: Apache/2.0.61 (Unix)Access-Control-Allow-Origin: http://api.bob.comAccess-Control-Allow-Methods: GET, POST, PUTAccess-Control-Allow-Headers: X-Custom-HeaderContent-Type: text/html; charset=utf-8Content-Encoding: gzipContent-Length: 0Keep-Alive: timeout=2, max=100Connection: Keep-AliveContent-Type: text/plain å…¶ä¸­ 12345678910//è¡¨ç¤ºæ”¯æŒä»»æ„è·¨åŸŸè¯·æ±‚Access-Control-Allow-Origin: *//è¡¨ç¤ºæ”¯æŒè·¨åŸŸè¯·æ±‚çš„æ–¹æ³•Access-Control-Allow-Methods: GET, POST, PUT//å½“æµè§ˆå™¨è¯·æ±‚åŒ…å«Access-Control-Request-Headersçš„æ—¶å€™å¿…éœ€ï¼Œè¡¨ç¤ºæ”¯æŒçš„å¤´ä¿¡æ¯å­—æ®µAccess-Control-Allow-Headers: X-Custom-Header//å…è®¸å‘é€cookieå’Œè®¤è¯ä¿¡æ¯Access-Control-Allow-Credentials: true//æŒ‡å®šæœ¬æ¬¡é¢„æ£€è¯·æ±‚çš„æœ‰æ•ˆæœŸAccess-Control-Max-Age: 1728000 å®ç°æ–¹å¼è¿™é‡Œä¸»è¦æ˜¯åç«¯çš„æ“ä½œï¼Œè¿™é‡Œç”¨äº†java springbootçš„è·¨åŸŸæ–¹å¼åšä¸ºæ ·ä¾‹ 1234567891011121314151617@Configurationpublic class CORSConfiguration &#123; @Bean public WebMvcConfigurer corsConfigurer() &#123; return new WebMvcConfigurer() &#123; @Override public void addCorsMappings(CorsRegistry registry) &#123; registry.addMapping("/**") .allowedOrigins("*") .allowedHeaders("*") .allowCredentials(true) .allowedMethods("GET", "POST", "DELETE", "PUT","PATCH") .maxAge(3600); &#125; &#125;; &#125;&#125; å…¶å®å°±æ˜¯åœ¨æœåŠ¡ç«¯å“åº”çš„æ—¶å€™æ·»åŠ è¯·æ±‚å¤´ï¼Œspringbootè¿˜æ”¯æŒåœ¨ä¸åŒcontrollerä¸Šä½¿ç”¨æ³¨è§£æ·»åŠ  4.nginxä»£ç†è·¨åŸŸè¿™ä¸ªåŸç†ä¹Ÿç®€å•ï¼Œå…¶å®å°±æ˜¯è®©å‰ç«¯å’Œåç«¯å¤„äºåŒæºä¸Šï¼Œåˆ©ç”¨nginxçš„åå‘ä»£ç†å¯ä»¥ä¿®æ”¹è¯·æ±‚çš„åŸŸåã€ç«¯å£ï¼Œä¹Ÿèƒ½æ·»åŠ cookieä¿¡æ¯å•¥çš„å®ç°è·¨åŸŸ 123456789101112131415#proxyæœåŠ¡å™¨server &#123; listen 81; server_name www.domain1.com; location / &#123; proxy_pass http://www.domain2.com:8080; #åå‘ä»£ç† proxy_cookie_domain www.domain2.com www.domain1.com; #ä¿®æ”¹cookieé‡ŒåŸŸå index index.html index.htm; # å½“ç”¨webpack-dev-serverç­‰ä¸­é—´ä»¶ä»£ç†æ¥å£è®¿é—®nignxæ—¶ï¼Œæ­¤æ—¶æ— æµè§ˆå™¨å‚ä¸ï¼Œæ•…æ²¡æœ‰åŒæºé™åˆ¶ï¼Œä¸‹é¢çš„è·¨åŸŸé…ç½®å¯ä¸å¯ç”¨ add_header Access-Control-Allow-Origin http://www.domain1.com; #å½“å‰ç«¯åªè·¨åŸŸä¸å¸¦cookieæ—¶ï¼Œå¯ä¸º* add_header Access-Control-Allow-Credentials true; &#125;&#125; å¦å¤–ä½¿ç”¨ä¸€äº›ä¸­é—´ä»¶çš„ä»£ç†æ–¹å¼å…¶åŸç†éƒ½æ˜¯è¿™å›äº‹ï¼Œè¿™é‡Œå°±ä¸åŠ èµ˜è¿° åˆ†æé—®é¢˜ä¸€é€šåˆ†æä¸Šé¢è§£å†³æ–¹æ¡ˆè¯´äº†ä¸€å¤§å †ï¼Œä½†æœ€ç»ˆè¿˜æ˜¯è¦å›å½’æˆ‘ä»¬çš„é—®é¢˜ï¼Œè¿™æ¬¡ï¼Œæˆ‘ä»¬å¼€å§‹å¯¹ç—‡ä¸‹è¯ã€‚é¦–å…ˆå†çœ‹ä¸€éæŠ¥é”™æ—¥å¿—ï¼š å—¯ï¼Ÿå¥½åƒå’Œæƒ³è±¡ä¸­çš„ä¸å¤ªä¸€æ ·ï¼Œå¸¸è§çš„è·¨åŸŸé—®é¢˜åº”è¯¥å¦‚åŒï¼š è¿™ç§ï¼Œçœ‹èµ·æ¥å…¶ä¸­æœ‰è¯ˆï¼Ÿ æœä¸å…¶ç„¶ï¼Œé€šè¿‡åå°æ·»åŠ è·¨åŸŸè®¾ç½®ï¼Œæˆ‘ä»¬çš„æŠ¥é”™ä¿¡æ¯ä¾ç„¶æ²¡æœ‰å˜åŒ–ã€‚ è¿™æ—¶æˆ‘ä»¬å°±éœ€è¦å¯¹æŠ¥é”™ä¿¡æ¯å¥½å¥½åˆ†æï¼ˆå…¶å®è¿™åº”è¯¥æ˜¯åˆ†ææ—¥å¿—çš„ç¬¬ä¸€æ­¥ï¼Œä¸ºäº†å¼ºè¡Œå¼•å…¥è·¨åŸŸè§£å†³æ–¹æ¡ˆï¼Œå› æ­¤ç‰¹åœ°å°†åˆ†ææ”¾åœ¨äº†åé¢ï¼‰ è¿™å¥è¯å¼•èµ·äº†æˆ‘çš„æ³¨æ„ Cross origin requests are only supported for protocol schemes: http, data, chrome, chrome-extension, https. é€šè¿‡æŸ¥é˜…èµ„æ–™å‘ç°ï¼ŒåŸæ¥è¿™é‡Œæˆ‘çš„å‰åç«¯äº¤äº’éƒ½æ˜¯å†æœ¬åœ°å®ç°ï¼Œæœ¬åœ°æ‰“å¼€htmlä½¿ç”¨çš„fileåè®®ï¼Œä½†æ˜¯fileåè®®çš„è¯·æ±‚æ— æ³•è¢«æµè§ˆå™¨è®¤å¯ï¼Œç½‘ä¸Šæä¾›çš„æ–¹æ³•å¦‚ä¸‹ åœ¨è°·æ­Œæµè§ˆå™¨ä¸‹çš„å¿«æ·æ–¹å¼ä½ç½® åœ¨ç›®æ ‡å¤„æ·»åŠ ï¼š 1"C:\Program Files (x86)\Google\Chrome\Application\chrome.exe" -args --disable-web-security --user-data-dir --allow-file-access-from-files å¤§æ¦‚å°±æ˜¯è¿™æ ·ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯ä¸æ¨èä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œå› ä¸ºè¿™æ ·çš„æ–¹å¼å¹¶ä¸æ˜¯ç‰¹åˆ«ä¼˜é›…çš„è§£å†³æ–¹æ³• å¦å¤–çš„å°è¯•å¦å¤–çš„è§£å†³æ–¹æ³•å°±æ˜¯åœ¨æœ¬åœ°éƒ¨ç½²nginxï¼Œè¯¸å¦‚ä¸Šé¢æåˆ°è¿‡çš„è§£å†³æ–¹æ³•ï¼Œä¸é€šè¿‡fileåè®®æ‰“å¼€æ–‡ä»¶ã€‚ ä»€ä¹ˆæ˜¯fileåè®®çš„æ‰“å¼€æ–¹å¼ï¼Ÿ å¤§æ¦‚å°±æ˜¯è¿™ç§ è¦æ¢æˆç”¨httpå½¢å¼æ‰“å¼€çš„æ–¹å¼ï¼Œè¯¸å¦‚è¿™ç§ è¿˜æœ‰å¦‚æœä¸å«Œéº»çƒ¦ç›´æ¥æŠŠç½‘é¡µéƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šä¹Ÿæ˜¯ä¸€ç§è§£å†³æ–¹æ³• æ„å¤–çš„ç»“æœä½†æ˜¯ï¼ï¼æœ€ç»ˆé—®é¢˜è¿˜æ˜¯æ²¡æœ‰å¾—åˆ°è§£å†³ï¼è¿™å¯æŠŠæˆ‘éš¾åˆ°äº†ã€‚ã€‚ äº‹å¿…æœ‰å› ï¼Œç»è¿‡ä¸€ä¸ªå¤šå°æ—¶çš„ä¸æ‡ˆåŠªåŠ›ï¼Œæˆ‘ç»ˆäºæ‰¾åˆ°äº†é—®é¢˜çš„æ ¹æº â€”â€”â€”â€” ajaxçš„è¯·æ±‚URLå¿…é¡»ä»¥httpçš„æ ¼å¼ã€‚ã€‚ã€‚ã€‚ å•Šå•Šå•Šå•Šæœç„¶è¿˜æ˜¯æˆ‘å¤ªèœäº†ã€‚ã€‚ å› ä¸ºåˆšå­¦ajaxï¼Œå¯¹å…¶åŸç†ä¸ç†Ÿï¼Œå¯¼è‡´æœ€åå‡ºç°äº†è¿™ç§é—®é¢˜ã€‚ å‚è€ƒé“¾æ¥é˜®ä¸€å³°çš„åšå®¢ ajaxè·¨åŸŸï¼Œè¿™åº”è¯¥æ˜¯æœ€å…¨çš„è§£å†³æ–¹æ¡ˆäº† å‰ç«¯å¸¸è§è·¨åŸŸè§£å†³æ–¹æ¡ˆï¼ˆå…¨ï¼‰]]></content>
      <categories>
        <category>æŠ€æœ¯æ¢ç´¢</category>
      </categories>
      <tags>
        <tag>è·¨åŸŸ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[netty_reactorçº¿ç¨‹æ¨¡å‹]]></title>
    <url>%2F2020%2F05%2F31%2Fnetty-reactorrctor-1%2F</url>
    <content type="text"><![CDATA[Nettyæ˜¯ä¸€ä¸ªå°è£…äº†JAVA NIOçš„å¼‚æ­¥ç½‘ç»œåº”ç”¨æ¡†æ¶ï¼Œå®ƒç®€åŒ–äº†æˆ‘ä»¬ç½‘ç»œç¼–ç¨‹ï¼ŒåŒæ—¶ä¿è¯äº†é«˜å¯ç”¨å’Œé«˜æ€§èƒ½ï¼Œå› æ­¤æˆ‘è®¤ä¸ºå­¦ä¹ nettyå¯¹ä»¥åæ·±å…¥ä¸€äº›RPCæ¡†æ¶ï¼Œæˆ–è€…æ¥è§¦ä¸€äº›ç½‘ç»œé€šä¿¡éƒ½å¤§æœ‰è£¨ç›Šã€‚ ä»Šå¤©å°±æ˜¯æƒ³ä»æºç è§’åº¦å­¦ä¹ ä¸€ä¸‹nettyçš„reactorçº¿ç¨‹æ¨¡å‹ï¼Œè¿™åº”è¯¥æ˜¯nettyçš„æ ¸å¿ƒä¹‹ä¸€ï¼Œæ•´ç¯‡æ–‡ç« åŒ…å«çš„åªæ˜¯æˆ‘ä½œä¸ºä¸€ä¸ªåˆå­¦è€…çš„ç²—æµ…è§è§£ï¼ŒåŒæ—¶ä¹Ÿå€Ÿé‰´äº†å¤§é‡çš„åšå®¢æ–‡ç« ï¼Œå› æ­¤å¯¹éƒ¨åˆ†å†…å®¹è®¤è¯†ä¸å¤Ÿæ·±å…¥ï¼Œæˆ–è€…å­˜åœ¨é€»è¾‘ä¸é€šçš„æƒ…å†µï¼Œå¸Œæœ›èƒ½å¤Ÿè°…è§£ã€‚ Reactorç®€ä»‹åœ¨æ¥è§¦nettyä¹‹å‰ï¼Œé¦–å…ˆå…ˆä»‹ç»ä¸€äº›åŸºç¡€çŸ¥è¯†ï¼Œè®©æˆ‘ä»¬äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯Reactoræ¨¡å¼ ç»´åŸºç™¾ç§‘çš„è§£è¯»å¦‚ä¸‹ The reactor design pattern is an event handling pattern for handling service requests delivered concurrently to a service handler by one or more inputs. The service handler then demultiplexes the incoming requests and dispatches them synchronously to the associated request handlers. ç¿»è¯‘æ€»ç»“ä¸»è¦æœ‰è¿™ä¹ˆå‡ ç‚¹ reactoræ˜¯ä¸€ç§äº‹ä»¶é©±åŠ¨çš„è®¾è®¡æ¨¡å¼ reactorå¯ä»¥åŒæ­¥åœ°æ¥å—å¤šä¸ªè¾“å…¥æº reactorä»¥å¤šè·¯å¤ç”¨çš„æ¨¡å¼åˆ†å‘å¤šä¸ªè¯·æ±‚åˆ°å¯¹åº”çš„å¤„ç†å™¨ä¸Šå» è®©æˆ‘ä»¬æ‹¿å®é™…æƒ…æ™¯åšä¾‹å­ã€‚ åœ¨ä¼ ç»ŸBIOä¸­ï¼Œä¸€æ—¦é‡åˆ°å¤šä¸ªäº‹ä»¶è¯·æ±‚å¹¶å‘ï¼Œäº‹ä»¶ç›‘å¬å™¨åªä¼šå°†åé¢çš„çº¿ç¨‹é˜»å¡ï¼Œç­‰åˆ°å½“å‰çº¿ç¨‹å¤„ç†ç»“æŸåæ‰èƒ½ç»§ç»­è¿›è¡Œç›‘å¬æ¥å—åç»­è¯·æ±‚ï¼Œè¿™æ ·ä¼šå¤§å¤§é™ä½ååé‡ï¼Œå¢å¤§ç³»ç»Ÿçš„è´Ÿè½½ï¼Œåœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹å®¹æ˜“é€ æˆæ˜æ˜¾çš„æ•°æ®å»¶è¿Ÿã€‚ å› æ­¤åœ¨NIOä¸­å°†è€—æ—¶çš„IOå¤„ç†æ“ä½œå’Œè¯·æ±‚çš„ç›‘å¬æ¥å—åˆ†ç¦»å¼€æ¥ï¼Œç”±ä¸€ä¸ªçº¿ç¨‹ä¸“é—¨ç›‘å¬äº‹ä»¶è¯·æ±‚ï¼Œå½“æ¥å—ä¸€ä¸ªè¯·æ±‚åå†å¼€å¯ä¸€æ¡çº¿ç¨‹ä¸“é—¨å¤„ç†IOè¯·æ±‚ï¼Œä»è€Œä¸»çº¿ç¨‹ä¸é˜»å¡ï¼Œè¾¾åˆ°äº†éé˜»å¡ã€‚ è‡³æ­¤ï¼ŒReactorçš„åŸºæœ¬æ¶æ„å·²ç»å‡ºæ¥äº†ï¼Œåœ¨ä¸Šè¿°æ–‡å­—ä¸­å·²ç»éšå«äº†Reactorçš„ä¸‰ç§åŸºç¡€è§’è‰²ï¼š Reactor å°†I/Oäº‹ä»¶åˆ†æ´¾ç»™å¯¹åº”çš„Handler Acceptor å¤„ç†å®¢æˆ·ç«¯æ–°è¿æ¥ï¼Œå¹¶åˆ†æ´¾è¯·æ±‚åˆ°å¤„ç†å™¨é“¾ä¸­ Handlers æ‰§è¡Œéé˜»å¡è¯»/å†™ ä»»åŠ¡ ç»å…¸çš„reactorçº¿ç¨‹æ¨¡å‹å¦‚å›¾æ‰€ç¤ºï¼Œ ä½†æ˜¯è¿™åªæ˜¯æœ€åˆçº§çš„æ¶æ„ï¼Œé’ˆå¯¹å…·ä½“å¤æ‚çš„åœºæ™¯ï¼Œè¿˜éœ€è¦åšå‡ºè¯¸å¤šä¼˜åŒ–ï¼Œæ¯”å¦‚æ„å»ºå¤„ç†IOè¯·æ±‚çš„çº¿ç¨‹æ± ã€å°†ç›‘å¬äº‹ä»¶å’Œåˆ†å‘äº‹ä»¶è¿›ä¸€æ­¥è§£è€¦ã€è¿›ä¸€æ­¥å‡å°‘èµ„æºå¼€é”€ç­‰ï¼Œè¿™äº›åœ¨è¿™é‡Œå°±ä¸å†å±•å¼€äº†ã€‚ nettyä¸­æ ¸å¿ƒçš„reactorçº¿ç¨‹æ¨¡å‹å°±æ˜¯ä¸€ä¸ªç›¸å¯¹æ›´æˆç†Ÿå’Œé«˜æ€§èƒ½çš„æ¨¡å‹ï¼Œå®ƒçš„æ¶æ„æ›´åƒæ˜¯ä¸‹å›¾ï¼Œæ˜¯ä¸€ä¸ªå¤šreactorå¤šçº¿ç¨‹çš„æ¨¡å‹ã€‚ å…¶ä¸­mainReactor ä¸»è¦æ˜¯ç”¨æ¥å¤„ç†ç½‘ç»œIO è¿æ¥å»ºç«‹æ“ä½œï¼Œé€šå¸¸ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥å¤„ç†ï¼Œè€ŒsubReactorä¸»è¦åšå’Œå»ºç«‹èµ·æ¥çš„socketåšæ•°æ®äº¤äº’å’Œäº‹ä»¶ä¸šåŠ¡å¤„ç†æ“ä½œï¼Œå®ƒçš„ä¸ªæ•°ä¸Šä¸€èˆ¬æ˜¯å’ŒCPUä¸ªæ•°ç­‰åŒï¼Œæ¯ä¸ªsubReactorä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ã€‚ å…³äºreactoræ¨¡å¼çš„æš‚æ—¶å°±ä»‹ç»è¿™ä¹ˆå¤šäº†ï¼Œå…¶å®å…³äºäº‹ä»¶çš„å¤„ç†è¿˜æœ‰å…¶ä»–çš„å¤„ç†æ¨¡å¼ã€‚åœ¨Douglas Schmidtçš„ä½œå“ã€ŠPOSA2ã€‹ä¸­æåˆ°äº†æœ‰å››ç§äº‹ä»¶å¤„ç†æ¨¡å¼: Reactor Proactor Asynchronous Completion Token Acceptor-Connector è¿™äº›ä»¥åæœ‰æ—¶é—´å†ç ”ç©¶ï¼Œä»Šå¤©å°±å…ˆä¸“æ³¨nettyçš„äº‹ä»¶å¤„ç† Reacorçº¿ç¨‹çš„å¯åŠ¨å’Œåˆ›å»ºå¾—ç›Šäºnettyè‰¯å¥½çš„å°è£…ï¼Œä½¿å¾—æˆ‘ä»¬åªè¦æ¥è§¦è¿‡nettyï¼Œç›¸ä¿¡éƒ½èƒ½ç›´æ¥æ„Ÿå—å…¶ä¸­reactoræ¨¡å¼çš„å­˜åœ¨ï¼Œä¸‹é¢ç»™ä¸€ä¸ªç®€å•çš„nettyæœåŠ¡ç«¯çš„å¯åŠ¨demo (æœ¬äººç¯å¢ƒ netty-all-4.1.48 )ï¼š 123456789101112131415161718192021222324252627public class NettyServer &#123; private final static int PORT = 8000; public static void main(String[] args) &#123; //nettyçš„å¯åŠ¨å¼•å¯¼ç±» ServerBootstrap serverBootstrap = new ServerBootstrap(); //ç»‘å®šçº¿ç¨‹ç»„ï¼Œè¿™æ—¶æˆ‘ä»¬ä»Šå¤©é‡ç‚¹å…³æ³¨å¯¹è±¡ NioEventLoopGroup boss = new NioEventLoopGroup(); NioEventLoopGroup worker = new NioEventLoopGroup(); //åœ¨å¼•å¯¼ç±»ä¸­é…ç½®ç›¸å…³é€‰é¡¹ï¼Œè¿™äº›æš‚æ—¶ä¸è¦å»åœ¨æ„å®ƒ serverBootstrap .group(boss,worker) .option(ChannelOption.TCP_NODELAY,true) .option(ChannelOption.SO_BACKLOG,1024) .option(ChannelOption.SO_KEEPALIVE,true) .channel(NioServerSocketChannel.class) //æ·»åŠ äº‹ä»¶å¤„ç†ç±»ï¼Œå°±æ˜¯reactorä¸­çš„handlerè§’è‰² .childHandler(new ChannelInitializer&lt;NioSocketChannel&gt;() &#123; @Override protected void initChannel(NioSocketChannel ch) throws Exception &#123; ch.pipeline().addLast(new EchoHandler()); &#125; &#125;).bind(port); &#125;&#125; å…¶ä¸­æœ€é‡è¦çš„å°±æ˜¯NioEventLoopGroupï¼Œå› ä¸ºåœ¨è¿™é‡Œæˆ‘ä»¬åˆ›å»ºäº†äº‹ä»¶çš„ç›‘å¬å’Œåˆ†å‘å™¨ã€‚é‚£ä»€ä¹ˆæ˜¯NioEventLoopGroupå‘¢ï¼Ÿé€šè¿‡è¯ä¹‰å¯ä»¥çœ‹åˆ°è¯æ ¹æ˜¯EventLoop, åœ¨Jsä¸­æˆ‘ä»¬çŸ¥é“Eventloopå°±æ˜¯Jsçš„è¿è¡Œæœºåˆ¶ï¼Œæ˜¯é€šè¿‡å•çº¿ç¨‹å¾ªç¯è°ƒåº¦å¤„ç†äº‹ä»¶ï¼Œè¿™å…¶å®ä¹Ÿå’Œreactoræ¨¡å¼ä¸­ç”¨å•çº¿ç¨‹ç›‘å¬æ¥å—äº‹ä»¶éå¸¸ç›¸ä¼¼ï¼Œé‚£å†nettyä¸­æ˜¯å¦å°±æ˜¯è¿™ä¸ªæ„æ€å‘¢ï¼Ÿè®©æˆ‘ä»¬å…ˆå¾€ä¸‹çœ‹ NioEventLoopGroupå› æ­¤,ç°åœ¨å°±è®©æˆ‘ä»¬æ‰’ä¸€æ‰’NioEventLoopGroupçš„æºç ï¼Œçœ‹çœ‹é‡Œé¢åšäº†ä»€ä¹ˆã€‚é¦–å…ˆè¿›å…¥NioEventLoopGroupï¼Œå‘ç°å®ƒç»§æ‰¿äº†MultithreadEventLoopGroupï¼Œå…ˆä¸æ€¥çœ‹çˆ¶ç±»ï¼Œçœ‹ä¸€ä¸‹å®ƒçš„æ„é€ å‡½æ•°ï¼š 1234567891011121314public class NioEventLoopGroup extends MultithreadEventLoopGroup &#123; public NioEventLoopGroup() &#123; this(0); &#125;//...çœç•¥ä¸­é—´è‹¥å¹²ä¸ªæ„é€ å‡½æ•°//ä»ç¬¬ä¸€ä¸ªæ— å‚æ„é€ å‡½æ•°å¼€å§‹ï¼Œå‘ç°æœ€ç»ˆåˆ°è¾¾äº†è¿™ä¸ªæ„é€ å‡½æ•°public NioEventLoopGroup(...) &#123; super(nThreads, executor, new Object[]&#123;selectorProvider, selectStrategyFactory, RejectedExecutionHandlers.reject()&#125;); &#125;//...çœç•¥å…¶ä»–&#125; è§‚å¯Ÿä¸€ä¸‹å…¶ä¸­çš„ä¼ å…¥å‚æ•°,å…¶ä¸­å¤§éƒ¨åˆ†å‚æ•°éƒ½è¢«è®¾ç½®äº†é»˜è®¤å€¼ nThreads ï¼šè¡¨ç¤ºçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ï¼Œæ³¨æ„è¿™é‡Œçš„çº¿ç¨‹å¹¶éæ˜¯æˆ‘ä»¬å¸¸è§çš„çº¿ç¨‹ï¼Œå¤§å®¶å…ˆè¿™ä¸ªthreadçœ‹æˆæ˜¯æŸä¸ªå®ä½“ï¼Œæ¥ä¸‹æ¥ä¼šæ­æ™“è¿™ä¸ªå®ä½“æ˜¯ä»€ä¹ˆ executor: ä¼ å…¥çš„çº¿ç¨‹æ± å®ä¾‹ï¼Œè¿™ä¸ªæš‚æ—¶ä¸è¡¨ï¼Œåªè¦çŸ¥é“æ˜¯ç»™ä¸Šè¿°é‚£ä¸ªå®ä½“ç”¨çš„ selectorProvider: æˆ‘ä»¬éœ€è¦é€šè¿‡å®ƒæ¥å®ä¾‹åŒ– JDK çš„ Selectorï¼Œä¹Ÿå°±æ˜¯è¯´é‚£ä¸ªå®ä½“æŒæœ‰selector selectStrategyFactory ï¼šå…³äºselectorå¦‚ä½•selectçš„ç­–ç•¥ï¼Œä¹‹åç­‰æ­æ™“äº†è¿™ä¸ªå®ä½“ä¹‹åä¼šåšå‡ºè§£ç­” å…¶ä»–å‚æ•° chooserFactoryï¼š é€‰æ‹©ä»çº¿ç¨‹æ± ä¸­é€‰æ‹©çº¿ç¨‹ï¼ˆé‚£ä¸ªå®ä½“ï¼‰çš„ç­–ç•¥ rejectedExecutionHandlerï¼š çº¿ç¨‹æ± ä¸­å‡ºç°æ‹’ç»æ‰§è¡Œæ—¶çš„ç­–ç•¥, nettyçš„é»˜è®¤æ‹’ç»ç­–ç•¥æ˜¯æŠ›å‡ºå¼‚å¸¸ æ¥ä¸‹é‡Œæˆ‘ä»¬è¿›å…¥çˆ¶ç±»æŸ¥çœ‹æ„é€ æ–¹æ³• 12345private static final int DEFAULT_EVENT_LOOP_THREADS = Math.max(1, SystemPropertyUtil.getInt("io.netty.eventLoopThreads", NettyRuntime.availableProcessors() * 2));//çœ‹åˆ°nThreadså¦‚æœæ²¡æœ‰è¢«è®¾ç½®è¿‡å°±è¢«åˆå§‹åŒ–æˆæ ¸å¿ƒæ•°*2protected MultithreadEventLoopGroup(int nThreads, ThreadFactory threadFactory, Object... args) &#123; super(nThreads == 0 ? DEFAULT_EVENT_LOOP_THREADS : nThreads, threadFactory, args); &#125; ç»§ç»­è¿›å…¥çˆ¶ç±»æŸ¥çœ‹ 12345678//è¿›å…¥ä¸‹é¢çš„æ„é€ æ–¹æ³•protected MultithreadEventExecutorGroup(int nThreads, ThreadFactory threadFactory, Object... args) &#123; this(nThreads, (Executor)(threadFactory == null ? null : new ThreadPerTaskExecutor(threadFactory)), args); &#125;protected MultithreadEventExecutorGroup(int nThreads, Executor executor, Object... args) &#123; this(nThreads, executor, DefaultEventExecutorChooserFactory.INSTANCE, args); &#125; åˆ°è¿™é‡ŒMultithreadEventExecutorGroupä¼šå…ˆè®¾ç½®ä¸€ä¸ªThreadPerTaskExecutorï¼Œå°±æ˜¯ä¸Šé¢æ‰€è¯´çš„executor å†è®¾ç½®ä¸€ä¸ªchooserFactoryï¼Œç”¨æ¥å®ç°åœ¨çº¿ç¨‹æ± ä¸­é€‰æ‹©çº¿ç¨‹çš„é€‰æ‹©ç­–ç•¥ï¼Œè¿™éƒ¨åˆ†ä»£ç æ¯”è¾ƒç®€å•ï¼Œå°±ä¸è´´å‡ºæ¥äº† æ¥ç€this()å°±ä¼šè¿›å…¥æ­£å¼é…ç½®çš„æ„é€ æ–¹æ³• 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071protected MultithreadEventExecutorGroup(int nThreads, Executor executor, EventExecutorChooserFactory chooserFactory, Object... args) &#123; //.... //å°†æ‰€æœ‰childå®ä¾‹åŒ– for(int i = 0; i &lt; nThreads; ++i) &#123; boolean success = false; boolean var18 = false; try &#123; var18 = true; //æ³¨æ„è¿™é‡Œï¼Œæ„é€ äº†ä¸€ä¸ªçº¿ç¨‹æ± æ•°ç»„ this.children = new EventExecutor[nThreads]; int j; for(int i = 0; i &lt; nThreads; ++i) &#123; boolean success = false; boolean var18 = false; try &#123; var18 = true; //å®ä¾‹åŒ–ä¸€ä¸ªchild this.children[i] = this.newChild((Executor)executor, args); success = true; var18 = false; &#125; catch (Exception var19) &#123; throw new IllegalStateException("failed to create a child event loop", var19); &#125; finally &#123; //... ////è¿™é‡ŒæŒ‡ä¸Šé¢å®ä¾‹åŒ–childå¤±è´¥ï¼Œæ‰§è¡Œä¸‹é¢é€»è¾‘ if (!success) &#123; for(j = 0; j &lt; i; ++j) &#123; this.children[j].shutdownGracefully(); &#125; for(j = 0; j &lt; i; ++j) &#123; EventExecutor e = this.children[j]; try &#123; while(!e.isTerminated()) &#123; e.awaitTermination(2147483647L, TimeUnit.SECONDS); &#125; &#125; catch (InterruptedException var22) &#123; Thread.currentThread().interrupt(); break; &#125; &#125; &#125; &#125; //æ‰€æœ‰childéƒ½å·²ç»å®ä¾‹åŒ– //è®¾ç½®çº¿ç¨‹é€‰æ‹©ç­–ç•¥ this.chooser = chooserFactory.newChooser(this.children); //æ·»åŠ ç›‘å¬å™¨ï¼Œç›‘å¬æ¯ä¸ªçº¿ç¨‹æ˜¯å¦termination FutureListener&lt;Object&gt; terminationListener = new FutureListener&lt;Object&gt;() &#123; public void operationComplete(Future&lt;Object&gt; future) throws Exception &#123; if (MultithreadEventExecutorGroup.this.terminatedChildren.incrementAndGet() == MultithreadEventExecutorGroup.this.children.length) &#123; MultithreadEventExecutorGroup.this.terminationFuture.setSuccess((Object)null); &#125; &#125; &#125;; EventExecutor[] var24 = this.children; j = var24.length; for(int var26 = 0; var26 &lt; j; ++var26) &#123; EventExecutor e = var24[var26]; e.terminationFuture().addListener(terminationListener); &#125; //... &#125; &#125; æ¥ç€è¿›å…¥ä¸Šé¢çš„newChild()æ–¹æ³•,å®é™…ä¸Šæ˜¯è¿›å…¥çš„NioEventLoopçš„æ–¹æ³• 12345protected EventLoop newChild(Executor executor, Object... args) throws Exception &#123; EventLoopTaskQueueFactory queueFactory = args.length == 4 ? (EventLoopTaskQueueFactory)args[3] : null; //å®é™…ä¸Šæ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„NioEventLoop return new NioEventLoop(this, executor, (SelectorProvider)args[0], ((SelectStrategyFactory)args[1]).newSelectStrategy(), (RejectedExecutionHandler)args[2], queueFactory); &#125; è‡³æ­¤å¯ä»¥æ­æ™“è°œåº•äº†ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ï¼Œé‚£ä¸ªå®ä½“æŒ‡çš„å°±æ˜¯NioEventLoop!æ‰€ä»¥æˆ‘ä»¬æ•´æ®µä»£ç çœ‹ä¸‹æ¥ï¼Œå¯ä»¥å¾—å‡ºç»“è®ºï¼ŒNioEventLoopGroupåªæ˜¯ä¸€ä¸ªåˆ›å»ºNioEventLoopçš„å®ä½“æ± ï¼Œè€Œå¾ˆå¤šæ„é€ æ–¹æ³•é‡Œçš„å‚æ•°æœ€ç»ˆä¹Ÿæ˜¯è¦è¿›å…¥NioEventLoopè¿›è¡Œä½¿ç”¨ã€‚ å…¶å®æˆ‘ä»¬çœ‹è¯ä¹‰å’Œç»§æ‰¿å…³ç³»ä¹Ÿèƒ½çœ‹å‡ºä¸ªå¤§æ¦‚ï¼ŒNioEventLoopç»§æ‰¿äº†MultithreadEventLoopGroupï¼Œè€ŒNioEventLoopç»§æ‰¿äº†SingleThreadEventLoopï¼Œä¹Ÿæ˜¯å¤šå’Œä¸€çš„å…³ç³»ã€‚ NioEventLoopé‚£æ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦æŸ¥çœ‹NioEventLoopçš„æºç ï¼Œåº·åº·é‡Œé¢ç©¶ç«Ÿå–ç€ä»€ä¹ˆè‘«èŠ¦è¯ é¦–å…ˆçœ‹çœ‹å®ƒçš„æ„é€ æ–¹æ³• 12345678910111213141516171819202122232425262728NioEventLoop(...) &#123; super(parent, executor, false, newTaskQueue(queueFactory), newTaskQueue(queueFactory), rejectedExecutionHandler);//è€é¢å­” this.provider = (SelectorProvider)ObjectUtil.checkNotNull(selectorProvider, "selectorProvider");//è€é¢å­” this.selectStrategy = (SelectStrategy)ObjectUtil.checkNotNull(strategy, "selectStrategy");//selecorï¼Œé‡è¦çš„ç»„ä»¶ NioEventLoop.SelectorTuple selectorTuple = this.openSelector(); this.selector = selectorTuple.selector; this.unwrappedSelector = selectorTuple.unwrappedSelector;&#125;//çœ‹ä¸€ä¸‹çˆ¶ç±»çš„æ„é€ æ–¹æ³•protected SingleThreadEventLoop(...) &#123; super(parent, executor, addTaskWakesUp, taskQueue, rejectedExecutionHandler); this.tailTasks = (Queue)ObjectUtil.checkNotNull(tailTaskQueue, "tailTaskQueue"); &#125;//çœ‹ä¸€ä¸‹çˆ¶ç±»çš„æ„é€ æ–¹æ³• protected SingleThreadEventExecutor(...) &#123; //... //è€é¢å­” this.executor = ThreadExecutorMap.apply(executor, this); //å…¶ä¸­æœ€é‡è¦çš„å°±æ˜¯è¿™ä¸ªtaskQueueï¼Œè”æƒ³ä¸€ä¸‹jsä¸­çš„Eventloopæ˜¯ä¸æ˜¯ä¹Ÿæœ‰è¿™ä¸ªä¸œè¥¿ï¼Ÿ //ä»»åŠ¡é˜Ÿåˆ—ï¼Œæäº¤ç»™ NioEventLoop çš„ä»»åŠ¡éƒ½ä¼šè¿›å…¥åˆ°è¿™ä¸ª taskQueue ä¸­ç­‰å¾…è¢«æ‰§è¡Œ this.taskQueue = (Queue)ObjectUtil.checkNotNull(taskQueue, "taskQueue"); //è€é¢å­” this.rejectedExecutionHandler = (RejectedExecutionHandler)ObjectUtil.checkNotNull(rejectedHandler, "rejectedHandler"); &#125; å‘ç°äº†å¾ˆå¤šè€é¢å­”äº†ï¼Œè¿™äº›éƒ½æ˜¯ç›´æ¥ä»å¤–å±‚ä¼ é€’è¿›æ¥çš„ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›æ¯”è¾ƒé‡è¦çš„ä¸œè¥¿ï¼Œæ¯”å¦‚selectorï¼Œè¿™æ˜¯reactorçš„é‡è¦è§’è‰² ç°åœ¨æˆ‘ä»¬å…¶å®å¯¹NioEventLoopçš„å…·ä½“å·¥ä½œæµç¨‹å°šä¸äº†è§£ï¼Œä½†æ˜¯é€šè¿‡å¯¹æ„é€ å‡½æ•°çš„åˆ†æï¼Œç›¸ä¿¡å¤§å®¶ä¹Ÿéƒ½æ˜ç™½äº†è¿™ä¸ªå®ä½“ç±»çš„é‡è¦æ€§ã€‚è¿™é‡Œåšä¸€ä¸‹æ€»ç»“ï¼Œæ¥ä¸‹æ¥ä¼šç»§ç»­åˆ†æNioEventLoopçš„å…·ä½“å·¥ä½œ ä»æ„é€ ä¸Šå¯ä»¥çœ‹å‡ºï¼ŒNioEventLoopå®é™…ä¸Šæ˜¯ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œåªä¸è¿‡æ˜¯ä¸€ä¸ªå•çº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œé‡Œé¢æŒæœ‰ä¸€ä¸ªSelectorï¼Œè´Ÿè´£Reactorä¸­æœ€é‡è¦çš„è§’è‰² æˆ‘ä»¬åˆ©ç”¨NioEventLoopGroupæ„å»ºNioEventLoopï¼ŒNioEventLoopGroupæ˜¯ä¸€ä¸ªNioEventLoopæ± ï¼Œé»˜è®¤åˆ›å»º2*æ ¸å¿ƒæ•°ä¸ªNioEventLoopï¼ŒåŒæ—¶ï¼Œå®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªNioEventLoopGroupï¼ŒæœåŠ¡ç«¯åˆ›å»ºä¸¤ä¸ªNioEventLoopGroupï¼Œå®é™…ä¸Šæ˜¯å¤šreactoræ¨¡å‹ï¼Œå¯¹äº‹ä»¶çš„æ¥å—å’Œåˆ†å‘åšè§£è€¦ï¼Œè¿™ä¸ªä¹‹åå›é¡¾æ•´ä½“æ¶æ„çš„æ—¶å€™å†ç»†è¯´ æ‰§è¡Œåœ¨nettyæœåŠ¡ç«¯çš„demoå¯åŠ¨åï¼Œä»£ç ä¼šæ‰§è¡Œåˆ°NioEventLoopçš„runæ–¹æ³•ï¼Œè®©æˆ‘ä»¬ç›´æ¥è¿›å…¥runæ–¹æ³•æŸ¥çœ‹eventloopæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980protected void run() &#123; int selectCnt = 0; while(true) &#123; while(true) &#123; while(true) &#123; try &#123; int strategy; try &#123; //æ³¨æ„è¿™é‡Œï¼Œè¿™é‡Œçš„selectStrategyå°±æ˜¯æˆ‘ä»¬ä¹‹å‰æ‰€æåˆ°çš„æ„é€ æ–¹æ³•é‡Œçš„ä¸€ä¸ªå‚æ•° //è¿™é‡Œæœ‰ä¸‰ä¸ªå€¼ï¼š-1ä»£è¡¨ SELECT -2ä»£è¡¨CONTINUE -3ä»£è¡¨BUSY_WAIT // strategy = this.selectStrategy.calculateStrategy(this.selectNowSupplier, this.hasTasks()); switch(strategy) &#123; case -3: case -1: long curDeadlineNanos = this.nextScheduledTaskDeadlineNanos(); if (curDeadlineNanos == -1L) &#123; curDeadlineNanos = 9223372036854775807L; &#125; this.nextWakeupNanos.set(curDeadlineNanos); try &#123; if (!this.hasTasks()) &#123; strategy = this.select(curDeadlineNanos); &#125; break; &#125; finally &#123; this.nextWakeupNanos.lazySet(-1L); &#125; case -2: continue; &#125; &#125; catch (IOException var38) &#123; this.rebuildSelector0(); selectCnt = 0; handleLoopException(var38); continue; &#125; ++selectCnt; this.cancelledKeys = 0; this.needsToSelectAgain = false; ///ioRatio çš„é»˜è®¤å€¼æ˜¯50 int ioRatio = this.ioRatio; boolean ranTasks; if (ioRatio == 100) &#123; try &#123; if (strategy &gt; 0) &#123; this.processSelectedKeys(); &#125; &#125; finally &#123; ranTasks = this.runAllTasks(); &#125; &#125; else if (strategy &gt; 0) &#123; long ioStartTime = System.nanoTime(); boolean var26 = false; try &#123; var26 = true; this.processSelectedKeys(); var26 = false; &#125; finally &#123; if (var26) &#123; long ioTime = System.nanoTime() - ioStartTime; this.runAllTasks(ioTime * (long)(100 - ioRatio) / (long)ioRatio); &#125; &#125; long ioTime = System.nanoTime() - ioStartTime; ranTasks = this.runAllTasks(ioTime * (long)(100 - ioRatio) / (long)ioRatio); &#125; else &#123; ranTasks = this.runAllTasks(0L); &#125; //... &#125; &#125;&#125; é‡ç‚¹å…³æ³¨å…¶ä¸­çš„ä¸€ä¸ª switch(strategy)ï¼Œä¸€ä¸ª if (ioRatio == 100) è¿™é‡Œå…¶å®ä¸»è¦æ¶‰åŠåˆ°ä¸‰ä¸ªæ“ä½œã€ select()ï¼šè½®è¯¢ï¼Œæ¥å—æ³¨å†Œåˆ°reactorçº¿ç¨‹ä¸Šçš„äº‹ä»¶ processSelectedKeys()ï¼šå¤„ç†äº§ç”Ÿç½‘ç»œIOäº‹ä»¶çš„channel runAllTasks()ï¼šå¤„ç†ä»»åŠ¡é˜Ÿåˆ— è¿™ä¸‰ä¸ªæ“ä½œå°±æ˜¯NioEventLoopçš„æ ¸å¿ƒæ“ä½œï¼Œå®é™…ä¸Šå°±åŒ…å«äº†channelçš„æ¥å—ï¼Œåˆ†å‘å’Œå¤„ç†ï¼Œä¸‹é¢å°±åˆ†åˆ«ä»‹ç»ä¸€ä¸‹è¿™ä¸‰ä¸ªæ“ä½œ select()æˆªå–runæ–¹æ³•ä¸­çš„ä¸€éƒ¨åˆ† 12345678910111213141516171819switch(strategy) &#123; //è¿™é‡Œæœ‰ä¸‰ä¸ªå€¼ï¼š-1ä»£è¡¨ SELECT -2ä»£è¡¨CONTINUE -3ä»£è¡¨BUSY_WAIT case -1: long curDeadlineNanos = this.nextScheduledTaskDeadlineNanos(); if (curDeadlineNanos == -1L) &#123; curDeadlineNanos = 9223372036854775807L; &#125; this.nextWakeupNanos.set(curDeadlineNanos); try &#123; if (!this.hasTasks()) &#123; strategy = this.select(curDeadlineNanos); &#125; break; &#125; finally &#123; this.nextWakeupNanos.lazySet(-1L); &#125; &#125; è¿™é‡Œä¸»è¦å…³æ³¨selectåˆ†æ”¯ï¼Œé¦–å…ˆè¦æ³¨æ„çš„æ˜¯selectæ˜¯ä¸€ä¸ªé˜»å¡æ–¹æ³•ï¼Œè¿”å›å€¼è¡¨ç¤ºå¤šå°‘channelå‡†å¤‡å°±ç»ªï¼Œå¯ä»¥è¿›å…¥å¤„ç†ã€‚ çœ‹ä¸€çœ‹selectå‰åå¤„ç†é€»è¾‘ï¼Œé¦–å…ˆè®¾ç½®å½“å‰æœ€è¿Ÿçš„è½®è¯¢æ—¶é—´ï¼Œç„¶åè¿›å…¥selectæ–¹æ³• 123456789private int select(long deadlineNanos) throws IOException &#123; if (deadlineNanos == 9223372036854775807L) &#123; return this.selector.select(); &#125; else &#123; //è®¾ç½®è¾¹ç•Œæ—¶é—´ä¸º0.995s long timeoutMillis = deadlineToDelayNanos(deadlineNanos + 995000L) / 1000000L; return timeoutMillis &lt;= 0L ? this.selector.selectNow() : this.selector.select(timeoutMillis); &#125; &#125; nettyé‡Œé¢å®šæ—¶ä»»åŠ¡é˜Ÿåˆ—æ˜¯æŒ‰ç…§å»¶è¿Ÿæ—¶é—´ä»å°åˆ°å¤§è¿›è¡Œæ’åºï¼Œæ¯æ¬¡è·å–ä»»åŠ¡éƒ½æ˜¯ä»å»¶è¿Ÿæ—¶é—´æœ€å°çš„å¼€å§‹è·å–ã€‚selectå°±æ˜¯é€šè¿‡åˆ¤æ–­æ˜¯å¦æœ‰ä»»åŠ¡æ­£åœ¨æ’é˜Ÿæ¥å†³å®šæ˜¯å¦è¿›è¡Œselect è¿™é‡Œï¼Œå¦‚æœæ—¶é—´å°äº0.995sï¼Œè¡¨ç¤ºæˆªæ­¢äº‹ä»¶æ—¶é—´å¿«åˆ°äº†ï¼Œé‚£å°±ç«‹åˆ»selectä¸€æ¬¡ï¼Œè°ƒç”¨selectNow()æ–¹æ³•ã€‚ å…¶ä¸­è¿˜è®¾ç½®äº†ä¸‹ä¸€æ¬¡å”¤é†’æ—¶é—´ï¼Œå¦‚æœæˆªæ­¢æ—¶é—´åˆ°äº†ä½†æ˜¯ä»»åŠ¡è¿˜æ²¡æœ‰è¢«å¤„ç†ï¼Œå°±ä¼šè‡ªåŠ¨å”¤é†’ Â· processSelectedKeys()è®©æˆ‘ä»¬è¿›å…¥processSelectedKeys()æ–¹æ³•çœ‹çœ‹é‡Œé¢å¹²äº†ä»€ä¹ˆ 12345678910private void processSelectedKeys() &#123; if (this.selectedKeys != null) &#123; //å¤„ç†ä¼˜åŒ–è¿‡çš„SelectionKey this.processSelectedKeysOptimized(); &#125; else &#123; //å¤„ç†æ­£å¸¸æƒ…å†µçš„SelectionKey this.processSelectedKeysPlain(this.selector.selectedKeys()); &#125; &#125; æˆ‘ä»¬çŸ¥é“SelectionKeyä»£è¡¨äº‹ä»¶è¿”å›çš„å¯¹è±¡ï¼Œé‡Œé¢æœ‰æ„Ÿå…´è¶£äº‹ä»¶é›†åˆï¼Œå‡†å¤‡å°±ç»ªçš„äº‹ä»¶é›†åˆï¼Œchannelï¼Œselectorï¼Œattachmentç­‰ ä¼˜åŒ–è¿‡çš„SelectionKeyå’Œæ­£å¸¸çš„SelectionKeyçš„åŒºåˆ«åœ¨äºnettyé‡å†™äº†SelectedSelectionKeySetçš„selectedKeyså±æ€§å’ŒpublicSelectedKeyså±æ€§ï¼Œä½¿å¾—åŸæ¥çš„setå˜æˆæ•°ç»„ï¼Œé™ä½äº†ä¿®æ”¹å…ƒç´ çš„äº‹ä»¶å¤æ‚åº¦ã€‚ çœ‹ä¸€ä¸‹processSelectedKeysOptimized()çš„ä»£ç ï¼š 123456789101112131415161718192021222324private void processSelectedKeysOptimized() &#123; for(int i = 0; i &lt; this.selectedKeys.size; ++i) &#123; //å–å‡ºIOäº‹ä»¶å’Œchannel SelectionKey k = this.selectedKeys.keys[i]; this.selectedKeys.keys[i] = null; //è·å–selectoinKeyä¸­çš„attachment Object a = k.attachment(); //attachmentä¸€èˆ¬æ˜¯AbstractNioChannelï¼Œå­˜æ”¾ç€å…·ä½“IOäº‹ä»¶ if (a instanceof AbstractNioChannel) &#123; this.processSelectedKey(k, (AbstractNioChannel)a); &#125; else &#123; NioTask&lt;SelectableChannel&gt; task = (NioTask)a; processSelectedKey(k, task); &#125; //éƒ¨åˆ†æƒ…å†µå¯èƒ½å‡ºç°éœ€è¦å†æ¬¡è½®è¯¢çš„æƒ…å†µ if (this.needsToSelectAgain) &#123; this.selectedKeys.reset(i + 1); this.selectAgain(); i = -1; &#125; &#125;&#125; ä»€ä¹ˆæ—¶å€™éœ€è¦å†æ¬¡è½®è¯¢ï¼Ÿ åœ¨channelä»selectorä¸Šç§»é™¤çš„æ—¶å€™ï¼Œè°ƒç”¨cancelå‡½æ•°å°†keyå–æ¶ˆï¼Œå¹¶ä¸”å½“è¢«å»æ‰çš„keyåˆ°è¾¾ CLEANUP_INTERVAL çš„æ—¶å€™ï¼Œè®¾ç½®needsToSelectAgainä¸ºtrue,CLEANUP_INTERVALé»˜è®¤å€¼ä¸º256 å› æ­¤æ¯æ»¡256æ¬¡ä¼šå°†selectedKeysçš„å†…éƒ¨æ•°ç»„å…¨éƒ¨æ¸…ç©ºï¼Œç„¶åé‡æ–°selectAgainé‡æ–°è£…è½½selectionKey runTasks()å…ˆçœ‹runæ–¹æ³•çš„ä»£ç ç‰‡æ®µ 12345678910111213141516171819202122232425262728293031323334 ++selectCnt; this.cancelledKeys = 0; this.needsToSelectAgain = false;//ioRatioæ˜¯ IO ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´æ¯”ä¾‹,å¦‚æœç­‰äº100è¡¨ç¤ºæ‰€æœ‰æ—¶é—´éƒ½è¢«ç”¨æ¥å¤„ç†ioä»»åŠ¡ï¼Œé»˜è®¤æ˜¯50 int ioRatio = this.ioRatio; boolean ranTasks; if (ioRatio == 100) &#123; try &#123; if (strategy &gt; 0) &#123; this.processSelectedKeys(); &#125; &#125; finally &#123; ranTasks = this.runAllTasks(); &#125; &#125; else if (strategy &gt; 0) &#123; long ioStartTime = System.nanoTime(); boolean var26 = false; try &#123; var26 = true; this.processSelectedKeys(); var26 = false; &#125; finally &#123; if (var26) &#123; long ioTime = System.nanoTime() - ioStartTime; this.runAllTasks(ioTime * (long)(100 - ioRatio) / (long)ioRatio); &#125; &#125; long ioTime = System.nanoTime() - ioStartTime; ranTasks = this.runAllTasks(ioTime * (long)(100 - ioRatio) / (long)ioRatio); &#125; else &#123; ranTasks = this.runAllTasks(0L); &#125; å¦‚æœioRatioä¸º100åŒæ—¶å°±ç›´æ¥æ‰§è¡ŒIOæ“ä½œï¼Œå¹¶æœ€åå¤„ç†è¿”å›çš„ä»»åŠ¡ å¦‚æœioRatioä¸æ˜¯100 å°±è®¡ç®—ioå¤„ç†é™åˆ¶æ—¶é—´ï¼Œè®¾ç½®å¤„ç†è¿”å›ä»»åŠ¡çš„æˆªæ­¢æ—¶é—´ï¼Œè®©å¤„ç†I/Oäº‹ä»¶çš„æ—¶é—´å’Œæ‰§è¡Œä»»åŠ¡çš„æ—¶é—´ä¸º1:1ã€‚ å†çœ‹runAllTasksçš„å®ç°ä¹‹å‰ï¼Œå…ˆè¦æ˜ç™½taskç©¶ç«Ÿæ˜¯ä»€ä¹ˆã€‚åœ¨nettyä¸­ä¸€å…±æœ‰ä¸¤ç§ä»»åŠ¡ï¼Œä¸€ç§æ˜¯æ™®é€šä»»åŠ¡ï¼Œä¸€ç§æ˜¯å®šæ—¶ä»»åŠ¡ã€‚è¿™é‡Œå…ˆæŠ›å‡ºç»“è®ºï¼šæ™®é€šä»»åŠ¡å­˜æ”¾åœ¨taskQueueä¸­ï¼Œå®šæ—¶ä»»åŠ¡å­˜æ”¾åœ¨PriorityQueueä¸­ï¼Œè¿™éƒ¨åˆ†çš„ä»£ç è¿½è¸ªæš‚æ—¶å°±ä¸å†™å‡ºæ¥äº†ï¼Œè®©æˆ‘ä»¬é¦–å…ˆå…³æ³¨å¦‚ä½•å»è¿è¡Œè‡´è°¢taskså§ è¿›å…¥runAllTasks()çœ‹ä¸€ä¸‹: 1234567891011121314151617181920212223242526272829303132333435363738protected boolean runAllTasks(long timeoutNanos) &#123; //ç­‰ä¼šè®² this.fetchFromScheduledTaskQueue(); //ä»é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡ Runnable task = this.pollTask(); if (task == null) &#123; this.afterRunningAllTasks(); return false; &#125; else &#123; long deadline = timeoutNanos &gt; 0L ? ScheduledFutureTask.nanoTime() + timeoutNanos : 0L; long runTasks = 0L; long lastExecutionTime; while(true) &#123; //å¤„ç†ä»»åŠ¡ï¼Œè¿™é‡Œçš„taskå…¶å®å°±æ˜¯ä¸€ä¸ªRunnableç±»ï¼Œæ–¹æ³•é‡Œç›´æ¥runå°±è¡Œäº† safeExecute(task); //è®°å½•å¤„ç†å®Œçš„ä»»åŠ¡æ•° ++runTasks; //æ¯64ä¸ªä»»åŠ¡æ‰æ£€æŸ¥ä¸€æ¬¡timeoutï¼Œå› ä¸ºnanoTime()å¼€é”€æ¯”è¾ƒå¤§ if ((runTasks &amp; 63L) == 0L) &#123; lastExecutionTime = ScheduledFutureTask.nanoTime(); if (lastExecutionTime &gt;= deadline) &#123; break; &#125; &#125; //ç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ªä»»åŠ¡ task = this.pollTask(); if (task == null) &#123; lastExecutionTime = ScheduledFutureTask.nanoTime(); break; &#125; &#125; this.afterRunningAllTasks(); this.lastExecutionTime = lastExecutionTime; return true; &#125; &#125; æ•´ä½“é€»è¾‘è¿˜ç®—ç®€å•ï¼Œä¸»è¦å…ˆçœ‹çœ‹fetchFromScheduledTaskQueue()é‡Œé¢åšäº†ä»€ä¹ˆ 1234567891011121314151617181920private boolean fetchFromScheduledTaskQueue() &#123; if (this.scheduledTaskQueue != null &amp;&amp; !this.scheduledTaskQueue.isEmpty()) &#123; long nanoTime = AbstractScheduledEventExecutor.nanoTime(); Runnable scheduledTask; do &#123; //åœ¨å®šæ—¶ä»»åŠ¡é˜Ÿåˆ—ä¸­è·å–ä¸€ä¸ªç¦»æˆªæ­¢æ—¶é—´æœ€è¿‘çš„ä»»åŠ¡ scheduledTask = this.pollScheduledTask(nanoTime); if (scheduledTask == null) &#123; return true; &#125;//æ·»åŠ æ™®é€šé˜Ÿåˆ—ä¸­å» &#125; while(this.taskQueue.offer(scheduledTask)); //å¦‚æœæ·»åŠ å¤±è´¥ï¼Œå°±å½’è¿˜å®šæ—¶ä»»åŠ¡ this.scheduledTaskQueue.add((ScheduledFutureTask)scheduledTask); return false; &#125; else &#123; return true; &#125; &#125; ä¹‹å‰è¯´è¿‡taskåŒ…å«æ™®é€šä»»åŠ¡å’Œå®šæ—¶ä»»åŠ¡ï¼Œåˆ†åˆ«å¤„åœ¨ä¸åŒçš„é˜Ÿåˆ—ä¸­ã€‚å¯è§è¿™ä¸ªå‡½æ•°çš„ä¸»è¦ä½œç”¨å°±æ˜¯å°†å®šæ—¶ä»»åŠ¡æ·»åŠ åˆ°æ™®é€šé˜Ÿåˆ—ä¸­å»ï¼Œè¿™æ ·åé¢å¤„ç†ä»»åŠ¡çš„æ—¶å€™å°±å¯ä»¥ç»Ÿä¸€ä¸€ä¸ªé˜Ÿåˆ—ä¸­è·å–ã€‚ ä¸ºä»€ä¹ˆæ˜¯æ”¾åœ¨æ™®é€šé˜Ÿåˆ—ä¸­ï¼Ÿå› ä¸ºå®šæ—¶é˜Ÿåˆ—æ˜¯æŒ‰ç…§æ—¶é—´ä¼˜å…ˆçº§çš„é¡ºåºæ’åˆ—ï¼Œæ™®é€šä»»åŠ¡ä¹Ÿæ— æ³•æ­£å¸¸çš„æ’å…¥å®šæ—¶ä»»åŠ¡é˜Ÿåˆ—ï¼Œåä¹‹å¿«åˆ°æˆªæ­¢æ—¶é—´çš„å®šæ—¶ä»»åŠ¡æ˜¯å¯ä»¥çœ‹ä½œæ˜¯æ™®é€šä»»åŠ¡æ¥å¤„ç†çš„ã€‚ åˆ°è¿™é‡ŒrunTasksçš„é€»è¾‘ä¹ŸåŸºæœ¬è®²å®Œäº†ã€‚æ€»ç»“ä¸€ä¸‹ä¸»è¦å¹²äº†è¿™äº›äº‹ åè°ƒIOæ—¶é—´å’Œå¤„ç†ä»»åŠ¡çš„æ—¶é—´ï¼Œè®¡ç®—å¤„ç†ä»»åŠ¡éœ€è¦çš„deadlineæˆªæ­¢æ—¶é—´ èšåˆå®šæ—¶ä»»åŠ¡å’Œæ™®é€šä»»åŠ¡ï¼Œå¾ªç¯å–å‡ºä»»åŠ¡æ‰§è¡Œ æ¯æ‰§è¡Œ64æ¬¡ä»»åŠ¡å°±æ£€æŸ¥ä¸€æ¬¡æˆªæ­¢æ—¶é—´ï¼Œåˆ°æœŸé€€å‡ºå¾ªç¯ åœ¨afterRunningAllTasks()ä¸­ï¼Œåšä¸€äº›æ”¶å°¾åŠ¨ä½œ æ€»ç»“è‡³æ­¤ï¼ŒEventLoopä¸Šçš„æ‰€æœ‰ä»»åŠ¡éƒ½å¼€å§‹æ‰§è¡Œäº†ï¼Œæ•´ä¸ªæµç¨‹ä¹Ÿç»“æŸäº†ã€‚Â· æœ€åè®©æˆ‘ä»¬çœ‹çœ‹reactoræ¨¡å¼åŠå¯¹åº”ä¸‹å„ä¸ªè§’è‰²çš„å…·ä½“å®ç°ï¼Œè®©æˆ‘ä»¬å†çœ‹ä¸€çœ¼ Reactorçº¿ç¨‹æ¨¡å‹çš„ä¸»è¦å®ç°å®ä½“ï¼šNioEventLoop clientï¼š è¯·æ±‚çš„äº‹ä»¶ï¼Œå¯ä»¥ç†è§£æ˜¯ä¸€ä¸ªchannel acceptorï¼š selectorï¼Œä¸»è¦æŒ‡selectorçš„select()è´Ÿè´£çš„ç›‘å¬å¹¶æ¥å—äº‹ä»¶ mainReactorå’ŒsunReactorï¼šåœ¨æœåŠ¡ç«¯ä¼šç»‘å®šä¸¤ä¸ªNioEventLoopGroupï¼šparentGroupå’ŒchildGroupï¼Œä¸€èˆ¬åœ¨parentGroupä¸­å¤„ç†acceptäº‹ä»¶ï¼Œå†childGroupä¸­å¤„ç†å…¶ä»–äº‹ä»¶ã€‚IOäº‹ä»¶çš„å¤„ç†ä¸»è¦æ˜¯åœ¨processSelectedKeys()å‡½æ•°é‡Œï¼Œåˆ¤æ–­SelectionKeyçš„ç±»å‹ï¼Œå¹¶äº¤ç»™ä¸åŒçš„å‡½æ•°å¤„ç†ã€‚ queued tasks:å½“å»ºç«‹äº†è¿æ¥åï¼Œå¾…å¤„ç†ä»»åŠ¡å°±ä¼šè¿›å…¥tasks queueï¼Œç­‰åˆ°å†runTasks()ä¸­å¾ªç¯é˜Ÿåˆ—å¤„ç†ï¼Œæ¯ä¸ªä»»åŠ¡å¯¹åº”ä»threadpoolä¸­å–å‡ºä¸€æ¡worker threadè¿›è¡Œå¤„ç† å‚è€ƒåšå®¢ã€NIOç³»åˆ—ã€‘â€”â€”ä¹‹Reactoræ¨¡å‹ Java NIOæµ…æ-ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ]]></content>
      <categories>
        <category>æŠ€æœ¯æ¢ç´¢</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>netty</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[scrapyçˆ¬è™«å…¥é—¨]]></title>
    <url>%2F2020%2F05%2F12%2Fscrapy1%2F</url>
    <content type="text"><![CDATA[var ap = new APlayer({ element: document.getElementById("aplayer-uPhkWXAt"), narrow: false, autoplay: false, showlrc: false, music: { title: "Something I Need", author: "OneRepublic", url: "http://music.163.com/song/media/outer/url?id=26060071.mp3", pic: "http://p2.music.126.net/b2nl6jsVbqj23IV8dVvJcg==/7766950139663735.jpg?param=130y130", lrc: "" } }); window.aplayers || (window.aplayers = []); window.aplayers.push(ap); ç°åœ¨è¯´åˆ°çˆ¬è™«ï¼Œå¤§å®¶éƒ½ä¼šæˆ–å¤šæˆ–å°‘åœ°å°†pythonå’Œçˆ¬è™«è”ç³»åœ¨ä¸€èµ·ï¼Œå½’æ ¹åˆ°åº•ï¼Œæ˜¯å› ä¸ºpythonä¸°å¯Œçš„ç”Ÿæ€å’Œçµæ´»ç®€å•çš„è¯­æ³•ã€‚åŒæ—¶åŸºäºpythonå­˜åœ¨æœ‰å‡ ä¸ªå¼ºå¤§çš„çˆ¬è™«æ¡†æ¶ï¼Œæå¤§åœ°é™ä½äº†çˆ¬è™«çš„éš¾åº¦ï¼Œæé«˜äº†ç¼–å†™ç¨‹åºçš„æ•ˆç‡ã€‚å› æ­¤ï¼Œä»Šå¤©å°±è®©æˆ‘ä»¬åˆæ¢å…¶ä¸­ä¸€ä¸ªå¼ºå¤§çš„pythonæ¡†æ¶â€”â€”scrapyï¼Œä½“éªŒä¸€ä¸‹ä½¿ç”¨æ¡†æ¶çˆ¬è™«çš„å¿«æ„Ÿå§ ç®€ä»‹ Scrapyæ˜¯ä¸€ä¸ªç”¨äºçˆ¬ç½‘ç½‘ç«™å’Œæå–ç»“æ„åŒ–æ•°æ®çš„åº”ç”¨ç¨‹åºæ¡†æ¶ï¼Œå¯ç”¨äºå„ç§æœ‰ç”¨çš„åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚æ•°æ®æŒ–æ˜ï¼Œä¿¡æ¯å¤„ç†æˆ–å†å²æ¡£æ¡ˆã€‚ â€”â€”ç¿»è¯‘è‡ªå®˜ç½‘ æ¨èç›´æ¥æŸ¥çœ‹å®˜ç½‘ï¼Œé‡Œé¢ç”šè‡³æœ‰å®Œæ•´çš„scraoyæ•™ç¨‹ï¼Œç®€ç›´æ˜¯æ·±å…¥å­¦ä¹ æ¡†æ¶çš„å¿…å¤‡é€‰æ‹©ï¼ å®‰è£…åœ¨å®‰è£…scrapyæ¡†æ¶çš„æ—¶å€™ï¼Œç½‘ä¸Šæœ‰è®¸å¤šæ–¹æ³•ï¼Œé’ˆå¯¹pythonçš„ç¯å¢ƒä¸åŒï¼Œå¯èƒ½å­˜åœ¨å¥‡å¥‡æ€ªæ€ªçš„é”™è¯¯ï¼Œè¿™é‡Œæˆ‘åŸºäºpython3ç¯å¢ƒï¼Œé¢„è£…äº†pipï¼Œäº²æµ‹ä¸€éè¿‡ é¢„è£…ç¯å¢ƒ Windows 10 + python 3.7.0 + pip20.1 +virtualenv åŒæ—¶è¯·å¼€å¯ä¸€ä¸ªæ–°çš„virtualç¯å¢ƒæ¥ä¿è¯ä¸ä¼šå‡ºç°å…¶ä»–åŒ…çš„ä¾èµ–å†²çª å‰æœŸå®‰è£…ç»„ä»¶ lxml pyOpenSSL Twisted PyWin32 å®‰è£…lxml ç›´æ¥pipå®‰è£…å³å¯ã€‚è¿™æ˜¯pythonä¸€ä¸ªHTMLã€XMLè§£æåº“ï¼Œå³ä½¿ä¸ç”¨æ¡†æ¶ä¹Ÿæ˜¯ç»å¸¸ä½¿ç”¨çš„ 1pip3 install lxml å®‰è£…PyWin32 å®˜ç½‘ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„å®‰è£…åŒ…åŒå‡»å®‰è£…å³å¯ [pywin32]([https://sourceforge.net/projects/pywin32/files/pywin32/Build%20221/](https://sourceforge.net/projects/pywin32/files/pywin32/Build 221/)) å®‰è£…å‰©ä½™ç»„ä»¶ è¿™é‡Œé¦–å…ˆè¦ä»‹ç»wheel wheelæ˜¯pythonçš„ä¸€ä¸ªæ‰“åŒ…æ ¼å¼ï¼Œä»¥å‰pythonä¸»æµçš„æ‰“åŒ…æ ¼å¼æ˜¯.eggæ–‡ä»¶ï¼Œä½†ç°åœ¨*.whlæ–‡ä»¶ä¹Ÿå˜å¾—æµè¡Œèµ·æ¥ã€‚ wheelå…¶å®ä¸Šæ˜¯pythonä¸Šä¸€ç§å‹ç¼©æ‰“åŒ…çš„ç»„ä»¶ï¼Œæœ‰ç‚¹ç±»ä¼¼äºzipä¹‹ç±»çš„ï¼Œä½†åœ¨æœ¬æ–‡ä¸­ä½ åªè¦çŸ¥é“é€šè¿‡wheelæ–‡ä»¶æ ¼å¼æ–‡ä»¶ä½ å¯ä»¥å¿«é€Ÿå°†ä¸€ä¸ªåº“å®‰è£…åˆ°ä½ çš„pythonç¯å¢ƒä¸­ å®‰è£…å…¶å®ä¹Ÿå¾ˆç®€å• 1pip3 install wheel è¿™æ ·ä½ çš„pythonç¯å¢ƒå°±æ”¯æŒ.whlæ–‡ä»¶æ ¼å¼çš„å®‰è£…å•¦ æ¥ä¸‹æ¥çš„æ­¥éª¤å°±æ˜¯åˆ°å„ä¸ªå®˜ç½‘ä¸Šä¸‹è½½å„ç»„ä»¶çš„whlæ ¼å¼ï¼Œæ³¨æ„è¦å’Œä½ çš„pythonç¯å¢ƒåŒ¹é… pyOpenSSL å®‰è£… 1pip3 install pyOpenSSL-19.1.0-py2.py3-none-any.whl Twistedæ³¨æ„è¦å’Œä½ çš„pythonç‰ˆæœ¬å¯¹åº” åƒæˆ‘çš„ç¯å¢ƒå°±æ˜¯ 1pip3 install Twisted-20.3.0-cp37-cp37m-win_amd64.whl å®‰è£…scrapy æ‰€æœ‰ä¾èµ–åŒ…å®‰è£…æˆåŠŸåç›´æ¥pipå®‰è£…scrapyå°±ä¸ä¼šæœ‰é—®é¢˜å•¦ 1pip3 install Scrapy ç»„ä»¶ä»‹ç»é¦–å…ˆåˆ›å»ºé¡¹ç›® åœ¨ä½ æƒ³è¦æ”¾ç½®çˆ¬è™«é¡¹ç›®çš„æ–‡ä»¶å¤¹è¿è¡Œï¼Œxxxå°±æ˜¯ä½ çš„é¡¹ç›®å 1scrapy startproject xxx é¡ºä¾¿è®°å½•ä¸€ä¸‹ä¸€äº›åŸºæœ¬çš„æ“ä½œ åˆ›å»ºé¡¹ç›®ï¼šscrapy startproject xxx è¿›å…¥é¡¹ç›®ï¼šcd xxx #è¿›å…¥æŸä¸ªæ–‡ä»¶å¤¹ä¸‹ åˆ›å»ºçˆ¬è™«ï¼šscrapy genspider xxxï¼ˆçˆ¬è™«åï¼‰ xxx.com ï¼ˆçˆ¬å–åŸŸï¼‰ ç”Ÿæˆæ–‡ä»¶ï¼šscrapy crawl xxx -o xxx.json (ç”ŸæˆæŸç§ç±»å‹çš„æ–‡ä»¶) è¿è¡Œçˆ¬è™«ï¼šscrapy crawl XXX åˆ—å‡ºæ‰€æœ‰çˆ¬è™«ï¼šscrapy list è·å¾—é…ç½®ä¿¡æ¯ï¼šscrapy settings [options] åˆ›å»ºå®Œæˆåä½ å¯ä»¥çœ‹åˆ°æ–‡ä»¶å¤¹ä¸‹å¤šäº†è¿™äº›å†…å®¹ è®©æˆ‘ä»¬ä¸€ä¸ªä¸ªä»‹ç»è¿™äº›ç»„ä»¶ï¼ˆspider_demoæ˜¯ä½ çš„çˆ¬è™«é¡¹ç›®åï¼‰ scrapy.cfg: é¡¹ç›®çš„é…ç½®æ–‡ä»¶(åœ¨é¡¹ç›®æ–‡ä»¶å¤¹çš„å¹³è¡Œç›®å½•ä¸‹) spider_demo/spiders/: æ”¾ç½®spiderä»£ç çš„ç›®å½•. ï¼ˆæ”¾çˆ¬è™«çš„åœ°æ–¹ï¼‰ä¹Ÿæ˜¯ä½ æ”¾çˆ¬è™«å…·ä½“é€»è¾‘çš„åœ°æ–¹ spider_demo/items.py: é¡¹ç›®ä¸­çš„itemæ–‡ä»¶.ï¼ˆåˆ›å»ºå®¹å™¨çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯å®šä¹‰æœ€ç»ˆçˆ¬è™«å¾—åˆ°çš„ç»“æœæ ¼å¼çš„åœ°æ–¹ï¼‰ spider_demo/pipelines.py: é¡¹ç›®ä¸­çš„pipelinesæ–‡ä»¶.ï¼ˆå®ç°æ•°æ®çš„æ¸…æ´—ã€å­˜å‚¨å’ŒéªŒè¯ï¼‰ spider_demo/settings.py: é¡¹ç›®çš„è®¾ç½®æ–‡ä»¶.ï¼ˆçˆ¬è™«çš„å…·ä½“é…ç½®ï¼ŒåŒ…æ‹¬å¯åŠ¨æŸä¸ªä¸­é—´ä»¶ï¼Œå¯åŠ¨å…³é—­æŸä¸ªåŠŸèƒ½ç­‰ï¼‰ spider_demo/middlewares.py:å®šä¹‰é¡¹ç›®çš„ä¸‹è½½å™¨ä¸­é—´ä»¶å’Œçˆ¬è™«ä¸­é—´ä»¶ æ„Ÿè§‰æ˜¯ä¸æ˜¯è¿˜æœ‰ç‚¹è’™åœˆï¼Ÿæ¥ä¸‹æ¥ç®€å•ä»‹ç»ä¸€ä¸‹scrapyè¿è¡Œçš„åŸç†ï¼Œè¿™æ ·ç›¸ä¿¡å°±èƒ½æ›´ç†è§£è¿™äº›ç»„ä»¶çš„ä½œç”¨äº† å®˜ç½‘çš„æµç¨‹å›¾ Scrapyæ˜¯ç”±æ‰§è¡Œå¼•æ“æ§åˆ¶æ‰§è¡Œçš„ Spiderå‘èµ·è¯·æ±‚ç»™Engine Engineå®‰æ’è¯·æ±‚Schedulerå’Œæ¥å—ä¸‹ä¸€ä¸ªçˆ¬å–è¯·æ±‚ Schedulerè¿”å›ä¸‹ä¸€ä¸ªè¯·æ±‚ Engineå°†è¯·æ±‚é€šè¿‡Downloader Middlewareså‘é€ç»™Downloader Downloaderçˆ¬å–ç½‘é¡µå¹¶å°†è¿”å›ç»“æœé€šè¿‡Downloader Middlewareså‘é€å›Engine å¼•æ“æ¥å—å“åº”å¹¶é€šè¿‡Spider Middlewareè½¬å‘ç»™Spiderå¤„ç† Spiderçš„parse()æ–¹æ³•å¯¹è·å–åˆ°çš„responseè¿›è¡Œå¤„ç†ï¼Œè§£æå‡ºitemsæˆ–è€…è¯·æ±‚ï¼Œå°†è§£æå‡ºæ¥çš„itemsæˆ–è¯·æ±‚ï¼Œè¿”å›ç»™Engine Engineå°†itemså‘é€åˆ°Item Pipline,å°†è¯·æ±‚å‘é€åˆ°Scheduler é‡å¤æ­¥éª¤1ç›´åˆ°æ²¡æœ‰æ–°çš„è¯·æ±‚ æ€»ç»“ä¸€ä¸‹ä¸Šé¢æ­¥éª¤å‡ºç°çš„ç»„ä»¶ ç»„ä»¶å ç»„ä»¶åŠŸèƒ½ Engine æ¡†æ¶æ ¸å¿ƒï¼Œè´Ÿè´£æ•´ä½“çš„æ•°æ®å’Œä¿¡å·çš„è°ƒåº¦ æ¡†æ¶å®ç° Scheduler ä¸€ä¸ªå­˜æ”¾è¯·æ±‚çš„é˜Ÿåˆ— æ¡†æ¶å®ç° Downloader æ‰§è¡Œå…·ä½“ä¸‹è½½ä»»åŠ¡çš„å•å…ƒ æ¡†æ¶å®ç° Spider å¤„ç†ä¸‹è½½å¾—åˆ°çš„å“åº”ç»“æœï¼Œæå–éœ€è¦çš„æ˜¯æ•°æ®ï¼ˆå…·ä½“çš„ä¸šåŠ¡é€»è¾‘ï¼‰ è‡ªå·±å®ç° Item Pipline å¤„ç†æœ€ç»ˆå¾—åˆ°çš„æ•°æ®ï¼Œå¦‚è¿›è¡ŒæŒä¹…åŒ–æ“ä½œ è‡ªå·±å®ç° Downloader MIddlewares åœ¨æ­£å¼è¿›è¡Œä¸‹è½½ä»»åŠ¡ä¹‹å‰ï¼Œå¯ä»¥è¿›è¡Œä¸€äº›è‡ªå®šä¹‰å¤„ç†ã€‚æ¯”å¦‚è®¾ç½®è¯·æ±‚å¤´ï¼Œè®¾ç½®ä»£ç† è‡ªå·±å®ç° Spider Midderwares è‡ªå®šä¹‰è¯·æ±‚å’Œè¿‡æ»¤å“åº” è‡ªå·±å®ç° ç›¸ä¿¡è¿™ä¸€å¥—ç»„åˆæ‹³ä¸‹æ¥åº”è¯¥èƒ½å¯¹è¿™ä¸ªæ¡†æ¶æœ‰äº†åŸºæœ¬çš„è®¤è¯†ï¼Œæ¥ä¸‹æ¥å°±é€šè¿‡å®æˆ˜æ¥å¼ºåŒ–ä¸€ä¸‹è®°å¿†å§ ç®€å•åº”ç”¨è¿™æ¬¡æ˜¯æ ¹æ®ç½‘ä¸Šé€šè¿‡çˆ¬å–çŒ«çœ¼ç”µå½±çš„æ’è¡Œæ¦œåšçš„ä¸€ä¸ªdemoï¼Œä»¥åæœ‰æ—¶é—´å†æ¢ä¸€ä¸ªæ›´åŠ å¤æ‚çš„demo å®ç°ç›®æ ‡æ˜¯çˆ¬å–ç”µå½±æ’è¡Œæ¦œä¸Šçš„ç‰‡åã€åˆ†æ•°å’Œæ’åï¼ŒåŒæ—¶å°†ç»“æœä»¥jsonçš„æ ¼å¼ä¿å­˜åœ¨ä¸€ä¸ª.jsonæ–‡ä»¶ä¸­ é¦–å…ˆä½ è¦ç¡®å®šä½ éœ€è¦çˆ¬å–å“ªäº›æ•°æ®ï¼Œå°†ä½ éœ€è¦çš„æ•°æ®è®°å½•åˆ°å®¹å™¨ä¸­ï¼Œåœ¨item.pyä¸­è¿›è¡Œç¼–å†™ï¼š 1234567891011import scrapy#è¿™é‡Œæˆ‘ä»¬éœ€è¦æ’åã€æ ‡é¢˜ã€æ”¶è—äººæ•°ã€ä¸Šæ˜ æ—¶é—´å’Œåˆ†æ•°class SpiderDemoItem(scrapy.Item): # define the fields for your item here like: # name = scrapy.Field() index = scrapy.Field() title = scrapy.Field() star = scrapy.Field() releasetime = scrapy.Field() score = scrapy.Field() æ¥ä¸‹æ¥åœ¨Spidersæ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ªçˆ¬è™«æ–‡ä»¶ï¼Œä¾‹å¦‚æˆ‘æ–°å»ºäº†ä¸€ä¸ªMoyanSpider.pyæ–‡ä»¶ 12345678910111213141516171819202122232425262728293031323334import scrapyfrom spider_demo.items import SpiderDemoItemclass MaoyanSpider(scrapy.Spider): #è¿™æ˜¯çˆ¬è™«å¯åŠ¨çš„åç§°ï¼Œä¹‹åå¯åŠ¨çˆ¬è™«å°±éœ€è¦ç”¨åˆ°è¿™ä¸ªåç§° name = "maoyan" #å¯ä»¥çˆ¬å–çš„åŸŸåå¯é€‰åˆ—è¡¨ allowed_domains = ["maoyan.com"] #ç›®æ ‡çˆ¬å–çš„ç½‘å€ start_urls = [ "http://maoyan.com/board/7/", "http://maoyan.com/board/4/", ] #å¤„ç†å·²ç»ä¸‹è½½çš„é¡µé¢ def parse(self, response): dl = response.css(".board-wrapper dd") #é€šè¿‡è§£æå¾—åˆ°å…·ä½“çš„æ•°æ®å­˜åˆ°å®¹å™¨ä¸­ for dd in dl: item = SpiderDemoItem() item["index"] = dd.css(".board-index::text").extract_first() item["title"] = dd.css(".name a::text").extract_first() item["star"] = dd.css(".star::text").extract_first() item["releasetime"] = dd.css(".releasetime::text").extract_first() score = dd.css('.integer::text').extract_first() if score is not None: item["score"] = score + dd.css('.fraction::text').extract_first() else: item["score"] = 0 #é€šè¿‡yieldå°†ç»“æœè¿”å› yield item è¿™é‡Œæä¸€ä¸‹ï¼Œscrapyæ”¯æŒå„ç§ç±»å‹çš„è§£æï¼Œä½ å¯ä»¥ä½¿ç”¨pythonå¸¸è§çš„ä¸‰å¤§è§£æåº“è¿›è¡Œè§£æï¼Œä½†æ¡†æ¶ä¹Ÿæä¾›äº†ä¸€ç§è‡ªå·±çš„è§£ææ–¹å¼ï¼ˆSelectorï¼‰ é€‰æ‹©å™¨ Xpath è¿™é‡Œä¸è¯¦ç»†å™è¿°ï¼Œä»¥åæœ‰æ—¶é—´å†ç»†èŠ åŒæ—¶æˆ‘ä»¬éœ€è¦åœ¨setting,pyä¸­å¯¹é…ç½®ç¨å¾®è¿›è¡Œä¿®æ”¹(setting.pyä¸­æœ‰è®¸å¤šé»˜è®¤é…ç½®ï¼Œè¿™é‡Œåªå±•ç¤ºä¿®æ”¹çš„éƒ¨åˆ†) 12345#å¦‚æœæ²¡æœ‰è‡ªåŠ¨ç”ŸæˆUAï¼Œå°±éœ€è¦æ‰‹åŠ¨å®šä¹‰ï¼Œä½†æ˜¯æ¯æ¬¡çˆ¬å–éƒ½æ˜¯åŒæ ·çš„UAå®¹æ˜“å‡ºç°éªŒè¯æ“ä½œï¼Œå› æ­¤åé¢è¿˜ä¼šä»‹ç»ä¸€ç§éšæœºç”ŸæˆUAçš„æ–¹æ³•USER_AGENT = 'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.100 Safari/537.36'#å…è®¸æœºå™¨äººåè®®ï¼Œå…³äºæœºå™¨äººåè®®çš„å…·ä½“å†…å®¹å¯ä»¥è‡ªè¡Œä¸Šç½‘æŸ¥æ‰¾ROBOTSTXT_OBEY = False è¿™æ ·ï¼ŒåŸºæœ¬å°±å®Œæˆäº†ä¸€ä¸ªç®€å•çš„çˆ¬è™«ï¼Œåªéœ€è¦æ‰§è¡Œscrapy crawl maoyan(æœ€åä¸€ä¸ªæ˜¯ä½ çš„çˆ¬è™«å) ä¹‹åè¿˜æœ‰ä¸¤ä¸ªè¦ç‚¹ï¼Œä¸€ä¸ªæ˜¯é¡¹ç›®çš„æŒä¹…åŒ–ï¼Œä¸€ä¸ªæ˜¯éšæœºåŒ–User-Agentã€‚ å…ˆçœ‹æŒä¹…åŒ–ï¼Œè¿™é‡Œç®€å•èµ·è§å°±ç¤ºèŒƒå°†çˆ¬è™«æ•°æ®ä»¥jsonæ ¼å¼å¯¼å‡º è¿™é‡Œéœ€è¦ä¿®æ”¹pipline.pyï¼Œè‡³äºä¸ºä»€ä¹ˆï¼Œç›¸ä¿¡çœ‹äº†ä¹‹å‰çš„ç»„ä»¶ä»‹ç»åº”è¯¥èƒ½æ˜ç™½ 1234567891011121314151617181920212223import jsonimport codecsclass SpiderDemoPipeline: def process_item(self, item, spider): return itemclass JsonPipline(object): def __init__(self): print("æ‰“å¼€æ–‡ä»¶ï¼Œå‡†å¤‡å†™å…¥....") self.file = codecs.open("maoyan.json", "wb", encoding='utf-8') def process_item(self, item, spider): print("å‡†å¤‡å†™å…¥...") line = json.dumps(dict(item), ensure_ascii=False) + "\n" self.file.write(line) return item def close_spider(self, spider): print("å†™å…¥å®Œæ¯•ï¼Œå…³é—­æ–‡ä»¶") self.file.close ç„¶ååœ¨setting.pyä¸­å¼€å¯è‡ªå®šä¹‰çš„pipline 1234ITEM_PIPELINES = &#123; # &apos;spider_demo.pipelines.SpiderDemoPipeline&apos;: 300, &apos;spider_demo.pipelines.JsonPipline&apos;: 200&#125; è‡³äºéšæœºåŒ–UAï¼Œå…ˆè¯´æ˜æ·»åŠ UAçš„åŸç† scrapyé¦–å…ˆä¼šè¯»å–setting.pyé‡Œé¢å…³äºUAçš„è®¾ç½®ï¼Œç„¶åç»è¿‡middlewareï¼Œå¦‚æœæ²¡æœ‰è¿›è¡Œè‡ªå®šä¹‰æ“ä½œï¼Œå°±ä¼šå°†é…ç½®ä¸­çš„UAæ·»åŠ åˆ°è¯·æ±‚å¤´ä¸­ã€‚å› æ­¤ï¼Œæƒ³è¦å®ç°éšæœºåŒ–UA,å®é™…ä¸Šå°±å¯ä»¥åœ¨å‘èµ·ç½‘é¡µè¯·æ±‚ä¹‹å‰ï¼Œåœ¨Download Middlewareä¸Šåšæ–‡ç« ã€‚ è¿™é‡Œåœ¨middleware.pyä¸Šåšäº†ä¿®æ”¹,å¼•å…¥äº†ç¬¬ä¸‰æ–¹åŒ…fake_useragent 123456789101112131415161718192021from scrapy import signalsimport randomfrom fake_useragent import UserAgentclass RandomUserAgentMiddleware(object): # éšæœºæ›´æ¢user-agent def __init__(self, crawler): super(RandomUserAgentMiddleware, self).__init__() self.ua = UserAgent() self.ua_type = crawler.settings.get("RANDOM_UA_TYPE", "random") @classmethod def from_crawler(cls, crawler): return cls(crawler) def process_request(self, request, spider): def get_ua(): return getattr(self.ua, self.ua_type) request.headers.setdefault('User-Agent', get_ua()) åŒæ—¶åœ¨setting.pyä¸Šåšä¿®æ”¹ 123456789DOWNLOADER_MIDDLEWARES = &#123; 'spider_demo.middlewares.SpiderDemoDownloaderMiddleware': 543, 'spider_demo.middlewares.RandomUserAgentMiddleware': 400, 'scrapy.downloadermiddleware.useragent.UserAgentMiddleware': None,&#125;# éšæœºé€‰æ‹©UA#è¿™ä¸ªæ˜¯è‡ªå·±è®¾ç½®çš„ï¼Œä¾èµ–äºfake-useragentRANDOM_UA_TYPE = 'random' è‡³æ­¤ï¼Œä¸€ä¸ªç®€å•çš„çˆ¬è™«åº”ç”¨å°±å®ç°äº†ï¼ å¯ä»¥çœ‹è§UAå‘ç”Ÿäº†å˜åŒ– åŒæ—¶ç”Ÿæˆäº†ä¸€ä¸ªmaoyan.jsonæ–‡ä»¶]]></content>
      <tags>
        <tag>python</tag>
        <tag>scrapy</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ˜¥æ‹›é¢ç»å°è®°]]></title>
    <url>%2F2020%2F05%2F12%2Finterview%2F</url>
    <content type="text"><![CDATA[var ap = new APlayer({ element: document.getElementById("aplayer-PESXheQB"), narrow: false, autoplay: false, showlrc: false, music: { title: "è¿½æ¢¦èµ¤å­å¿ƒ", author: "GALA", url: "http://music.163.com/song/media/outer/url?id=355992.mp3", pic: "http://p2.music.126.net/XDncptlBJ4_LN3hLBx-8aw==/19061133579343591.jpg?param=130y130", lrc: "" } }); window.aplayers || (window.aplayers = []); window.aplayers.push(ap); ä»3æœˆå¼€å§‹æ­£å¼æŠ•é€’ï¼Œåˆ°ç°åœ¨ï¼Œå¤§å¤§å°å°ç»å†äº†åå‡ åœºç¬”è¯•ï¼Œæ¥æ¥å›å›ä¹Ÿç®—ç»å†äº†ä¸å°‘çš„é¢è¯•ï¼Œä»ä¸€å¼€å§‹çš„è¸Œèº‡æ»¡å¿—åˆ°æ…¢æ…¢å¼€å§‹æ¥å—ç°å®ï¼Œè¿™ä¸¤ä¸ªæœˆæ¥çš„ç»å†ç¡®å®è®©æˆ‘å¼€å§‹è®¤æ¸…è‡ªå·±ï¼Œåœ¨æ¢¦æƒ³å’Œç°å®ä¸­æ…¢æ…¢æ‰¾å¯»å¹³è¡¡ã€‚ æ·±æ„Ÿè‡ªå·±èƒ½åŠ›çš„ä¸è¶³ï¼Œä½†æ˜¯åˆä¸ç”˜å°±è¿™æ ·åœæ­‡ï¼Œæ—¢ç„¶å†³å®šå°†æ­¤ä½œä¸ºæ¯•ç”Ÿçš„äº‹ä¸šï¼Œé‚£å°±ä¸è¦æŠ±æ€¨ï¼Œä¸€å¿ƒä¸€æ„ï¼Œä¸æ–­å‘å‰å§ã€‚ åˆ†äº«è¿™å‡ ä¸ªæœˆçš„é¢è¯•ç»éªŒ è…¾è®¯ä¸€å¼€å§‹æŠ•æå‰æ‰¹çš„æ—¶å€™æœŸæœ›æŒºé«˜ï¼Œç»“æœæŠ•äº†å‡ å®¶å…¬å¸éƒ½æ³æ— éŸ³è®¯ï¼Œå€’æ˜¯è…¾è®¯æˆä¸ºäº†æˆ‘çš„é¦–å®¶é¢è¯•å…¬å¸ã€‚ç¬¬ä¸€æ¬¡é¢è¯•æ„Ÿè§‰ç¡®å®å¾ˆç´§å¼ ï¼Œè™½ç„¶å¯¹è…¾è®¯çš„é¢è¯•é‡ç‚¹æœ‰æ‰€äº†è§£ï¼Œä½†æ˜¯å‡†å¤‡ä¾ç„¶ä¸å……åˆ†ã€‚é¢è¯•å®˜è¿˜æ˜¯éå¸¸å’Œè”¼ï¼Œè¿™è®©æˆ‘æ…¢æ…¢æ”¾æ¾äº†ä¸‹æ¥ï¼Œä½†æ˜¯æœ€åè¿˜æ˜¯è´¥åœ¨äº†ç®—æ³•é¢˜ä¸Šé¢ ä¸€é¢è®¡ç®—æœºç½‘ç»œ IPæŠ¥æ–‡å¤´æœ‰å“ªäº›ï¼Ÿ å½“æ—¶æ²¡æœ‰æå‰å‡†å¤‡ï¼Œå‡­ç€å¾ˆæ—©çš„è®°å¿†å‹‰å¼ºè¯´äº†å‡ºæ¥ ttlçš„ä½œç”¨ ç”Ÿå‘½å‘¨æœŸï¼Œæ ‡è®°IPæ•°æ®åŒ…è½¬å‘çš„æœ€å¤§è·³æ•°ï¼Œé˜²æ­¢åœ¨è®¡ç®—æœºç½‘ç»œä¸Šæ— ä¼‘æ­¢åœ°å¾ªç¯ æ‹¥å¡æ§åˆ¶ httpsæ€ä¹ˆä¼˜åŒ–ï¼ˆè¿™ä¸ªç¡®å®æ¯”è¾ƒæ‡µï¼‰ çœ‹äº†ä¸€ä¸‹åšå®¢ï¼Œå¤§è‡´æ€»ç»“è¿™äº›ï¼š False Startï¼šå®¢æˆ·ç«¯åœ¨å‘é€ Change Cipher Spec Finished åŒæ—¶å‘é€åº”ç”¨æ•°æ®ï¼ˆå¦‚ HTTP è¯·æ±‚ï¼‰ï¼ŒæœåŠ¡ç«¯åœ¨ TLS æ¡æ‰‹å®Œæˆæ—¶ç›´æ¥è¿”å›åº”ç”¨æ•°æ®ï¼ˆå¦‚ HTTP å“åº”ï¼‰ã€‚è¿™æ ·ï¼Œåº”ç”¨æ•°æ®çš„å‘é€å®é™…ä¸Šå¹¶æœªç­‰åˆ°æ¡æ‰‹å…¨éƒ¨å®Œæˆï¼Œæ•…è°“ä¹‹æŠ¢è·‘Â· å¯ç”¨TLS False Startå¯ä»¥èŠ‚çœä¸€ä¸ªRTTæ—¶é—´ï¼Œä½†æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½éœ€è¦æ”¯æŒNPN/ALPNï¼Œéœ€è¦é‡‡ç”¨æ”¯æŒå‰å‘ä¿å¯†çš„å¯†ç å¥—ä»¶ï¼Œå³ä½¿ç”¨ECDHEè¿›è¡Œå¯†é’¥äº¤æ¢ã€‚ å‡å°‘è¯ä¹¦å¤§å°ï¼Œä¾‹å¦‚ ECCï¼ˆElliptic Curve Cryptographyï¼Œæ¤­åœ†æ›²çº¿å¯†ç å­¦ï¼‰è¯ä¹¦ Session Resumption ä¼šè¯å¤ç”¨ï¼šå°†ç¬¬ä¸€æ¬¡æ¡æ‰‹è¾›è¾›è‹¦è‹¦ç®—å‡ºæ¥çš„å¯¹ç§°å¯†é’¥å­˜èµ·æ¥ï¼Œåç»­è¯·æ±‚ä¸­ç›´æ¥ä½¿ç”¨ã€‚è¿™æ ·å¯ä»¥èŠ‚çœè¯ä¹¦ä¼ é€ç­‰å¼€é”€ï¼Œä¹Ÿå¯ä»¥å°† TLS æ¡æ‰‹æ‰€éœ€ RTT å‡å°‘åˆ°ä¸€ä¸ªã€‚ å®ç°æ–¹æ³•ï¼šåˆ©ç”¨sessioinID åˆ¤åˆ«å®¢æˆ·ç«¯èº«ä»½ï¼ŒSession Ticket æ˜¯ç”¨åªæœ‰æœåŠ¡ç«¯çŸ¥é“çš„å®‰å…¨å¯†é’¥åŠ å¯†è¿‡çš„ä¼šè¯ä¿¡æ¯ï¼Œæœ€ç»ˆä¿å­˜åœ¨æµè§ˆå™¨ç«¯ã€‚æµè§ˆå™¨å¦‚æœåœ¨ ClientHello æ—¶å¸¦ä¸Šäº† Session Ticketï¼Œåªè¦æœåŠ¡å™¨èƒ½æˆåŠŸè§£å¯†å°±å¯ä»¥å®Œæˆå¿«é€Ÿæ¡æ‰‹ã€‚ é€‰ç”¨åˆé€‚çš„åŠ å¯†ç®—æ³• å®ç°ä¸€ä¸ªTCPæœåŠ¡å™¨ï¼ˆä¸€å¼€å§‹ä¸æ‡‚å…·ä½“è¦é—®ä»€ä¹ˆçŸ¥è¯†ç‚¹ï¼Œé¢è¯•å®˜å†è¡¥å……äº†ä¸€ä¸‹æ‰å¤§è‡´æ˜ç™½åº”è¯¥æ˜¯è€ƒå¯ŸIOã€socketè¿™äº›çš„â€¦ï¼‰è¦è¯´å‡ºè¿æ¥socketå»ºç«‹æœåŠ¡ç«¯å®¢æˆ·ç«¯çš„å…·ä½“è¿‡ç¨‹è§„åˆ™ï¼š æ­£ç­‰å¾…è¿æ¥è¯·æ±‚çš„ä¸€ç«¯æœ‰ä¸€ä¸ªå›ºå®šé•¿åº¦çš„è¿æ¥é˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—ä¸­çš„è¿æ¥å·²è¢«TCPæ¥å—ï¼ˆå®Œæˆä¸‰æ¬¡æ¡æ‰‹ï¼‰ï¼Œä½†è¿˜æ²¡æœ‰è¢«åº”ç”¨å±‚æ¥å—ã€‚æ³¨æ„ï¼šTCPæ¥å—ä¸€ä¸ªè¿æ¥æ˜¯å°†å…¶æ”¾å…¥è¿™ä¸ªé˜Ÿåˆ—ï¼Œè€Œåº”ç”¨å±‚æ¥å—è¿æ¥æ˜¯å°†å…¶ä»è¯¥é˜Ÿåˆ—ä¸­ç§»å‡ºã€‚ä¹Ÿå°±æ˜¯ä½¿ç”¨*\.accept()å‡½æ•°æ¥é˜»å¡ç­‰å¾…å®¢æˆ·çš„è¯·æ±‚**ã€‚ åº”ç”¨å±‚æŒ‡æ˜è¯¥é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦ï¼Œè¿™ä¸ªå€¼è¢«ç§°ä¸ºâ€œç§¯å‹å€¼(backlog)â€ï¼ŒèŒƒå›´ä¸º0~5ã€‚ä¹Ÿå°±æ˜¯ä½¿ç”¨*\.listen(5)å‡½æ•°æ¥æŒ‡å®šçš„é˜Ÿåˆ—é•¿åº¦ã€‚é€šå¸¸å–å€¼5** å½“ä¸€ä¸ªè¿æ¥è¯·æ±‚åˆ°è¾¾æ—¶ï¼ŒTCPä½¿ç”¨ä¸€ä¸ªç®—æ³•ï¼Œæ ¹æ®å½“å‰è¿æ¥é˜Ÿåˆ—ä¸­çš„è¿æ¥æ•°æ¥ç¡®å®šæ˜¯å¦æ¥æ”¶è¿™ä¸ªè¿æ¥ã€‚è¿™ä¸åŒäºç§¯å‹å€¼ï¼Œç§¯å‹å€¼è¯´æ˜çš„æ˜¯TCPç›‘å¬çš„ç«¯ç‚¹å·²è¢«TCPæ¥å—è€Œç­‰å¾…åº”ç”¨å±‚æ¥å—çš„æœ€å¤§è¿æ¥æ•°ã€‚è¿™ä¸ªç§¯å‹å€¼å¯¹ç³»ç»Ÿæ‰€å…è®¸çš„æœ€å¤§è¿æ¥æ•°ï¼Œæˆ–è€…å¹¶å‘æœåŠ¡å™¨æ‰€èƒ½å¹¶å‘å¤„ç†çš„å®¢æˆ·æ•°ï¼Œå¹¶æ— å½±å“ã€‚ å¦‚æœå¯¹äºæ–°çš„è¿æ¥è¯·æ±‚ï¼Œè¯¥TCPç›‘å¬çš„ç«¯ç‚¹çš„è¿æ¥é˜Ÿåˆ—ä¸­è¿˜æœ‰ç©ºé—´ï¼ŒTCPæ¨¡å—å°†å¯¹SYNè¿›è¡Œç¡®è®¤å¹¶å®Œæˆè¿æ¥çš„å»ºç«‹ã€‚ä½†åº”ç”¨å±‚åªæœ‰åœ¨ä¸‰æ¬¡æ¡æ‰‹ä¸­çš„ç¬¬ä¸‰ä¸ªæŠ¥æ–‡æ®µæ”¶åˆ°åæ‰ä¼šçŸ¥é“è¿™ä¸ªæ–°è¿æ¥ã€‚å¦å¤–ï¼Œå½“å®¢æˆ·è¿›ç¨‹çš„ä¸»åŠ¨æ‰“å¼€æˆåŠŸä½†æœåŠ¡å™¨çš„åº”ç”¨å±‚è¿˜ä¸çŸ¥é“è¿™ä¸ªæ–°è¿æ¥æ—¶ï¼Œå®ƒå¯èƒ½ä¼šè®¤ä¸ºæœåŠ¡å™¨è¿›ç¨‹å·²ç»å‡†å¤‡å¥½æ¥å—æ•°æ®äº†ã€‚æ­¤åï¼Œå¦‚æœå®¢æˆ·ç¨‹åºå‘é€æ•°æ®ï¼ŒæœåŠ¡å™¨çš„TCPæ¨¡å—ä¼šå°†æ¥æ”¶çš„æ•°æ®æ”¾å…¥ç¼“å­˜é˜Ÿåˆ—ã€‚ å¦‚æœå¯¹äºæ–°çš„è¿æ¥è¯·æ±‚ï¼Œè¿æ¥é˜Ÿåˆ—ä¸­å·²æ²¡æœ‰ç©ºé—´ï¼ŒTCPå°†ä¸ç†ä¼šæ”¶åˆ°çš„SYNï¼Œä¹Ÿä¸å‘å›ä»»ä½•æŠ¥æ–‡æ®µ(åŒ…æ‹¬RST)ï¼Œè¿™æ˜¯ä¸€ä¸ªè½¯é”™è¯¯ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªç¡¬é”™è¯¯ã€‚å¦‚æœåº”ç”¨å±‚ä¸èƒ½åŠæ—¶æ¥å—.listen(5)ä¸­çš„è¿æ¥ï¼Œè¾¾åˆ°ç§¯å‹å€¼(5)ï¼Œå®¢æˆ·çš„ä¸»åŠ¨æ‰“å¼€æœ€ç»ˆä¹Ÿå°†è¶…æ—¶ nginxè´Ÿè½½å‡è¡¡çš„ç­–ç•¥ï¼ˆå½“æ—¶çœŸçš„æ²¡æœ‰å¤ä¹ åˆ°è¿™..ï¼‰ weightæƒé‡åˆ¤æ–­ æ—¶é—´ç‰‡è½®è½¬ fairæ ¹æ®å“åº”æ—¶é—´ ip hash url hash Linux è¿›ç¨‹é—´é€šä¿¡çš„æ–¹å¼ï¼Œæœ€å¸¸ä½¿ç”¨çš„æœ‰å“ªäº›ï¼Ÿ è¿›ç¨‹çš„å†…å­˜ç»“æ„ï¼Œå †æ ˆçš„åŒºåˆ« ç®¡é“çš„æ³¨æ„äº‹é¡¹ å¦‚ä½•é¿å…æ­»é” é¿å…å¤šæ¬¡é”å®šã€‚å°½é‡é¿å…åŒä¸€ä¸ªçº¿ç¨‹å¯¹å¤šä¸ª Lockè¿›è¡Œé”å®šã€‚ä¾‹å¦‚ä¸Šé¢çš„æ­»é”ç¨‹åºï¼Œä¸»çº¿ç¨‹è¦å¯¹ Aã€B ä¸¤ä¸ªå¯¹è±¡çš„ Lockè¿›è¡Œé”å®šï¼Œå‰¯çº¿ç¨‹ä¹Ÿè¦å¯¹ Aã€B ä¸¤ä¸ªå¯¹è±¡çš„ Lockè¿›è¡Œé”å®šï¼Œè¿™å°±åŸ‹ä¸‹äº†å¯¼è‡´æ­»é”çš„éšæ‚£ã€‚ å…·æœ‰ç›¸åŒçš„åŠ é”é¡ºåºã€‚å¦‚æœå¤šä¸ªçº¿ç¨‹éœ€è¦å¯¹å¤šä¸ª Lockè¿›è¡Œé”å®šï¼Œåˆ™åº”è¯¥ä¿è¯å®ƒä»¬ä»¥ç›¸åŒçš„é¡ºåºè¯·æ±‚åŠ é”ã€‚æ¯”å¦‚ä¸Šé¢çš„æ­»é”ç¨‹åºï¼Œä¸»çº¿ç¨‹å…ˆå¯¹ A å¯¹è±¡çš„ LockåŠ é”ï¼Œå†å¯¹ B å¯¹è±¡çš„ LockåŠ é”ï¼›è€Œå‰¯çº¿ç¨‹åˆ™å…ˆå¯¹ B å¯¹è±¡çš„ LockåŠ é”ï¼Œå†å¯¹ A å¯¹è±¡çš„ LockåŠ é”ã€‚è¿™ç§åŠ é”é¡ºåºå¾ˆå®¹æ˜“å½¢æˆåµŒå¥—é”å®šï¼Œè¿›è€Œå¯¼è‡´æ­»é”ã€‚å¦‚æœè®©ä¸»çº¿ç¨‹ã€å‰¯çº¿ç¨‹æŒ‰ç…§ç›¸åŒçš„é¡ºåºåŠ é”ï¼Œå°±å¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ã€‚ ä½¿ç”¨å®šæ—¶é”ã€‚ç¨‹åºåœ¨è°ƒç”¨ acquire() æ–¹æ³•åŠ é”æ—¶å¯æŒ‡å®š timeoutå‚æ•°ï¼Œè¯¥å‚æ•°æŒ‡å®šè¶…è¿‡ timeoutç§’åä¼šè‡ªåŠ¨é‡Šæ”¾å¯¹ Lockçš„é”å®šï¼Œè¿™æ ·å°±å¯ä»¥è§£å¼€æ­»é”äº†ã€‚ æ­»é”æ£€æµ‹ã€‚æ­»é”æ£€æµ‹æ˜¯ä¸€ç§ä¾é ç®—æ³•æœºåˆ¶æ¥å®ç°çš„æ­»é”é¢„é˜²æœºåˆ¶ï¼Œå®ƒä¸»è¦æ˜¯é’ˆå¯¹é‚£äº›ä¸å¯èƒ½å®ç°æŒ‰åºåŠ é”ï¼Œä¹Ÿä¸èƒ½ä½¿ç”¨å®šæ—¶é”çš„åœºæ™¯çš„ã€‚ java hashmapçš„å†…éƒ¨ç»“æ„ï¼Œä»‹ç»äº†hashç®—æ³•ã€rehashæœºåˆ¶ æ•°æ®åº“ innodbå’ŒmyISamçš„åŒºåˆ« redisçš„æ•°æ®ç»“æ„ï¼Œè·³è¡¨çš„å®ç° éšæœºåŒ–å±‚æ•°çš„ç®—æ³• å®Œå…¨äºŒå‰æ ‘çš„æ·±åº¦ æ•°æ®ç»“æ„ å½’å¹¶æ’åºçš„æ—¶é—´å¤æ‚åº¦ æ·±åº¦ä¼˜å…ˆéå†å’Œå¹¿åº¦ä¼˜å…ˆéå†ä½¿ç”¨çš„æ•°æ®ç»“æ„ï¼ˆæ ˆï¼‰ topKé—®é¢˜ åœºæ™¯é¢˜ ä¸¤ä¸ªæ–‡ä»¶å­˜å‚¨qqå·ï¼Œå¦‚ä½•å»é‡ bitMap+ å¸ƒéš†è¿‡æ»¤å™¨ åˆ†å¸ƒå¼IDï¼Œæœ€èŠ‚çº¦å†…å­˜çš„æ–¹æ³• å¦‚æœæ•°æ®åº“å­˜åˆ†å¸ƒå¼IDï¼Œå¦‚ä½•ä¿è¯åˆ†å¸ƒå¼IDçš„å”¯ä¸€æ€§ï¼Œï¼ˆæ•°æ®åº“åŒæ­¥ï¼‰ å”¯ä¸€ç´¢å¼•è‡ªå¢ redisè‡ªå¢ UUID é›ªèŠ±ç®—æ³• ä»£ç é¢˜ ä¸¤ä¸ªæ ‘ï¼Œç”¨æ•°ç»„è¡¨ç¤ºï¼Œç»“åˆæˆä¸€ä¸ªæœ‰åºæ•°ç»„ åšçš„å¾ˆå‹‰å¼ºï¼Œå…¶å®ä¸ç”¨æƒ³å¤ªå¤šï¼Œç›´æ¥æ ‘åŒ–ï¼Œä¸­åºéå† äºŒé¢æ ¹æ®ä¸€é¢çš„æƒ…å†µï¼Œè‡ªå·±ä¹Ÿæ„Ÿè§‰åº”è¯¥æ˜¯æŒ‚äº† ï¼Œä½†å±…ç„¶è¿˜æœ‰äºŒé¢ã€‚è™½è¯´æ˜¯äºŒé¢ï¼Œå®é™…ä¸Šæ„Ÿè§‰å°±æ˜¯åœ¨åˆ·kpiï¼Œç”šè‡³æ²¡æœ‰ç»™ä»£ç é¢˜ï¼Œé—®çš„é—®é¢˜éƒ½å¾ˆæ•·è¡ï¼Œæ„Ÿè§‰å°±æ˜¯æ ¹æ®é¢˜åº“éšæœºæŠ½é¢˜é—®ï¼Œé¢å®Œååæ‰‹å°±ç»™æŒ‚ã€‚ï¼ŒçœŸä¸ç†è§£è¿™æ ·çš„é¢è¯•æ„ä¹‰ä½•åœ¨ï¼Œä»é¢è¯•è€…çš„è§’åº¦è¿™æ ·ä»ä¸€å¼€å§‹å°±æ²¡æœ‰ç»“æœçš„é¢è¯•å°±æ˜¯åœ¨æŒ¥éœæˆ‘ä»¬çš„æœŸå¾…ï¼Œæœ‰ç‚¹è´¥åå¥½æ„Ÿã€‚ è®¡ç®—æœºç½‘ç»œ IPæŠ¥æ–‡å¤´ ä¼ è¾“å±‚æŠ¥æ–‡å¤´ ä¸ºä»€ä¹ˆå‡ºç°IPæŠ¥æ–‡ ä¸€ä¸ªæ–‡æœ¬æ€ä¹ˆä»ä¸€ä¸ªä¸»æœºä¼ åˆ°å¦ä¸€ä¸ªä¸»æœº linux åŸºç¡€å‘½ä»¤ è™šæ‹Ÿåœ°å€ç©ºé—´ cæ–‡ä»¶åˆ°å¯æ‰§è¡Œæ–‡ä»¶çš„ç¼–è¯‘è¿‡ç¨‹ åŠ¨æ€é“¾æ¥å’Œé™æ€é“¾æ¥ ç³»ç»Ÿåº“å’Œæ ‡å‡†åº“çš„åŒºåˆ« ä¸€ä¸ªæ˜¯å•†å®¶è‡ªè¡Œå¼€å‘ï¼Œä¸€ä¸ªæ˜¯è¯­è¨€æ ‡å‡†çš„å‡½æ•°åº“ æ•°æ®åº“ æŸ¥è¯¢è¯­å¥ åˆ›å»ºç´¢å¼•çš„sqlè¯­å¥ 1CREATE INDEX index_name webå¼€å‘ ä½ äº†è§£è¿‡ä¸€äº›å®‰å…¨æ–¹é¢çš„ä¸œè¥¿å— æ€ä¹ˆè°ƒè¯•BUG æƒ…æ™¯é¢˜ é»‘å¸½å­ç™½å¸½å­ï¼Œè‡³å°‘ä¸€äººæˆ´é»‘å¸½å­ï¼Œå¦‚æœè‡ªå·±æ˜¯é»‘å¸½å­åˆ™é¼“æŒï¼Œä¸‰æ¬¡å¼€å…³ç¯åæ‰æœ‰äººé¼“æŒï¼Œé—®é»‘å¸½å­å‡ é¡¶ï¼ˆæƒ³äº†å¥½ä¹…æ‰æƒ³å‡ºæ¥çš„ï¼Œæ„Ÿè§‰æœ‰ç‚¹åšå¼ˆè®ºçš„æ„Ÿè§‰ï¼‰ ä¸‰é¡¶ã€‚å¦‚æœæ˜¯ä¸€ä¸ªäººæˆ´é»‘çš„,ç¬¬ä¸€æ¬¡ç†„ç¯ä»–å‘ç°æ‰€æœ‰äººéƒ½æ˜¯ç™½å¸½,æ‰€ä»¥ä»–å¿…ç„¶é»‘å¸½ï¼›å¯æ˜¯æ²¡æœ‰äººé¼“æŒ,è¯æ˜æ‰€æœ‰äººçœ‹åˆ°å…¶ä»–äººæœ‰æˆ´é»‘å¸½çš„,å¦‚æœæ˜¯ä¸¤ä¸ªäºº,é‚£ä¹ˆç¬¬äºŒæ¬¡ç†„ç¯é‚£ä¸¤ä¸ªäººä¼šä¸€èµ·é¼“æŒ,å› ä¸ºä»–ä»¬çŸ¥é“è‚¯å®šä¸åªä¸€ä¸ªé»‘å¸½å­,å¯è‡ªå·±åªçœ‹åˆ°ä¸€ä¸ªé»‘å¸½å­,æ‰€ä»¥è‚¯å®šè‡ªå·±ä¹Ÿæ˜¯é»‘å¸½å­,ä»¥æ­¤ç±»æ¨,ç»“æœå°±æ˜¯,ç†„å‡ æ¬¡ç¯å‡ ä¸ªé»‘å¸½å­ ä¸¤åŸå¸‚è·ç¦»sï¼Œä¸¤åˆ—è½¦ABç›¸å‘è€Œè¡Œï¼Œä¸€æ— äººæœºé€Ÿåº¦cï¼Œå¿«äºABï¼Œé£åˆ°ABåè¿”å›ï¼Œé—®æœ€åABç›¸é‡çš„æ—¶å€™æ— äººæœºé£çš„è·ç¦» ABç›¸å‘è€Œè¡Œ,è·ç¦»ä¸ºs,é€Ÿåº¦å°±æ˜¯a+b,æ—¶é—´å°±ä¸ºs/ï¼ˆa+b)é¸½å­çš„é€Ÿåº¦ä¸ºc,å®ƒç›´åˆ°ABç›¸é‡æ¶ˆè€—çš„æ—¶é—´ä¸ºs/ï¼ˆa+b)é‚£ä¹ˆå®ƒæ‰€é£è¡Œçš„è·¯ç¨‹=é€Ÿåº¦*æ—¶é—´=c*[s/ï¼ˆa+b)]=cs/(a+b) 5æœˆ15æ—¥æ›´ã€‚ æ­£å¼æ‰¹æ˜æ˜æ²¡æœ‰åšç¬”è¯•ï¼Œç»“æœå±…ç„¶è¿˜æœ‰ç”µè¯é¢ã€‚ã€‚è¿™ä¸ªæ—¶å€™æˆ‘å·²ç»æ²¡æœ‰åœ¨å‡†å¤‡é¢è¯•äº†ï¼Œæ‰€ä»¥ç­”å¾—ä¸æ˜¯å¾ˆå¥½ã€‚ã€‚è¿™æ¬¡çš„é¢è¯•å®˜å°±æ²¡æœ‰ä¸Šä¸€æ¬¡é‚£ä¹ˆäº²åˆ‡äº†ï¼Œæœ‰ç‚¹å’„å’„é€¼äººï¼Œä¸ç®¡æ€æ ·è¿˜æ˜¯è‡ªå·±æŠ€æœ¯å¤ªèœäº†ã€‚ æ­£å¼æ‰¹ç”µè¯é¢ UDPå’ŒTCP javaæ€ä¹ˆå®ç°çš„ï¼Ÿ ç°åœ¨forå¾ªç¯10è¯è¿æ¥UDPï¼Œç«¯å£å·æ˜¯å¦ä¼šé‡Šæ”¾(SQLè¿æ¥æ˜¯å¦ä¼šé‡Šæ”¾) å¦‚ä½•å®ç°å…±äº«å†…å­˜ï¼Ÿï¼ˆå†…å­˜æ·˜æ±°æœºåˆ¶ï¼Œçº¿ç¨‹å®‰å…¨æ€§ï¼‰ å¤§æ–‡ä»¶å­˜æ”¾å­—ç¬¦ä¸²ï¼Œæ±‚å‡ºç°æ¬¡æ•°æœ€å¤šçš„TOP5 ä¸€å¼ è¡¨ï¼Œæ—¶é—´ï¼Œç”¨æˆ·ID å¥–å“ID ç­çº§ æ±‚ XXæ—¶é—´æ®µä¸­è·å¥–æ¬¡æ•°æœ€å¤šçš„å­¦ç”ŸIDå’Œé¢†å–æ¬¡æ•°æœ€å¤šçš„å¥–å“ID 1SELECT stuId,count(*) as count FROM (SELECT * FROM tab WHERE time &lt; xxx AND time &gt; xxx) GROUP BY stuid ORDER BY count(*) LIMIT 5 è˜‘è‡è¡—è˜‘è‡è¡—æ˜¯æˆ‘é¢è¯•äº†æ‰çŸ¥é“çš„å…¬å¸ï¼Œç¡®å®å…¬å¸ç°åœ¨çš„è¿è¥ä¹Ÿä¸æ˜¯å¾ˆå¥½ï¼Œä½†ä¸å¾—ä¸è¯´è¿˜æ˜¯ä¸€å®¶æ ‡å‡†çš„äº’è”ç½‘å…¬å¸ï¼Œåœ¨åé¢ä¹Ÿé€šè¿‡ä¸€äº›åšå®¢ä¸“æ ä½œè€…æ¯”å¦‚æ•–ä¸™äº†è§£åˆ°äº†å…¬å¸çš„å†…éƒ¨æƒ…å†µå’Œæœªæ¥çš„å‘å±•ï¼Œä¸å¾—ä¸è¯´å¯¹æˆ‘çš„å‡†å¤‡å’Œæœªæ¥è§„åˆ’è¿˜æ˜¯èµ·åˆ°äº†ä¸€å®šçš„å½±å“ã€‚æœ€åç»ˆæ­¢äºäºŒé¢ï¼ˆè¯è¯´åˆšçœ‹åˆ°å…¬å¸è£å‘˜å°±æ”¶åˆ°äº†æ„Ÿè°¢ä¿¡â€¦)å€’ä¹Ÿæ²¡ä»€ä¹ˆé—æ†¾çš„ã€‚ ä¸€é¢ä¸€é¢é—®åŸºç¡€é—®çš„æœ‰ç‚¹åã€‚ã€‚ JavaåŸºç¡€ swap(Integer a,Ingteger b)å¦‚ä½•äº¤æ¢ ä½¿ç”¨æ•°ç»„ä¼ å‚ï¼ˆè¿™é“é¢˜ä¸å…è®¸ï¼‰ ä½¿ç”¨è‡ªå®šä¹‰ç±»ï¼Œsetã€getï¼ˆè¿™é“é¢˜ä¸å…è®¸ï¼‰ ç”±äºjavaä¸­å¯¹äºéåŸç”Ÿç±»å‹éƒ½è¯´ä¼ é€’å¼•ç”¨ï¼Œè€Œå¯¹äºåŸç”Ÿæ•°æ®ç±»å‹éƒ½è¯´é€šè¿‡ä¼ é€’å€¼çš„æ–¹å¼ä¼ é€’å‚æ•°çš„ï¼Œå¦‚æœä»…ä»…é€šè¿‡ä¼ é€’å€¼çš„æ–¹å¼æ¥äº¤æ¢a,bçš„å€¼ï¼Œåœ¨Javaä¸­æ˜¯ä¸å¯èƒ½å®ç°çš„ Integerè™½ç„¶ä¸æ˜¯åŸç”Ÿç±»å‹ï¼Œä½†æ˜¯jvmå¯¹è¿™ç§ç±»å‹æ·»åŠ äº†ç¼“å†²æ± ï¼Œæ¯æ¬¡ Java äº¤æ¢ä¸¤ä¸ªå˜é‡çš„æ•°å€¼å®ç°æ–¹æ³• è¿™ç§æ–¹æ³•ç†è®ºä¸Šå¯è¡Œï¼Œä½†æ˜¯å®é™…æ“ä½œè¡Œä¸é€š Mybatisä½¿ç”¨åŸç† å†…éƒ¨åŸç† ${} å’Œ #{}çš„åŒºåˆ« Spring äº‹åŠ¡ mysql äº‹åŠ¡çš„å®ç°åŸç† åœ¨äº‹ç‰©è¿›è¡Œè¿‡ç¨‹ä¸­ï¼Œæœªç»“æŸä¹‹å‰ï¼ŒDMLè¯­å¥æ˜¯ä¸ä¼šæ›´æ”¹åº•å±‚æ•°æ®ï¼Œåªæ˜¯å°†å†å²æ“ä½œè®°å½•ä¸€ä¸‹ï¼Œåœ¨å†…å­˜ä¸­å®Œæˆè®°å½•ã€‚åªæœ‰åœ¨äº‹ç‰©ç»“æŸçš„æ—¶å€™ï¼Œè€Œä¸”æ˜¯æˆåŠŸçš„ç»“æŸçš„æ—¶å€™ï¼Œæ‰ä¼šä¿®æ”¹åº•å±‚ç¡¬ç›˜æ–‡ä»¶ä¸­çš„æ•°æ® mysqlä»»æ„ä¸€æ¡DMLè¯­å¥ä»£è¡¨äº‹åŠ¡çš„å¼€å¯ï¼ŒåŒæ—¶é»˜è®¤è‡ªåŠ¨æäº¤äº‹åŠ¡ï¼Œå¦‚æœè¦å¼€å¯å›æ»šï¼Œéœ€è¦æ‰‹åŠ¨æäº¤äº‹åŠ¡ã€‚ äº‹åŠ¡çš„æäº¤å’Œå›æ»šæ˜¯å¦‚ä½•å®ç°çš„ begin/start transaction å‘½ä»¤å¹¶ä¸æ˜¯ä¸€ä¸ªäº‹åŠ¡çš„èµ·ç‚¹ï¼Œåœ¨æ‰§è¡Œåˆ°å®ƒä»¬ä¹‹åçš„ç¬¬ä¸€ä¸ªæ“ä½œInnoDBè¡¨çš„è¯­å¥ï¼Œäº‹åŠ¡æ‰çœŸæ­£å¯åŠ¨ã€‚å¦‚æœä½ æƒ³è¦é©¬ä¸Šå¯åŠ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨start transaction with consistent snapshot è¿™ä¸ªå‘½ä»¤ã€‚ å·²çŸ¥ç´¢å¼•A(a,b,c) ç°åœ¨æœ‰sqlè¯­å¥ï¼šwhere b &gt; 1 and a = 1and c =1 è¯·é—®æ˜¯å¦èƒ½åº”ç”¨ç´¢å¼•ï¼Ÿ ç°åœ¨æœ‰sqlè¯­å¥ï¼šwhere a = 1 and b &gt; 1 and c =1 è¯·é—®æ˜¯å¦èƒ½åº”ç”¨ç´¢å¼•ï¼Ÿ è€ƒçš„æ˜¯æœ€å·¦åŒ¹é…åŸåˆ™ sqlè¯­å¥ä¼˜åŒ–çš„è¿‡ç¨‹ é¡¹ç›®æ¶æ„ ä»‹ç»ä¸€ä¸‹é¡¹ç›® å¤šçº¿ç¨‹æŠ€æœ¯çš„è€ƒé‡ æ¶ˆæ¯é˜Ÿåˆ— å¦‚ä½•é˜²æ­¢æ¶ˆæ¯è¢«é‡å¤æ¶ˆè´¹ å¦‚ä½•é˜²æ­¢æ¶ˆæ¯è¢«é‡å¤ç”Ÿäº§ ä»…è€ƒè™‘é¡¹ç›®å‡ºç°é‡å¤æ¶ˆæ¯æ¨é€ï¼Œå¯ä»¥åŠ åŒæ­¥é” Kafkaçš„æ¶ˆè´¹æœºåˆ¶ è¿™ä¸ªç®—ç»™è‡ªå·±æŒ–å‘çš„ã€‚ã€‚æ˜æ˜ä¸å¤ªç†Ÿæ‚‰è¿˜è¦æ233 æ€»ç»“ åŸºç¡€çŸ¥è¯†æŒæ¡ä¸ç‰¢ï¼Œå°¤å…¶æ˜¯ç´¢å¼•è¿™å—å…·ä½“æè¿°çš„æ—¶å€™æ— æ³•æ¸…æ¥šæè¿° è®²è§£é¡¹ç›®çš„æ—¶å€™ç»™è‡ªå·±æŒ–å‘äº† æƒ…æ™¯é¢˜çš„ä¸´åœºå‘æŒ¥èƒ½åŠ›ï¼Œä¸€äº›åŸºç¡€çš„è®²è¿°èƒ½åŠ›ï¼ŒMVCCå®Œå…¨æ²¡æœ‰è®²å¥½ äºŒé¢è¿‡äº†å¥½ä¹…çš„äºŒé¢ã€‚ã€‚ é—®äº†é¡¹ç›®åº”ç”¨ jwtçš„åŸç† å¦‚ä½•ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ ç»“åˆåº”ç”¨åœºæ™¯è°ˆè°ˆrediså¦‚ä½•ä¿éšœæ•°æ®ä¸€è‡´æ€§ æˆ‘è¿˜æ˜¯æ²¡ç­”ä¸Šæ¥ï¼Œæ³¨æ„è¿™å’Œé‡å¤æäº¤ã€åˆ†å¸ƒå¼é”æ˜¯ä¸åŒçš„ æ–‡ä»¶ä¸Šä¼ ä¸ºä»€ä¹ˆä¸èƒ½æ”¾åœ¨æœ¬åœ°ï¼ˆç»“åˆæ— çŠ¶æ€è€ƒè™‘ï¼‰ FTPåè®®ä¸Šä¼ æ–‡ä»¶ æ–‡ä»¶å­˜æ”¾åœ¨æœ¬åœ°çš„è¯æ— æ³•é€šè¿‡ç”¨æˆ·ç™»å½•çŸ¥é“ç”¨æˆ·ä¿¡æ¯ï¼ˆå‚ç…§JWTï¼‰ çº¿ä¸Šå‡ºç°æ•°æ®ç¼“å­˜ä¸ä¸€è‡´é—®é¢˜æ€ä¹ˆè§£å†³ï¼Ÿ åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼šåŸç†ã€é—®é¢˜ä¸æ–¹æ³• ä½œä¸šå¸®ä½œä¸šå¸®é¢è¯•ä½“éªŒè¿˜è¡Œå§ï¼Œçœ‹çš„å‡ºæ¥é—®çš„é—®é¢˜ä¸æ˜¯å¾ˆæ·±ï¼Œå’Œå¤§å‚æœç„¶æ²¡æ³•æ¯”ï¼Œæœ€åæ”¶äº†offerï¼Œä½†æ˜¯æ‹’äº† ä¸€é¢é¡¹ç›®æ¶æ„ ç®€å•è®²è®²ä½ çš„é¡¹ç›®æ¶æ„ã€å†…å®¹ã€è´Ÿè´£éƒ¨åˆ† æ€ä¹ˆå®ç°çš„çˆ¬å– æ€ä¹ˆå®ç°çš„è®¢é˜…æœåŠ¡ æ•°æ®åº“ redisçš„æ•°æ®ç»“æ„ redisçš„åˆ†å¸ƒå¼é”å®ç° rediså„ç§æ•°æ®ç»“æ„çš„åº”ç”¨åœºæ™¯ redisè‡ªå¢å¦‚ä½•ä¿è¯åŸå­æ€§ redisæ˜¯å•çº¿ç¨‹çš„ mysqläº‹åŠ¡ã€ACID B+æ ‘çš„å®ç°æœºåˆ¶ webæ–¹é¢ æ€ä¹ˆç†è§£restfulè®¾è®¡è§„èŒƒ ä»£ç  å›å‹æ‰“å°äºŒç»´æ•°ç»„ äºŒé¢ é¡¹ç›® åˆ†å¸ƒå¼äº‹åŠ¡ åˆ†å¸ƒå¼äº‹åŠ¡äº†è§£è¿‡å—ï¼Ÿ åˆ†å¸ƒå¼äº‹åŠ¡çš„ç‰¹ç‚¹ äºŒæ®µå¼æäº¤ ä¸‰æ®µå¼æäº¤ è®¡ç®—æœºåŸºç¡€ â€¦å¿˜è®°äº†ï¼Œæ¯”è¾ƒå¸¸è§„ ç®—æ³• æ’åºçš„æ—¶é—´å¤æ‚åº¦ é€’å½’çš„æ—¶é—´å¤æ‚åº¦ OPPOæŠ€æœ¯é¢çœŸä¸çŸ¥é“oppoå…‰é ä¸€é¢æŠ€æœ¯é¢è¿˜æ²¡æœ‰ä»£ç æ˜¯æ€ä¹ˆé€‰äººçš„ã€‚ã€‚ æ•°ç»„å’Œé“¾è¡¨çš„åº•å±‚åŒºåˆ« æ•°ç»„çš„æŸ¥è¯¢å’Œé“¾è¡¨çš„å†…å­˜æŸ¥è¯¢æœ‰ä»€ä¹ˆä¸åŒ åœ¨æ“ä½œç³»ç»Ÿå†…å­˜ç®¡ç†æ–¹é¢ä¹Ÿæœ‰ä¸åŒã€‚æ­£å› ä¸ºæ•°ç»„ä¸é“¾è¡¨çš„ç‰©ç†å­˜å‚¨ç»“æ„ä¸åŒï¼Œåœ¨å†…å­˜é¢„è¯»æ–¹é¢ï¼Œå†…å­˜ç®¡ç†ä¼šå°†è¿ç»­çš„å­˜å‚¨ç©ºé—´æå‰è¯»å…¥ç¼“å­˜ï¼ˆå±€éƒ¨æ€§åŸç†ï¼‰ï¼Œæ‰€ä»¥æ•°ç»„å¾€å¾€ä¼šè¢«éƒ½è¯»å…¥åˆ°ç¼“å­˜ä¸­ï¼Œè¿™æ ·è¿›ä¸€æ­¥æé«˜äº†è®¿é—®çš„æ•ˆç‡ï¼Œè€Œé“¾è¡¨ç”±äºåœ¨å†…å­˜ä¸­åˆ†å¸ƒæ˜¯åˆ†æ•£çš„ï¼Œå¾€å¾€ä¸ä¼šéƒ½è¯»å…¥åˆ°ç¼“å­˜ä¸­ï¼Œè¿™æ ·æœ¬æ¥è®¿é—®æ•ˆç‡å°±ä½ï¼Œè¿™æ ·æ•ˆç‡åè€Œæ›´ä½äº†ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå› ä¸ºé“¾è¡¨å¸¦æ¥çš„åŠ¨æ€æ‰©å®¹çš„ä¾¿åˆ©æ€§ï¼Œåœ¨åšä¸ºç®—æ³•çš„å®¹å™¨æ–¹é¢ï¼Œç”¨çš„æ›´æ™®éä¸€ç‚¹ã€‚ mysql çº¿ç¨‹æ˜¯å¼‚æ­¥çš„å— éƒ¨åˆ†æ˜¯éƒ¨åˆ†ä¸æ˜¯ IOçº¿ç¨‹å¼‚æ­¥çš„åŸå› æ˜¯å¹¶è¡Œæ‰§è¡Œï¼ŒåŒæ—¶å¯ä»¥åˆ·æ–°é‚»é¡µ å¼‚æ­¥é€šçŸ¥ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ å¦‚ä½•ä¿è¯æ–­ç”µåæ•°æ®æ¢å¤ æ•°æ®ä¸€è‡´æ€§é—®é¢˜ åœ¨MySQL5.5ä»¥åŠä¹‹å‰ï¼Œ slaveçš„ SQLçº¿ç¨‹æ‰§è¡Œçš„relay log çš„ä½ç½®åªèƒ½ä¿å­˜åœ¨æ–‡ä»¶ï¼ˆrelay-log.infoï¼‰é‡Œé¢ï¼Œå¹¶ä¸”è¯¥æ–‡ä»¶é»˜è®¤æ¯æ‰§è¡Œ 10000æ¬¡äº‹åŠ¡åšä¸€æ¬¡åŒæ­¥åˆ°ç£ç›˜ï¼Œ è¿™æ„å‘³ç€ slaveæ„å¤– crashé‡å¯æ—¶ï¼Œ SQL çº¿ç¨‹æ‰§è¡Œåˆ°çš„ä½ç½®å’Œæ•°æ®åº“çš„æ•°æ®æ˜¯ä¸ä¸€è‡´çš„ï¼Œå°†å¯¼è‡´å¤åˆ¶æŠ¥é”™ï¼Œå¦‚æœä¸é‡æ­å¤åˆ¶ï¼Œåˆ™æœ‰å¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚ MySQL 5.6 å¼•å…¥å‚æ•°relay_log_info_repositoryï¼Œå°†è¯¥å‚æ•°è®¾ç½®ä¸º TABLEæ—¶ï¼Œ MySQL å°† SQL çº¿ç¨‹æ‰§è¡Œåˆ°çš„ä½ç½®å­˜åˆ°mysql.slave_relay_log_info è¡¨ï¼Œè¿™æ ·æ›´æ–°è¯¥è¡¨çš„ä½ç½®å’Œ SQL çº¿ç¨‹æ‰§è¡Œçš„ç”¨æˆ·äº‹åŠ¡ç»‘å®šæˆä¸€ä¸ªäº‹åŠ¡ï¼Œè¿™æ · slave æ„å¤–å®•æœºåï¼Œ slave é€šè¿‡ innodb çš„å´©æºƒæ¢å¤å¯ä»¥æŠŠ SQL çº¿ç¨‹æ‰§è¡Œåˆ°çš„ä½ç½®å’Œç”¨æˆ·äº‹åŠ¡æ¢å¤åˆ°ä¸€è‡´æ€§çš„çŠ¶æ€ã€‚ MySQL 5.6å¼•å…¥ GTIDå¤åˆ¶ï¼Œæ¯ä¸ª GTIDå¯¹åº”çš„äº‹åŠ¡åœ¨æ¯ä¸ªå®ä¾‹ä¸Šé¢æœ€å¤šæ‰§è¡Œä¸€æ¬¡ï¼Œ è¿™æå¤§åœ°æé«˜äº†å¤åˆ¶çš„æ•°æ®ä¸€è‡´æ€§ï¼› MySQL 5.5å¼•å…¥åŠåŒæ­¥å¤åˆ¶ï¼Œ ç”¨æˆ·å®‰è£…åŠåŒæ­¥å¤åˆ¶æ’ä»¶å¹¶ä¸”å¼€å¯å‚æ•°åï¼Œè®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œå¯ä¿è¯åœ¨è¶…æ—¶æ—¶é—´å†…å¦‚æœ binlogä¸ä¼ åˆ° slave ä¸Šé¢ï¼Œé‚£ä¹ˆç”¨æˆ·æäº¤äº‹åŠ¡æ—¶ä¸ä¼šè¿”å›ï¼Œç›´åˆ°è¶…æ—¶ååˆ‡æˆå¼‚æ­¥å¤åˆ¶ï¼Œä½†æ˜¯å¦‚æœåˆ‡æˆå¼‚æ­¥ä¹‹å‰ç”¨æˆ·çº¿ç¨‹æäº¤æ—¶åœ¨ master ä¸Šé¢ç­‰å¾…çš„æ—¶å€™ï¼Œäº‹åŠ¡å·²ç»æäº¤ï¼Œè¯¥äº‹åŠ¡å¯¹ masterä¸Šé¢çš„å…¶ä»– sessionæ˜¯å¯è§çš„ï¼Œå¦‚æœè¿™æ—¶ master å®•æœºï¼Œé‚£ä¹ˆåˆ° slave ä¸Šé¢è¯¥äº‹åŠ¡åˆä¸å¯è§äº†ï¼Œè¯¥é—®é¢˜ç›´åˆ° 5.7 æ‰è§£å†³ï¼› MySQL 5.7 å¼•å…¥æ— æŸåŠåŒæ­¥å¤åˆ¶ï¼Œå¼•å…¥å‚ rpl_semi_sync_master_wait_pointï¼Œè¯¥å‚æ•°é»˜è®¤ä¸º after_syncï¼ŒæŒ‡çš„æ˜¯åœ¨åˆ‡æˆåŠåŒæ­¥ä¹‹å‰ï¼Œäº‹åŠ¡ä¸æäº¤ï¼Œè€Œæ˜¯æ¥æ”¶åˆ° slave çš„ ACK ç¡®è®¤ä¹‹åæ‰æäº¤è¯¥äº‹åŠ¡ï¼Œä»æ­¤ï¼Œå¤åˆ¶çœŸæ­£å¯ä»¥åšåˆ°æ— æŸçš„äº†ã€‚ å»¶æ—¶æ€§Â· 5.5 æ˜¯å•çº¿ç¨‹å¤åˆ¶ï¼Œ 5.6 æ˜¯å¤šåº“å¤åˆ¶ï¼ˆå¯¹äºå•åº“æˆ–è€…å•è¡¨çš„å¹¶å‘æ“ä½œæ˜¯æ²¡ç”¨çš„ï¼‰ï¼Œ 5.7 æ˜¯çœŸæ­£æ„ä¹‰çš„å¤šçº¿ç¨‹å¤åˆ¶ï¼Œå®ƒçš„åŸç†æ˜¯åŸºäºgroup commitï¼Œ åªè¦master ä¸Šé¢çš„äº‹åŠ¡æ˜¯ group commitçš„ï¼Œé‚£ slave ä¸Šé¢ä¹Ÿå¯ä»¥é€šè¿‡å¤šä¸ª workerçº¿ç¨‹å»å¹¶å‘æ‰§è¡Œã€‚ å’Œ MairaDB10.0.0.5 å¼•å…¥å¤šçº¿ç¨‹å¤åˆ¶çš„åŸç†åŸºæœ¬ä¸€æ ·ã€‚ 1mysqldumpç”¨äºå¤‡ä»½ï¼Œè®°å½•ä¸€ä¸‹ redis é”æå‰é‡Šæ”¾äº†æ€ä¹ˆåŠ ä¸»ä»åŒæ­¥æ€ä¹ˆé˜²æ­¢é”ä¸ä¸¢å¤± redlock å®ç°åˆ†å¸ƒå¼é”çš„ä¸€ä¸ªéå¸¸é‡è¦çš„ç‚¹å°±æ˜¯setçš„valueè¦å…·æœ‰å”¯ä¸€æ€§ï¼Œredissonçš„valueæ˜¯æ€æ ·ä¿è¯valueçš„å”¯ä¸€æ€§å‘¢?ç­”æ¡ˆæ˜¯UUID+threadId å¦‚æœé”ä¸¢å¤±äº†æ€ä¹ˆè§£å†³ epollå’Œpoll å¤šçº¿ç¨‹ volatileå’Œé”çš„åŒºåˆ« å¤šçº¿ç¨‹ä¸­çº¿ç¨‹å‡ºç°å¼‚å¸¸ä¼šæ€æ · çº¿ç¨‹ä»£ç ä¸­äº§ç”Ÿå¼‚å¸¸çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå°±ç»“æŸäº†ï¼Œè¿™ç§æƒ…å†µç§°ä¸ºçº¿ç¨‹æ³„æ¼ã€‚ æ³¨æ„ï¼Œåªæ˜¯è¿™ä¸ªçº¿ç¨‹çš„ç”Ÿå‘½ç»“æŸäº†ï¼Œä½†å…¶ä»–çš„çº¿ç¨‹è¿˜æ˜¯æ´»ç€çš„ã€‚å¦‚æœæ˜¯ä»£ç æœ‰ BUGï¼Œé‚£å…¶ä»–çº¿ç¨‹èµ°åˆ°è¿™ä¸€å—ä¼°è®¡ä¹Ÿä¼šæŒ‚æ‰çš„ã€‚ FileStream é˜¿é‡Œç”µè¯é¢é˜¿é‡Œç¡®å®è¦æ±‚å¾ˆé«˜ï¼Œæµç¨‹ä¹Ÿå¾ˆé•¿ï¼Œè‡ªå·±é¢çš„æ—¶å€™æ€»å½’æœ‰ç‚¹æ”¾å¼ƒçš„æ„Ÿè§‰ã€‚ä½†æ˜¯ä»ç”µè¯é¢ä¸­æˆ‘ç¡®å®ä½“éªŒåˆ°äº†ä»€ä¹ˆå«æ·±æŒ–é¡¹ç›®ï¼Œå‡ ä¹å¯¹æ¯ä¸€ä¸ªç»†èŠ‚éƒ½è¿›è¡Œäº†æ·±æŒ–ï¼Œåªè¦è‡ªå·±ç¨å¾®ç»™è‡ªå·±æŒ–å‘å°±å‡‰å‡‰äº†ã€‚ã€‚è¿™ä¹Ÿç®—å¾—åˆ°äº†ä¸€ç§ç»éªŒå§ å¿ƒå¾—ï¼šä¸»è¦åœ¨äºå¯¹å¾…æ¶æ„çš„éœ€æ±‚ï¼Œä¸ºä»€ä¹ˆéœ€è¦è¿™æ ·åš åšé¡¹ç›®çš„æ—¶å€™é‡åˆ°ä»€ä¹ˆæ ·çš„é—®é¢˜ï¼Ÿç­”ï¼šè·¨åŸŸ è·¨åŸŸé—®é¢˜æ€ä¹ˆå‡ºç°çš„åè®® + åŸŸå+ ç«¯å£ è§£å†³æ–¹æ³•ï¼šnginxæˆ–è€…è¯·æ±‚å¤´æ·»åŠ å…è®¸è·¨åŸŸæ ‡è¯† åˆ†å¸ƒå¼é”ã€‚å•æœºä¸ºä»€ä¹ˆè¦ç”¨åˆ†å¸ƒå¼é”ï¼Ÿ å¤šä¸ªè¯·æ±‚åŒæ—¶æ’å…¥å¦‚ä½•ä¿è¯å¹‚ç­‰æ€§ ä¸ç”¨redisé˜²æ­¢é‡å¤è¯·æ±‚æ•°æ®åº“ å¹‚ç­‰ï¼ˆidempotentã€idempotenceï¼‰ åœ¨ç¼–ç¨‹ä¸­.ä¸€ä¸ªå¹‚ç­‰æ“ä½œçš„ç‰¹ç‚¹æ˜¯å…¶ä»»æ„å¤šæ¬¡æ‰§è¡Œæ‰€äº§ç”Ÿçš„å½±å“å‡ä¸ä¸€æ¬¡æ‰§è¡Œçš„å½±å“ç›¸åŒã€‚å¹‚ç­‰å‡½æ•°ï¼Œæˆ–å¹‚ç­‰æ–¹æ³•ï¼Œæ˜¯æŒ‡å¯ä»¥ä½¿ç”¨ç›¸åŒå‚æ•°é‡å¤æ‰§è¡Œï¼Œå¹¶èƒ½è·å¾—ç›¸åŒç»“æœçš„å‡½æ•°ã€‚è¿™äº›å‡½æ•°ä¸ä¼šå½±å“ç³»ç»ŸçŠ¶æ€ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒé‡å¤æ‰§è¡Œä¼šå¯¹ç³»ç»Ÿé€ æˆæ”¹å˜ã€‚ä¾‹å¦‚ï¼Œâ€œgetUsername()å’ŒsetTrue()â€å‡½æ•°å°±æ˜¯ä¸€ä¸ªå¹‚ç­‰å‡½æ•°. é«˜å¹¶å‘çš„æ ¸å¿ƒæŠ€æœ¯-å¹‚ç­‰çš„å®ç°æ–¹æ¡ˆ åˆ†å¸ƒå¼ç³»ç»Ÿåå°å¦‚ä½•é˜²æ­¢é‡å¤æäº¤ å¦‚ä½•é˜²æ­¢é‡å¤æäº¤ redis+è®¡æ•°å™¨ï¼Œå¤§äº1è¡¨ç¤ºé‡å¤ï¼Œé—®é¢˜å°±è½¬æ¢æˆå¦‚ä½•ç”Ÿæˆå”¯ä¸€IDçš„æƒ…æ™¯ mysqlçš„å”¯ä¸€ç´¢å¼•ï¼Œå‡ºç°æŠ¥é”™å°±å¤„ç†è¿”å› tokenæœºåˆ¶ï¼šé˜²æ­¢é¡µé¢é‡å¤æäº¤ã€‚ åŸç†ä¸Šé€šè¿‡session tokenæ¥å®ç°çš„(ä¹Ÿå¯ä»¥é€šè¿‡redisæ¥å®ç°)ã€‚å½“å®¢æˆ·ç«¯è¯·æ±‚é¡µé¢æ—¶ï¼ŒæœåŠ¡å™¨ä¼šç”Ÿæˆä¸€ä¸ªéšæœºæ•°Tokenï¼Œå¹¶ä¸”å°†Tokenæ”¾ç½®åˆ°sessionå½“ä¸­ï¼Œç„¶åå°†Tokenå‘ç»™å®¢æˆ·ç«¯ï¼ˆä¸€èˆ¬é€šè¿‡æ„é€ hiddenè¡¨å•ï¼‰ã€‚ä¸‹æ¬¡å®¢æˆ·ç«¯æäº¤è¯·æ±‚æ—¶ï¼ŒTokenä¼šéšç€è¡¨å•ä¸€èµ·æäº¤åˆ°æœåŠ¡å™¨ç«¯ã€‚ æœåŠ¡å™¨ç«¯ç¬¬ä¸€æ¬¡éªŒè¯ç›¸åŒè¿‡åï¼Œä¼šå°†sessionä¸­çš„Tokenå€¼æ›´æ–°ä¸‹ï¼Œè‹¥ç”¨æˆ·é‡å¤æäº¤ï¼Œç¬¬äºŒæ¬¡çš„éªŒè¯åˆ¤æ–­å°†å¤±è´¥ï¼Œå› ä¸ºç”¨æˆ·æäº¤çš„è¡¨å•ä¸­çš„Tokenæ²¡å˜ï¼Œä½†æœåŠ¡å™¨ç«¯sessionä¸­Tokenå·²ç»æ”¹å˜äº†ã€‚ å­—èŠ‚ä¸€é¢å­—èŠ‚ç¡®å®é¢çš„å¾ˆç´§å¼ ã€‚ä¸€æ¥æ˜¯å› ä¸ºå­—èŠ‚çš„æœºé‡ç¡®å®å¤§ï¼Œåªè¦æä¸€æå°±æœ‰å¾ˆå¤§çš„å¸Œæœ›è¿›å»ï¼Œä½†å¦ä¸€æ–¹é¢ï¼Œç®—æ³•åˆæ˜¯æˆ‘çš„è–„å¼±é¡¹ï¼Œäºæ˜¯è‡ªå·±æ€»æ˜¯åœ¨ä¸æ–­çš„å‡†å¤‡ï¼ŒçŠ¹è±«ï¼Œé€ æˆäº†ç›´åˆ°é¢è¯•ä¹Ÿæ˜¯å‡ºç°äº†æ¯”ä»¥å¾€è¿˜æœ‰æ¿€çƒˆçš„å…´è¶£ååº”ã€‚è¿™å°±æ˜¯è‡ªå·±çš„å¿ƒæ€ç®¡ç†è¿˜ä¸åˆ°ä½çš„ç¼˜æ•…ã€‚æœ€åæœŸæœ›è¶Šå¤§ï¼Œå¤±æœ›è¶Šå¤§ã€‚ é¡¹ç›® åˆ†å¸ƒå¼é”å®ç° æ•°æ®åº“ mysqlçš„äº‹åŠ¡ç‰¹æ€§å’Œéš”ç¦»çº§åˆ« å¤šçº¿ç¨‹ åŒæ­¥å¼‚æ­¥ã€é˜»å¡éé˜»å¡ gitå’Œmaven gitæ€ä¹ˆä¿®æ”¹å·²æäº¤çš„æ–‡ä»¶ mavençš„å¤šæ¨¡å—æ˜¯ä»€ä¹ˆ è®¾è®¡æ¨¡å¼ çŸ¥é“çš„è®¾è®¡æ¨¡å¼ å•ä¾‹æ¨¡å¼çš„å†™æ³•(è´¥ç¬”ï¼ç»å¯¹çš„è´¥ç¬”ï¼Œå¯è§è‡ªå·±å¹³æ—¶æ²¡æœ‰å®Œå…¨ç†è§£ï¼Œä¸€ç›´ä»¥ä¸ºè‡ªå·±èƒ½å†™å‡ºæ¥ç»“æœåœ¨ç°åœºå´æ‰é“¾å­äº†) ç¼–ç¨‹é¢˜ äºŒå‰æ ‘æ±‚å’Œ å›æº¯ æ™ºåŠ›é¢˜ å•æç®¡ ä¸¤ä¸¤è§¦ç¢°èƒ½æŒ‡ç¤ºå¯¹æ–¹çš„å¥½åï¼Œå¥½çš„èƒ½æŒ‡ç¤ºæ­£ç¡®ç»“æœï¼Œåçš„æŒ‡ç¤ºç»“æœä¸ç¡®å®šï¼Œç°åœ¨å¥½çš„æ•°é‡å¤§äºn/2ï¼Œé—®æ€ä¹ˆå°†å¥½çš„å’Œåçš„åŒºåˆ†å‡ºæ¥ï¼Ÿæ—¶é—´å¤æ‚åº¦å¤šå°‘ï¼Ÿ åªè¦ å’Œæ‰€æœ‰æ¯”å¯¹ï¼Œå¥½çš„å¤§äº1/2å°±å¯ä»¥ç¡®å®šä»–æ˜¯å¥½çš„ ç¾å›¢ä¸€é¢ç¾å›¢æ˜¯æˆ‘æœŸæœ›æœ€å¤§çš„å…¬å¸ï¼Œæˆ‘ä¹Ÿä¸ºæ­¤åšå‡ºäº†è‡ªä»¥ä¸ºæœ€å……è¶³çš„å‡†å¤‡ã€‚ä½†æ˜¯æœ€åä¾ç„¶æƒ¨æ·¡æ”¶åœºã€‚è™½ç„¶ç®—æ³•é¢˜æ²¡æœ‰å†™å‡ºæ¥æ˜¯æœ€å¤§çš„é—®é¢˜ï¼Œä½†æ˜¯è¿™æ¬¡ç»™æˆ‘æœ€å¤§çš„æ„Ÿæ‚Ÿæ˜¯é¢è¯•å®˜åœ¨é¢è¯•ä¸­æŒ‡å‡ºäº†æˆ‘çš„æ€§æ ¼é—®é¢˜ï¼Œè¿™æ˜¯ç¬¬ä¸€æ¬¡æˆ‘è¢«æŒ‡å‡ºæŠ€æœ¯ä»¥å¤–çš„é—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜ä¹Ÿæ˜¯æˆ‘ä¸€ç›´ä¸è‡ªçŸ¥çš„ã€‚é‚£å°±æ˜¯æˆ‘åœ¨é¢è¯•ä¸­ä½“ç°å‡ºæ¥çš„å¼ºç­”ï¼Œè‡ªä»¥ä¸ºæ˜¯åœ¨èµŒè¿ï¼Œä½†åœ¨é¢è¯•å®˜é¢å‰ï¼Œä¸æ‡‚è£…æ‡‚æ˜¯æœ€å¤§çš„æ— çŸ¥ã€‚ çŸ¥ä¹‹ä¸ºçŸ¥ä¹‹ï¼Œä¸çŸ¥ä¸ºä¸çŸ¥ï¼Œæ˜¯æ™ºä¹Ÿã€‚ è¿™æ¬¡é¢è¯•æ˜¯å€¼å¾—çš„ã€‚ hashmapè´Ÿè½½å› å­ï¼Ÿï¼ˆè¿™ä¸ªæˆ‘é‚£æ—¶å€™æƒ³é”™äº†ï¼Œæ˜¯æˆ‘çš„å¤±è¯¯ï¼Œä½†åœ¨é¢è¯•å®˜çœ‹æ¥åªæ˜¯æˆ‘çš„ä¸æ‡‚è£…æ‡‚ï¼Œå› æ­¤ç»™ä»–ç•™ä¸‹äº†ä¸å¥½çš„å°è±¡ï¼‰ B+æ ‘å’Œçº¢é»‘æ ‘çš„åŒºåˆ« çº¢é»‘æ ‘æ€§èƒ½ç¨³å®šä½†ä¸ºäº†ç»´æŒç¨³å®šéœ€è¦æ›´å¤šå¼€é”€ï¼Œä¸é€‚åˆå®ç°å¿«é€ŸæŸ¥æ‰¾çš„åŠŸèƒ½ ç®—æ³•é¢˜ å€’æ°´é—®é¢˜ï¼š 10 7 3 å¤´æ¡ä¸€é¢å­—èŠ‚è¿‡åçš„å¤´æ¡ï¼Œè¿™æ—¶çš„æˆ‘å¯¹é¢è¯•å·²ç»ç–²å€¦äº†ï¼Œæ•´ä½“çš„é¢è¯•çŠ¶æ€éå¸¸ä¸å¥½ï¼Œè‡ªç„¶æ²¡æœ‰è¿‡ linux ä¿æŒåå°è¿è¡Œçš„å‘½ä»¤ æŠŠç¨‹åºæ”¾åå°è¿è¡Œï¼Œç®€å•çš„è¯ï¼Œåªè¦åœ¨å‘½ä»¤åé¢åŠ ä¸€ä¸ªâ€œ&amp;â€ï¼Œ å¦‚ï¼šphp test.php &amp; æˆ–è€…åœ¨è¿è¡Œå‘½ä»¤åï¼ŒæŒ‰ä¸€ä¸‹ Ctrl+Zï¼Œå¦‚è¿è¡Œphp test.phpåï¼ŒæŒ‰ä¸€ä¸‹Ctrl+Z ç¨‹åºåœ¨åå°è¿è¡Œäº†ï¼Œä½†è¿˜æ˜¯çœ‹åˆ°è¾“å‡ºä¿¡æ¯ï¼Œå¯ä»¥ç”¨ç®¡é“å‘½ä»¤æŠŠè¾“å‡ºå®šå‘åˆ°/dev/nullï¼Œå¦‚ï¼šphp test.php &gt;/dev/null æ™®é€šçš„è¾“å‡ºä¿¡æ¯çœ‹ä¸åˆ°äº†ï¼Œä½†è¿˜æ˜¯çœ‹åˆ°ä¸€äº›ä¿¡æ¯ï¼Œå¦‚é”™è¯¯ä¿¡æ¯ç­‰ï¼Œéœ€è¦å†æ·»åŠ 2&gt;&amp;1å‘½ä»¤ï¼Œå¦‚ï¼šphp test.php &gt;/dev/null 2&gt;&amp;1 ç¨‹åºåœ¨åå°è¿è¡Œäº†ï¼Œä½†é€€å‡ºå½“å‰ä¼šè¯ï¼Œå‘ç°ç¨‹åºè¿˜æ˜¯åœæ­¢äº†ï¼Œæ­¤æ—¶è¦ç”¨nohupå‘½ä»¤ï¼Œå¦‚ï¼šnohup php test.php &gt;/dev/null 2&gt;&amp;1 ä½¿ç”¨nohupåï¼Œåº”ç¡®ä¿ç”¨exitå‘½ä»¤é€€å‡ºå½“å‰è´¦æˆ·ï¼Œéå¸¸æ­£å¸¸é€€å‡ºæˆ–ç»“æŸå½“å‰ä¼šè¯ï¼Œåœ¨åå°è¿è¡Œçš„ä½œä¸šä¹Ÿä¼šç»ˆæ­¢ å‘½ä»¤åœ¨åå°è¿è¡Œäº†ï¼Œæ€ä¹ˆæŸ¥çœ‹ï¼Ÿä½¿ç”¨jobså‘½ä»¤å¯åˆ—å‡ºå½“å‰ä¼šè¯çš„åå°ä»»åŠ¡ï¼Œjobs -l èƒ½æŸ¥çœ‹åˆ° PIDï¼Œè¿›è€Œå¯ä»¥ç”¨killç»ˆæ­¢æŸä¸ªä»»åŠ¡ æ˜¯ç»ˆå‘½ä»¤å¯èƒ½æ˜¯ï¼šnohup php test.php &gt;/dev/null 2&gt;&amp;1 &amp; linuxæŸ¥çœ‹cpuä½¿ç”¨ç‡çš„å‘½ä»¤ java æŸ¥çœ‹CPUä½¿ç”¨å‚æ•°çš„å‘½ä»¤ mysqlç´¢å¼•æŸ¥è¯¢ ç®—æ³• å¹³æ–¹æ ¹ è·³å°é˜¶ åŠ¨æ€è§„åˆ’ï¼ï¼ CVTEç”µè¯é¢ä¸»è¦æ˜¯æ•°æ®åº“è®¾è®¡ç›¸å…³æœ‰ç‚¹æ–°æ„ äº¬ä¸œç”µè¯é¢æçªè¢­ï¼Œéƒ½5æœˆäº†æ‰å¼€å§‹ï¼Œç€å®æœ‰ç‚¹å°´å°¬ è‡ªåŠ¨è£…ç®±æ‹†ç®± intå­˜æ”¾åœ¨å“ªé‡Œ å¸¸é‡æ±  åŸºæœ¬æ•°æ®ç±»å‹l åˆ›å»ºçº¿ç¨‹æœ‰å“ªå‡ ç§æ–¹æ³•]]></content>
      <tags>
        <tag>é¢è¯•</tag>
        <tag>æ„Ÿæ‚Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¤§é“è‡³ç®€â€”â€”virtualenvä»‹ç»]]></title>
    <url>%2F2020%2F05%2F09%2Fvirtualenv%2F</url>
    <content type="text"><![CDATA[pythonå› ä¸ºä¸°å¯Œçš„æ‰©å±•åº“è¢«å¤§å®¶æ‰€é’çï¼Œä½†æ˜¯å½“å¼€å‘ç¯å¢ƒä¸­çš„ç¬¬ä¸‰æ–¹åŒ…è¶Šæ¥è¶Šå¤šçš„æ—¶å€™ï¼ŒåŸºäºè¯¥å¼€å‘ç¯å¢ƒå¼€å‘çš„åº”ç”¨è¶Šæ¥è¶Šéš¾ä»¥ç§»æ¤ã€è¿ç§»ã€‚åƒåœ¨æ“ä½œç³»ç»Ÿä¸­æˆ‘ä»¬å¯ä»¥ç”¨å®¹å™¨ï¼ˆä¾‹å¦‚dockerï¼‰å°†å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒåˆ†å¼€ï¼Œåœ¨åšpythonçš„åº”ç”¨å¼€å‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬åŒæ ·éœ€è¦ç»™æ¯ä¸ªåº”ç”¨æä¾›ä¸€ä¸ªéš”ç¦»çš„è¿è¡Œç¯å¢ƒï¼Œä»è€Œé¿å…å¢åŠ ä¸å¿…è¦çš„ç‰ˆæœ¬å†²çªå’Œæ’æŸ¥æˆæœ¬ã€‚ virtualenvå°±æ˜¯å¹²è¿™è¡Œçš„ã€‚ å®‰è£…å®‰è£…å…¶å®éå¸¸ç®€å•ã€‚ é¦–å…ˆä½ å¿…é¡»å®‰è£…å¥½pip(è£…pythonçš„æ—¶å€™æ²¡æœ‰äººä¸è£…å§ï¼Ÿ) ç„¶åè¾“å…¥å‘½ä»¤ 1pip3 install virtualenv ç­‰å¾…å®‰è£…å®Œæˆå°±å¤§åŠŸå‘Šæˆäº†ï¼ æ³¨ï¼šPython3 å·²ç»å†…ç½®äº† venv æ¨¡å—,å®é™…ä¸Šä¸éœ€è¦æ‰‹åŠ¨å®‰è£…å³å¯ã€‚æŸ¥çœ‹æ˜¯å¦å®‰è£… 1python3 -m venv --help åŸºæœ¬æ“ä½œåˆ›å»ºè™šæ‹Ÿç¯å¢ƒåªè¦åœ¨è‡ªå·±å¸Œæœ›åˆ›å»ºè™šæ‹Ÿç¯å¢ƒçš„ä½ç½®ï¼Œè¾“å…¥ 1virtualenv test ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œå³å¯åˆ›å»ºä¸€ä¸ªåç§°ä¸ºâ€œtestâ€çš„è™šæ‹Ÿç¯å¢ƒï¼Œä»¥åï¼Œåœ¨è¿™ä¸ªè™šæ‹Ÿç¯å¢ƒä¸‹ä¸‹è½½ç¬¬ä¸‰æ–¹çš„åŒ…éƒ½ä¼šè¢«æ”¾åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹é¢ã€‚ ä¸‹å›¾è¡¨ç¤ºåˆ›å»ºæˆåŠŸï¼š ç„¶åä½ çš„è™šæ‹Ÿç¯å¢ƒçš„æ‰€æœ‰é…ç½®éƒ½å­˜æ”¾åœ¨testæ–‡ä»¶å¤¹ä¸­ï¼Œ é»˜è®¤çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼ˆWindows 10 ç¯å¢ƒä¸‹ï¼‰ 123456- test - Inculde - Lib - Script - tcl - LICENCE.txt æ—§ç‰ˆå‘½ä»¤åˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒä¼šé»˜è®¤ç»§æ‰¿å®é™…ç¯å¢ƒå­˜åœ¨çš„ç¬¬ä¸‰æ–¹åŒ…ï¼Œå¦‚æœéœ€è¦åˆ›å»ºä¸€ä¸ªå¹²å‡€çš„è™šæ‹Ÿç¯å¢ƒ è¾“å…¥ï¼švirtualenv --no-site-packages test æ–°ç‰ˆé»˜è®¤åˆ›å»ºæ— ç¬¬ä¸‰æ–¹åŒ…çš„çº¯å‡€ç¯å¢ƒ è¿›å…¥è™šæ‹Ÿç¯å¢ƒwindowsç³»ç»Ÿè¿›å…¥Scriptæ–‡ä»¶å¤¹ï¼Œæ‰§è¡Œactivate.batæ–‡ä»¶ linuxæ‰§è¡Œ: 1source test/bin/activate testæ˜¯ä½ åˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒæ‰€åœ¨çš„æ–‡ä»¶å¤¹ å½“å‘½ä»¤è¡Œå‰é¢å‡ºç°è™šæ‹Ÿç¯å¢ƒåè¯´æ˜å·²ç»åˆ‡æ¢åˆ°è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œä¹‹åä½ å®‰è£…çš„ç¬¬ä¸‰æ–¹ä¾èµ–åŒ…éƒ½ä¼šä¸‹è½½åˆ°è¿™ä¸ªè™šæ‹Ÿç¯å¢ƒä¸­ï¼Œä»è€Œä¸å½±å“æœ¬æœºå®é™…çš„pythonè¿è¡Œç¯å¢ƒã€‚å®é™…ä¸Šä¹Ÿæ˜¯å°†è¿™äº›ä¾èµ–ä¸‹è½½åˆ°è¿™ä¸ªè™šæ‹Ÿç¯å¢ƒæ‰€åœ¨çš„æ–‡ä»¶å¤¹ä¸­ é€€å‡ºè™šæ‹Ÿç¯å¢ƒwindowsè¾“å…¥ linuxç³»ç»Ÿæ‰§è¡Œ 1source test/bin/deactive äº¤æ¥ç¯å¢ƒè¿™ä¸ªåšæ³•æ¯”è¾ƒå¸¸è§ï¼Œå‡ºç°åœ¨ä½ éœ€è¦å°†è‡ªå·±çš„å¼€å‘ç¯å¢ƒè½¬ç§»åˆ°å¦å¤–ä¸€å°ç”µè„‘æˆ–ç§»äº¤ç»™æŸäººçš„æ—¶å€™ï¼Œéœ€è¦å°†è‡ªå·±çš„è™šæ‹Ÿç¯å¢ƒæ‹·è´åˆ°å¦å¤–çš„åœ°æ–¹ åšæ³•æ˜¯ å…ˆå†»ç»“ç¯å¢ƒåŒ…ï¼Œå°†åŒ…çš„ç‰ˆæœ¬ä¿¡æ¯ä¿å­˜åœ¨ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ä¸­ 1$ pip freeze &gt; requirements.txt åœ¨å¦å¤–ä¸€ä¸ªç¯å¢ƒä¸­ç›´æ¥ä¸‹è½½æ‰€æœ‰ä¾èµ– 1$ pip install -r requirements.txt å…¶ä»–å‘½ä»¤ç”¨æ³•ï¼š 1$ virtualenv [OPTIONS] DEST_DIR é€‰é¡¹: 12345678910111213141516171819202122232425262728â€“version #æ˜¾ç¤ºå½“å‰ç‰ˆæœ¬å·ã€‚ -h, â€“help #æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ã€‚ -v, â€“verbose #æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ã€‚ -q, â€“quiet #ä¸æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ã€‚ -p PYTHON_EXE, â€“python=PYTHON_EXE #æŒ‡å®šæ‰€ç”¨çš„pythonè§£æå™¨çš„ç‰ˆæœ¬ï¼Œæ¯”å¦‚ â€“python=python2.5 å°±ä½¿ç”¨2.5ç‰ˆæœ¬çš„è§£æå™¨åˆ›å»ºæ–°çš„éš”ç¦»ç¯å¢ƒã€‚ é»˜è®¤ä½¿ç”¨çš„æ˜¯å½“å‰ç³»ç»Ÿå®‰è£…(/usr/bin/python)çš„pythonè§£æå™¨ â€“clear #æ¸…ç©ºérootç”¨æˆ·çš„å®‰è£…ï¼Œå¹¶é‡å¤´å¼€å§‹åˆ›å»ºéš”ç¦»ç¯å¢ƒã€‚ â€“no-site-packages #ä»¤éš”ç¦»ç¯å¢ƒä¸èƒ½è®¿é—®ç³»ç»Ÿå…¨å±€çš„site-packagesç›®å½•ã€‚ â€“system-site-packages #ä»¤éš”ç¦»ç¯å¢ƒå¯ä»¥è®¿é—®ç³»ç»Ÿå…¨å±€çš„site-packagesç›®å½•ã€‚ â€“unzip-setuptools #å®‰è£…æ—¶è§£å‹Setuptoolsæˆ–Distribute â€“relocatable #é‡å®šä½æŸä¸ªå·²å­˜åœ¨çš„éš”ç¦»ç¯å¢ƒã€‚ä½¿ç”¨è¯¥é€‰é¡¹å°†ä¿®æ­£è„šæœ¬å¹¶ä»¤æ‰€æœ‰.pthæ–‡ä»¶ä½¿ç”¨ç›¸å½“è·¯å¾„ã€‚ â€“distribute #ä½¿ç”¨Distributeä»£æ›¿Setuptoolsï¼Œä¹Ÿå¯è®¾ç½®ç¯å¢ƒå˜é‡VIRTUALENV_DISTRIBUTEè¾¾åˆ°åŒæ ·æ•ˆè¦ã€‚ â€“extra-search-dir=SEARCH_DIRS #ç”¨äºæŸ¥æ‰¾setuptools/distribute/pipå‘å¸ƒåŒ…çš„ç›®å½•ã€‚å¯ä»¥æ·»åŠ ä»»æ„æ•°é‡çš„â€“extra-search-dirè·¯å¾„ã€‚ â€“never-download #ç¦æ­¢ä»ç½‘ä¸Šä¸‹è½½ä»»ä½•æ•°æ®ã€‚æ­¤æ—¶ï¼Œå¦‚æœåœ¨æœ¬åœ°æœç´¢å‘å¸ƒåŒ…å¤±è´¥ï¼Œvirtualenvå°±ä¼šæŠ¥é”™ã€‚ â€“prompt==PROMPT #å®šä¹‰éš”ç¦»ç¯å¢ƒçš„å‘½ä»¤è¡Œå‰ç¼€ã€‚ ç»„æˆå†çœ‹ä¸€ä¸‹virtualç¯å¢ƒçš„ç›®å½•ï¼ˆWindows 10ç¯å¢ƒä¸‹ï¼‰ 123456- [è™šæ‹Ÿç¯å¢ƒå] - Inculde - Lib - Script - tcl - LICENCE.txt Include ï¼š Libï¼šåº“æ–‡ä»¶ Scriptï¼š è„šæœ¬æ–‡ä»¶ tcl é¦–å…ˆä»‹ç»ä¸€ä¸‹pythonçš„è¿è¡Œç¯å¢ƒã€‚ åœ¨VScodeä¸­æ„‰å¿«ç©è€ å¦‚ä½•åœ¨VScodeä¸­éƒ¨ç½²virtualç¯å¢ƒ ç¬¬ä¸€ç§æ–¹æ³•åœ¨é¡¹ç›®çš„\.vscode\launch.jsonæ–‡ä»¶é‡ŒåŠ äº†ä¸€å¥:&quot;pythonPath&quot;: &quot;D:\\myproject\\venv\\Scripts\\python.exe&quot;, ç¬¬äºŒç§æ–¹æ³• æœ¬äººäº²æµ‹æœ‰æ•ˆ è¦åœ¨VScodeä¸­ä½¿ç”¨Pythonçš„virtualenvè™šæ‹Ÿç¯å¢ƒ,é¦–å…ˆåœ¨è®¾ç½®åŒæ·»åŠ è™šæ‹Ÿç¯å¢ƒæ‰€åœ¨ç›®å½•å’Œè™šæ‹Ÿç¯å¢ƒçš„è¯†åˆ«è§„åˆ™: 12345678910&#123; ... "python.venvPath": "E:\\envs", "python.venvFolders": [ "envs", ".pyenv", ".direnv', ".env" ]&#125; ä¹‹åå½“ä½ æƒ³è¦åˆ‡æ¢è™šæ‹Ÿç¯å¢ƒçš„æ—¶å€™åªéœ€è¦é€šè¿‡å‘½ä»¤é¢æ¿Python: Select Interpreterå°±ä¼šåˆ—å‡ºæ‰€æœ‰çš„è™šæ‹Ÿç¯å¢ƒ. å®ƒå…¶å®æ˜¯åœ¨ä½ çš„é¡¹ç›®æ ¹ç›®å½•ä¸‹æ–°å»ºäº†ä¸€ä¸ª ./.vscode/settings.json é…ç½®æ–‡ä»¶ï¼Œå°†è§£é‡Šå™¨è·¯å¾„é€‰é¡¹å†™åœ¨é‡Œé¢äº†ï¼Œè¯¥æ–‡ä»¶ç§°ä¸ºå·¥ä½œåŒºè®¾ç½®ï¼Œå¯ä»¥é’ˆå¯¹æ¯ä¸ªé¡¹ç›®å•ç‹¬è®¾ç½®é…ç½®é¡¹ã€‚ ç¬¬ä¸‰ç§æ–¹æ³•åœ¨å‘½ä»¤è¡Œæ¿€æ´»è™šæ‹Ÿç¯å¢ƒåï¼Œç›´æ¥ç”¨ codeæ‰“å¼€é¡¹ç›®æ–‡ä»¶å¤¹å°±è¡Œäº†ã€‚ã€‚ã€‚ 12XXX&gt;venv\scripts\activate(venv) XXX&gt;code project_name/ ä½¿ç”¨ Visual Studio Codeï¼ˆVSCodeï¼‰æ­å»ºç®€å•çš„Python+Djangoå¼€å‘ç¯å¢ƒçš„æ–¹æ³•æ­¥éª¤ VScodeä¸­æ”¯æŒPythonè™šæ‹Ÿç¯å¢ƒ åœ¨vscodeä¸­å¯ç”¨pythonçš„virtualenv è¿›é˜¶ä½¿ç”¨virtualenvwrapperç®¡ç†è™šæ‹Ÿç¯å¢ƒ]]></content>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é›†åˆæºç å­¦ä¹ ï¼ˆ1ï¼‰]]></title>
    <url>%2F2020%2F03%2F10%2Fcollection1%2F</url>
    <content type="text"><![CDATA[mapç±»ç›¸å…³çŸ¥è¯†ç‚¹æ€»ç»“ ä¸»è¦å…³æ³¨mapç›¸å…³çš„æºç  HashTableã€HashMapã€HashSet ã€TreeMapâ€¦ HashTable åŸºäºä½æ¡¶+é“¾è¡¨å®ç°ã€‚ ç»§æ‰¿Dictionaryï¼ˆé™ˆæ—§ï¼‰ å®ç°Cloneableï¼Œå¯è¢«å…‹éš† å®ç°Serializableï¼Œå¯è¢«åºåˆ—åŒ– hash123int hash = key.hashCode();//0x7FFFFFFFè½¬æ¢ä¸º10è¿›åˆ¶ä¹‹åæ˜¯Intger.MAX_VALUE,ä¹Ÿå°±æ˜¯2^31 - 1int index = (hash &amp; 0x7FFFFFFF) % tab.length; å¾ˆå®¹æ˜“çœ‹å‡ºHashtableçš„hashç®—æ³•é¦–å…ˆä½¿å¾—hashçš„å€¼å°äºç­‰äºæ•´å‹æ•°çš„æœ€å¤§å€¼ï¼Œå†é€šè¿‡%è¿ç®—å®ç°å‡åŒ€æ•£å°„ã€‚ ==ç”±äºè®¡ç®—æœºæ˜¯åº•å±‚çš„è¿ç®—æ˜¯åŸºäº2è¿›åˆ¶çš„ï¼Œæ‰€ä»¥HashMapçš„hashç®—æ³•ä½¿ç”¨&amp;è¿ç®—ä»£æ›¿%è¿ç®—ï¼Œåœ¨è¿ç®—é€Ÿåº¦ä¸Šæ˜æ˜¾HashMapçš„hashç®—æ³•æ›´ä¼˜ã€‚== ä¸ºä»€ä¹ˆä¸€èˆ¬hashtableçš„æ¡¶æ•°ä¼šå–ä¸€ä¸ªç´ æ•° å±æ€§æ„é€ 1234567891011121314151617public Hashtable(int initialCapacity, float loadFactor) &#123; if (initialCapacity &lt; 0) throw new IllegalArgumentException("Illegal Capacity: "+ initialCapacity); if (loadFactor &lt;= 0 || Float.isNaN(loadFactor)) throw new IllegalArgumentException("Illegal Load: "+loadFactor); if (initialCapacity==0) initialCapacity = 1; this.loadFactor = loadFactor; table = new Entry&lt;?,?&gt;[initialCapacity]; threshold = (int)Math.min(initialCapacity * loadFactor, MAX_ARRAY_SIZE + 1);&#125;public Hashtable() &#123; this(11, 0.75f);&#125; Hashtableåº•å±‚æ•°ç»„çš„é•¿åº¦å¯ä»¥ä¸ºä»»æ„å€¼ï¼Œè¿™å°±é€ æˆäº†å½“åº•å±‚æ•°ç»„é•¿åº¦ä¸ºåˆæ•°çš„æ—¶å€™ï¼ŒHashtableçš„hashç®—æ³•æ•£å°„ä¸å‡åŒ€ï¼Œå®¹æ˜“äº§ç”Ÿhashå†²çªã€‚æ‰€ä»¥ï¼Œå¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°Hashtableçš„é»˜è®¤æ„é€ å‡½æ•°åº•å±‚æ•°ç»„é•¿åº¦ä¸º11ï¼ˆè´¨æ•°ï¼‰ï¼Œè‡³äºä¸ºä»€ä¹ˆHashtableçš„åº•å±‚æ•°ç»„ç”¨è´¨æ•°è¾ƒå¥½ï¼Œè¯·å‚è€ƒåšæ–‡ï¼› æ–¹æ³•put valueä¸èƒ½ä¸ºnull çº¿ç¨‹å®‰å…¨ 12345678910111213141516171819202122232425262728293031323334353637383940414243public synchronized V put(K key, V value) &#123; // Make sure the value is not null if (value == null) &#123; throw new NullPointerException(); &#125; // Makes sure the key is not already in the hashtable. Entry&lt;?,?&gt; tab[] = table; int hash = key.hashCode(); int index = (hash &amp; 0x7FFFFFFF) % tab.length; @SuppressWarnings("unchecked") Entry&lt;K,V&gt; entry = (Entry&lt;K,V&gt;)tab[index]; for(; entry != null ; entry = entry.next) &#123; if ((entry.hash == hash) &amp;&amp; entry.key.equals(key)) &#123; V old = entry.value; entry.value = value; return old; &#125; &#125; addEntry(hash, key, value, index); return null;&#125;private void addEntry(int hash, K key, V value, int index) &#123; modCount++; Entry&lt;?,?&gt; tab[] = table; if (count &gt;= threshold) &#123; // Rehash the table if the threshold is exceeded rehash(); tab = table; hash = key.hashCode(); index = (hash &amp; 0x7FFFFFFF) % tab.length; &#125; // Creates the new entry. @SuppressWarnings("unchecked") Entry&lt;K,V&gt; e = (Entry&lt;K,V&gt;) tab[index]; tab[index] = new Entry&lt;&gt;(hash, key, value, e); count++;&#125; å¯ä»¥çœ‹å‡ºHashTableåˆ°äº†jdk1.8äº†å†…éƒ¨ç»“æ„å¹¶æ²¡æœ‰å®è´¨ä¼˜åŒ–ï¼Œç»§ç»­ä½¿ç”¨æ•°ç»„+é“¾è¡¨çš„æ–¹å¼å®ç°ã€‚ rehash123456789101112131415161718192021222324252627282930protected void rehash() &#123; int oldCapacity = table.length; Entry&lt;?,?&gt;[] oldMap = table; // overflow-conscious code int newCapacity = (oldCapacity &lt;&lt; 1) + 1; if (newCapacity - MAX_ARRAY_SIZE &gt; 0) &#123; if (oldCapacity == MAX_ARRAY_SIZE) // Keep running with MAX_ARRAY_SIZE buckets return; newCapacity = MAX_ARRAY_SIZE; &#125; Entry&lt;?,?&gt;[] newMap = new Entry&lt;?,?&gt;[newCapacity]; modCount++; threshold = (int)Math.min(newCapacity * loadFactor, MAX_ARRAY_SIZE + 1); table = newMap; for (int i = oldCapacity ; i-- &gt; 0 ;) &#123; for (Entry&lt;K,V&gt; old = (Entry&lt;K,V&gt;)oldMap[i] ; old != null ; ) &#123; Entry&lt;K,V&gt; e = old; old = old.next; int index = (e.hash &amp; 0x7FFFFFFF) % newCapacity; //ä½¿ç”¨å¤´æ’æ³•å°†é“¾è¡¨ååº e.next = (Entry&lt;K,V&gt;)newMap[index]; newMap[index] = e; &#125; &#125;&#125; Hashtableçš„æ‰©å®¹å°†å…ˆåˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸ºåŸé•¿åº¦2å€çš„æ•°ç»„ï¼Œå†ä½¿ç”¨å¤´æ’æ³•å°†é“¾è¡¨è¿›è¡Œååºã€‚ å’ŒHashMapçš„ä¸åŒä¹‹å¤„ HashMap Hashtable ç»§æ‰¿æœºåˆ¶ ç»§æ‰¿AbstractMap ç»§æ‰¿Dictionary çº¿ç¨‹å®‰å…¨ çº¿ç¨‹ä¸å®‰å…¨ putã€removeç­‰æ–¹æ³•å‡è¢«synchronizedä¿®é¥°ï¼ŒåŒæ­¥ï¼Œçº¿ç¨‹å®‰å…¨ å‚æ•°è®¾ç½® keyã€valueå‡å¯ä¸ºnull keyã€valueå‡ä¸å¯ä¸ºnull ç»“æ„ ç”±ä½æ¡¶+é“¾è¡¨+çº¢é»‘æ ‘æ„æˆ ç”±ä½æ¡¶+é“¾è¡¨æ„æˆ æ·»åŠ entry æ·»åŠ æ–°entryæ—¶ï¼Œæ”¾ç½®é“¾è¡¨å°¾éƒ¨ æ·»åŠ æ–°entryæ—¶ï¼Œæ”¾ç½®é“¾è¡¨å¤´éƒ¨ æ„é€ ä¸Š åº•å±‚æ•°ç»„çš„é•¿åº¦å¿…é¡»ä¸º2^n ,é»˜è®¤é•¿åº¦16 åº•å±‚æ•°ç»„çš„é•¿åº¦å¯ä»¥ä¸ºä»»æ„å€¼ï¼Œé»˜è®¤é•¿åº¦11 Hashç®—æ³•ä¸Š hashç®—æ³•é€šè¿‡éå¸¸è§„çš„è®¾è®¡ï¼Œå°†åº•å±‚tableé•¿åº¦è®¾è®¡ä¸º2^nï¼ˆåˆæ•°ï¼‰å¹¶ä½¿ç”¨äº†&amp;è¿ç®—æ¥ä»£æ›¿%è¿ç®—ä»¥å‡å°‘æ€§èƒ½ä¸Šé¢çš„æŸè€— hashç®—æ³•é¦–å…ˆä½¿å¾—hashçš„å€¼å°äºç­‰äºæ•´å‹æ•°çš„æœ€å¤§å€¼ï¼Œå†é€šè¿‡%è¿ç®—å®ç°å‡åŒ€æ•£å°„ æ‰©å®¹æœºåˆ¶ä¸Š æ‰©å®¹ä¸éœ€è¦é“¾è¡¨åè½¬ï¼Œç”¨hashCodeæ–°å¢çš„bitä½æŸ¥çœ‹æ˜¯å¦æ’å…¥æ—§æ•°ç»„è¿˜æ˜¯æ’å…¥æ–°æ•°ç»„ä½ç½® å¤´æ’æ³•æ‰©å®¹ çŸ¥ä¹ï¼šhashMapå’ŒhashTableçš„åŒºåˆ« HashMapHashMapå°±æ˜¯å…¸å‹çš„æ‹‰é“¾æ³•å“ˆå¸Œè¡¨ç»“æ„ã€‚Â· ä»–å®é™…ä¸Šæ˜¯ä¸€ä¸ªçº¿æ€§æ•°ç»„ã€‚ä»–çš„é™æ€å†…éƒ¨ç±»ç»§æ‰¿äº†ä¸€ä¸ªEntryæ¥å£ã€‚è¿™é‡Œæ³¨æ„ï¼Œåœ¨jdk1.8ä¸­ï¼Œåœ¨é“¾è¡¨ä¸­åŠ å…¥äº†çº¢é»‘æ ‘ï¼ˆå¹³è¡¡äºŒåˆ†æŸ¥æ‰¾æ ‘ï¼‰ã€‚æ‰€ä»¥1.8ç‰ˆæœ¬çš„HashMapæ˜¯ç”±æ•°ç»„+ï¼ˆé“¾è¡¨+çº¢é»‘æ ‘ï¼‰å®ç°çš„ã€‚ hashåŸºæœ¬æ¦‚å¿µ Hashï¼Œå³æ•£åˆ—ï¼ŒæŠŠä»»æ„é•¿åº¦çš„è¾“å…¥ï¼Œé€šè¿‡æ•£åˆ—ç®—æ³•å˜æˆå›ºå®šé•¿åº¦çš„è¾“å‡ºã€‚ç”±äºæ˜¯ä¸å®šé•¿åˆ°å®šé•¿çš„å‹ç¼©æ˜ å°„ï¼Œè¾“å‡ºå€¼åŸŸå°äºè¾“å…¥å€¼åŸŸï¼Œæ‰€ä»¥ä¸åŒçš„è¾“å…¥å¯èƒ½æœ‰ç›¸åŒçš„è¾“å‡ºï¼Œå³hashç¢°æ’ã€‚ hashç®—æ³• 123456static final int hash(Object key) &#123; int h; return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);&#125;//æ‰‹å†™çš„ï¼Œæºç åœ¨ä¸å­˜åœ¨è¿™ä¸€å¥ï¼Œä½†æ˜¯åŸç†æ˜¯ç±»ä¼¼çš„ï¼Œè¯¦æƒ…å¯ä»¥å»çœ‹putValæ–¹æ³•int i = (table.length-1) &amp; hash(key) è¿™é‡ŒHashç®—æ³•çš„æœ¬è´¨æ˜¯å–keyçš„hashCodeå€¼ã€é«˜ä½è¿ç®—ã€å–æ¨¡è¿ç®— Â· åœ¨JDK1.8çš„å®ç°ä¸­ï¼Œä¼˜åŒ–äº†é«˜ä½è¿ç®—çš„ç®—æ³•ï¼Œé€šè¿‡hashCode()çš„é«˜16ä½å¼‚æˆ–ä½16ä½å®ç°çš„ï¼š(h = k.hashCode()) ^ (h &gt;&gt;&gt; 16)ï¼Œä¸»è¦æ˜¯ä»é€Ÿåº¦ã€åŠŸæ•ˆã€è´¨é‡æ¥è€ƒè™‘çš„ï¼Œè¿™ä¹ˆåšå¯ä»¥åœ¨æ•°ç»„tableçš„lengthæ¯”è¾ƒå°çš„æ—¶å€™ï¼Œä¹Ÿèƒ½ä¿è¯è€ƒè™‘åˆ°é«˜ä½Bitéƒ½å‚ä¸åˆ°Hashçš„è®¡ç®—ä¸­ï¼ŒåŒæ—¶ä¸ä¼šæœ‰å¤ªå¤§çš„å¼€é”€ã€‚ å±æ€§123456789101112131415161718192021222324252627282930313233343536373839404142434445464748public class HashMap&lt;K,V&gt; extends AbstractMap&lt;K,V&gt; implements Map&lt;K,V&gt;, Cloneable, Serializable &#123; int threshold; // æ‰€èƒ½å®¹çº³çš„key-valueå¯¹æé™ final float loadFactor; // è´Ÿè½½å› å­ //modCountå­—æ®µä¸»è¦ç”¨æ¥è®°å½•HashMapå†…éƒ¨ç»“æ„å‘ç”Ÿå˜åŒ–çš„æ¬¡æ•°ï¼Œä¸»è¦ç”¨äºè¿­ä»£çš„å¿«é€Ÿå¤±è´¥ã€‚å¼ºè°ƒä¸€ç‚¹ï¼Œå†…éƒ¨ç»“æ„å‘ç”Ÿå˜åŒ–æŒ‡çš„æ˜¯ç»“æ„å‘ç”Ÿå˜åŒ–ï¼Œä¾‹å¦‚putæ–°é”®å€¼å¯¹ï¼Œä½†æ˜¯æŸä¸ªkeyå¯¹åº”çš„valueå€¼è¢«è¦†ç›–ä¸å±äºç»“æ„å˜åŒ– int modCount; int size; ...... static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; &#123; final int hash;//hash code value for this map entry final K key; V value; Node&lt;K,V&gt; next; Node(int hash, K key, V value, Node&lt;K,V&gt; next) &#123; this.hash = hash; this.key = key; this.value = value; this.next = next; &#125; public final K getKey() &#123; return key; &#125; public final V getValue() &#123; return value; &#125; public final String toString() &#123; return key + "=" + value; &#125; public final int hashCode() &#123; return Objects.hashCode(key) ^ Objects.hashCode(value); &#125; public final V setValue(V newValue) &#123; V oldValue = value; value = newValue; return oldValue; &#125; public final boolean equals(Object o) &#123; if (o == this) return true; if (o instanceof Map.Entry) &#123; Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;)o; if (Objects.equals(key, e.getKey()) &amp;&amp; Objects.equals(value, e.getValue())) return true; &#125; return false; &#125; &#125; ......&#125; æ„é€ å¯ä»¥çœ‹å‡ºHashMapçš„åº•å±‚æ•°ç»„çš„é•¿åº¦å¿…é¡»ä¸º2^nï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ä¸ºä»¥åçš„hashç®—æ³•åšå‡†å¤‡ 1234567891011121314151617181920212223public HashMap(int initialCapacity, float loadFactor) &#123; if (initialCapacity &lt; 0) throw new IllegalArgumentException("Illegal initial capacity: " + initialCapacity); if (initialCapacity &gt; MAXIMUM_CAPACITY) initialCapacity = MAXIMUM_CAPACITY; if (loadFactor &lt;= 0 || Float.isNaN(loadFactor)) throw new IllegalArgumentException("Illegal load factor: " + loadFactor); this.loadFactor = loadFactor; this.threshold = tableSizeFor(initialCapacity);&#125;//è¯¥æ–¹æ³•è¿”å›å¤§äºç­‰äºcapçš„æœ€å°2æ¬¡å¹‚çš„æ•´æ•°static final int tableSizeFor(int cap) &#123; int n = cap - 1; n |= n &gt;&gt;&gt; 1; n |= n &gt;&gt;&gt; 2; n |= n &gt;&gt;&gt; 4; n |= n &gt;&gt;&gt; 8; n |= n &gt;&gt;&gt; 16; return (n &lt; 0) ? 1 : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1;&#125; æ–¹æ³•æ‰€æœ‰æ–¹æ³•é›†åˆ 123456789101112131415161718192021222324void clear() // ç§»é™¤æ‰€æœ‰é”®å€¼Object clone() // æµ…å¤åˆ¶ï¼Œé”®å€¼æœ¬èº«ä¸ä¼šå¤åˆ¶V compute(K key, BiFunction&lt;? super K,? super V,? extends V&gt; remappingFunction) // å°è¯•ä¸ºæŒ‡å®šçš„é”®å’Œå®ƒå½“å‰æ˜ å°„çš„å€¼è®¡ç®—ä¸€ä¸ªæ˜ å°„ï¼ˆæ²¡æœ‰åˆ™è¿”å›nullï¼‰V computeIfAbsent(K key, Function&lt;? super K,? extends V&gt; mappingFunction) // å¦‚æœæŒ‡å®šçš„é”®æ²¡æœ‰å…³è”å€¼ï¼ˆæˆ–å…³è”nullï¼‰ï¼Œä½¿ç”¨æŒ‡å®šçš„æ˜ å°„å‡½æ•°è®¡ç®—å€¼ï¼Œéç©ºåˆ™åŠ å…¥mapV computeIfPresent(K key, BiFunction&lt;? super K,? super V,? extends V&gt; remappingFunction) // å¦‚æœæŒ‡å®šé”®å…³è”äº†éç©ºå€¼ï¼Œå°è¯•ç”¨ç»™å®šçš„é”®å€¼è®¡ç®—ä¸€ä¸ªæ˜ å°„boolean containsKey(Object key) // æ˜¯å¦åŒ…å«æŸé”®boolean containsValue(Object value) // æ˜¯å¦åŒ…å«æŸå€¼Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet() // é”®å€¼å¯¹çš„Seté›†åˆvoid forEach(BiConsumer&lt;? super K,? super V&gt; action) // ä¸ºæ¯ä¸ªé”®å€¼å¯¹æŒ‡å®šç‰¹å®šå‡½æ•°ï¼ŒæŠ›å‡ºå¼‚å¸¸åˆ™ä¸­æ–­V get(Object key) // è·å–æŸé”®çš„å€¼V getOrDefault(Object key, V defaultValue) // è·å–æŸé”®çš„å€¼ï¼Œæ²¡æœ‰åˆ™è¿”å›é»˜è®¤å€¼boolean isEmpty() // mapæ˜¯å¦ä¸ºç©ºå®¹å™¨Set&lt;K&gt; keySet() // é”®çš„Seté›†åˆV merge(K key, V value, BiFunction&lt;? super V,? super V,? extends V&gt; remappingFunction) // å¦‚æœæŒ‡å®šçš„é”®æ²¡æœ‰å…³è”å€¼æˆ–å…³è”nullï¼Œåˆ™ç”¨ç»™å®šçš„éç©ºå€¼å…³è”å®ƒV put(K key, V value) // æ·»åŠ é”®å€¼å¯¹void putAll(Map&lt;? extends K,? extends V&gt; m) // æ·»åŠ ç»™å®šmapä¸­æ‰€æœ‰é”®å€¼å¯¹V putIfAbsent(K key, V value) // å¦‚æœæŒ‡å®šçš„é”®æ²¡æœ‰å…³è”å€¼æˆ–å…³è”nullï¼Œå°†å®ƒå…³è”æ–°å€¼ï¼Œå¹¶è¿”å›åŸå€¼V remove(Object key) // ç§»é™¤æŸé”®boolean remove(Object key, Object value) // ç§»é™¤æŸé”®å€¼å¯¹V replace(K key, V value) // æ›¿æ¢é”®å€¼å¯¹boolean replace(K key, V oldValue, V newValue) // åŸå€¼ç›¸åŒåˆ™æ›¿æ¢é”®å€¼å¯¹void replaceAll(BiFunction&lt;? super K,? super V,? extends V&gt; function) // è°ƒç”¨å‡½æ•°æ›¿æ¢æ¯ä¸ªé”®å€¼å¯¹ï¼ŒæŠ›å‡ºå¼‚å¸¸ä¸­æ–­int size() // mapå¤§å°Collection&lt;V&gt; values() // mapçš„å€¼é›†åˆ get/getNode12345678910111213141516171819202122232425262728293031public V get(Object key) &#123; Node&lt;K,V&gt; e; //keyæ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨è¿”å›keyçš„valueå€¼ï¼Œä¸å­˜åœ¨è¿”å›null //hash(key)è·å¾—keyçš„hashå€¼ return (e = getNode(hash(key), key)) == null ? null : e.value;&#125;final Node&lt;K,V&gt; getNode(int hash, Object key) &#123; Node&lt;K,V&gt;[] tab; //Entryæ•°ç»„ Node&lt;K,V&gt; first, e; int n; //æ•°ç»„é•¿åº¦ K k; // 1. å®šä½é”®å€¼å¯¹æ‰€åœ¨æ¡¶çš„ä½ç½® if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (first = tab[(n - 1) &amp; hash]) != null) &#123; //2.åˆ¤æ–­é”®å€¼çš„hashcodeç›¸ç­‰ï¼Œå¯¹è±¡ç›¸ç­‰ if (first.hash == hash &amp;&amp; // always check first node ((k = first.key) == key || (key != null &amp;&amp; key.equals(k)))) return first; if ((e = first.next) != null) &#123; // 3..å¦‚æœ first æ˜¯ TreeNode ç±»å‹ï¼Œåˆ™è°ƒç”¨é»‘çº¢æ ‘æŸ¥æ‰¾æ–¹æ³• if (first instanceof TreeNode) return ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key); do &#123; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) return e; &#125; while ((e = e.next) != null); &#125; &#125; return null; &#125; å…·ä½“é€»è¾‘ï¼š è®¡ç®—æ¡¶åœ¨æ¡¶æ•°ç»„çš„ä½ç½®(first = tab[(n - 1) &amp; hash]) != null 1a % b == (b-1) &amp; a ,å½“bæ˜¯2çš„æŒ‡æ•°æ—¶ï¼Œç­‰å¼æˆç«‹ã€‚ åˆ¤æ–­hashcodeæ˜¯å¦ç›¸ç­‰,å¯¹è±¡æ˜¯å¦ç›¸ç­‰ åˆ¤æ–­æ˜¯å¦æ˜¯TreeNodeç±»å‹ put/putVal 123public V put(K key, V value) &#123; return putVal(hash(key), key, value, false, true);//1. onlyIfAbsentå‚æ•° &#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i; // åˆå§‹åŒ–æ¡¶æ•°ç»„ table if ((tab = table) == null || (n = tab.length) == 0) //æ‰©å®¹æ–¹æ³• n = (tab = resize()).length; // å½“å‰keyä¸å­˜åœ¨ï¼Œæ–°å»ºé”®å€¼å¯¹åŠ å…¥ if ((p = tab[i = (n - 1) &amp; hash]) == null) tab[i] = newNode(hash, key, value, null); else &#123; Node&lt;K,V&gt; e; K k; // å¦‚æœé”®çš„å€¼ä»¥åŠèŠ‚ç‚¹ hash ç­‰äºé“¾è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªé”®å€¼å¯¹èŠ‚ç‚¹æ—¶ï¼Œåˆ™å°† e æŒ‡å‘è¯¥é”®å€¼å¯¹ if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) e = p; //å¦‚æœèŠ‚ç‚¹ä¸‹å¼•ç”¨æ•°æ®ç»“æ„ä¸ºçº¢é»‘æ ‘ï¼Œè°ƒç”¨çº¢é»‘æ ‘æ’å…¥æ³• else if (p instanceof TreeNode) e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value); else &#123; // é“¾è¡¨ç»“æ„ï¼Œéå† for (int binCount = 0; ; ++binCount) &#123; //ä¸å­˜åœ¨å½“å‰éœ€è¦æ’å…¥çš„èŠ‚ç‚¹ if ((e = p.next) == null) &#123; //æ–°å»ºä¸€ä¸ªèŠ‚ç‚¹æ’å…¥ p.next = newNode(hash, key, value, null); //é“¾è¡¨é•¿åº¦è¶…è¿‡æˆ–ç­‰äºæ ‘åŒ–é˜™å€¼ï¼ˆ8ï¼‰ï¼Œå¯¹é“¾è¡¨è¿›è¡Œæ ‘åŒ– if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st treeifyBin(tab, hash); break; &#125; //éœ€è¦æ’å…¥çš„èŠ‚ç‚¹å·²ç»å­˜åœ¨äº† if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) break; p = e; &#125; &#125; if (e != null) &#123; // existing mapping for key V oldValue = e.value; if (!onlyIfAbsent || oldValue == null)//1.onlyIfAbsent åˆ¤æ–­ e.value = value; afterNodeAccess(e); return oldValue; &#125; &#125; ++modCount; if (++size &gt; threshold) resize(); afterNodeInsertion(evict); return null; &#125; å…·ä½“é€»è¾‘ï¼š åˆå§‹åŒ–æ¡¶æ•°ç»„ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨å°±æ–°åˆ›å»ºä¸€ä¸ª èŠ‚ç‚¹ è‹¥å­˜åœ¨ï¼Œé¦–å…ˆåˆ¤æ–­é”®çš„å€¼å’ŒèŠ‚ç‚¹çš„hashå€¼æ˜¯å¦æ˜¯é“¾è¡¨ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ˜¯åˆ™æ’å…¥ å…¶æ¬¡åˆ¤æ–­æ˜¯å¦æ˜¯æ ‘èŠ‚ç‚¹ï¼Œæ˜¯åˆ™æ‰§è¡Œæ ‘çš„æ’å…¥ å¦‚æœéƒ½ä¸æ˜¯å°±éå†é“¾è¡¨ï¼Œæ’å…¥èŠ‚ç‚¹ï¼Œå¤§äºé˜™å€¼å°±æ ‘åŒ–ï¼Œé‡åˆ°ç›¸ç­‰çš„èŠ‚ç‚¹å°±è¦†ç›–ï¼ˆhashç›¸ç­‰ï¼Œé”®ç›¸ç­‰ï¼‰ onlyIfAbsentå‚æ•° putçš„onlyIfAbesentçš„falseï¼ŒputIfAbsentçš„onlyIfAbsentæ˜¯true åœ¨æ”¾å…¥æ•°æ®æ—¶ï¼Œå¦‚æœå­˜åœ¨é‡å¤çš„keyï¼Œé‚£ä¹ˆputIfAbsentä¸ä¼šæ”¾å…¥å€¼ã€‚ å¦‚æœä¼ å…¥keyå¯¹åº”çš„valueå·²ç»å­˜åœ¨ï¼Œå°±è¿”å›å­˜åœ¨çš„valueï¼Œä¸è¿›è¡Œæ›¿æ¢ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œå°±æ·»åŠ keyå’Œvalueï¼Œè¿”å›null resizeresize()åªæœ‰åœ¨ä¸¤ç§æƒ…å†µä¸‹ä¼šè¢«è°ƒç”¨ï¼šÂ· ç”±äºHashMapå®è¡Œäº†æ‡’åŠ è½½: æ–°å»ºHashMapæ—¶ä¸ä¼šå¯¹tableè¿›è¡Œèµ‹å€¼, è€Œæ˜¯åˆ°ç¬¬ä¸€æ¬¡æ’å…¥æ—¶, è¿›è¡Œresizeæ—¶æ„å»ºtable; å½“HashMapçš„sizeå€¼å¤§äº thresholdæ—¶, ä¼šè¿›è¡Œresize(); çœ‹ä¸€ä¸‹thresholdåœ¨æºç ä¸­çš„æ³¨è§£: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586 final Node&lt;K,V&gt;[] resize() &#123; Node&lt;K,V&gt;[] oldTab = table;//å°†å½“å‰tableæš‚å­˜åˆ°oldtabæ¥æ“ä½œ int oldCap = (oldTab == null) ? 0 : oldTab.length; int oldThr = threshold; int newCap, newThr = 0; if (oldCap &gt; 0) &#123; if (oldCap &gt;= MAXIMUM_CAPACITY) &#123;//å¦‚æœè€å®¹é‡å¤§äºæœ€å¤§å®¹é‡ threshold = Integer.MAX_VALUE;//é˜ˆå€¼è®¾ç½®ä¸ºIntegerçš„æœ€å¤§å€¼ï¼Œå¥½åƒæ˜¯2147483647ï¼Œè¿œå¤§äºé»˜è®¤çš„æœ€å¤§å®¹é‡ return oldTab;//ç›´æ¥è¿”å›å½“å‰tableï¼Œä¸ç”¨æ‰©å®¹ &#125; else if ((newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY &amp;&amp; oldCap &gt;= DEFAULT_INITIAL_CAPACITY) newThr = oldThr &lt;&lt; 1; // åŒå€æ‰©å¤§è€å†…å­˜å’Œè€é˜ˆå€¼å¹¶èµ‹ç»™æ–°çš„table &#125;else if (oldThr &gt; 0) // åˆå§‹åŒ–HashMapæ—¶æ·»åŠ äº†åˆå§‹å®¹é‡å‚æ•° newCap = oldThr; else &#123; //è¿™ç§æƒ…å†µæ˜¯åˆå§‹åŒ–HashMapæ—¶å•¥å‚æ•°éƒ½æ²¡åŠ  newCap = DEFAULT_INITIAL_CAPACITY; newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY); &#125; if (newThr == 0) &#123;//å½“åªæ»¡è¶³è€é˜ˆå€¼å¤§äº0çš„æ¡ä»¶æ—¶ï¼Œæ–°é˜ˆå€¼ç­‰äºæ–°å®¹é‡*é»˜è®¤æ‰©å®¹å› å­ float ft = (float)newCap * loadFactor; newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (float)MAXIMUM_CAPACITY ? (int)ft : Integer.MAX_VALUE); &#125; threshold = newThr;//æŠŠæ–°çš„é˜ˆå€¼èµ‹ç»™å½“å‰table @SuppressWarnings(&#123;"rawtypes","unchecked"&#125;) Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])new Node[newCap];//åˆ›å»ºå®¹é‡ä¸ºnewCapçš„æ–°table table = newTab; if (oldTab != null) &#123; for (int j = 0; j &lt; oldCap; ++j) &#123;//å¯¹è€tableè¿›è¡Œéå† Node&lt;K,V&gt; e; if ((e = oldTab[j]) != null) &#123;//éå†åˆ°çš„èµ‹ç»™eè¿›è¡Œæš‚å­˜ï¼ŒåŒæ—¶å°†è€tableå¯¹åº”é¡¹èµ‹å€¼ä¸ºnull oldTab[j] = null; if (e.next == null)//å°†ä¸ä¸ºç©ºçš„å…ƒç´ å¤åˆ¶åˆ°æ–°tableä¸­ newTab[e.hash &amp; (newCap - 1)] = e;//åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹æ—¶ç­‰äºæ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºtableç„¶åé‡æ–°è¿›è¡Œå…ƒç´ çš„putï¼Œè¿™é‡Œçš„tableé•¿åº¦æ˜¯åŸtableçš„ä¸¤å€ else if (e instanceof TreeNode)// çº¢é»‘æ ‘è¿›è¡Œæ—‹è½¬ ((TreeNode&lt;K,V&gt;)e).split(this, newTab, j, oldCap); else &#123; // preserve order //HashMapåœ¨JDK1.8çš„æ—¶å€™æ”¹å–„äº†æ‰©å®¹æœºåˆ¶ï¼ŒåŸæ•°ç»„ç´¢å¼•iä¸Šçš„é“¾è¡¨ä¸éœ€è¦å†åè½¬ã€‚ // æ‰©å®¹ä¹‹åçš„ç´¢å¼•ä½ç½®åªèƒ½æ˜¯iæˆ–è€…i+oldCapï¼ˆåŸæ•°ç»„çš„é•¿åº¦ï¼‰ // æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦çœ‹hashcodeæ–°å¢çš„bitä¸º0æˆ–è€…1ã€‚ // å‡å¦‚æ˜¯0æ‰©å®¹ä¹‹åå°±åœ¨æ–°æ•°ç»„ç´¢å¼•iä½ç½®ï¼Œæ–°å¢ä¸º1ï¼Œå°±åœ¨ç´¢å¼•i+oldCapä½ç½® Node&lt;K,V&gt; loHead = null, loTail = null;//ç”¨äºä¿å­˜putåä¸ç§»ä½çš„é“¾è¡¨ Node&lt;K,V&gt; hiHead = null, hiTail = null;//ç”¨äºä¿å­˜putåç§»ä½çš„é“¾è¡¨ Node&lt;K,V&gt; next; do &#123; next = e.next; if ((e.hash &amp; oldCap) == 0) &#123;//å¦‚æœä¸çš„ç»“æœä¸º0ï¼Œè¡¨ç¤ºä¸ç§»ä½ï¼Œå°†æ¡¶ä¸­çš„å¤´ç»“ç‚¹æ·»åŠ åˆ°loheadå’Œlotailä¸­ï¼Œå¾€åå¦‚æœæ¡¶ä¸­è¿˜æœ‰ä¸ç§»ä½çš„ç»“ç‚¹ï¼Œå°±å‘tailç»§ç»­æ·»åŠ  if (loTail == null)//åœ¨åé¢éå†loheadå’Œlotailä¿å­˜åˆ°tableä¸­æ—¶ï¼Œloheadç”¨äºä¿å­˜å¤´ç»“ç‚¹çš„ä½ç½®ï¼Œlotailç”¨äºåˆ¤æ–­æ˜¯å¦åˆ°äº†æœ«å°¾ loHead = e; else loTail.next = e; loTail = e; &#125; else &#123;//è¿™æ˜¯æ·»åŠ ç§»ä½çš„ç»“ç‚¹ï¼Œä¸ä¸ç§»ä½çš„ç±»ä¼¼ if (hiTail == null) hiHead = e; else hiTail.next = e; hiTail = e; &#125; &#125; while ((e = next) != null); if (loTail != null) &#123;//æŠŠä¸ç§»ä½çš„ç»“ç‚¹æ·»åŠ åˆ°å¯¹åº”çš„é“¾è¡¨æ•°ç»„ä¸­å» loTail.next = null; newTab[j] = loHead; &#125; if (hiTail != null) &#123;//æŠŠç§»ä½çš„ç»“ç‚¹æ·»åŠ åˆ°å¯¹åº”çš„é“¾è¡¨æ•°ç»„ä¸­å» hiTail.next = null; newTab[j + oldCap] = hiHead; &#125; &#125; &#125; &#125; &#125; return newTab;&#125; å…·ä½“é€»è¾‘ è‹¥tableä¸ºnullæˆ–å®¹é‡ä¸º0ï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼16æ‰©å®¹ï¼Œä¸´ç•Œå€¼ä¸º16*0.75ï¼Œå¦åˆ™2 è‹¥å®¹é‡æ˜¯å¦è¶…è¿‡è®¾å®šçš„æœ€å¤§å®¹é‡ï¼Œé‡ç½®ä¸´ç•Œå€¼ä¸æ‰©å®¹è¿”å›ï¼Œå¦åˆ™3 å®¹å™¨å®¹é‡åŠ å€ï¼Œä¸´ç•Œå€¼åŠ å€Â· è‹¥å®¹å™¨åŸæ¥ä¸ä¸ºç©ºï¼Œåˆ™éœ€è¿ç§»æ•°æ® oldTab[i]é“¾è¡¨ä¸­æ•°æ®åˆ†åˆ«ç§»è‡³newTab[i]å’ŒnewTab[i+oldTab.length]ä¸­ ç»è¿‡è§‚æµ‹å¯ä»¥å‘ç°ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯2æ¬¡å¹‚çš„æ‰©å±•(æŒ‡é•¿åº¦æ‰©ä¸ºåŸæ¥2å€)ï¼Œæ‰€ä»¥ï¼Œå…ƒç´ çš„ä½ç½®è¦ä¹ˆæ˜¯åœ¨åŸä½ç½®ï¼Œè¦ä¹ˆæ˜¯åœ¨åŸä½ç½®å†ç§»åŠ¨2æ¬¡å¹‚çš„ä½ç½® jdk1.8å¯¹æ‰©å®¹è¿›è¡Œä¼˜åŒ–ï¼Œä½¿å¾—æ‰©å®¹ä¸å†éœ€è¦è¿›è¡Œé“¾è¡¨çš„åè½¬ï¼Œåªéœ€è¦çŸ¥é“hashcodeæ–°å¢çš„bitä½ä¸º0è¿˜æ˜¯1ã€‚å¦‚æœæ˜¯0å°±åœ¨åŸç´¢å¼•ä½ç½®ï¼Œæ–°å¢ç´¢å¼•æ˜¯1å°±åœ¨oldIndex+oldCapä½ç½®ã€‚ æ¨èçœ‹ä¸€ä¸‹è¿™ç¯‡é‡æ–°è®¤è¯†HashMapï¼Œå¯¹æ‰©å®¹å†™çš„å¾ˆæ¸…æ¥š çº¿ç¨‹å®‰å…¨æ€§åä¾‹ï¼Œä¼šé€ æˆæ— é™ç¯ ä¸»è¦åŸå› åœ¨äº å¹¶å‘ä¸‹çš„Rehash ä¼šé€ æˆå…ƒç´ ä¹‹é—´ä¼šå½¢æˆä¸€ä¸ªå¾ªç¯é“¾è¡¨ã€‚ä¸è¿‡ï¼Œjdk 1.8 åè§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸å»ºè®®åœ¨å¤šçº¿ç¨‹ä¸‹ä½¿ç”¨ HashMap,å› ä¸ºå¤šçº¿ç¨‹ä¸‹ä½¿ç”¨ HashMapè¿˜æ˜¯ä¼šå­˜åœ¨å…¶ä»–é—®é¢˜æ¯”å¦‚æ•°æ®ä¸¢å¤±ã€‚å¹¶å‘ç¯å¢ƒä¸‹æ¨èä½¿ç”¨ ConcurrentHashMapã€‚Â· 1234567891011121314151617181920public class HashMapInfiniteLoop &#123; private static HashMap&lt;Integer,String&gt; map = new HashMap&lt;Integer,String&gt;(2ï¼Œ0.75f); public static void main(String[] args) &#123; map.put(5ï¼Œ "C"); new Thread("Thread1") &#123; public void run() &#123; map.put(7, "B"); System.out.println(map); &#125;; &#125;.start(); new Thread("Thread2") &#123; public void run() &#123; map.put(3, "A); System.out.println(map); &#125;; &#125;.start(); &#125; &#125; ç®€å•ä»‹ç»çº¿ç¨‹å®‰å…¨çš„ConcurrentHashMapÂ· jdk1.7 åº•å±‚é‡‡ç”¨åˆ†æ®µçš„æ•°ç»„+é“¾è¡¨å®ç°ï¼Œçº¿ç¨‹å®‰å…¨ é€šè¿‡æŠŠæ•´ä¸ªMapåˆ†ä¸ºNä¸ªSegmentï¼Œå¯ä»¥æä¾›ç›¸åŒçš„çº¿ç¨‹å®‰å…¨ï¼Œä½†æ˜¯æ•ˆç‡æå‡Nå€ï¼Œé»˜è®¤æå‡16å€ã€‚(è¯»æ“ä½œä¸åŠ é”ï¼Œç”±äºHashEntryçš„valueå˜é‡æ˜¯ volatileçš„ï¼Œä¹Ÿèƒ½ä¿è¯è¯»å–åˆ°æœ€æ–°çš„å€¼ã€‚) Hashtableçš„synchronizedæ˜¯é’ˆå¯¹æ•´å¼ Hashè¡¨çš„ï¼Œå³æ¯æ¬¡é”ä½æ•´å¼ è¡¨è®©çº¿ç¨‹ç‹¬å ï¼ŒConcurrentHashMapå…è®¸å¤šä¸ªä¿®æ”¹æ“ä½œå¹¶å‘è¿›è¡Œï¼Œå…¶å…³é”®åœ¨äºä½¿ç”¨äº†é”åˆ†ç¦»æŠ€æœ¯ æœ‰äº›æ–¹æ³•éœ€è¦è·¨æ®µï¼Œæ¯”å¦‚size()å’ŒcontainsValue()ï¼Œå®ƒä»¬å¯èƒ½éœ€è¦é”å®šæ•´ä¸ªè¡¨è€Œè€Œä¸ä»…ä»…æ˜¯æŸä¸ªæ®µï¼Œè¿™éœ€è¦æŒ‰é¡ºåºé”å®šæ‰€æœ‰æ®µï¼Œæ“ä½œå®Œæ¯•åï¼ŒåˆæŒ‰é¡ºåºé‡Šæ”¾æ‰€æœ‰æ®µçš„é” æ‰©å®¹ï¼šæ®µå†…æ‰©å®¹ï¼ˆæ®µå†…å…ƒç´ è¶…è¿‡è¯¥æ®µå¯¹åº”Entryæ•°ç»„é•¿åº¦çš„75%è§¦å‘æ‰©å®¹ï¼Œä¸ä¼šå¯¹æ•´ä¸ªMapè¿›è¡Œæ‰©å®¹ï¼‰ï¼Œæ’å…¥å‰æ£€æµ‹éœ€ä¸éœ€è¦æ‰©å®¹ï¼Œæœ‰æ•ˆé¿å…æ— æ•ˆæ‰©å®¹ jdk1.8 åº•å±‚æ•°æ®ç»“æ„ï¼š JDK1.7çš„ ConcurrentHashMapåº•å±‚é‡‡ç”¨ åˆ†æ®µçš„æ•°ç»„+é“¾è¡¨ å®ç°ï¼ŒJDK1.8 é‡‡ç”¨çš„æ•°æ®ç»“æ„è·ŸHashMap1.8çš„ç»“æ„ä¸€æ ·ï¼Œæ•°ç»„+é“¾è¡¨/çº¢é»‘äºŒå‰æ ‘ã€‚Hashtableå’Œ JDK1.8 ä¹‹å‰çš„ HashMapçš„åº•å±‚æ•°æ®ç»“æ„ç±»ä¼¼éƒ½æ˜¯é‡‡ç”¨ æ•°ç»„+é“¾è¡¨ çš„å½¢å¼ï¼Œæ•°ç»„æ˜¯ HashMapçš„ä¸»ä½“ï¼Œé“¾è¡¨åˆ™æ˜¯ä¸»è¦ä¸ºäº†è§£å†³å“ˆå¸Œå†²çªè€Œå­˜åœ¨çš„ï¼› å®ç°çº¿ç¨‹å®‰å…¨çš„æ–¹å¼ï¼ˆé‡è¦ï¼‰ï¼š â‘  åœ¨JDK1.7çš„æ—¶å€™ï¼ŒConcurrentHashMapï¼ˆåˆ†æ®µé”ï¼‰ å¯¹æ•´ä¸ªæ¡¶æ•°ç»„è¿›è¡Œäº†åˆ†å‰²åˆ†æ®µ(Segment)ï¼Œæ¯ä¸€æŠŠé”åªé”å®¹å™¨å…¶ä¸­ä¸€éƒ¨åˆ†æ•°æ®ï¼Œå¤šçº¿ç¨‹è®¿é—®å®¹å™¨é‡Œä¸åŒæ•°æ®æ®µçš„æ•°æ®ï¼Œå°±ä¸ä¼šå­˜åœ¨é”ç«äº‰ï¼Œæé«˜å¹¶å‘è®¿é—®ç‡ã€‚ åˆ°äº† JDK1.8 çš„æ—¶å€™å·²ç»æ‘’å¼ƒäº†Segmentçš„æ¦‚å¿µï¼Œè€Œæ˜¯ç›´æ¥ç”¨ Node æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘çš„æ•°æ®ç»“æ„æ¥å®ç°ï¼Œå¹¶å‘æ§åˆ¶ä½¿ç”¨ synchronized å’Œ CASæ¥æ“ä½œã€‚ï¼ˆJDK1.6ä»¥å å¯¹ synchronizedé”åšäº†å¾ˆå¤šä¼˜åŒ–ï¼‰ æ•´ä¸ªçœ‹èµ·æ¥å°±åƒæ˜¯ä¼˜åŒ–è¿‡ä¸”çº¿ç¨‹å®‰å…¨çš„ HashMapï¼Œè™½ç„¶åœ¨JDK1.8ä¸­è¿˜èƒ½çœ‹åˆ° Segmentçš„æ•°æ®ç»“æ„ï¼Œä½†æ˜¯å·²ç»ç®€åŒ–äº†å±æ€§ï¼Œåªæ˜¯ä¸ºäº†å…¼å®¹æ—§ç‰ˆæœ¬ï¼› â‘¡ Hashtable(åŒä¸€æŠŠé”) :ä½¿ç”¨ synchronizedæ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ•ˆç‡éå¸¸ä½ä¸‹ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥æ–¹æ³•æ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä¹Ÿè®¿é—®åŒæ­¥æ–¹æ³•ï¼Œå¯èƒ½ä¼šè¿›å…¥é˜»å¡æˆ–è½®è¯¢çŠ¶æ€ï¼Œå¦‚ä½¿ç”¨ put æ·»åŠ å…ƒç´ ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¸èƒ½ä½¿ç”¨ put æ·»åŠ å…ƒç´ ï¼Œä¹Ÿä¸èƒ½ä½¿ç”¨ getï¼Œç«äº‰ä¼šè¶Šæ¥è¶Šæ¿€çƒˆæ•ˆç‡è¶Šä½ã€‚ WeakHashMapHashMapå’ŒWeakHashMapçš„ç›¸åŒç‚¹ å®ƒä»¬éƒ½æ˜¯æ•£åˆ—è¡¨ï¼Œå­˜å‚¨çš„æ˜¯â€œé”®å€¼å¯¹â€æ˜ å°„ã€‚ å®ƒä»¬éƒ½ç»§æ‰¿äºAbstractMapï¼Œå¹¶ä¸”å®ç°MapåŸºç¡€ã€‚ å®ƒä»¬çš„æ„é€ å‡½æ•°éƒ½ä¸€æ ·ã€‚å®ƒä»¬éƒ½åŒ…æ‹¬4ä¸ªæ„é€ å‡½æ•°ï¼Œè€Œä¸”å‡½æ•°çš„å‚æ•°éƒ½ä¸€æ ·ã€‚ é»˜è®¤çš„å®¹é‡å¤§å°æ˜¯16ï¼Œé»˜è®¤çš„åŠ è½½å› å­æ˜¯0.75ã€‚ å®ƒä»¬çš„â€œé”®â€å’Œâ€œå€¼â€éƒ½å…è®¸ä¸ºnullã€‚ å®ƒä»¬éƒ½æ˜¯â€œéåŒæ­¥çš„â€ã€‚ HashMapå’ŒWeakHashMapçš„ä¸åŒç‚¹HashMapå®ç°äº†Cloneableå’ŒSerializableæ¥å£ï¼Œè€ŒWeakHashMapæ²¡æœ‰ã€‚ HashMapå®ç°Cloneableï¼Œæ„å‘³ç€å®ƒèƒ½é€šè¿‡clone()å…‹éš†è‡ªå·±ã€‚ HashMapå®ç°Serializableï¼Œæ„å‘³ç€å®ƒæ”¯æŒåºåˆ—åŒ–ï¼Œèƒ½é€šè¿‡åºåˆ—åŒ–å»ä¼ è¾“ã€‚ HashMapçš„â€œé”®â€æ˜¯â€œå¼ºå¼•ç”¨(StrongReference)â€ï¼Œè€ŒWeakHashMapçš„é”®æ˜¯â€œå¼±å¼•ç”¨(WeakReference)â€ã€‚ WeakReferenceçš„â€œå¼±é”®â€èƒ½å®ç°WeakReferenceå¯¹â€œé”®å€¼å¯¹â€çš„åŠ¨æ€å›æ”¶ã€‚å½“â€œå¼±é”®â€ä¸å†è¢«ä½¿ç”¨åˆ°æ—¶ï¼ŒGCä¼šå›æ”¶å®ƒï¼ŒWeakReferenceä¹Ÿä¼šå°†â€œå¼±é”®â€å¯¹åº”çš„é”®å€¼å¯¹åˆ é™¤ã€‚ è¿™ä¸ªâ€œå¼±é”®â€å®ç°çš„åŠ¨æ€å›æ”¶â€œé”®å€¼å¯¹â€çš„åŸç†å‘¢ï¼Ÿå…¶å®ï¼Œé€šè¿‡WeakReference(å¼±å¼•ç”¨)å’ŒReferenceQueue(å¼•ç”¨é˜Ÿåˆ—)å®ç°çš„ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦äº†è§£WeakHashMapä¸­ï¼š ç¬¬ä¸€ï¼Œâ€œé”®â€æ˜¯WeakReferenceï¼Œå³keyæ˜¯å¼±é”®ã€‚ ç¬¬äºŒï¼ŒReferenceQueueæ˜¯ä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼Œå®ƒæ˜¯å’ŒWeakHashMapè”åˆä½¿ç”¨çš„ã€‚å½“å¼±å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼ŒJavaè™šæ‹Ÿæœºå°±ä¼šæŠŠè¿™ä¸ªå¼±å¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚ WeakHashMapä¸­çš„ReferenceQueueæ˜¯queueã€‚ ç¬¬ä¸‰ï¼ŒWeakHashMapæ˜¯é€šè¿‡æ•°ç»„å®ç°çš„ï¼Œæˆ‘ä»¬å‡è®¾è¿™ä¸ªæ•°ç»„æ˜¯tableã€‚ åŠ¨æ€å›æ”¶æ­¥éª¤1å°†WeakHashMapä¸­çš„keyè®¾ç½®nullï¼Œå¹¶æ‰§è¡Œgc()ã€‚ç³»ç»Ÿä¼šå›æ”¶key æ–°å»ºWeakHashMapï¼Œå°†â€œé”®å€¼å¯¹â€æ·»åŠ åˆ°WeakHashMapä¸­ã€‚å°†â€œé”®å€¼å¯¹â€æ·»åŠ åˆ°WeakHashMapä¸­æ—¶ï¼Œæ·»åŠ çš„é”®éƒ½æ˜¯å¼±é”®ã€‚ å®é™…ä¸Šï¼ŒWeakHashMapæ˜¯é€šè¿‡æ•°ç»„tableä¿å­˜Entry(é”®å€¼å¯¹)ï¼›æ¯ä¸€ä¸ªEntryå®é™…ä¸Šæ˜¯ä¸€ä¸ªå•å‘é“¾è¡¨ï¼Œå³Entryæ˜¯é”®å€¼å¯¹é“¾è¡¨ã€‚ å½“æŸâ€œå¼±é”®â€ä¸å†è¢«å…¶å®ƒå¯¹è±¡å¼•ç”¨ï¼Œå¹¶è¢«GCå›æ”¶æ—¶ã€‚åœ¨GCå›æ”¶è¯¥â€œå¼±é”®â€æ—¶ï¼Œè¿™ä¸ªâ€œå¼±é”®â€ä¹ŸåŒæ—¶ä¼šè¢«æ·»åŠ åˆ°queueé˜Ÿåˆ—ä¸­ã€‚ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬åœ¨å°†â€œå¼±é”®â€keyæ·»åŠ åˆ°WeakHashMapä¹‹åï¼›åæ¥å°†keyè®¾ä¸ºnullã€‚è¿™æ—¶ï¼Œä¾¿æ²¡æœ‰å¤–éƒ¨å¤–éƒ¨å¯¹è±¡å†å¼•ç”¨è¯¥äº†keyã€‚ æ¥ç€ï¼Œå½“Javaè™šæ‹Ÿæœºçš„GCå›æ”¶å†…å­˜æ—¶ï¼Œä¼šå›æ”¶keyçš„ç›¸å…³å†…å­˜ï¼›åŒæ—¶ï¼Œå°†keyæ·»åŠ åˆ°queueé˜Ÿåˆ—ä¸­ã€‚ å½“ä¸‹ä¸€æ¬¡æˆ‘ä»¬éœ€è¦æ“ä½œWeakHashMapæ—¶ï¼Œä¼šå…ˆåŒæ­¥tableå’Œqueueã€‚tableä¸­ä¿å­˜äº†å…¨éƒ¨çš„é”®å€¼å¯¹ï¼Œè€Œqueueä¸­ä¿å­˜è¢«GCå›æ”¶çš„â€œå¼±é”®â€ï¼›åŒæ­¥å®ƒä»¬ï¼Œå°±æ˜¯åˆ é™¤tableä¸­è¢«GCå›æ”¶çš„â€œå¼±é”®â€å¯¹åº”çš„é”®å€¼å¯¹ã€‚ HashSet HashSetåŸºäºHashMapæ¥å®ç°çš„ï¼Œåº•å±‚æ˜¯ä½¿ç”¨HashMapçš„Keyä¿å­˜å…ƒç´ ï¼ŒValueç»Ÿä¸€ä¸ºç±»çš„å¸¸é‡Objectå¯¹è±¡ã€‚ ç»§æ‰¿AbstractCollectionï¼Œå®ç°Setã€Serializableã€Cloneableæ¥å£ã€‚ Serializableï¼šå¯è¢«åºåˆ—åŒ– Cloneableï¼šå¯è¢«å…‹éš† ç‰¹æ€§ï¼š æ— åº å”¯ä¸€ å¯ä¸ºnull ä¸åŒæ­¥ï¼ˆéçº¿ç¨‹å®‰å…¨ï¼‰ å±æ€§1234// ä½¿ç”¨mapçš„Keyä¿å­˜å…ƒç´ private transient HashMap map;// mapçš„Valueå‡æŒ‡å‘PRESENTï¼Œä¸è®¾ç½®ä¸ºnullæ˜¯ä¸ºäº†é˜²æ­¢NullPointerExceptionprivate static final Object PRESENT = new Object(); æ„é€ 123456789101112131415161718// ä½¿ç”¨HashMapçš„åˆå§‹å®¹é‡0å’Œé»˜è®¤åŠ è½½å› å­0.75fæ¥åˆå§‹åŒ–ï¼ˆJDK1.8ï¼‰public HashSet() &#123; map = new HashMap&lt;&gt;();&#125;public HashSet(Collection&lt;? extends E&gt; c) &#123; // å®¹é‡ä¸ºcçš„4/3å€å’Œ16çš„æœ€å¤§å€¼ map = new HashMap&lt;&gt;(Math.max((int) (c.size()/.75f) + 1, 16)); // æ·»åŠ æ‰€æœ‰å…ƒç´  addAll(c);&#125;// æŒ‡å®šåˆå§‹å®¹é‡public HashSet(int initialCapacity) &#123; map = new HashMap&lt;&gt;(initialCapacity);&#125;// æŒ‡å®šåˆå§‹å®¹é‡ï¼ŒåŠ è½½å› å­ï¼ˆdummyæœªä½¿ç”¨ï¼‰HashSet(int initialCapacity, float loadFactor, boolean dummy) &#123; map = new LinkedHashMap&lt;&gt;(initialCapacity, loadFactor);&#125; æ–¹æ³•123456789boolean add(E e) // æ·»åŠ å…ƒç´ void clear() // æ¸…é™¤Object clone() // æµ…å¤åˆ¶boolean contains(Object o) // æ˜¯å¦åŒ…å«boolean isEmpty() // æ˜¯å¦ä¸ºç©ºIterator&lt;E&gt; iterator() // è¿­ä»£å™¨boolean remove(Object o) // ç§»é™¤int size() // é›†åˆå¤§å°Spliterator&lt;E&gt; spliterator() add1234public boolean add(E e) &#123; // è°ƒç”¨HashMap.put(key, value)æ–¹æ³•ï¼ˆkey=eï¼Œvalue=PRESENTï¼‰ return map.put(e, PRESENT)==null;&#125; æ–¹æ³•å£°æ˜åªæœ‰å½“å…ƒç´ å°šæœªå­˜åœ¨äºé›†åˆä¸­æ—¶æ‰ä¼šæ·»åŠ å…ƒç´ ã€‚å¦‚æœæˆåŠŸæ·»åŠ äº†å…ƒç´ ï¼Œåˆ™è¯¥æ–¹æ³•è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚ remove1234public boolean remove(Object o) &#123; //è°ƒç”¨HashMap.remove(key)æ–¹æ³• return map.remove(o)==PRESENT;&#125; HashSetå¦‚ä½•ä¿æŒå”¯ä¸€æ€§ï¼Ÿå½“æˆ‘ä»¬å°†ä¸€ä¸ªå¯¹è±¡æ”¾å…¥ä¸€ä¸ªHashSetæ—¶ï¼Œå®ƒä½¿ç”¨è¯¥å¯¹è±¡çš„hashcodeå€¼æ¥ç¡®å®šä¸€ä¸ªå…ƒç´ æ˜¯å¦å·²ç»åœ¨è¯¥é›†åˆä¸­ã€‚ æ¯ä¸ªæ•£åˆ—ç å€¼å¯¹åº”äºæŸä¸ªå—ä½ç½®ï¼Œè¯¥å—ä½ç½®å¯ä»¥åŒ…å«è®¡ç®—å‡ºçš„æ•£åˆ—å€¼ç›¸åŒçš„å„ç§å…ƒç´ ã€‚ä½†æ˜¯å…·æœ‰ç›¸åŒhashCodeçš„ä¸¤ä¸ªå¯¹è±¡å¯èƒ½ä¸ç›¸ç­‰ã€‚ å› æ­¤ï¼Œå°†ä½¿ç”¨equalsï¼ˆï¼‰æ–¹æ³•æ¯”è¾ƒåŒä¸€å­˜å‚¨æ¡¶ä¸­çš„å¯¹è±¡ã€‚ hashCodeï¼ˆï¼‰ä¸equalsï¼ˆï¼‰çš„ç›¸å…³è§„å®šï¼š å¦‚æœä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ï¼Œåˆ™hashcodeä¸€å®šä¹Ÿæ˜¯ç›¸åŒçš„ ä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰,å¯¹ä¸¤ä¸ªequalsæ–¹æ³•è¿”å›true ä¸¤ä¸ªå¯¹è±¡æœ‰ç›¸åŒçš„hashcodeå€¼ï¼Œå®ƒä»¬ä¹Ÿä¸ä¸€å®šæ˜¯ç›¸ç­‰çš„ ç»¼ä¸Šï¼Œequalsæ–¹æ³•è¢«è¦†ç›–è¿‡ï¼Œåˆ™hashCodeæ–¹æ³•ä¹Ÿå¿…é¡»è¢«è¦†ç›– hashCode()çš„é»˜è®¤è¡Œä¸ºæ˜¯å¯¹å †ä¸Šçš„å¯¹è±¡äº§ç”Ÿç‹¬ç‰¹å€¼ã€‚å¦‚æœæ²¡æœ‰é‡å†™hashCode()ï¼Œåˆ™è¯¥classçš„ä¸¤ä¸ªå¯¹è±¡æ— è®ºå¦‚ä½•éƒ½ä¸ä¼šç›¸ç­‰ï¼ˆå³ä½¿è¿™ä¸¤ä¸ªå¯¹è±¡æŒ‡å‘ç›¸åŒçš„æ•°æ®ï¼‰ã€‚ æ€§èƒ½HashSetçš„æ€§èƒ½ä¸»è¦å—ä¸¤ä¸ªå‚æ•°å½±å“ - åˆå§‹å®¹é‡å’Œè´Ÿè½½å› å­ã€‚ è¾ƒä½çš„åˆå§‹å®¹é‡é™ä½äº†ç©ºé—´å¤æ‚æ€§ï¼Œä½†å¢åŠ äº†é‡æ–°æ•£å¸ƒçš„é¢‘ç‡ï¼Œè¿™æ˜¯ä¸€ä¸ªæ˜‚è´µçš„è¿‡ç¨‹ã€‚ å¦ä¸€æ–¹é¢ï¼Œé«˜åˆå§‹å®¹é‡å¢åŠ äº†è¿­ä»£æˆæœ¬å’Œåˆå§‹å†…å­˜æ¶ˆè€—ã€‚ HashMap å’Œ HashSetåŒºåˆ«TreeMap TreeMapæ˜¯åŸºäºçº¢é»‘æ ‘ï¼ˆRed-Black Treeï¼‰ TreeMapå®ç°SortedMapæ¥å£ï¼Œèƒ½å¤ŸæŠŠå®ƒä¿å­˜çš„è®°å½•æ ¹æ®é”®æ’åºï¼Œé»˜è®¤æ˜¯æŒ‰é”®å€¼çš„å‡åºæ’åºï¼Œä¹Ÿå¯ä»¥æŒ‡å®šæ’åºçš„æ¯”è¾ƒå™¨ï¼Œå½“ç”¨Iteratoréå†TreeMapæ—¶ï¼Œå¾—åˆ°çš„è®°å½•æ˜¯æ’è¿‡åºçš„ã€‚å¦‚æœä½¿ç”¨æ’åºçš„æ˜ å°„ï¼Œå»ºè®®ä½¿ç”¨TreeMapã€‚åœ¨ä½¿ç”¨TreeMapæ—¶ï¼Œkeyå¿…é¡»å®ç°Comparableæ¥å£æˆ–è€…åœ¨æ„é€ TreeMapä¼ å…¥è‡ªå®šä¹‰çš„Comparatorï¼Œå¦åˆ™ä¼šåœ¨è¿è¡Œæ—¶æŠ›å‡ºjava.lang.ClassCastExceptionç±»å‹çš„å¼‚å¸¸ã€‚ å±æ€§12345678// æ¯”è¾ƒå™¨private final Comparator&lt;? super K&gt; comparator;// æ ¹èŠ‚ç‚¹private transient Entry&lt;K,V&gt; root;// æ ‘ä¸­é”®å€¼å¯¹ä¸ªæ•°private transient int size = 0;// æ ‘ç»“æ„çš„ä¿®æ”¹æ¬¡æ•°private transient int modCount = 0; æ„é€ 12345678910111213141516171819public TreeMap() &#123; // æ¯”è¾ƒå™¨ä¸ºnullï¼Œä½¿ç”¨keyçš„è‡ªç„¶é¡ºåºæ¥ç»´æŒTreeMapçš„é¡ºåºï¼ŒKeyè¦æ±‚å®ç°Comparableæ¥å£ comparator = null; &#125;public TreeMap(Comparator&lt;? super K&gt; comparator) &#123; this.comparator = comparator; // è®¾ç½®æ¯”è¾ƒå™¨&#125;public TreeMap(Map&lt;? extends K, ? extends V&gt; m) &#123; comparator = null; // æ¯”è¾ƒå™¨ä¸ºnull putAll(m); // æ”¾ç½®æ‰€æœ‰å…ƒç´ &#125;public TreeMap(SortedMap&lt;K, ? extends V&gt; m) &#123; comparator = m.comparator(); // æ ¹æ®SortedMapçš„æ¯”è¾ƒå™¨ç»´æŒTreeMapçš„é¡ºåº try &#123; buildFromSorted(m.size(), m.entrySet().iterator(), null, null); &#125; catch (java.io.IOException cannotHappen) &#123; &#125; catch (ClassNotFoundException cannotHappen) &#123; &#125;&#125; æ–¹æ³•1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253V put(K key, V value) // æ·»åŠ é”®å€¼å¯¹void putAll(Map&lt;? extends K,? extends V&gt; map) // æ·»åŠ mapä¸­æ‰€æœ‰V remove(Object key) // æ ¹æ®keyç§»é™¤void clear() // ç§»é™¤æ‰€æœ‰é”®å€¼å¯¹Map.Entry&lt;K,V&gt; pollFirstEntry() // ç§»é™¤å¹¶è¿”å›æœ€å°keyçš„é”®å€¼å¯¹Map.Entry&lt;K,V&gt; pollLastEntry() // ç§»é™¤å¹¶è¿”å›æœ€å¤§keyçš„é”®å€¼å¯¹V replace(K key, V value) // æ›¿æ¢æŸkeyçš„valueboolean replace(K key, V oldValue, V newValue) // æ›¿æ¢æŸé”®å€¼å¯¹çš„valueint size() // é”®å€¼å¯¹ä¸ªæ•°Comparator&lt;? super K&gt; comparator() // è¿”å›æ¯”è¾ƒå™¨ï¼Œæ ¹æ®keyçš„è‡ªç„¶æ’åºåˆ™è¿”å›nullV get(Object key) // æŒ‡å®škeyçš„valueSet&lt;K&gt; keySet() // keyé›†åˆNavigableSet&lt;K&gt; navigableKeySet() // å’ŒkeySet()ä¸€æ ·Collection&lt;V&gt; values() // å€¼é›†åˆSet&lt;Map.Entry&lt;K,V&gt;&gt; entrySet() // æ˜ å°„çš„é”®å€¼å¯¹é›†åˆboolean containsKey(Object key) // æ˜¯å¦åŒ…å«æŸé”®boolean containsValue(Object value) // æ˜¯å¦åŒ…å«æŸå€¼NavigableSet&lt;K&gt; descendingKeySet() // keyçš„é™åºé›†åˆNavigableMap&lt;K,V&gt; descendingMap() // é”®å€¼å¯¹çš„é™åºæ˜ å°„Map.Entry&lt;K,V&gt; ceilingEntry(K key) // keyçš„ä¸Šé™ï¼ˆ&gt;=ï¼‰é”®å€¼å¯¹Map.Entry&lt;K,V&gt; floorEntry(K key) // keyçš„ä¸‹é™ï¼ˆ&lt;=ï¼‰é”®å€¼å¯¹K ceilingKey(K key) // keyçš„ä¸Šé™ï¼ˆ&gt;=ï¼‰é”®K floorKey(K key) // keyçš„ä¸‹é™ï¼ˆ&lt;=ï¼‰é”®Map.Entry&lt;K,V&gt; firstEntry() // æœ€å°çš„é”®å€¼å¯¹Map.Entry&lt;K,V&gt; lastEntry() // æœ€å¤§çš„é”®å€¼å¯¹K firstKey() // æœ€å°çš„keyK lastKey() // æœ€å¤§çš„keyMap.Entry&lt;K,V&gt; higherEntry(K key) // å¤§äºkeyçš„ç¬¬ä¸€ä¸ªé”®å€¼å¯¹K higherKey(K key) // å¤§äºkeyçš„ç¬¬ä¸€ä¸ªé”®Map.Entry&lt;K,V&gt; lowerEntry(K key) // å°äºkeyçš„ç¬¬ä¸€ä¸ªé”®å€¼å¯¹K lowerKey(K key) // å°äºkeyçš„ç¬¬ä¸€ä¸ªé”®SortedMap&lt;K,V&gt; headMap(K toKey) // portion &lt; tokey çš„éƒ¨åˆ†NavigableMap&lt;K,V&gt; headMap(K toKey, boolean inclusive) // portion &lt; tokey çš„éƒ¨åˆ†ï¼ˆinclusiveæ˜¯å¦åŒ…å«è¾¹ç•Œï¼‰SortedMap&lt;K,V&gt; subMap(K fromKey, K toKey) // fromKey &lt;= portion &lt; toKey çš„éƒ¨åˆ†NavigableMap&lt;K,V&gt; subMap(K fromKey, boolean fromInclusive, K toKey, boolean toInclusive) // fromKey &lt; portion &lt; toKey çš„éƒ¨åˆ†ï¼ˆinclusiveæ˜¯å¦åŒ…å«è¾¹ç•Œï¼‰SortedMap&lt;K,V&gt; tailMap(K fromKey) // portion &gt;= tokey çš„éƒ¨åˆ†NavigableMap&lt;K,V&gt; tailMap(K fromKey, boolean inclusive) // portion &gt; tokey çš„éƒ¨åˆ†ï¼ˆinclusiveæ˜¯å¦åŒ…å«è¾¹ç•Œï¼‰void forEach(BiConsumer&lt;? super K,? super V&gt; action) // å¯¹æ¯ä¸ªé”®å€¼å¯¹æ‰§è¡Œç›¸åŒæ“ä½œï¼Œå¼‚å¸¸ä¸­æ–­void replaceAll(BiFunction&lt;? super K,? super V,? extends V&gt; function) // å¯¹æ¯ä¸ªé”®å€¼å¯¹æ‰§è¡Œç›¸åŒçš„æ›¿æ¢æ“ä½œï¼Œå¼‚å¸¸ä¸­æ–­Object clone() // æµ…å¤åˆ¶TreeMapå®ä¾‹ ä½¿ç”¨ç¤ºä¾‹ 1234567891011121314// éå†treeMaptreeMap.forEach(new BiConsumer&lt;Integer, String&gt;() &#123; @Override public void accept(Integer integer, String s) &#123; System.out.println(integer+"-&gt;"+s); &#125;&#125;);// æ›¿æ¢treeMapæ‰€æœ‰å…ƒç´ treeMap.replaceAll(new BiFunction&lt;Integer, String, String&gt;() &#123; @Override public String apply(Integer integer, String s) &#123; return s+"...."; &#125;&#125;); put123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263public V put(K key, V value) &#123; Entry&lt;K,V&gt; t = root; // æ ¹èŠ‚ç‚¹ä¸ºnullï¼Œç›´æ¥åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹è¿”å› if (t == null) &#123; compare(key, key); // ç±»å‹æ ¡éªŒï¼Œæ˜¯å¦ä¸ºnull root = new Entry&lt;&gt;(key, value, null); size = 1; modCount++; return null; &#125; int cmp; Entry&lt;K,V&gt; parent; Comparator&lt;? super K&gt; cpr = comparator; // æ¯”è¾ƒå™¨ä¸ä¸ºnullï¼Œä½¿ç”¨æ¯”è¾ƒå™¨ç»´æŒTreeMapçš„å…ƒç´ é¡ºåº if (cpr != null) &#123; // å¾ªç¯ï¼Œè·å–æ’å…¥åçš„çˆ¶èŠ‚ç‚¹ do &#123; // è®°å½•çˆ¶èŠ‚ç‚¹ parent = t; cmp = cpr.compare(key, t.key); // key&lt;t.keyï¼Œæ’å…¥åˆ°èŠ‚ç‚¹çš„å·¦è¾¹ if (cmp &lt; 0) t = t.left; // key&gt;t.keyï¼Œæ’å…¥åˆ°èŠ‚ç‚¹çš„å³è¾¹ else if (cmp &gt; 0) t = t.right; // key==t.keyï¼Œè¦†ç›–åŸå€¼å³å¯ï¼Œå¹¶è¿”å›åŸå€¼ else return t.setValue(value); &#125; while (t != null); &#125; // æ¯”è¾ƒå™¨ä¸ºnullï¼Œä½¿ç”¨keyä½œä¸ºæ¯”è¾ƒå™¨è¿›è¡Œæ¯”è¾ƒï¼Œkeyéœ€å®ç°Comparableæ¥å£ else &#123; if (key == null) throw new NullPointerException(); @SuppressWarnings("unchecked") Comparable&lt;? super K&gt; k = (Comparable&lt;? super K&gt;) key; // åŒä¸Šé¢ä¸€æ ·ï¼Œè·å–æ’å…¥åçš„çˆ¶èŠ‚ç‚¹ do &#123; parent = t; cmp = k.compareTo(t.key); if (cmp &lt; 0) t = t.left; else if (cmp &gt; 0) t = t.right; else return t.setValue(value); &#125; while (t != null); &#125; // åˆ›å»ºæ–°èŠ‚ç‚¹ Entry&lt;K,V&gt; e = new Entry&lt;&gt;(key, value, parent); if (cmp &lt; 0) // keyå°äºçˆ¶èŠ‚ç‚¹ï¼Œæ’å…¥åˆ°å·¦ä¾§ parent.left = e; else // keyå¤§äºçˆ¶èŠ‚ç‚¹ï¼Œæ’å…¥åˆ°å³ä¾§ parent.right = e; // æ’å…¥åï¼Œä¿æŒçº¢é»‘æ ‘å¹³è¡¡è¿›è¡Œè°ƒæ•´ fixAfterInsertion(e); size++; modCount++; return null;&#125; rotateLeft12345678910111213141516171819202122232425// å·¦æ—‹// é‡ç½®ä¸‰ä¸ªçˆ¶å­èŠ‚ç‚¹// 1. p å’Œ r.left// 2. p.parent å’Œ r// 3. r å’Œ pprivate void rotateLeft(Entry&lt;K,V&gt; p) &#123; if (p != null) &#123; Entry&lt;K,V&gt; r = p.right; // 1. p å’Œ r.left å»ºç«‹çˆ¶å­èŠ‚ç‚¹å…³ç³» p.right = r.left; if (r.left != null) r.left.parent = p; // 2. p.parent å’Œ r å»ºç«‹çˆ¶å­èŠ‚ç‚¹å…³ç³» r.parent = p.parent; if (p.parent == null) root = r; else if (p.parent.left == p) p.parent.left = r; else p.parent.right = r; // 3. r å’Œ p å»ºç«‹çˆ¶å­èŠ‚ç‚¹å…³ç³» r.left = p; p.parent = r; &#125;&#125; rotateRight123456789101112131415161718192021222324// å³æ—‹// é‡ç½®ä¸‰ä¸ªçˆ¶å­èŠ‚ç‚¹// 1. p å’Œ l.right// 2. p.parent å’Œ l// 3. l å’Œ pprivate void rotateRight(Entry&lt;K,V&gt; p) &#123; if (p != null) &#123; Entry&lt;K,V&gt; l = p.left; // 1. p å’Œ l.right å»ºç«‹çˆ¶å­èŠ‚ç‚¹å…³ç³» p.left = l.right; if (l.right != null) l.right.parent = p; // 2. p.parent å’Œ l å»ºç«‹çˆ¶å­èŠ‚ç‚¹å…³ç³» l.parent = p.parent; if (p.parent == null) root = l; else if (p.parent.right == p) p.parent.right = l; else p.parent.left = l; // 3. l å’Œ p å»ºç«‹çˆ¶å­èŠ‚ç‚¹å…³ç³» l.right = p; p.parent = l; &#125;&#125; remove123456789101112public V remove(Object key) &#123; // æ ¹æ®keyæŸ¥æ‰¾é”®å€¼å¯¹ Entry&lt;K,V&gt; p = getEntry(key); if (p == null) return null; // ä¿å­˜åŸå€¼ V oldValue = p.value; // åˆ é™¤é”®å€¼å¯¹ deleteEntry(p); // è¿”å›åŸå€¼ return oldValue;&#125; å¯¹equalçš„å‡ ç‚¹è¡¥å…… é›†åˆä¸­å¤§é‡ä½¿ç”¨equalsæ–¹æ³•ï¼Œå®é™…ä¸Šï¼Œè¯¥æ–¹æ³•å¦‚æœæ²¡æœ‰è¢«é‡å†™ï¼Œåˆ™å°±æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦å®Œå…¨ç›¸ç­‰ã€‚ javaå¯¹equals()çš„è¦æ±‚ 123451. å¯¹ç§°æ€§ï¼šå¦‚æœx.equals(y)è¿”å›æ˜¯&quot;true&quot;ï¼Œé‚£ä¹ˆy.equals(x)ä¹Ÿåº”è¯¥è¿”å›æ˜¯&quot;true&quot;ã€‚2. åå°„æ€§ï¼šx.equals(x)å¿…é¡»è¿”å›æ˜¯&quot;true&quot;ã€‚3. ç±»æ¨æ€§ï¼šå¦‚æœx.equals(y)è¿”å›æ˜¯&quot;true&quot;ï¼Œè€Œä¸”y.equals(z)è¿”å›æ˜¯&quot;true&quot;ï¼Œé‚£ä¹ˆz.equals(x)ä¹Ÿåº”è¯¥è¿”å›æ˜¯&quot;true&quot;ã€‚4. ä¸€è‡´æ€§ï¼šå¦‚æœx.equals(y)è¿”å›æ˜¯&quot;true&quot;ï¼Œåªè¦xå’Œyå†…å®¹ä¸€ç›´ä¸å˜ï¼Œä¸ç®¡ä½ é‡å¤x.equals(y)å¤šå°‘æ¬¡ï¼Œè¿”å›éƒ½æ˜¯&quot;true&quot;ã€‚5. éç©ºæ€§ï¼Œx.equals(null)ï¼Œæ°¸è¿œè¿”å›æ˜¯&quot;false&quot;ï¼›x.equals(å’Œxä¸åŒç±»å‹çš„å¯¹è±¡)æ°¸è¿œè¿”å›æ˜¯&quot;false&quot;ã€‚ equals() ä¸ == çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ æ²¡æœ‰è¢«å¤å†™çš„æ—¶å€™ç­‰ä»· hashCode() çš„ä½œç”¨ æœ¬è´¨ä½œç”¨æ˜¯ç¡®å®šè¯¥å¯¹è±¡åœ¨å“ˆå¸Œè¡¨ä¸­çš„ç´¢å¼•ä½ç½® åœ¨æ•£åˆ—è¡¨ä¸­å¯ä»¥åˆ¤æ–­å¯¹è±¡çš„å¤§å°å…³ç³» hashCode() å’Œ equals() çš„å…³ç³» åœ¨ä¼šåˆ›å»ºâ€œç±»å¯¹åº”çš„æ•£åˆ—è¡¨â€çš„æƒ…å†µä¸‹ 1)ã€å¦‚æœä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ï¼Œé‚£ä¹ˆå®ƒä»¬çš„hashCode()å€¼ä¸€å®šç›¸åŒã€‚ è¿™é‡Œçš„ç›¸ç­‰æ˜¯æŒ‡ï¼Œé€šè¿‡equals()æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ—¶è¿”å›trueã€‚ 2)ã€å¦‚æœä¸¤ä¸ªå¯¹è±¡hashCode()ç›¸ç­‰ï¼Œå®ƒä»¬å¹¶ä¸ä¸€å®šç›¸ç­‰ã€‚ å› ä¸ºåœ¨æ•£åˆ—è¡¨ä¸­ï¼ŒhashCode()ç›¸ç­‰ï¼Œå³ä¸¤ä¸ªé”®å€¼å¯¹çš„å“ˆå¸Œå€¼ç›¸ç­‰ã€‚ç„¶è€Œå“ˆå¸Œå€¼ç›¸ç­‰ï¼Œå¹¶ä¸ä¸€å®šèƒ½å¾—å‡ºé”®å€¼å¯¹ç›¸ç­‰ã€‚è¡¥å……è¯´ä¸€å¥ï¼šâ€œä¸¤ä¸ªä¸åŒçš„é”®å€¼å¯¹ï¼Œå“ˆå¸Œå€¼ç›¸ç­‰â€ï¼Œè¿™å°±æ˜¯å“ˆå¸Œå†²çªã€‚ å¯¹conparableå’Œcomparatorçš„å‡ ç‚¹è¡¥å……Java ä¸­ Comparable å’Œ Comparator æ¯”è¾ƒ ComparableComparable æ˜¯æ’åºæ¥å£ã€‚ è‹¥ä¸€ä¸ªç±»å®ç°äº†Comparableæ¥å£ï¼Œå°±æ„å‘³ç€â€œè¯¥ç±»æ”¯æŒæ’åºâ€ã€‚ å³ç„¶å®ç°Comparableæ¥å£çš„ç±»æ”¯æŒæ’åºï¼Œå‡è®¾ç°åœ¨å­˜åœ¨â€œå®ç°Comparableæ¥å£çš„ç±»çš„å¯¹è±¡çš„Liståˆ—è¡¨(æˆ–æ•°ç»„)â€ï¼Œåˆ™è¯¥Liståˆ—è¡¨(æˆ–æ•°ç»„)å¯ä»¥é€šè¿‡ Collections.sortï¼ˆæˆ– Arrays.sortï¼‰è¿›è¡Œæ’åºã€‚ 123456package java.lang;import java.util.*;public interface Comparable&lt;T&gt; &#123; public int compareTo(T o);&#125; è¯´æ˜ï¼šå‡è®¾æˆ‘ä»¬é€šè¿‡ x.compareTo(y) æ¥â€œæ¯”è¾ƒxå’Œyçš„å¤§å°â€ã€‚è‹¥è¿”å›â€œè´Ÿæ•°â€ï¼Œæ„å‘³ç€â€œxæ¯”yå°â€ï¼›è¿”å›â€œé›¶â€ï¼Œæ„å‘³ç€â€œxç­‰äºyâ€ï¼›è¿”å›â€œæ­£æ•°â€ï¼Œæ„å‘³ç€â€œxå¤§äºyâ€ã€‚ ComparatorComparator æ˜¯æ¯”è¾ƒå™¨æ¥å£ã€‚ æˆ‘ä»¬è‹¥éœ€è¦æ§åˆ¶æŸä¸ªç±»çš„æ¬¡åºï¼Œè€Œè¯¥ç±»æœ¬èº«ä¸æ”¯æŒæ’åº(å³æ²¡æœ‰å®ç°Comparableæ¥å£)ï¼›é‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥å»ºç«‹ä¸€ä¸ªâ€œè¯¥ç±»çš„æ¯”è¾ƒå™¨â€æ¥è¿›è¡Œæ’åºã€‚è¿™ä¸ªâ€œæ¯”è¾ƒå™¨â€åªéœ€è¦å®ç°Comparatoræ¥å£å³å¯ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡â€œå®ç°Comparatorç±»æ¥æ–°å»ºä¸€ä¸ªæ¯”è¾ƒå™¨â€ï¼Œç„¶åé€šè¿‡è¯¥æ¯”è¾ƒå™¨å¯¹ç±»è¿›è¡Œæ’åºã€‚ 12345678package java.util;public interface Comparator&lt;T&gt; &#123; int compare(T o1, T o2); boolean equals(Object obj);&#125; è¯´æ˜ï¼š è‹¥ä¸€ä¸ªç±»è¦å®ç°Comparatoræ¥å£ï¼šå®ƒä¸€å®šè¦å®ç°compareTo(T o1, T o2) å‡½æ•°ï¼Œä½†å¯ä»¥ä¸å®ç° equals(Object obj) å‡½æ•°ã€‚ ä¸ºä»€ä¹ˆå¯ä»¥ä¸å®ç° equals(Object obj) å‡½æ•°å‘¢ï¼Ÿ å› ä¸ºä»»ä½•ç±»ï¼Œé»˜è®¤éƒ½æ˜¯å·²ç»å®ç°äº†equals(Object obj)çš„ã€‚ Javaä¸­çš„ä¸€åˆ‡ç±»éƒ½æ˜¯ç»§æ‰¿äºjava.lang.Objectï¼Œåœ¨Object.javaä¸­å®ç°äº†equals(Object obj)å‡½æ•°ï¼›æ‰€ä»¥ï¼Œå…¶å®ƒæ‰€æœ‰çš„ç±»ä¹Ÿç›¸å½“äºéƒ½å®ç°äº†è¯¥å‡½æ•°ã€‚ int compare(T o1, T o2)æ˜¯â€œæ¯”è¾ƒo1å’Œo2çš„å¤§å°â€ã€‚è¿”å›â€œè´Ÿæ•°â€ï¼Œæ„å‘³ç€â€œo1æ¯”o2å°â€ï¼›è¿”å›â€œé›¶â€ï¼Œæ„å‘³ç€â€œo1ç­‰äºo2â€ï¼›è¿”å›â€œæ­£æ•°â€ï¼Œæ„å‘³ç€â€œo1å¤§äºo2â€ã€‚ æ¯”è¾ƒComparableæ˜¯æ’åºæ¥å£ï¼›è‹¥ä¸€ä¸ªç±»å®ç°äº†Comparableæ¥å£ï¼Œå°±æ„å‘³ç€â€œè¯¥ç±»æ”¯æŒæ’åºâ€ã€‚è€ŒComparatoræ˜¯æ¯”è¾ƒå™¨ï¼›æˆ‘ä»¬è‹¥éœ€è¦æ§åˆ¶æŸä¸ªç±»çš„æ¬¡åºï¼Œå¯ä»¥å»ºç«‹ä¸€ä¸ªâ€œè¯¥ç±»çš„æ¯”è¾ƒå™¨â€æ¥è¿›è¡Œæ’åºã€‚ æˆ‘ä»¬ä¸éš¾å‘ç°ï¼šComparableç›¸å½“äºâ€œå†…éƒ¨æ¯”è¾ƒå™¨â€ï¼Œè€ŒComparatorç›¸å½“äºâ€œå¤–éƒ¨æ¯”è¾ƒå™¨â€ã€‚ 1ä¸€ä¸ªç±»æœ¬èº«å®ç°äº†Comparableæ¯”è¾ƒå™¨ï¼Œå°±æ„å‘³ç€å®ƒæœ¬èº«æ”¯æŒæ’åºï¼›è‹¥å®ƒæœ¬èº«æ²¡å®ç°Comparableï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¤–éƒ¨æ¯”è¾ƒå™¨Comparatorè¿›è¡Œæ’åºã€‚ ConcurrentHashMap(jdk1.7)å±æ€§1234567891011 final Segment&lt;K,V&gt;[] segments; transient volatile HashEntry&lt;K,V&gt;[] table;static final class HashEntry&lt;K,V&gt; &#123; final int hash; final K key; volatile V value; volatile HashEntry&lt;K,V&gt; next; //å…¶ä»–çœç•¥&#125; Segmentç»§æ‰¿äº†ReentrantLockï¼Œæ‰€ä»¥å®ƒå°±æ˜¯ä¸€ç§å¯é‡å…¥é”ï¼ˆReentrantLock)ã€‚åœ¨ConcurrentHashMapï¼Œä¸€ä¸ªSegmentå°±æ˜¯ä¸€ä¸ªå­å“ˆå¸Œè¡¨ï¼ŒSegmenté‡Œç»´æŠ¤äº†ä¸€ä¸ªHashEntryæ•°ç»„ï¼Œå¹¶å‘ç¯å¢ƒä¸‹ï¼Œå¯¹äºä¸åŒSegmentçš„æ•°æ®è¿›è¡Œæ“ä½œæ˜¯ä¸ç”¨è€ƒè™‘é”ç«äº‰çš„ã€‚ï¼ˆå°±æŒ‰é»˜è®¤çš„ConcurrentLevelä¸º16æ¥è®²ï¼Œç†è®ºä¸Šå°±å…è®¸16ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼‰ æ„é€ segmentæ„é€ æ–¹æ³• 12345Segment(float lf, int threshold, HashEntry&lt;K,V&gt;[] tab) &#123; this.loadFactor = lf;//è´Ÿè½½å› å­ this.threshold = threshold;//é˜ˆå€¼ this.table = tab;//ä¸»å¹²æ•°ç»„å³HashEntryæ•°ç»„ &#125; ConcurrentHashMapæ„é€ æ–¹æ³• 123456789101112131415161718192021222324252627282930313233343536373839//åˆå§‹åŒ–æ–¹æ³•æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œå¦‚æœç”¨æˆ·ä¸æŒ‡å®šåˆ™ä¼šä½¿ç”¨é»˜è®¤å€¼ï¼ŒinitialCapacityä¸º16ï¼ŒloadFactorä¸º0.75ï¼ˆè´Ÿè½½å› å­ï¼Œæ‰©å®¹æ—¶éœ€è¦å‚è€ƒï¼‰ï¼ŒconcurrentLevelä¸º16ã€‚public ConcurrentHashMap(int initialCapacity, float loadFactor, int concurrencyLevel) &#123; if (!(loadFactor &gt; 0) || initialCapacity &lt; 0 || concurrencyLevel &lt;= 0) throw new IllegalArgumentException(); //MAX_SEGMENTS ä¸º1&lt;&lt;16=65536ï¼Œä¹Ÿå°±æ˜¯æœ€å¤§å¹¶å‘æ•°ä¸º65536 if (concurrencyLevel &gt; MAX_SEGMENTS) concurrencyLevel = MAX_SEGMENTS; //2çš„sshifæ¬¡æ–¹ç­‰äºssizeï¼Œä¾‹:ssize=16,sshift=4;ssize=32,sshif=5 int sshift = 0; //ssize ä¸ºsegmentsæ•°ç»„é•¿åº¦ï¼Œæ ¹æ®concurrentLevelè®¡ç®—å¾—å‡º int ssize = 1; while (ssize &lt; concurrencyLevel) &#123; ++sshift; ssize &lt;&lt;= 1; &#125; //segmentShiftå’ŒsegmentMaskè¿™ä¸¤ä¸ªå˜é‡åœ¨å®šä½segmentæ—¶ä¼šç”¨åˆ° this.segmentShift = 32 - sshift; this.segmentMask = ssize - 1; if (initialCapacity &gt; MAXIMUM_CAPACITY) initialCapacity = MAXIMUM_CAPACITY; //è®¡ç®—capçš„å¤§å°ï¼Œå³Segmentä¸­HashEntryçš„æ•°ç»„é•¿åº¦ï¼Œcapä¹Ÿä¸€å®šä¸º2çš„næ¬¡æ–¹. int c = initialCapacity / ssize; if (c * ssize &lt; initialCapacity) ++c; // é»˜è®¤ MIN_SEGMENT_TABLE_CAPACITY æ˜¯ 2ï¼Œè¿™ä¸ªå€¼ä¹Ÿæ˜¯æœ‰è®²ç©¶çš„ï¼Œå› ä¸ºè¿™æ ·çš„è¯ï¼Œå¯¹äºå…·ä½“çš„æ§½ä¸Šï¼Œ // æ’å…¥ä¸€ä¸ªå…ƒç´ ä¸è‡³äºæ‰©å®¹ï¼Œæ’å…¥ç¬¬äºŒä¸ªçš„æ—¶å€™æ‰ä¼šæ‰©å®¹ int cap = MIN_SEGMENT_TABLE_CAPACITY; while (cap &lt; c) cap &lt;&lt;= 1; //åˆ›å»ºsegmentsæ•°ç»„å¹¶åˆå§‹åŒ–ç¬¬ä¸€ä¸ªSegmentï¼Œå…¶ä½™çš„Segmentå»¶è¿Ÿåˆå§‹åŒ– Segment&lt;K,V&gt; s0 = new Segment&lt;K,V&gt;(loadFactor, (int)(cap * loadFactor), (HashEntry&lt;K,V&gt;[])new HashEntry[cap]); Segment&lt;K,V&gt;[] ss = (Segment&lt;K,V&gt;[])new Segment[ssize]; UNSAFE.putOrderedObject(ss, SBASE, s0); this.segments = ss; &#125; åˆå§‹åŒ–å®Œæˆï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ª Segment æ•°ç»„ã€‚æˆ‘ä»¬å°±å½“æ˜¯ç”¨ new ConcurrentHashMap() æ— å‚æ„é€ å‡½æ•°è¿›è¡Œåˆå§‹åŒ–çš„ï¼Œé‚£ä¹ˆåˆå§‹åŒ–å®Œæˆåï¼š Segmentæ•°ç»„é•¿åº¦ä¸º 16ï¼Œä¸å¯ä»¥æ‰©å®¹.Segmentæ•°ç»„çš„å¤§å°ssizeæ˜¯ç”±concurrentLevelæ¥å†³å®šçš„ï¼Œä½†æ˜¯å´ä¸ä¸€å®šç­‰äºconcurrentLevelï¼Œssizeä¸€å®šæ˜¯å¤§äºæˆ–ç­‰äºconcurrentLevelçš„æœ€å°çš„2çš„æ¬¡å¹‚ Segment[i] çš„é»˜è®¤å¤§å°ä¸º 2ï¼Œè´Ÿè½½å› å­æ˜¯ 0.75ï¼Œå¾—å‡ºåˆå§‹é˜ˆå€¼ä¸º 1.5ï¼Œä¹Ÿå°±æ˜¯ä»¥åæ’å…¥ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ä¼šè§¦å‘æ‰©å®¹ï¼Œæ’å…¥ç¬¬äºŒä¸ªä¼šè¿›è¡Œç¬¬ä¸€æ¬¡æ‰©å®¹ è¿™é‡Œåˆå§‹åŒ–äº† segment[0]ï¼Œå…¶ä»–ä½ç½®è¿˜æ˜¯ nullï¼Œè‡³äºä¸ºä»€ä¹ˆè¦åˆå§‹åŒ– segment[0]ï¼Œåé¢çš„ä»£ç ä¼šä»‹ç» å½“å‰ segmentShiftçš„å€¼ä¸º 32 - 4 = 28ï¼ŒsegmentMask ä¸º 16 - 1 = 15ï¼Œå§‘ä¸”æŠŠå®ƒä»¬ç®€å•ç¿»è¯‘ä¸ºç§»ä½æ•°å’Œæ©ç ï¼Œè¿™ä¸¤ä¸ªå€¼é©¬ä¸Šå°±ä¼šç”¨åˆ° æ–¹æ³•put123456789101112131415161718public V put(K key, V value) &#123; Segment&lt;K,V&gt; s; //concurrentHashMapä¸å…è®¸key/valueä¸ºç©º if (value == null) throw new NullPointerException(); // 1. è®¡ç®— key çš„ hash å€¼ //hashå‡½æ•°å¯¹keyçš„hashCodeé‡æ–°æ•£åˆ—ï¼Œé¿å…å·®åŠ²çš„ä¸åˆç†çš„hashcodeï¼Œä¿è¯æ•£åˆ—å‡åŒ€ int hash = hash(key); // 2. æ ¹æ® hash å€¼æ‰¾åˆ° Segment æ•°ç»„ä¸­çš„ä½ç½® j //è¿”å›çš„hashå€¼æ— ç¬¦å·å³ç§»segmentShiftä½ä¸æ®µæ©ç è¿›è¡Œä½è¿ç®—ï¼Œå®šä½segment int j = (hash &gt;&gt;&gt; segmentShift) &amp; segmentMask; if ((s = (Segment&lt;K,V&gt;)UNSAFE.getObject // nonvolatile; recheck (segments, (j &lt;&lt; SSHIFT) + SBASE)) == null) // in ensureSegment s = ensureSegment(j); // 3. æ’å…¥æ–°å€¼åˆ°æ§½ s ä¸­ //è°ƒç”¨ä»£ç†åˆ°segmentä¸Šçš„putæ–¹æ³• return s.put(key, hash, value, false); &#125; ä»æºç çœ‹å‡ºï¼Œputçš„ä¸»è¦é€»è¾‘ä¹Ÿå°±ä¸¤æ­¥ï¼š 1. å®šä½segmentå¹¶ç¡®ä¿å®šä½çš„Segmentå·²åˆå§‹åŒ– 2. è°ƒç”¨Segmentçš„putæ–¹æ³• å…³äºsegmentShiftå’ŒsegmentMaskÂ· segmentShiftå’ŒsegmentMaskè¿™ä¸¤ä¸ªå…¨å±€å˜é‡çš„ä¸»è¦ä½œç”¨æ˜¯ç”¨æ¥å®šä½Segmentï¼Œint j =(hash &gt;&gt;&gt; segmentShift) &amp; segmentMaskã€‚ segmentMaskï¼šæ®µæ©ç ï¼Œå‡å¦‚segmentsæ•°ç»„é•¿åº¦ä¸º16ï¼Œåˆ™æ®µæ©ç ä¸º16-1=15ï¼›segmentsé•¿åº¦ä¸º32ï¼Œæ®µæ©ç ä¸º32-1=31ã€‚è¿™æ ·å¾—åˆ°çš„æ‰€æœ‰bitä½éƒ½ä¸º1ï¼Œå¯ä»¥æ›´å¥½åœ°ä¿è¯æ•£åˆ—çš„å‡åŒ€æ€§ segmentShiftï¼š2çš„sshiftæ¬¡æ–¹ç­‰äºssizeï¼ŒsegmentShift=32-sshiftã€‚è‹¥segmentsé•¿åº¦ä¸º16ï¼ŒsegmentShift=32-4=28;è‹¥segmentsé•¿åº¦ä¸º32ï¼ŒsegmentShift=32-5=27ã€‚è€Œè®¡ç®—å¾—å‡ºçš„hashå€¼æœ€å¤§ä¸º32ä½ï¼Œæ— ç¬¦å·å³ç§»segmentShiftï¼Œåˆ™æ„å‘³ç€åªä¿ç•™é«˜å‡ ä½ï¼ˆå…¶ä½™ä½æ˜¯æ²¡ç”¨çš„ï¼‰ï¼Œç„¶åä¸æ®µæ©ç segmentMaskä½è¿ç®—æ¥å®šä½Segmentã€‚ *concurrentHashMapä»£ç†åˆ°Segmentä¸Šçš„putæ–¹æ³•ï¼ŒSegmentä¸­çš„putæ–¹æ³•æ˜¯è¦åŠ é”çš„ã€‚åªä¸è¿‡æ˜¯é”ç²’åº¦ç»†äº†è€Œå·²: * 123456789101112131415161718192021222324252627282930313233343536373839404142434445final V put(K key, int hash, V value, boolean onlyIfAbsent) &#123; HashEntry&lt;K,V&gt; node = tryLock() ? null : scanAndLockForPut(key, hash, value);//tryLockä¸æˆåŠŸæ—¶ä¼šéå†å®šä½åˆ°çš„HashEnryä½ç½®çš„é“¾è¡¨ï¼ˆéå†ä¸»è¦æ˜¯ä¸ºäº†ä½¿CPUç¼“å­˜é“¾è¡¨ï¼‰ï¼Œè‹¥æ‰¾ä¸åˆ°ï¼Œåˆ™åˆ›å»ºHashEntryã€‚tryLockä¸€å®šæ¬¡æ•°åï¼ˆMAX_SCAN_RETRIESå˜é‡å†³å®šï¼‰ï¼Œåˆ™lockã€‚è‹¥éå†è¿‡ç¨‹ä¸­ï¼Œç”±äºå…¶ä»–çº¿ç¨‹çš„æ“ä½œå¯¼è‡´é“¾è¡¨å¤´ç»“ç‚¹å˜åŒ–ï¼Œåˆ™éœ€è¦é‡æ–°éå†ã€‚ V oldValue; try &#123; HashEntry&lt;K,V&gt;[] tab = table; int index = (tab.length - 1) &amp; hash;//å®šä½HashEntryï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªhashå€¼åœ¨å®šä½Segmentæ—¶å’Œåœ¨Segmentä¸­å®šä½HashEntryéƒ½ä¼šç”¨åˆ°ï¼Œåªä¸è¿‡å®šä½Segmentæ—¶åªç”¨åˆ°é«˜å‡ ä½ã€‚ HashEntry&lt;K,V&gt; first = entryAt(tab, index); for (HashEntry&lt;K,V&gt; e = first;;) &#123; if (e != null) &#123; K k; if ((k = e.key) == key || (e.hash == hash &amp;&amp; key.equals(k))) &#123; oldValue = e.value; if (!onlyIfAbsent) &#123; e.value = value; ++modCount; &#125; break; &#125; e = e.next; &#125; else &#123;// node åˆ°åº•æ˜¯ä¸æ˜¯ nullï¼Œè¿™ä¸ªè¦çœ‹è·å–é”çš„è¿‡ç¨‹ï¼Œä¸è¿‡å’Œè¿™é‡Œéƒ½æ²¡æœ‰å…³ç³»ã€‚// å¦‚æœä¸ä¸º nullï¼Œé‚£å°±ç›´æ¥å°†å®ƒè®¾ç½®ä¸ºé“¾è¡¨è¡¨å¤´ï¼›å¦‚æœæ˜¯nullï¼Œåˆå§‹åŒ–å¹¶è®¾ç½®ä¸ºé“¾è¡¨è¡¨å¤´ã€‚ if (node != null) node.setNext(first); else node = new HashEntry&lt;K,V&gt;(hash, key, value, first); int c = count + 1; //è‹¥cè¶…å‡ºé˜ˆå€¼thresholdï¼Œéœ€è¦æ‰©å®¹å¹¶rehashã€‚æ‰©å®¹åçš„å®¹é‡æ˜¯å½“å‰å®¹é‡çš„2å€ã€‚è¿™æ ·å¯ä»¥æœ€å¤§ç¨‹åº¦é¿å…ä¹‹å‰æ•£åˆ—å¥½çš„entryé‡æ–°æ•£åˆ—ï¼Œå…·ä½“åœ¨å¦ä¸€ç¯‡æ–‡ç« ä¸­æœ‰è¯¦ç»†åˆ†æï¼Œä¸èµ˜è¿°ã€‚æ‰©å®¹å¹¶rehashçš„è¿™ä¸ªè¿‡ç¨‹æ˜¯æ¯”è¾ƒæ¶ˆè€—èµ„æºçš„ã€‚ if (c &gt; threshold &amp;&amp; tab.length &lt; MAXIMUM_CAPACITY) rehash(node); else setEntryAt(tab, index, node); ++modCount; count = c; oldValue = null; break; &#125; &#125; &#125; finally &#123; unlock(); &#125; return oldValue; &#125; åˆå§‹åŒ–æ§½: ensureSegment ConcurrentHashMap åˆå§‹åŒ–çš„æ—¶å€™ä¼šåˆå§‹åŒ–ç¬¬ä¸€ä¸ªæ§½ segment[0]ï¼Œå¯¹äºå…¶ä»–æ§½æ¥è¯´ï¼Œåœ¨æ’å…¥ç¬¬ä¸€ä¸ªå€¼çš„æ—¶å€™è¿›è¡Œåˆå§‹åŒ–ã€‚è¿™é‡Œéœ€è¦è€ƒè™‘å¹¶å‘ï¼Œå› ä¸ºå¾ˆå¯èƒ½ä¼šæœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›æ¥åˆå§‹åŒ–åŒä¸€ä¸ªæ§½ segment[k]ï¼Œä¸è¿‡åªè¦æœ‰ä¸€ä¸ªæˆåŠŸäº†å°±å¯ä»¥ã€‚ 1234567891011121314151617181920212223242526272829private Segment&lt;K,V&gt; ensureSegment(int k) &#123; final Segment&lt;K,V&gt;[] ss = this.segments; long u = (k &lt;&lt; SSHIFT) + SBASE; // raw offset Segment&lt;K,V&gt; seg; if ((seg = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(ss, u)) == null) &#123; // è¿™é‡Œçœ‹åˆ°ä¸ºä»€ä¹ˆä¹‹å‰è¦åˆå§‹åŒ– segment[0] äº†ï¼Œ // ä½¿ç”¨å½“å‰ segment[0] å¤„çš„æ•°ç»„é•¿åº¦å’Œè´Ÿè½½å› å­æ¥åˆå§‹åŒ– segment[k] // ä¸ºä»€ä¹ˆè¦ç”¨â€œå½“å‰â€ï¼Œå› ä¸º segment[0] å¯èƒ½æ—©å°±æ‰©å®¹è¿‡äº† Segment&lt;K,V&gt; proto = ss[0]; int cap = proto.table.length; float lf = proto.loadFactor; int threshold = (int)(cap * lf); // åˆå§‹åŒ– segment[k] å†…éƒ¨çš„æ•°ç»„ HashEntry&lt;K,V&gt;[] tab = (HashEntry&lt;K,V&gt;[])new HashEntry[cap]; if ((seg = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(ss, u)) == null) &#123; // å†æ¬¡æ£€æŸ¥ä¸€éè¯¥æ§½æ˜¯å¦è¢«å…¶ä»–çº¿ç¨‹åˆå§‹åŒ–äº†ã€‚ Segment&lt;K,V&gt; s = new Segment&lt;K,V&gt;(lf, threshold, tab); // ä½¿ç”¨ while å¾ªç¯ï¼Œå†…éƒ¨ç”¨ CASï¼Œå½“å‰çº¿ç¨‹æˆåŠŸè®¾å€¼æˆ–å…¶ä»–çº¿ç¨‹æˆåŠŸè®¾å€¼åï¼Œé€€å‡º while ((seg = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(ss, u)) == null) &#123; if (UNSAFE.compareAndSwapObject(ss, u, null, seg = s)) break; &#125; &#125; &#125; return seg;&#125; æ€»çš„æ¥è¯´ï¼ŒensureSegment(int k)æ¯”è¾ƒç®€å•ï¼Œå¯¹äºå¹¶å‘æ“ä½œä½¿ç”¨ CAS è¿›è¡Œæ§åˆ¶ã€‚å¦‚æœå½“å‰çº¿ç¨‹ CAS å¤±è´¥ï¼Œè¿™é‡Œçš„ while å¾ªç¯æ˜¯ä¸ºäº†å°† seg èµ‹å€¼è¿”å›ã€‚ è·å–å†™å…¥é”: scanAndLockForPut å¾€æŸä¸ª segment ä¸­ put çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šè°ƒç”¨ node = tryLock() ? null : scanAndLockForPut(key, hash, value)ï¼Œä¹Ÿå°±æ˜¯è¯´å…ˆè¿›è¡Œä¸€æ¬¡ tryLock() å¿«é€Ÿè·å–è¯¥ segment çš„ç‹¬å é”ï¼Œå¦‚æœå¤±è´¥ï¼Œé‚£ä¹ˆè¿›å…¥åˆ° scanAndLockForPut è¿™ä¸ªæ–¹æ³•æ¥è·å–é”ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839private HashEntry&lt;K,V&gt; scanAndLockForPut(K key, int hash, V value) &#123; HashEntry&lt;K,V&gt; first = entryForHash(this, hash); HashEntry&lt;K,V&gt; e = first; HashEntry&lt;K,V&gt; node = null; int retries = -1; // negative while locating node // å¾ªç¯è·å–é” while (!tryLock()) &#123; HashEntry&lt;K,V&gt; f; // to recheck first below if (retries &lt; 0) &#123; if (e == null) &#123; if (node == null) // speculatively create node // è¿›åˆ°è¿™é‡Œè¯´æ˜æ•°ç»„è¯¥ä½ç½®çš„é“¾è¡¨æ˜¯ç©ºçš„ï¼Œæ²¡æœ‰ä»»ä½•å…ƒç´  // å½“ç„¶ï¼Œè¿›åˆ°è¿™é‡Œçš„å¦ä¸€ä¸ªåŸå› æ˜¯ tryLock() å¤±è´¥ï¼Œæ‰€ä»¥è¯¥æ§½å­˜åœ¨å¹¶å‘ï¼Œä¸ä¸€å®šæ˜¯è¯¥ä½ç½® node = new HashEntry&lt;K,V&gt;(hash, key, value, null); retries = 0; &#125; else if (key.equals(e.key)) retries = 0; else // é¡ºç€é“¾è¡¨å¾€ä¸‹èµ° e = e.next; &#125; // é‡è¯•æ¬¡æ•°å¦‚æœè¶…è¿‡ MAX_SCAN_RETRIESï¼ˆå•æ ¸1å¤šæ ¸64ï¼‰ï¼Œé‚£ä¹ˆä¸æŠ¢äº†ï¼Œè¿›å…¥åˆ°é˜»å¡é˜Ÿåˆ—ç­‰å¾…é” // lock() æ˜¯é˜»å¡æ–¹æ³•ï¼Œç›´åˆ°è·å–é”åè¿”å› else if (++retries &gt; MAX_SCAN_RETRIES) &#123; lock(); break; &#125; else if ((retries &amp; 1) == 0 &amp;&amp; // è¿™ä¸ªæ—¶å€™æ˜¯æœ‰å¤§é—®é¢˜äº†ï¼Œé‚£å°±æ˜¯æœ‰æ–°çš„å…ƒç´ è¿›åˆ°äº†é“¾è¡¨ï¼Œæˆä¸ºäº†æ–°çš„è¡¨å¤´ // æ‰€ä»¥è¿™è¾¹çš„ç­–ç•¥æ˜¯ï¼Œç›¸å½“äºé‡æ–°èµ°ä¸€éè¿™ä¸ª scanAndLockForPut æ–¹æ³• (f = entryForHash(this, hash)) != first) &#123; e = first = f; // re-traverse if entry changed retries = -1; &#125; &#125; return node;&#125; è¿™ä¸ªæ–¹æ³•æœ‰ä¸¤ä¸ªå‡ºå£ï¼Œä¸€ä¸ªæ˜¯ tryLock() æˆåŠŸäº†ï¼Œå¾ªç¯ç»ˆæ­¢ï¼Œå¦ä¸€ä¸ªå°±æ˜¯é‡è¯•æ¬¡æ•°è¶…è¿‡äº† MAX_SCAN_RETRIESï¼Œè¿›åˆ° lock() æ–¹æ³•ï¼Œæ­¤æ–¹æ³•ä¼šé˜»å¡ç­‰å¾…ï¼Œç›´åˆ°æˆåŠŸæ‹¿åˆ°ç‹¬å é”ã€‚è¿™ä¸ªæ–¹æ³•å°±æ˜¯çœ‹ä¼¼å¤æ‚ï¼Œä½†æ˜¯å…¶å®å°±æ˜¯åšäº†ä¸€ä»¶äº‹ï¼Œé‚£å°±æ˜¯è·å–è¯¥segmentçš„ç‹¬å é”ï¼Œå¦‚æœéœ€è¦çš„è¯é¡ºä¾¿å®ä¾‹åŒ–äº†ä¸€ä¸‹ nodeã€‚ rehash segment æ•°ç»„ä¸èƒ½æ‰©å®¹ï¼Œæ‰©å®¹æ˜¯ segment æ•°ç»„æŸä¸ªä½ç½®å†…éƒ¨çš„æ•°ç»„ HashEntry[] è¿›è¡Œæ‰©å®¹ï¼Œæ‰©å®¹åï¼Œå®¹é‡ä¸ºåŸæ¥çš„ 2 å€ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬è¦å›é¡¾ä¸€ä¸‹è§¦å‘æ‰©å®¹çš„åœ°æ–¹ï¼Œput çš„æ—¶å€™ï¼Œå¦‚æœåˆ¤æ–­è¯¥å€¼çš„æ’å…¥ä¼šå¯¼è‡´è¯¥ segment çš„å…ƒç´ ä¸ªæ•°è¶…è¿‡é˜ˆå€¼ï¼Œé‚£ä¹ˆå…ˆè¿›è¡Œæ‰©å®¹ï¼Œå†æ’å€¼ è¯¥æ–¹æ³•ä¸éœ€è¦è€ƒè™‘å¹¶å‘ï¼Œå› ä¸ºåˆ°è¿™é‡Œçš„æ—¶å€™ï¼Œæ˜¯æŒæœ‰è¯¥ segment çš„ç‹¬å é”çš„ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960// æ–¹æ³•å‚æ•°ä¸Šçš„ node æ˜¯è¿™æ¬¡æ‰©å®¹åï¼Œéœ€è¦æ·»åŠ åˆ°æ–°çš„æ•°ç»„ä¸­çš„æ•°æ®ã€‚private void rehash(HashEntry&lt;K,V&gt; node) &#123; HashEntry&lt;K,V&gt;[] oldTable = table; int oldCapacity = oldTable.length; // 2 å€ int newCapacity = oldCapacity &lt;&lt; 1; threshold = (int)(newCapacity * loadFactor); // åˆ›å»ºæ–°æ•°ç»„ HashEntry&lt;K,V&gt;[] newTable = (HashEntry&lt;K,V&gt;[]) new HashEntry[newCapacity]; // æ–°çš„æ©ç ï¼Œå¦‚ä» 16 æ‰©å®¹åˆ° 32ï¼Œé‚£ä¹ˆ sizeMask ä¸º 31ï¼Œå¯¹åº”äºŒè¿›åˆ¶ â€˜000...00011111â€™ int sizeMask = newCapacity - 1; // éå†åŸæ•°ç»„ï¼Œè€å¥—è·¯ï¼Œå°†åŸæ•°ç»„ä½ç½® i å¤„çš„é“¾è¡¨æ‹†åˆ†åˆ° æ–°æ•°ç»„ä½ç½® i å’Œ i+oldCap ä¸¤ä¸ªä½ç½® for (int i = 0; i &lt; oldCapacity ; i++) &#123; // e æ˜¯é“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´  HashEntry&lt;K,V&gt; e = oldTable[i]; if (e != null) &#123; HashEntry&lt;K,V&gt; next = e.next; // è®¡ç®—åº”è¯¥æ”¾ç½®åœ¨æ–°æ•°ç»„ä¸­çš„ä½ç½®ï¼Œ // å‡è®¾åŸæ•°ç»„é•¿åº¦ä¸º 16ï¼Œe åœ¨ oldTable[3] å¤„ï¼Œé‚£ä¹ˆ idx åªå¯èƒ½æ˜¯ 3 æˆ–è€…æ˜¯ 3 + 16 = 19 int idx = e.hash &amp; sizeMask; if (next == null) // è¯¥ä½ç½®å¤„åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œé‚£æ¯”è¾ƒå¥½åŠ newTable[idx] = e; else &#123; // Reuse consecutive sequence at same slot // e æ˜¯é“¾è¡¨è¡¨å¤´ HashEntry&lt;K,V&gt; lastRun = e; // idx æ˜¯å½“å‰é“¾è¡¨çš„å¤´ç»“ç‚¹ e çš„æ–°ä½ç½® int lastIdx = idx; // ä¸‹é¢è¿™ä¸ª for å¾ªç¯ä¼šæ‰¾åˆ°ä¸€ä¸ª lastRun èŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹ä¹‹åçš„æ‰€æœ‰å…ƒç´ æ˜¯å°†è¦æ”¾åˆ°ä¸€èµ·çš„ for (HashEntry&lt;K,V&gt; last = next; last != null; last = last.next) &#123; int k = last.hash &amp; sizeMask; if (k != lastIdx) &#123; lastIdx = k; lastRun = last; &#125; &#125; // å°† lastRun åŠå…¶ä¹‹åçš„æ‰€æœ‰èŠ‚ç‚¹ç»„æˆçš„è¿™ä¸ªé“¾è¡¨æ”¾åˆ° lastIdx è¿™ä¸ªä½ç½® newTable[lastIdx] = lastRun; // ä¸‹é¢çš„æ“ä½œæ˜¯å¤„ç† lastRun ä¹‹å‰çš„èŠ‚ç‚¹ï¼Œ // è¿™äº›èŠ‚ç‚¹å¯èƒ½åˆ†é…åœ¨å¦ä¸€ä¸ªé“¾è¡¨ä¸­ï¼Œä¹Ÿå¯èƒ½åˆ†é…åˆ°ä¸Šé¢çš„é‚£ä¸ªé“¾è¡¨ä¸­ for (HashEntry&lt;K,V&gt; p = e; p != lastRun; p = p.next) &#123; V v = p.value; int h = p.hash; int k = h &amp; sizeMask; HashEntry&lt;K,V&gt; n = newTable[k]; newTable[k] = new HashEntry&lt;K,V&gt;(h, p.key, v, n); &#125; &#125; &#125; &#125; // å°†æ–°æ¥çš„ node æ”¾åˆ°æ–°æ•°ç»„ä¸­åˆšåˆšçš„ ä¸¤ä¸ªé“¾è¡¨ä¹‹ä¸€ çš„ å¤´éƒ¨ int nodeIndex = node.hash &amp; sizeMask; // add the new node node.setNext(newTable[nodeIndex]); newTable[nodeIndex] = node; table = newTable;&#125; è¿™é‡Œçš„æ‰©å®¹æ¯”ä¹‹å‰çš„ HashMap è¦å¤æ‚ä¸€äº›ï¼Œä»£ç éš¾æ‡‚ä¸€ç‚¹ã€‚ä¸Šé¢æœ‰ä¸¤ä¸ªæŒ¨ç€çš„ for å¾ªç¯ï¼Œç¬¬ä¸€ä¸ª for æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿå¦‚æœæ²¡æœ‰ç¬¬ä¸€ä¸ª for å¾ªç¯ï¼Œä¹Ÿæ˜¯å¯ä»¥å·¥ä½œçš„ï¼Œä½†æ˜¯ï¼Œè¿™ä¸ª for å¾ªç¯ä¸‹æ¥ï¼Œå¦‚æœ lastRun çš„åé¢è¿˜æœ‰æ¯”è¾ƒå¤šçš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¿™æ¬¡å°±æ˜¯å€¼å¾—çš„ã€‚å› ä¸ºæˆ‘ä»¬åªéœ€è¦å…‹éš† lastRun å‰é¢çš„èŠ‚ç‚¹ï¼Œåé¢çš„ä¸€ä¸²èŠ‚ç‚¹è·Ÿç€ lastRun èµ°å°±æ˜¯äº†ï¼Œä¸éœ€è¦åšä»»ä½•æ“ä½œã€‚æˆ‘è§‰å¾— Doug Lea çš„è¿™ä¸ªæƒ³æ³•ä¹Ÿæ˜¯æŒºæœ‰æ„æ€çš„ï¼Œä¸è¿‡æ¯”è¾ƒåçš„æƒ…å†µå°±æ˜¯æ¯æ¬¡ lastRun éƒ½æ˜¯é“¾è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ æˆ–è€…å¾ˆé åçš„å…ƒç´ ï¼Œé‚£ä¹ˆè¿™æ¬¡éå†å°±æœ‰ç‚¹æµªè´¹äº†ã€‚ä¸è¿‡ Doug Lea ä¹Ÿè¯´äº†ï¼Œæ ¹æ®ç»Ÿè®¡ï¼Œå¦‚æœä½¿ç”¨é»˜è®¤çš„é˜ˆå€¼ï¼Œå¤§çº¦åªæœ‰ 1/6 çš„èŠ‚ç‚¹éœ€è¦å…‹éš†ã€‚ get1234567891011121314151617public V get(Object key) &#123; Segment&lt;K,V&gt; s; HashEntry&lt;K,V&gt;[] tab; int h = hash(key); long u = (((h &gt;&gt;&gt; segmentShift) &amp; segmentMask) &lt;&lt; SSHIFT) + SBASE; //å…ˆå®šä½Segmentï¼Œå†å®šä½HashEntry if ((s = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(segments, u)) != null &amp;&amp; (tab = s.table) != null) &#123; for (HashEntry&lt;K,V&gt; e = (HashEntry&lt;K,V&gt;) UNSAFE.getObjectVolatile (tab, ((long)(((tab.length - 1) &amp; h)) &lt;&lt; TSHIFT) + TBASE); e != null; e = e.next) &#123; K k; if ((k = e.key) == key || (e.hash == h &amp;&amp; key.equals(k))) return e.value; &#125; &#125; return null; &#125; getæ–¹æ³•æ— éœ€åŠ é”ï¼Œç”±äºå…¶ä¸­æ¶‰åŠåˆ°çš„å…±äº«å˜é‡éƒ½ä½¿ç”¨volatileä¿®é¥°ï¼Œvolatileå¯ä»¥ä¿è¯å†…å­˜å¯è§æ€§ï¼Œæ‰€ä»¥ä¸ä¼šè¯»å–åˆ°è¿‡æœŸæ•°æ®ã€‚ è®¡ç®— hash å€¼ï¼Œæ‰¾åˆ° segment æ•°ç»„ä¸­çš„å…·ä½“ä½ç½®ï¼Œæˆ–æˆ‘ä»¬å‰é¢ç”¨çš„â€œæ§½â€ æ§½ä¸­ä¹Ÿæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ ¹æ® hash æ‰¾åˆ°æ•°ç»„ä¸­å…·ä½“çš„ä½ç½® åˆ°è¿™é‡Œæ˜¯é“¾è¡¨äº†ï¼Œé¡ºç€é“¾è¡¨è¿›è¡ŒæŸ¥æ‰¾å³å¯ å¹¶å‘åˆ†æput æ“ä½œçš„çº¿ç¨‹å®‰å…¨æ€§ åˆå§‹åŒ–æ§½ï¼Œè¿™ä¸ªæˆ‘ä»¬ä¹‹å‰å°±è¯´è¿‡äº†ï¼Œä½¿ç”¨äº† CAS æ¥åˆå§‹åŒ– Segment ä¸­çš„æ•°ç»„ã€‚ æ·»åŠ èŠ‚ç‚¹åˆ°é“¾è¡¨çš„æ“ä½œæ˜¯æ’å…¥åˆ°è¡¨å¤´çš„ï¼Œæ‰€ä»¥ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™ get æ“ä½œåœ¨é“¾è¡¨éå†çš„è¿‡ç¨‹å·²ç»åˆ°äº†ä¸­é—´ï¼Œæ˜¯ä¸ä¼šå½±å“çš„ã€‚å½“ç„¶ï¼Œå¦ä¸€ä¸ªå¹¶å‘é—®é¢˜å°±æ˜¯ get æ“ä½œåœ¨ put ä¹‹åï¼Œéœ€è¦ä¿è¯åˆšåˆšæ’å…¥è¡¨å¤´çš„èŠ‚ç‚¹è¢«è¯»å–ï¼Œè¿™ä¸ªä¾èµ–äº setEntryAt æ–¹æ³•ä¸­ä½¿ç”¨çš„ UNSAFE.putOrderedObjectã€‚ æ‰©å®¹ã€‚æ‰©å®¹æ˜¯æ–°åˆ›å»ºäº†æ•°ç»„ï¼Œç„¶åè¿›è¡Œè¿ç§»æ•°æ®ï¼Œæœ€åé¢å°† newTable è®¾ç½®ç»™å±æ€§ tableã€‚æ‰€ä»¥ï¼Œå¦‚æœ get æ“ä½œæ­¤æ—¶ä¹Ÿåœ¨è¿›è¡Œï¼Œé‚£ä¹ˆä¹Ÿæ²¡å…³ç³»ï¼Œå¦‚æœ get å…ˆè¡Œï¼Œé‚£ä¹ˆå°±æ˜¯åœ¨æ—§çš„ table ä¸ŠåšæŸ¥è¯¢æ“ä½œï¼›è€Œ put å…ˆè¡Œï¼Œé‚£ä¹ˆ put æ“ä½œçš„å¯è§æ€§ä¿è¯å°±æ˜¯ table ä½¿ç”¨äº† volatile å…³é”®å­—ã€‚ remove æ“ä½œçš„çº¿ç¨‹å®‰å…¨æ€§get æ“ä½œéœ€è¦éå†é“¾è¡¨ï¼Œä½†æ˜¯ remove æ“ä½œä¼šâ€ç ´åâ€é“¾è¡¨ã€‚å¦‚æœ remove ç ´åçš„èŠ‚ç‚¹ get æ“ä½œå·²ç»è¿‡å»äº†ï¼Œé‚£ä¹ˆè¿™é‡Œä¸å­˜åœ¨ä»»ä½•é—®é¢˜ã€‚å¦‚æœ remove å…ˆç ´åäº†ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ†ä¸¤ç§æƒ…å†µè€ƒè™‘ã€‚ 1ã€å¦‚æœæ­¤èŠ‚ç‚¹æ˜¯å¤´ç»“ç‚¹ï¼Œé‚£ä¹ˆéœ€è¦å°†å¤´ç»“ç‚¹çš„ next è®¾ç½®ä¸ºæ•°ç»„è¯¥ä½ç½®çš„å…ƒç´ ï¼Œtable è™½ç„¶ä½¿ç”¨äº† volatile ä¿®é¥°ï¼Œä½†æ˜¯ volatile å¹¶ä¸èƒ½æä¾›æ•°ç»„å†…éƒ¨æ“ä½œçš„å¯è§æ€§ä¿è¯ï¼Œæ‰€ä»¥æºç ä¸­ä½¿ç”¨äº† UNSAFE æ¥æ“ä½œæ•°ç»„ï¼Œè¯·çœ‹æ–¹æ³• setEntryAtã€‚2ã€å¦‚æœè¦åˆ é™¤çš„èŠ‚ç‚¹ä¸æ˜¯å¤´ç»“ç‚¹ï¼Œå®ƒä¼šå°†è¦åˆ é™¤èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹æ¥åˆ°å‰é©±èŠ‚ç‚¹ä¸­ï¼Œè¿™é‡Œçš„å¹¶å‘ä¿è¯å°±æ˜¯ next å±æ€§æ˜¯ volatile çš„ã€‚ ConcurrentHashMap(1.8)æ„é€ 1234567891011// è¿™æ„é€ å‡½æ•°é‡Œï¼Œä»€ä¹ˆéƒ½ä¸å¹²public ConcurrentHashMap() &#123;&#125;public ConcurrentHashMap(int initialCapacity) &#123; if (initialCapacity &lt; 0) throw new IllegalArgumentException(); int cap = ((initialCapacity &gt;= (MAXIMUM_CAPACITY &gt;&gt;&gt; 1)) ? MAXIMUM_CAPACITY : tableSizeFor(initialCapacity + (initialCapacity &gt;&gt;&gt; 1) + 1)); this.sizeCtl = cap;&#125; æ–¹æ³•put12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091public V put(K key, V value) &#123; return putVal(key, value, false);&#125;final V putVal(K key, V value, boolean onlyIfAbsent) &#123; if (key == null || value == null) throw new NullPointerException(); // å¾—åˆ° hash å€¼ int hash = spread(key.hashCode()); // ç”¨äºè®°å½•ç›¸åº”é“¾è¡¨çš„é•¿åº¦ int binCount = 0; for (Node&lt;K,V&gt;[] tab = table;;) &#123; Node&lt;K,V&gt; f; int n, i, fh; // å¦‚æœæ•°ç»„"ç©º"ï¼Œè¿›è¡Œæ•°ç»„åˆå§‹åŒ– if (tab == null || (n = tab.length) == 0) // åˆå§‹åŒ–æ•°ç»„ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç» tab = initTable(); // æ‰¾è¯¥ hash å€¼å¯¹åº”çš„æ•°ç»„ä¸‹æ ‡ï¼Œå¾—åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ f else if ((f = tabAt(tab, i = (n - 1) &amp; hash)) == null) &#123; // å¦‚æœæ•°ç»„è¯¥ä½ç½®ä¸ºç©ºï¼Œ // ç”¨ä¸€æ¬¡ CAS æ“ä½œå°†è¿™ä¸ªæ–°å€¼æ”¾å…¥å…¶ä¸­å³å¯ï¼Œè¿™ä¸ª put æ“ä½œå·®ä¸å¤šå°±ç»“æŸäº†ï¼Œå¯ä»¥æ‹‰åˆ°æœ€åé¢äº† // å¦‚æœ CAS å¤±è´¥ï¼Œé‚£å°±æ˜¯æœ‰å¹¶å‘æ“ä½œï¼Œè¿›åˆ°ä¸‹ä¸€ä¸ªå¾ªç¯å°±å¥½äº† if (casTabAt(tab, i, null, new Node&lt;K,V&gt;(hash, key, value, null))) break; // no lock when adding to empty bin &#125; // hash å±…ç„¶å¯ä»¥ç­‰äº MOVEDï¼Œè¿™ä¸ªéœ€è¦åˆ°åé¢æ‰èƒ½çœ‹æ˜ç™½ï¼Œä¸è¿‡ä»åå­—ä¸Šä¹Ÿèƒ½çŒœåˆ°ï¼Œè‚¯å®šæ˜¯å› ä¸ºåœ¨æ‰©å®¹ else if ((fh = f.hash) == MOVED) // å¸®åŠ©æ•°æ®è¿ç§»ï¼Œè¿™ä¸ªç­‰åˆ°çœ‹å®Œæ•°æ®è¿ç§»éƒ¨åˆ†çš„ä»‹ç»åï¼Œå†ç†è§£è¿™ä¸ªå°±å¾ˆç®€å•äº† tab = helpTransfer(tab, f); else &#123; // åˆ°è¿™é‡Œå°±æ˜¯è¯´ï¼Œf æ˜¯è¯¥ä½ç½®çš„å¤´ç»“ç‚¹ï¼Œè€Œä¸”ä¸ä¸ºç©º V oldVal = null; // è·å–æ•°ç»„è¯¥ä½ç½®çš„å¤´ç»“ç‚¹çš„ç›‘è§†å™¨é” synchronized (f) &#123; if (tabAt(tab, i) == f) &#123; if (fh &gt;= 0) &#123; // å¤´ç»“ç‚¹çš„ hash å€¼å¤§äº 0ï¼Œè¯´æ˜æ˜¯é“¾è¡¨ // ç”¨äºç´¯åŠ ï¼Œè®°å½•é“¾è¡¨çš„é•¿åº¦ binCount = 1; // éå†é“¾è¡¨ for (Node&lt;K,V&gt; e = f;; ++binCount) &#123; K ek; // å¦‚æœå‘ç°äº†"ç›¸ç­‰"çš„ keyï¼Œåˆ¤æ–­æ˜¯å¦è¦è¿›è¡Œå€¼è¦†ç›–ï¼Œç„¶åä¹Ÿå°±å¯ä»¥ break äº† if (e.hash == hash &amp;&amp; ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek)))) &#123; oldVal = e.val; if (!onlyIfAbsent) e.val = value; break; &#125; // åˆ°äº†é“¾è¡¨çš„æœ€æœ«ç«¯ï¼Œå°†è¿™ä¸ªæ–°å€¼æ”¾åˆ°é“¾è¡¨çš„æœ€åé¢ Node&lt;K,V&gt; pred = e; if ((e = e.next) == null) &#123; pred.next = new Node&lt;K,V&gt;(hash, key, value, null); break; &#125; &#125; &#125; else if (f instanceof TreeBin) &#123; // çº¢é»‘æ ‘ Node&lt;K,V&gt; p; binCount = 2; // è°ƒç”¨çº¢é»‘æ ‘çš„æ’å€¼æ–¹æ³•æ’å…¥æ–°èŠ‚ç‚¹ if ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key, value)) != null) &#123; oldVal = p.val; if (!onlyIfAbsent) p.val = value; &#125; &#125; &#125; &#125; // binCount != 0 è¯´æ˜ä¸Šé¢åœ¨åšé“¾è¡¨æ“ä½œ if (binCount != 0) &#123; // åˆ¤æ–­æ˜¯å¦è¦å°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œä¸´ç•Œå€¼å’Œ HashMap ä¸€æ ·ï¼Œä¹Ÿæ˜¯ 8 if (binCount &gt;= TREEIFY_THRESHOLD) // è¿™ä¸ªæ–¹æ³•å’Œ HashMap ä¸­ç¨å¾®æœ‰ä¸€ç‚¹ç‚¹ä¸åŒï¼Œé‚£å°±æ˜¯å®ƒä¸æ˜¯ä¸€å®šä¼šè¿›è¡Œçº¢é»‘æ ‘è½¬æ¢ï¼Œ // å¦‚æœå½“å‰æ•°ç»„çš„é•¿åº¦å°äº 64ï¼Œé‚£ä¹ˆä¼šé€‰æ‹©è¿›è¡Œæ•°ç»„æ‰©å®¹ï¼Œè€Œä¸æ˜¯è½¬æ¢ä¸ºçº¢é»‘æ ‘ // å…·ä½“æºç æˆ‘ä»¬å°±ä¸çœ‹äº†ï¼Œæ‰©å®¹éƒ¨åˆ†åé¢è¯´ treeifyBin(tab, i); if (oldVal != null) return oldVal; break; &#125; &#125; &#125; // addCount(1L, binCount); return null;&#125; åˆå§‹åŒ–æ•°ç»„ initTable() 1234567891011121314151617181920212223242526272829private final Node&lt;K,V&gt;[] initTable() &#123; Node&lt;K,V&gt;[] tab; int sc; while ((tab = table) == null || tab.length == 0) &#123; // åˆå§‹åŒ–çš„"åŠŸåŠ³"è¢«å…¶ä»–çº¿ç¨‹"æŠ¢å»"äº† if ((sc = sizeCtl) &lt; 0) Thread.yield(); // lost initialization race; just spin // CAS ä¸€ä¸‹ï¼Œå°† sizeCtl è®¾ç½®ä¸º -1ï¼Œä»£è¡¨æŠ¢åˆ°äº†é” else if (U.compareAndSwapInt(this, SIZECTL, sc, -1)) &#123; try &#123; if ((tab = table) == null || tab.length == 0) &#123; // DEFAULT_CAPACITY é»˜è®¤åˆå§‹å®¹é‡æ˜¯ 16 int n = (sc &gt; 0) ? sc : DEFAULT_CAPACITY; // åˆå§‹åŒ–æ•°ç»„ï¼Œé•¿åº¦ä¸º 16 æˆ–åˆå§‹åŒ–æ—¶æä¾›çš„é•¿åº¦ Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])new Node&lt;?,?&gt;[n]; // å°†è¿™ä¸ªæ•°ç»„èµ‹å€¼ç»™ tableï¼Œtable æ˜¯ volatile çš„ table = tab = nt; // å¦‚æœ n ä¸º 16 çš„è¯ï¼Œé‚£ä¹ˆè¿™é‡Œ sc = 12 // å…¶å®å°±æ˜¯ 0.75 * n sc = n - (n &gt;&gt;&gt; 2); &#125; &#125; finally &#123; // è®¾ç½® sizeCtl ä¸º scï¼Œæˆ‘ä»¬å°±å½“æ˜¯ 12 å§ sizeCtl = sc; &#125; break; &#125; &#125; return tab;&#125; é“¾è¡¨è½¬çº¢é»‘æ ‘: treeifyBinå‰é¢æˆ‘ä»¬åœ¨ put æºç åˆ†æä¹Ÿè¯´è¿‡ï¼ŒtreeifyBin ä¸ä¸€å®šå°±ä¼šè¿›è¡Œçº¢é»‘æ ‘è½¬æ¢ï¼Œä¹Ÿå¯èƒ½æ˜¯ä»…ä»…åšæ•°ç»„æ‰©å®¹ã€‚æˆ‘ä»¬è¿˜æ˜¯è¿›è¡Œæºç åˆ†æå§ã€‚ 123456789101112131415161718192021222324252627282930313233private final void treeifyBin(Node&lt;K,V&gt;[] tab, int index) &#123; Node&lt;K,V&gt; b; int n, sc; if (tab != null) &#123; // MIN_TREEIFY_CAPACITY ä¸º 64 // æ‰€ä»¥ï¼Œå¦‚æœæ•°ç»„é•¿åº¦å°äº 64 çš„æ—¶å€™ï¼Œå…¶å®ä¹Ÿå°±æ˜¯ 32 æˆ–è€… 16 æˆ–è€…æ›´å°çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œæ•°ç»„æ‰©å®¹ if ((n = tab.length) &lt; MIN_TREEIFY_CAPACITY) // åé¢æˆ‘ä»¬å†è¯¦ç»†åˆ†æè¿™ä¸ªæ–¹æ³• tryPresize(n &lt;&lt; 1); // b æ˜¯å¤´ç»“ç‚¹ else if ((b = tabAt(tab, index)) != null &amp;&amp; b.hash &gt;= 0) &#123; // åŠ é” synchronized (b) &#123; if (tabAt(tab, index) == b) &#123; // ä¸‹é¢å°±æ˜¯éå†é“¾è¡¨ï¼Œå»ºç«‹ä¸€é¢—çº¢é»‘æ ‘ TreeNode&lt;K,V&gt; hd = null, tl = null; for (Node&lt;K,V&gt; e = b; e != null; e = e.next) &#123; TreeNode&lt;K,V&gt; p = new TreeNode&lt;K,V&gt;(e.hash, e.key, e.val, null, null); if ((p.prev = tl) == null) hd = p; else tl.next = p; tl = p; &#125; // å°†çº¢é»‘æ ‘è®¾ç½®åˆ°æ•°ç»„ç›¸åº”ä½ç½®ä¸­ setTabAt(tab, index, new TreeBin&lt;K,V&gt;(hd)); &#125; &#125; &#125; &#125;&#125; æ‰©å®¹ï¼štryPresizeå¦‚æœè¯´ Java8 ConcurrentHashMap çš„æºç ä¸ç®€å•ï¼Œé‚£ä¹ˆè¯´çš„å°±æ˜¯æ‰©å®¹æ“ä½œå’Œè¿ç§»æ“ä½œã€‚è¿™ä¸ªæ–¹æ³•è¦å®Œå®Œå…¨å…¨çœ‹æ‡‚è¿˜éœ€è¦çœ‹ä¹‹åçš„ transfer æ–¹æ³•ï¼Œè¯»è€…åº”è¯¥æå‰çŸ¥é“è¿™ç‚¹ã€‚è¿™é‡Œçš„æ‰©å®¹ä¹Ÿæ˜¯åšç¿»å€æ‰©å®¹çš„ï¼Œæ‰©å®¹åæ•°ç»„å®¹é‡ä¸ºåŸæ¥çš„ 2 å€ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051// é¦–å…ˆè¦è¯´æ˜çš„æ˜¯ï¼Œæ–¹æ³•å‚æ•° size ä¼ è¿›æ¥çš„æ—¶å€™å°±å·²ç»ç¿»äº†å€äº†private final void tryPresize(int size) &#123; // cï¼šsize çš„ 1.5 å€ï¼Œå†åŠ  1ï¼Œå†å¾€ä¸Šå–æœ€è¿‘çš„ 2 çš„ n æ¬¡æ–¹ã€‚ int c = (size &gt;= (MAXIMUM_CAPACITY &gt;&gt;&gt; 1)) ? MAXIMUM_CAPACITY : tableSizeFor(size + (size &gt;&gt;&gt; 1) + 1); int sc; while ((sc = sizeCtl) &gt;= 0) &#123; Node&lt;K,V&gt;[] tab = table; int n; // è¿™ä¸ª if åˆ†æ”¯å’Œä¹‹å‰è¯´çš„åˆå§‹åŒ–æ•°ç»„çš„ä»£ç åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥ä¸ç”¨ç®¡è¿™å—ä»£ç  if (tab == null || (n = tab.length) == 0) &#123; n = (sc &gt; c) ? sc : c; if (U.compareAndSwapInt(this, SIZECTL, sc, -1)) &#123; try &#123; if (table == tab) &#123; @SuppressWarnings("unchecked") Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])new Node&lt;?,?&gt;[n]; table = nt; sc = n - (n &gt;&gt;&gt; 2); // 0.75 * n &#125; &#125; finally &#123; sizeCtl = sc; &#125; &#125; &#125; else if (c &lt;= sc || n &gt;= MAXIMUM_CAPACITY) break; else if (tab == table) &#123; // æˆ‘æ²¡çœ‹æ‡‚ rs çš„çœŸæ­£å«ä¹‰æ˜¯ä»€ä¹ˆï¼Œä¸è¿‡ä¹Ÿå…³ç³»ä¸å¤§ int rs = resizeStamp(n); if (sc &lt; 0) &#123; Node&lt;K,V&gt;[] nt; if ((sc &gt;&gt;&gt; RESIZE_STAMP_SHIFT) != rs || sc == rs + 1 || sc == rs + MAX_RESIZERS || (nt = nextTable) == null || transferIndex &lt;= 0) break; // 2. ç”¨ CAS å°† sizeCtl åŠ  1ï¼Œç„¶åæ‰§è¡Œ transfer æ–¹æ³• // æ­¤æ—¶ nextTab ä¸ä¸º null if (U.compareAndSwapInt(this, SIZECTL, sc, sc + 1)) transfer(tab, nt); &#125; // 1. å°† sizeCtl è®¾ç½®ä¸º (rs &lt;&lt; RESIZE_STAMP_SHIFT) + 2) // æˆ‘æ˜¯æ²¡çœ‹æ‡‚è¿™ä¸ªå€¼çœŸæ­£çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿä¸è¿‡å¯ä»¥è®¡ç®—å‡ºæ¥çš„æ˜¯ï¼Œç»“æœæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤§çš„è´Ÿæ•° // è°ƒç”¨ transfer æ–¹æ³•ï¼Œæ­¤æ—¶ nextTab å‚æ•°ä¸º null else if (U.compareAndSwapInt(this, SIZECTL, sc, (rs &lt;&lt; RESIZE_STAMP_SHIFT) + 2)) transfer(tab, null); &#125; &#125;&#125; ä¸ªæ–¹æ³•çš„æ ¸å¿ƒåœ¨äº sizeCtl å€¼çš„æ“ä½œï¼Œé¦–å…ˆå°†å…¶è®¾ç½®ä¸ºä¸€ä¸ªè´Ÿæ•°ï¼Œç„¶åæ‰§è¡Œ transfer(tab, null)ï¼Œå†ä¸‹ä¸€ä¸ªå¾ªç¯å°† sizeCtl åŠ  1ï¼Œå¹¶æ‰§è¡Œ transfer(tab, nt)ï¼Œä¹‹åå¯èƒ½æ˜¯ç»§ç»­ sizeCtl åŠ  1ï¼Œå¹¶æ‰§è¡Œ transfer(tab, nt)ã€‚æ‰€ä»¥ï¼Œå¯èƒ½çš„æ“ä½œå°±æ˜¯æ‰§è¡Œ 1 æ¬¡ transfer(tab, null) + å¤šæ¬¡ transfer(tab, nt)ï¼Œè¿™é‡Œæ€ä¹ˆç»“æŸå¾ªç¯çš„éœ€è¦çœ‹å®Œ transfer æºç æ‰æ¸…æ¥š HashMapå’ŒConcurrentHashMapæºç jkd7~8å…¨è§£æ]]></content>
      <tags>
        <tag>java</tag>
        <tag>æºç </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é“¾è¡¨é—®é¢˜æ•´ç†]]></title>
    <url>%2F2020%2F02%2F23%2FlinkedList%2F</url>
    <content type="text"><![CDATA[é“¾è¡¨å¯ä»¥è¯´æ˜¯æœ€å¸¸è§çš„æ•°æ®ç»“æ„ä¹‹ä¸€ã€‚çœ‹ä¼¼ç®€å•ä½†æ˜¯çœŸæ­£åº”ç”¨èµ·æ¥æœ‰å¾ˆå¼ºçš„çµæ´»æ€§ï¼Œç°åœ¨å°†é“¾è¡¨é—®é¢˜å½’çº³ä¸€ä¸‹ï¼Œä»é“¾è¡¨çš„å¸¸è§å˜å¼åˆ°å…·ä½“åº”ç”¨ï¼Œäº‰å–å¯¹é“¾è¡¨é—®é¢˜ä¸€ç½‘æ‰“å°½ï¼ å•é“¾è¡¨ ç›¸æ¯”äºæ•°ç»„æ’å…¥åˆ é™¤æ—¶O(n)çš„æ—¶é—´å¤æ‚åº¦ï¼Œé“¾è¡¨çš„æ—¶é—´å¤æ‚åº¦åªè¦O(1) ä½†æ˜¯é“¾è¡¨éšæœºè®¿é—®çš„æ€§èƒ½æ²¡æœ‰æ•°ç»„å¥½ï¼Œéœ€è¦ O(n) çš„æ—¶é—´å¤æ‚åº¦ å°¾éƒ¨æ’å…¥1234567891011121314151617private void insertToTail(int value)&#123; Node node = new Node(value,null); if(null == head)&#123; head = node; &#125;else &#123; Node q = head; while(q.next!= null )&#123; q = q.next; &#125; //å…³é”®æ­¥éª¤ï¼Œä¸èƒ½è°ƒæ¢é¡ºåº node.next = q.next; q.next = node; &#125; &#125; ç´¢å¼•æ’å…¥1234567891011121314151617181920212223private void insert(int value,int index)&#123; Node node = head; Node preNode = null; int pos = 0; while(node != null &amp;&amp; index != pos)&#123; preNode = node; node = node.next; pos++; &#125; Node newNode= new Node(value,node.next); if(node == null)&#123; return ; &#125; if(preNode ==null)&#123; newNode.next = head; head = newNode; &#125;else&#123; newNode.next = preNode.next; preNode.next = newNode; &#125; &#125; é€šè¿‡å€¼åˆ é™¤èŠ‚ç‚¹æ³¨æ„å¤´èŠ‚ç‚¹çš„ç‰¹æ®Šå¤„ç† 123456789101112131415161718192021222324252627private void deleteByNode(int data)&#123; if(head == null)&#123; return ; &#125; Node node = head; //åº”è¯¥æ˜¯ä¿å­˜æ’å…¥èŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹ Node q = null; while(node!= null &amp;&amp; node.data != data)&#123; //ä¿å­˜ä¸Šä¸€ä¸ªèŠ‚ç‚¹ q = node; //ä½¿å¾—å¾ªç¯ç»§ç»­ä¸‹å» node = node.next; &#125; //è¯´æ˜æ²¡æœ‰æ‰¾åˆ°èŠ‚ç‚¹ if(node == null)&#123; return; &#125; //åˆ é™¤headå¤´èŠ‚ç‚¹çš„æ—¶å€™ï¼Œæ­¤æ—¶qä¾ç„¶ä¸ºnull(æ²¡æœ‰è¿›å…¥å¾ªç¯)ï¼Œå¿…é¡»ç‰¹æ®Šå¤„ç†ï¼Œç²¾é«“æ‰€åœ¨ if(q == null)&#123; head = head.next; &#125;else&#123; q.next = q.next.next; &#125; &#125; é€šè¿‡å€¼æŸ¥æ‰¾1234567private Node findByValue(int data)&#123; Node node = head; while(node != null)&#123; node = node.next; &#125; return node; &#125; åŒé“¾è¡¨ä»ç»“æ„ä¸Šæ¥çœ‹ï¼ŒåŒå‘é“¾è¡¨å¯ä»¥æ”¯æŒ O(1) æ—¶é—´å¤æ‚åº¦çš„æƒ…å†µä¸‹æ‰¾åˆ°å‰é©±ç»“ç‚¹ï¼Œæ­£æ˜¯è¿™æ ·çš„ç‰¹ç‚¹ï¼Œä¹Ÿä½¿åŒå‘é“¾è¡¨åœ¨æŸäº›æƒ…å†µä¸‹çš„æ’å…¥ã€åˆ é™¤ç­‰æ“ä½œéƒ½è¦æ¯”å•é“¾è¡¨ç®€å•ã€é«˜æ•ˆã€‚ æ¯”å¦‚ï¼Œåˆ é™¤æ“ä½œçš„æƒ…å†µå­˜åœ¨ä¸¤ç§æƒ…å†µï¼š åˆ é™¤ç»“ç‚¹ä¸­â€œå€¼ç­‰äºæŸä¸ªç»™å®šå€¼â€çš„ç»“ç‚¹ åˆ é™¤ç»™å®šæŒ‡é’ˆæŒ‡å‘çš„ç»“ç‚¹ã€‚ ç¬¬ä¸€ç§æƒ…å†µé“¾è¡¨çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(n)ï¼Œç¬¬äºŒç§æƒ…å†µåŒé“¾è¡¨æ— éœ€æŸ¥æ‰¾ï¼ŒO(1)æ—¶é—´å¤æ‚åº¦åˆ é™¤èŠ‚ç‚¹ LinkedHashMapç”¨çš„å°±æ˜¯åŒå‘é“¾è¡¨ æ’å…¥æ“ä½œä»¥å°¾éƒ¨æ’å…¥ä¸¾ä¾‹ 1234567891011121314private void insertToTail(int data)&#123; DuoNode node = new DuoNode(data); DuoNode last = tail; if(count == 0)&#123; head = node; tail = node; &#125;else&#123; last.next = node; node.prev = last; tail = node; &#125; ++count; &#125; åˆ é™¤æ“ä½œåˆ é™¤å¤´éƒ¨ 1234567891011private DuoNode deleteHead()&#123; DuoNode h = head; if(count &gt;0)&#123; //ä¸¤å¥è¯æœ€å¥½ä¸è¦åç€æ¥ head = h.next; head.prev = null; --count; return h; &#125; return null; &#125; åˆ é™¤å°¾éƒ¨ 123456789private DuoNode deleteTail() &#123; DuoNode q = tail; if (count &gt; 0) &#123; tail = tail.prev; tail.next = null; --count; &#125; return q; &#125; æŸ¥æ‰¾123456789101112private DuoNode findIndex(int index) &#123; if(index &gt;count)&#123; return null; &#125; DuoNode node = head; int num = 0; while(num &lt; index) &#123; node = node.next; ++num; &#125; return node; &#125; å¾ªç¯é“¾è¡¨å¾ªç¯é“¾è¡¨çš„ä¼˜ç‚¹æ˜¯ä»é“¾å°¾åˆ°é“¾å¤´æ¯”è¾ƒæ–¹ä¾¿ã€‚å½“è¦å¤„ç†çš„æ•°æ®å…·æœ‰ç¯å‹ç»“æ„ç‰¹ç‚¹æ—¶ï¼Œå°±ç‰¹åˆ«é€‚åˆé‡‡ç”¨å¾ªç¯é“¾è¡¨ ç§æœ‰å±æ€§123456789101112public class CircleLinkedList &#123; private Node head; private Node tail; private int count; CircleLinkedList()&#123; head = null; tail = null; count = 0; &#125; //...&#125; æ’å…¥æ“ä½œ12345678910111213private void insertHead(int data)&#123; Node node = new Node(data,null); if(count== 0)&#123; head = node; tail = node; &#125;else&#123; node.next = head; tail.next = node; head = node; count++; &#125; &#125; åº”ç”¨LRUç¼“å­˜æ·˜æ±°ç®—æ³•æ€è·¯ï¼šç»´æŠ¤ä¸€ä¸ªæœ‰åºå•é“¾è¡¨ï¼Œè¶Šé è¿‘é“¾è¡¨å°¾éƒ¨çš„ç»“ç‚¹æ˜¯è¶Šæ—©ä¹‹å‰è®¿é—®çš„ã€‚å½“æœ‰ä¸€ä¸ªæ–°çš„æ•°æ®è¢«è®¿é—®æ—¶ï¼Œæˆ‘ä»¬ä»é“¾è¡¨å¤´å¼€å§‹é¡ºåºéå†é“¾è¡¨ã€‚ å¦‚æœæ­¤æ•°æ®ä¹‹å‰å·²ç»è¢«ç¼“å­˜åœ¨é“¾è¡¨ä¸­äº†ï¼Œæˆ‘ä»¬éå†å¾—åˆ°è¿™ä¸ªæ•°æ®å¯¹åº”çš„ç»“ç‚¹ï¼Œå¹¶å°†å…¶ä»åŸæ¥çš„ä½ç½®åˆ é™¤ï¼Œç„¶åå†æ’å…¥åˆ°é“¾è¡¨çš„å¤´éƒ¨ã€‚ å¦‚æœæ­¤æ•°æ®æ²¡æœ‰åœ¨ç¼“å­˜é“¾è¡¨ä¸­ï¼Œåˆå¯ä»¥åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š å¦‚æœæ­¤æ—¶ç¼“å­˜æœªæ»¡ï¼Œåˆ™å°†æ­¤ç»“ç‚¹ç›´æ¥æ’å…¥åˆ°é“¾è¡¨çš„å¤´éƒ¨ï¼› å¦‚æœæ­¤æ—¶ç¼“å­˜å·²æ»¡ï¼Œåˆ™é“¾è¡¨å°¾ç»“ç‚¹åˆ é™¤ï¼Œå°†æ–°çš„æ•°æ®ç»“ç‚¹æ’å…¥é“¾è¡¨çš„å¤´éƒ¨ã€‚ æ„é€ æ–¹æ³• æ¯”èµ·æ™®é€šé“¾è¡¨å¤šç»´æŠ¤ä¸€ä¸ªå®¹é‡ 1234567891011121314public class LRUByLinkedList&#123; private Node head; //æœ€å¤§å®¹é‡ private int size; //å·²å­˜å‚¨å®¹é‡ private int count; public LRUByLinkedList(int capacity)&#123; head = null; size = capacity; count = 0; &#125; //...&#125; æ’å…¥æ“ä½œ 12345678910111213private void insert(int data)&#123; Node preNode = findNode(data); //æ›´æ–°ç¼“å­˜ï¼Œæ—§ç¼“å­˜æ¸…é™¤ if(null != preNode)&#123; delete(preNode); &#125;else&#123; if(count &gt;= size)&#123; //å¦‚æœç¼“å­˜æº¢å‡ºï¼Œåˆ é™¤æœ€æ—©çš„ç¼“å­˜ deleteToTail(); &#125; &#125; insertToHead(data); &#125; æŸ¥æ‰¾ç¼“å­˜ 1234567891011private Node findNode(int data) &#123; Node node = head; while(null != node &amp;&amp; null != node.next)&#123; Node nextNode = node.next; if(data == nextNode.data)&#123; return node; &#125; node = nextNode; &#125; return null; &#125; è¯¦ç»†ä»£ç  å•é“¾è¡¨åè½¬é€’å½’æ³• æ³¨æ„å¼€å§‹è¾¹ç•Œæ¡ä»¶ å½“é€’å½’çš„æœ€åèŠ‚ç‚¹çš„æ—¶å€™å°†æœ€åç¬¬äºŒä¸ªèŠ‚ç‚¹çš„nextèŠ‚ç‚¹æŒ‡å‘æœ€åç¬¬äºŒä¸ªèŠ‚ç‚¹ï¼Œç„¶åæœ€åä¸€ä¸ªèŠ‚ç‚¹æˆä¸ºäº†å¤´èŠ‚ç‚¹ 123456789101112/** * é“¾è¡¨åè½¬ â€”â€”é€’å½’æ³•ï¼ˆç²¾é«“ï¼‰ * @param head * @return */ public Node reverseList(Node node) &#123; if (node == null || node.next == null) return node; Node p = reverseList(node.next); node.next.next = node; node.next = null; return p; &#125; éé€’å½’æ³• è¦ç‚¹ï¼š1. å¿…é¡»ç»´æŠ¤å‰é©±èŠ‚ç‚¹ 2. åè½¬å°†åç»§æŒ‡é’ˆæŒ‡å‘å‰é©±èŠ‚ç‚¹ 123456789101112131415161718192021/** * å•é“¾è¡¨åè½¬ * @param list * @return */public static Node reserve(Node list)&#123; Node cur = list; //å­˜å‚¨é“¾è¡¨çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼Œéå†å®Œä¹‹åå˜æˆå¤´èŠ‚ç‚¹ Node pre = null; while(cur != null)&#123; //æš‚å­˜æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨ Node next = cur.next; //åè½¬ï¼Œå°†å­˜å‚¨çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘ä¸Šä¸€ä¸ªèŠ‚ç‚¹ cur.next = pre; //ä¸‹é¢ä¸¤éƒ¨å°†é“¾è¡¨å‘ä¸‹ç§»åŠ¨ pre = cur; cur = next; &#125; //éå†å®Œä¹‹åpreå˜æˆå¤´èŠ‚ç‚¹ return pre;&#125; ç¯çš„æ£€æµ‹123456789101112131415161718192021//ä½¿ç”¨å¿«æ…¢æŒ‡é’ˆæ³•ã€‚è¿½åŠé—®é¢˜ï¼Œåªè¦æ…¢æŒ‡é’ˆè¿½ä¸Šå¿«æŒ‡é’ˆï¼Œè¯´æ˜å­˜åœ¨ç¯è·¯ public static boolean checkCircle(Node list)&#123; if(list== null) &#123; return false; &#125; Node fast = list.next; Node slow = list; //æ³¨æ„æˆªæ­¢æ¡ä»¶ while(fast != null &amp;&amp; fast.next != null)&#123; fast = fast.next.next; slow = slow.next; if(fast == slow)&#123; return true; &#125; &#125; return false; &#125; ä¸¤ä¸ªæœ‰åºé“¾è¡¨çš„åˆå¹¶123456789101112131415161718192021222324252627282930313233public static Node mergeSortList(Node la,Node lb)&#123; Node p = la; Node q =lb; Node head ; //å¤„ç†å¤´éƒ¨çš„ç‰¹æ®Šæƒ…å†µ if(p.data&lt;q.data)&#123; head = p; p = p.next; &#125;else&#123; head = q; q = q.next; &#125; Node r = head; while(q != null &amp;&amp; p != null) &#123; if (q.data &lt; p.data) &#123; r.next = q; q = q.next; &#125; else &#123; r.next = p; p = p.next; &#125; &#125; if(p.next == null)&#123; r.next = q; &#125; if(q.next == null)&#123; r.next =p; &#125; return r; &#125; å¯ä»¥é€šè¿‡ç»´æŠ¤ä¸€ä¸ªå“¨å…µè®©ä»£ç æ›´åŠ ç®€æ´ 12345678910111213141516/** * æœ‰åºåˆå¹¶ï¼ˆå“¨å…µæœºåˆ¶ä¼˜åŒ–ï¼‰ * @param la * @param lb * @return */public static Node mergeTwoListsA(Node la,Node lb)&#123; Node soldier = new Node(0,null); Node p = soldier; //æ­£å¸¸çš„åˆå¹¶é€»è¾‘ return p;&#125; é€’å½’æ³• 1234567891011121314151617181920212223/** * é€’å½’åˆå¹¶é“¾è¡¨ * @param l1 * @param l2 * @return */ public Node mergeTwoLists(Node l1, Node l2) &#123; if (l1 == null) &#123; return l2; &#125; else if (l2 == null) &#123; return l1; &#125; else if (l1.data &lt; l2.data) &#123; l1.next = mergeTwoLists(l1.next, l2); return l1; &#125; else &#123; l2.next = mergeTwoLists(l1, l2.next); return l2; &#125; &#125; åˆ é™¤é“¾è¡¨çš„å€’æ•°nä¸ªèŠ‚ç‚¹å¿«æŒ‡é’ˆæ¯”æ…¢æŒ‡é’ˆå‰kä¸ªèŠ‚ç‚¹ï¼Œç„¶åå¿«æŒ‡é’ˆéå†åˆ°å°¾éƒ¨çš„æ—¶å€™æ…¢æŒ‡é’ˆåˆšåˆšå¥½åˆ°åˆ é™¤èŠ‚ç‚¹ï¼Œæ³¨æ„ä¿å­˜åˆ é™¤èŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹ 12345678910111213141516171819202122232425262728private void deleteLastKth(Node list,int index)&#123; Node fast = list; //æ³¨æ„è¿™é‡Œçš„iï¼ï¼ï¼ï¼ int i = 1; while(fast != null &amp;&amp; i&lt;index)&#123; fast = fast.next; i++; &#125; if(fast == null)&#123; return ; &#125; Node slow = list; Node prev = null; //éå†åˆ°æœ€åfastæŒ‡é’ˆæŒ‡å‘æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ³¨æ„å¿«æ…¢æŒ‡é’ˆä¹‹é—´çš„é—´éš” //å› ä¸ºé€‰æ‹©ä½¿ç”¨prevä½œä¸ºåˆ é™¤èŠ‚ç‚¹ï¼Œæ‰€ä»¥next !=null while(fast.next != null)&#123; fast = fast.next; prev = slow; slow = slow.next; &#125; if(prev != null)&#123; prev.next = prev.next.next; &#125;else&#123; list = list.next; &#125; return ; &#125; æ±‚é“¾è¡¨çš„ä¸­é—´èŠ‚ç‚¹å¿«æ…¢æŒ‡é’ˆæ³• 123456789101112private static Node fndMiddleNode(Node list )&#123; Node fast = list; Node slow = list; //ç¬¬ä¸€ä¸ªæ¡ä»¶æ˜¯é˜²æ­¢headä¸ºnullï¼Œç¬¬äºŒä¸ªæ˜¯ä¸ºäº†ä½¿å¾—fastæŒ‡é’ˆéå†åˆ°æœ€åä¸€ä¸ªèŠ‚ç‚¹ while(fast != null &amp;&amp; fast.next != null)&#123; fast = fast.next.next; slow = slow.next; &#125; return slow; &#125; åˆ¤æ–­æ˜¯å¦å›æ–‡ä¸²æ€è·¯ï¼š ä½¿ç”¨å¿«æ…¢ä¸¤ä¸ªæŒ‡é’ˆæ‰¾åˆ°é“¾è¡¨ä¸­ç‚¹ï¼Œæ…¢æŒ‡é’ˆæ¯æ¬¡å‰è¿›ä¸€æ­¥ï¼Œå¿«æŒ‡é’ˆæ¯æ¬¡å‰è¿›ä¸¤æ­¥ã€‚åœ¨æ…¢æŒ‡é’ˆå‰è¿›çš„è¿‡ç¨‹ä¸­ï¼ŒåŒæ—¶ä¿®æ”¹å…¶ next æŒ‡é’ˆï¼Œä½¿å¾—é“¾è¡¨å‰åŠéƒ¨åˆ†ååºã€‚æœ€åæ¯”è¾ƒä¸­ç‚¹ä¸¤ä¾§çš„é“¾è¡¨æ˜¯å¦ç›¸ç­‰ã€‚ 1234567891011121314151617181920212223242526272829303132//ä½¿ç”¨çš„public boolean isPalindrome(Node list)&#123; Node slow = list; Node fast = list; Node prev = null; if(list == null)&#123; return false; &#125; while(fast != null &amp;&amp; fast.next != null)&#123; fast = fast.next.next; Node next = slow.next; //é“¾è¡¨åå‘ slow.next = prev; //å‰é©±æŒ‡é’ˆåç§» prev = slow; //æ…¢æŒ‡é’ˆåç§» slow = next; &#125; //è·¨è¿‡ä¸­ç‚¹ï¼Œä½¿å¾—prevå’ŒslowåŒæ­¥ï¼Œè¿™é‡Œå­˜åœ¨èŠ‚ç‚¹æ•°æ˜¯å¥‡æ•°è¿˜æ˜¯å¶æ•°çš„æƒ…å†µ if(fast != null)&#123; slow = slow.next; &#125; if(slow != null)&#123; if(slow.data != prev.data)&#123; return false; &#125; slow = slow.next; prev = prev.next; &#125; return true; &#125;]]></content>
      <categories>
        <category>å­¦ä¹ ç¬”è®°</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸€ç¯‡æ–‡ç« æ”»ç•¥ARPåè®®]]></title>
    <url>%2F2020%2F02%2F15%2Farp%2F</url>
    <content type="text"><![CDATA[ARPåè®®å…¨ç§°åœ°å€è§£æåè®®ï¼ˆ Address Resolution Protocolï¼‰ï¼Œå³é€šè¿‡IPåœ°å€è§£æMACåœ°å€çš„åè®®ã€‚ å½“ä¸»æœºä¹‹é—´éœ€è¦ç›¸äº’é€šä¿¡ï¼Œå¹¶ä¸”å·²ç»è·å–åˆ°å¯¹æ–¹ä¸»æœºçš„IPåœ°å€åï¼Œå¤„äºä¸‰å±‚çš„æ•°æ®åŒ…è¦å‘ä¸‹å°è£…ï¼Œä¸ºäº†èƒ½è®©æ•°æ®é€šè¿‡ç‰©ç†é“¾è·¯ä¼ è¾“åˆ°å¯¹æ–¹ï¼Œéœ€è¦çŸ¥é“å¯¹æ–¹çš„MACåœ°å€ã€‚ARPåè®®å°±æ˜¯é€šè¿‡ç›®çš„IPåœ°å€å»å¯»æ‰¾ç›®çš„MACåœ°å€çš„åè®®ã€‚ æŠ¥æ–‡æ ¼å¼é¦–å…ˆæŸ¥çœ‹ä¸€ä¸‹ARPåè®®çš„æŠ¥æ–‡æ ¼å¼ Source/Destination Hardware/Protocol Address: ä»ä¹‹å‰æ‰€è¿°å¯ä»¥å¾—çŸ¥ARPåè®®é€šè¿‡IPåœ°å€å»æŸ¥æ‰¾MACåœ°å€ï¼Œå› æ­¤æŠ¥æ–‡ä¸­å¿…å®šå«æœ‰æºç›®IPåœ°å€å’Œæºç›®MACåœ°å€ã€‚åŒæ—¶æ®æ­¤ä¹Ÿå¯ä»¥çœ‹å‡ºARPåè®®æ˜¯å·¥ä½œåœ¨ç½‘ç»œå±‚çš„ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–å­—æ®µ Hardware/Protocol Typeï¼šMACåœ°å€/IPåœ°å€ç±»å‹ï¼Œä¸€èˆ¬ç¡¬ä»¶åœ°å€ç±»å‹æ˜¯ä»¥å¤ªç½‘ï¼Œä¸‰å±‚åè®®ç±»å‹æ˜¯IP Hardware/Protocol Length:MACåœ°å€/IPåœ°å€é•¿åº¦ï¼Œå•ä½æ˜¯å­—èŠ‚ åŸºæœ¬å·¥ä½œæµç¨‹çœ‹å®Œäº†ARPæŠ¥æ–‡çš„åŸºæœ¬ç»“æ„ï¼Œæ¥ä¸‹æ¥å°±è®©æˆ‘ä»¬çœ‹çœ‹ARPåè®®æ˜¯å¦‚ä½•å…·ä½“å·¥ä½œçš„å§ åŠ¨æ€ARPARPåè®®æœ€å¸¸è§çš„åº”ç”¨å°±æ˜¯åŠ¨æ€ARP å¦‚å›¾ï¼Œå‡è®¾æ–°åŠ å…¥çš„ä¸€å°ä¸»æœºHost_1æƒ³è¦å‘Host_3å‘é€æ•°æ®ï¼Œæ­¤æ—¶Host_1å·²ç»æ‹¥æœ‰äº†Host_3çš„IPåœ°å€ 1.ARPè¯·æ±‚ ARPåè®®ä¼šç»´æŠ¤ARPè¡¨ï¼Œé‡Œé¢å­˜æ”¾ç€IPåœ°å€å’ŒMACåœ°å€çš„æ˜ å°„å…³ç³»ã€‚Host_1ä¼šæŸ¥æ‰¾è‡ªå·±çš„ARPè¡¨é¡¹ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œç›´æ¥å•æ’­å‘é€åˆ°ç›®çš„ä¸»æœºï¼›å¦‚æœæ²¡æœ‰ï¼Œå…¨ç½‘æ®µå¹¿æ’­IPåœ°å€ 2.ARPå“åº” æ”¶åˆ°ARPè¯·æ±‚çš„ä¸»æœºéƒ½ä¼šæŸ¥çœ‹è¯·æ±‚æŠ¥æ–‡çš„ç›®çš„IPåœ°å€æ˜¯ä¸æ˜¯è‡ªå·±çš„ï¼Œå¦‚æœä¸æ˜¯ï¼Œç›´æ¥ä¸¢å¼ƒï¼›å¦‚æœæ˜¯ï¼Œå› ä¸ºçŸ¥é“æŠ¥æ–‡å‘é€æ–¹çš„IPåœ°å€å’ŒMACåœ°å€ï¼Œæ‰€ä»¥å°†å‘é€å•æ’­ARPå“åº”åˆ°Host_1ï¼›åŒæ—¶å°†è¯¥ARPæŠ¥æ–‡ä¸­æºIPåœ°å€å’ŒæºMACåœ°å€ç¼“å­˜åœ¨è‡ªå·±çš„ARPè¡¨ä¸­ 3.ARPç¼“å­˜ æ”¶åˆ°å“åº”åä¸»æœºHost_1å°†æ£€æŸ¥è‡ªå·±çš„IPåœ°å€å’Œå“åº”çš„IPåœ°å€æ˜¯å¦åŒ¹é…ï¼Œå¦‚æœåŒ¹é…æˆåŠŸï¼Œå°†è¯¥æ˜ å°„å…³ç³»ç¼“å­˜åœ¨ARPè¡¨ä¸­ï¼Œå¹¶å°è£…æ•°æ®ä¼ è¾“åˆ°å¯¹ç«¯ä¸»æœº é™æ€ARPç›¸æ¯”è¾ƒåŠ¨æ€ARPè‡ªåŠ¨è·å–MACåœ°å€ï¼Œé™æ€ARPéœ€è¦ç½‘ç»œç®¡ç†å‘˜æ‰‹åŠ¨å°†IPåœ°å€å’ŒMACåœ°å€çš„æ˜ å°„å…³ç³»å†™å…¥åˆ°ARPè¡¨ä¸­ï¼Œé™æ€çš„ARPè¡¨é¡¹ä¸ä¼šè€åŒ– æœ‰ä¸¤ç§é™æ€è¡¨é¡¹ çŸ­é™æ€è¡¨é¡¹ï¼šåªç»‘å®šIPåœ°å€å’ŒMACåœ°å€ï¼Œä¸ç»‘å®šVLANå’Œæ¥å£ã€‚æ­¤æ—¶è¯¥è¡¨é¡¹ä¸èƒ½ç›´æ¥ç”¨äºæ•°æ®è½¬å‘ï¼Œéœ€è¦å‘èµ·ARPè¯·æ±‚å¹¶æ”¶åˆ°ARPå“åº”åï¼ŒåŒ¹é…å“åº”çš„æ˜ å°„å…³ç³»å’Œé™æ€è¡¨é¡¹ç›¸åŒåï¼Œå°†VLANå’Œæ¥å£å¡«å…¥ARPè¡¨é¡¹åï¼Œè¯¥è¡¨é¡¹æ‰èƒ½æ­£å¼ç”Ÿæ•ˆ é•¿é™æ€è¡¨é¡¹ï¼šä¸ä»…ç»‘å®šIPåœ°å€å’ŒMACåœ°å€ï¼ŒåŒæ—¶ç»‘å®šVLANå’Œæ¥å£ï¼Œæ­¤æ—¶è¯¥è¡¨é¡¹ç›´æ¥ç”Ÿæ•ˆ. é…ç½®é™æ€ARPçš„åœºæ™¯ é™æ€ARPè™½ç„¶é…ç½®ç¹çï¼Œä¸çµæ´»ï¼Œä½†æ˜¯ä¸ä¼šè€åŒ–ï¼Œä¹Ÿä¸ä¼šè¢«åŠ¨æ€ARPè¡¨é¡¹è¦†ç›–ï¼Œå› æ­¤åœ¨ç‰¹å®šåœºæ™¯ä¸‹æœ‰ç‰¹æ®Šçš„ç”¨é€”ï¼Œä¸‹é¢ä»‹ç»å‡ ç§å…¸å‹åº”ç”¨ åŠ¨æ€ARPå®¹æ˜“è¢«æ”»å‡»ï¼ŒåŒæ—¶ä¹Ÿå¯èƒ½ä¼šå‡ºç°è€åŒ–è€Œæ¶ˆå¤±çš„ç°è±¡ï¼Œå› æ­¤ä¸ºäº†ç¡®ä¿æŸå°é‡è¦è®¾å¤‡çš„ç¨³å®šæ€§å’Œå®‰å…¨æ€§ï¼Œå¯ä»¥é€‰æ‹©é…ç½®ç›¸å¯¹å®‰å…¨å¯é çš„é™æ€ARPã€‚ å½“ç½‘ç»œä¸­ç”¨æˆ·è®¾å¤‡çš„MACåœ°å€ä¸ºç»„æ’­MACåœ°å€æ—¶ï¼Œå¯ä»¥åœ¨è·¯ç”±å™¨ä¸Šé…ç½®é™æ€ARPè¡¨é¡¹ã€‚ç¼ºçœæƒ…å†µä¸‹ï¼Œè®¾å¤‡æ”¶åˆ°æºMACåœ°å€ä¸ºç»„æ’­MACåœ°å€çš„ARPæŠ¥æ–‡æ—¶ä¸ä¼šè¿›è¡ŒARPå­¦ä¹ ã€‚ å½“éœ€è¦ç¦æ­¢æŸä¸ªIPåœ°å€è®¿é—®è®¾å¤‡æ—¶ï¼Œå¯ä»¥å°†è¯¥IPåœ°å€å’Œä¸€ä¸ªä¸å­˜åœ¨çš„MACåœ°å€ç»‘å®šã€‚ è€åŒ–æœºåˆ¶å­˜åœ¨åœ¨ARPè¡¨ä¸­çš„åŠ¨æ€ARPè¡¨é¡¹å­˜åœ¨æœ‰æ•ˆæ—¶é—´ï¼Œè¿‡æœŸå°†åˆ é™¤è¯¥è¡¨é¡¹ï¼Œä»è€Œé‡Šæ”¾ARPè¡¨çš„å®¹é‡ï¼Œæé«˜è®¾å¤‡çš„æ€§èƒ½ åŠ¨æ€ARPè¡¨é¡¹çš„è€åŒ–å‚æ•°æœ‰ï¼šè€åŒ–è¶…æ—¶æ—¶é—´ã€è€åŒ–æ¢æµ‹æ¬¡æ•°å’Œè€åŒ–æ¢æµ‹æ¨¡å¼ è€åŒ–è¶…æ—¶æ—¶é—´ï¼šARPè¾¾åˆ°è¶…æ—¶æ—¶é—´åä¼šå‘é€è€åŒ–æ¢æµ‹æŠ¥æ–‡ï¼ˆå…¶å®å°±æ˜¯ARPè¯·æ±‚ï¼‰ï¼Œå¦‚æœæ”¶åˆ°å“åº”ï¼Œæ›´æ–°ARPè¡¨é¡¹ï¼Œå¦‚æœæ²¡æœ‰ï¼Œæ¢æµ‹ç»“æŸ è€åŒ–æ¢æµ‹æ¬¡æ•°ï¼šåˆ°è¾¾ä¸€å®šè€åŒ–æ¢æµ‹æ¬¡æ•°æœªæ”¶åˆ°å“åº”ï¼Œåˆ é™¤è¯¥è¡¨é¡¹ è€åŒ–æ¢æµ‹æ¨¡å¼ï¼šæ¢æµ‹æŠ¥æ–‡æ”¯æŒå¹¿æ’­å’Œå•æ’­ æ³¨ï¼šå½“æ¥å£downæ‰åï¼Œè¯¥æ¥å£ç›¸å…³çš„æ‰€æœ‰åŠ¨æ€ARPè¡¨é¡¹å°†å…¨éƒ¨åˆ é™¤ å…¶ä»–ç‰¹æ€§å…è´¹ARPå¯ç”¨äºä¸»æœºIPå†²çªæ£€æµ‹ï¼šå½“ä¸»æœºçš„IPåœ°å€å‘ç”Ÿå˜æ›´åæˆ–è€…é“¾è·¯åˆšåˆšUPåï¼Œä¸ºäº†é˜²æ­¢å’Œå·²å­˜åœ¨çš„IPåœ°å€å†²çªï¼ŒARPåè®®å°†ä¸»åŠ¨å¹¿æ’­åŒ…å«ä¸»æœºIPåœ°å€çš„ARPè¯·æ±‚ï¼Œå¦‚æœæ”¶åˆ°ARPå“åº”ï¼Œè¯´æ˜è¯¥IPåœ°å€å·²ç»è¢«ä½¿ç”¨ï¼Œåˆ™å­˜åœ¨å†²çªã€‚ é€šå‘Šæ–°çš„MACåœ°å€ï¼šç”±äºè®¾å¤‡æ–°æ¢äº†ç½‘å¡ç­‰æƒ…å†µå¯¼è‡´MACåœ°å€å‘ç”Ÿå˜æ›´ï¼Œæ­¤æ—¶å¯ä»¥å‘é€å…è´¹ARPæ¥è®©å…¶å®ƒä¸»æœºæ›´æ–°è¡¨é¡¹ ç”¨äºVRRPç»„ä¸»å¤‡æ¨¡å¼ä¹‹é—´åˆ‡æ¢ï¼š å‘ç”Ÿä¸»å¤‡å˜æ¢åï¼ŒMASTERè®¾å¤‡ä¼šå¹¿æ’­å‘é€ä¸€ä¸ªå…è´¹ARPæŠ¥æ–‡æ¥é€šå‘Šå‘ç”Ÿäº†ä¸»å¤‡å˜æ¢ ä»£ç†ARPå¦‚æœARPæŠ¥æ–‡éœ€è¦å‘å¾€åŒä¸€ç½‘æ®µä½†ä¸åŒç‰©ç†ç½‘ç»œçš„ä¸»æœºæ—¶ï¼Œå°±éœ€è¦é€šè¿‡ä»£ç†ARPæ¥å®ç°è¯·æ±‚çš„ä»£ç†ã€‚å¼€å¯ä»£ç†ARPçš„è®¾å¤‡å°†æ¥å—æœ¬ç½‘æ®µçš„ARPè¯·æ±‚ï¼ŒåŒæ—¶æŸ¥æ‰¾è·¯ç”±è¡¨ï¼Œå¦‚æœè·¯ç”±è¡¨ä¸­æœ‰ç›¸åº”çš„IPåœ°å€ï¼Œè¯´æ˜é€šè¿‡è¯¥è®¾å¤‡å¯ä»¥é€šå¾€ç›®çš„è®¾å¤‡ï¼Œåˆ™ä»£ç†ARPè®¾å¤‡ä¼šä»¥è‡ªå·±çš„MACåœ°å€å‘é€ARPå“åº”ï¼Œä¹‹åä¾¿é€šè¿‡è¯¥è®¾å¤‡è¿›è¡Œæ•°æ®è½¬å‘ã€‚ ä»£ç†ARPå…±æœ‰ä¸‰ç§æ¨¡å¼ è·¯ç”±å¼ä»£ç†ï¼š éœ€è¦äº’é€šçš„ä¸»æœºï¼ˆä¸»æœºä¸Šæ²¡æœ‰é…ç½®ç¼ºçœç½‘å…³ï¼Œæ— æ³•çŸ¥é“ï¼‰å¤„äºç›¸åŒçš„ç½‘æ®µä½†ä¸åœ¨åŒä¸€ç‰©ç†ç½‘ç»œï¼ˆå³ä¸åœ¨åŒä¸€å¹¿æ’­åŸŸï¼‰çš„åœºæ™¯ VLANå†…ä»£ç†ï¼š éœ€è¦äº’é€šçš„ä¸»æœºå¤„äºç›¸åŒç½‘æ®µï¼Œå¹¶ä¸”å±äºç›¸åŒVLANï¼Œä½†æ˜¯VLANå†…é…ç½®äº†ç«¯å£éš”ç¦»çš„åœºæ™¯ã€‚ VLANé—´ä»£ç†ï¼š éœ€è¦äº’é€šçš„ä¸»æœºå¤„äºç›¸åŒç½‘æ®µï¼Œä½†å±äºä¸åŒVLANçš„åœºæ™¯ ä»£ç†ARPåŠŸèƒ½å¼ºå¤§ï¼Œä¸€èˆ¬ç”¨äºç½‘å…³è·¯ç”±å™¨ï¼Œå¯ä»¥é˜²æ­¢ç”¨æˆ·é…ç½®é”™è¯¯ç½‘å…³åœ°å€ä¾ç„¶å¯ä»¥é€šä¿¡ï¼Œä½†æ˜¯ç”±äºä»£ç†ARPå¯¹é€šä¿¡æ— æ„ŸçŸ¥ï¼Œå› æ­¤å¯èƒ½è¢«é»‘å®¢åˆ©ç”¨å®æ–½ARPæ¬ºéª—ç­‰æ”»å‡»ï¼Œå¯¹ç½‘ç»œå®‰å…¨é€ æˆé£é™©ã€‚åŒæ—¶ï¼Œåœ¨é…ç½®é™æ€è·¯ç”±æ—¶å¦‚æœä½¿ç”¨é”™è¯¯ä½¿ç”¨ä»£ç†ARPä¹Ÿä¼šå¯¼è‡´å­¦ä¹ åˆ°é”™è¯¯çš„MACåœ°å€ã€‚ RARPå±äºARPçš„é€†å‘åè®®ï¼Œ å¯ä»¥å°†MACåœ°å€è§£æä¸ºIPåœ°å€çš„åè®®ã€‚ ä¸€èˆ¬ä¼šåœ¨æ— ç›˜å·¥ä½œç«™ã€å¸§ä¸­ç»§åè®®ä¸­å‡ºç°ï¼Œä½†æ˜¯ç°åœ¨ä½¿ç”¨è¾ƒå°‘ã€‚ that â€™s all~]]></content>
      <categories>
        <category>å­¦ä¹ ç¬”è®°</category>
      </categories>
      <tags>
        <tag>ICT</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Stringç±»æºç å­¦ä¹ ]]></title>
    <url>%2F2020%2F02%2F12%2FstringBuilder%2F</url>
    <content type="text"><![CDATA[æ°å¥½æœ€è¿‘é¡¹ç›®åšåˆ°äº†stringç±»ç›¸å…³çš„é—®é¢˜ï¼Œå°±å€Ÿç€ç½‘ä¸Šçš„åˆ†æï¼Œè¾ƒæ·±å…¥åœ°æ¯”è¾ƒäº†ä¸€ä¸‹stringBuilderç±»å’ŒStringç±»çš„æºç ï¼Œæœ¬æ¥è¿˜åº”è¯¥æœ‰ä¸€ä¸ªStringbufferç±»ï¼Œå› ä¸ºæ—¶é—´åŸå› æ‰€ä»¥åªèƒ½ä¸‹æ¬¡è¡¥ä¸Šäº†ã€‚ StringBuilderç±»å’Œstringç±»çš„åŒºåˆ«ç›¸åŒï¼šåº•å±‚å‡é‡‡ç”¨å­—ç¬¦æ•°ç»„valueæ¥ä¿å­˜å­—ç¬¦ä¸² åŒºåˆ«ï¼šStringç±»çš„valueæ•°ç»„æœ‰finalä¿®é¥°ï¼ŒæŒ‡å‘ä¸å¯æ”¹ï¼ŒåŒæ—¶privateæœªæä¾›ä¿®æ”¹valueæ•°ç»„çš„æ–¹æ³•ï¼Œ==å› æ­¤Stringç±»ä¸€æ—¦èµ‹å€¼å³ä¸å¯å˜==ã€‚StringBuilderç±»çš„valueæ•°ç»„æ²¡æœ‰finalä¿®é¥°ï¼Œå¯ä»¥æ”¹å˜æŒ‡å‘ï¼Œ==ä¸”å¯ä»¥æ‰©å®¹ï¼Œæ‰©å®¹é€šè¿‡æ–°å»ºå­—ç¬¦æ•°ç»„å®Œæˆ==ã€‚ Stringç±»æ„é€ å‡½æ•°1.é»˜è®¤çš„æ— å‚å’Œå«å‚æ„é€ å‡½æ•°12345678public String() &#123; this.value = "".value; &#125;public String(String original) &#123; this.value = original.value; this.hash = original.hash; &#125; éƒ½æ˜¯ç›´æ¥åœ¨ç°æœ‰å¸¸é‡ä¸Šè¿›è¡Œèµ‹å€¼ï¼ˆå°†å¸¸é‡çš„æŒ‡é’ˆæŒ‡å‘å‚æ•°ï¼‰ 2.å‚æ•°æ˜¯æ•°ç»„çš„æ„é€ å‡½æ•°123public String(char value[]) &#123; this.value = Arrays.copyOf(value, value.length); &#125; 123456789/**Arrayç±»**/public static char[] copyOf(char[] original, int newLength) &#123; char[] copy = new char[newLength]; System.arraycopy(original, 0, copy, 0, Math.min(original.length, newLength)); return copy; &#125; è°ƒç”¨Arraysçš„copyOfæ–¹æ³•ï¼Œè¿”å›å¤åˆ¶å®Œçš„æ–°æ•°ç»„ã€‚ å¸¸ç”¨å‡½æ•°length()è¿”å›çš„æ˜¯å­—ç¬¦æ•°ç»„valueçš„é•¿åº¦ 123public int length() &#123; return value.length;&#125; isEmpty()åˆ¤æ–­å­—ç¬¦æ•°ç»„é•¿åº¦æ˜¯å¦ä¸º0 123public boolean isEmpty() &#123; return value.length == 0; &#125; charAt()è¿”å›valueå¯¹è±¡çš„ç´¢å¼• 123456public char charAt(int index) &#123; if ((index &lt; 0) || (index &gt;= value.length)) &#123; throw new StringIndexOutOfBoundsException(index); &#125; return value[index];&#125; equals()é‡å†™equals()æ–¹æ³•,åˆ¤æ–­ä¸ºçœŸçš„æƒ…å†µæ˜¯ï¼šä¸¤ä¸ªå¯¹è±¡ç›¸åŒï¼ŒåŒæ—¶å¯¹åº”çš„valueå­—ç¬¦æ•°ç»„å†…å®¹ä¹Ÿç›¸åŒ å…¶ä¸­ï¼šå¯èƒ½æ˜¯åŒä¸€å¯¹è±¡ä¹Ÿå¯èƒ½æ˜¯å†…å®¹ç›¸åŒçš„ä¸åŒString 1234567891011121314151617181920212223public boolean equals(Object anObject) &#123; //åˆ¤æ–­æ˜¯ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ if (this == anObject) &#123; return true; &#125; //åˆ¤æ–­æ˜¯ä¸æ˜¯Stringå¯¹è±¡ï¼Œå¼ºè½¬Stringç±»å‹ if (anObject instanceof String) &#123; String anotherString = (String)anObject; int n = value.length; if (n == anotherString.value.length) &#123; char v1[] = value; char v2[] = anotherString.value; int i = 0; while (n-- != 0) &#123; if (v1[i] != v2[i]) return false; i++; &#125; return true; &#125; &#125; return false; &#125; compareTo()è¿”å›ï¼šå¦‚æœç¬¬ä¸€ä¸ªä¸ç›¸åŒå­—ç¬¦ä¹‹å·®ï¼Œå¦‚æœä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ä¸€ä¸ªçš„å­ä¸²ï¼ˆå‰limä¸ªå­—ç¬¦ç›¸åŒï¼‰ï¼Œè¿”å›ä¸¤ä¸ªå­—ç¬¦ä¸²é•¿åº¦ä¹‹å·® 123456789101112131415161718public int compareTo(String anotherString) &#123; int len1 = value.length; int len2 = anotherString.value.length; int lim = Math.min(len1, len2); char v1[] = value; char v2[] = anotherString.value; int k = 0; while (k &lt; lim) &#123; char c1 = v1[k]; char c2 = v2[k]; if (c1 != c2) &#123; return c1 - c2; &#125; k++; &#125; return len1 - len2;&#125; substring()1.substring(int) è¯¥å‡½æ•°è¿”å›ä»ç»™å®šå‚æ•°ä½ç½®èµ·åˆ°å­—ç¬¦ä¸²ç»“æŸçš„æ–°å­—ç¬¦ä¸²ã€‚å¦‚æœç»™å®šä»0å¼€å§‹ï¼Œåˆ™è¿”å›åŸæœ¬çš„Stringå¯¹è±¡ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªæ–°çš„Stringå¯¹è±¡ã€‚ 12345678910public String substring(int beginIndex) &#123; if (beginIndex &lt; 0) &#123; throw new StringIndexOutOfBoundsException(beginIndex); &#125; int subLen = value.length - beginIndex; if (subLen &lt; 0) &#123; throw new StringIndexOutOfBoundsException(subLen); &#125; return (beginIndex == 0) ? this : new String(value, beginIndex, subLen); &#125; 2.substring(int, int) å¦‚æœè¦è·å–çš„å­ä¸²æ˜¯ä»0åˆ°æœ€åï¼Œåˆ™è¿”å›åŸæœ¬çš„Stringå¯¹è±¡ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªæ–°çš„Stringå¯¹è±¡ã€‚ 1234567891011121314public String substring(int beginIndex, int endIndex) &#123; if (beginIndex &lt; 0) &#123; throw new StringIndexOutOfBoundsException(beginIndex); &#125; if (endIndex &gt; value.length) &#123; throw new StringIndexOutOfBoundsException(endIndex); &#125; int subLen = endIndex - beginIndex; if (subLen &lt; 0) &#123; throw new StringIndexOutOfBoundsException(subLen); &#125; return ((beginIndex == 0) &amp;&amp; (endIndex == value.length)) ? this : new String(value, beginIndex, subLen); &#125; replace()è¿”å›ï¼šå¦‚æœæ˜¯ç›¸åŒåˆ™è¿”å›åŸæ¥çš„Stringå¯¹è±¡ï¼Œä¸åŒåˆ™å…ˆæ‰¾åˆ°ç¬¬ä¸€ä¸ªä¸åŒçš„å­—ç¬¦ç„¶åå°†å­—ç¬¦å¤åˆ¶åˆ°æ–°çš„å­—ç¬¦æ•°ç»„ä¸­ 123456789101112131415161718192021222324252627public String replace(char oldChar, char newChar) &#123; if (oldChar != newChar) &#123; int len = value.length; int i = -1; char[] val = value; /* avoid getfield opcode */ //æ‰¾åˆ°ç¬¬ä¸€ä¸ªä¸åŒçš„ç´¢å¼•ä¸‹æ ‡ while (++i &lt; len) &#123; if (val[i] == oldChar) &#123; break; &#125; &#125; if (i &lt; len) &#123; char buf[] = new char[len]; for (int j = 0; j &lt; i; j++) &#123; buf[j] = val[j]; &#125; while (i &lt; len) &#123; char c = val[i]; buf[i] = (c == oldChar) ? newChar : c; i++; &#125; return new String(buf, true); &#125; &#125; return this; &#125; å¯è§ï¼ŒStringæ˜¯ä¾èµ–å­—ç¬¦å¸¸é‡è¡¨å®ç°çš„ï¼› åŒæ—¶æ‰€æœ‰å¯¹Stringå‘ç”Ÿä¿®æ”¹çš„æ–¹æ³•è¿”å›å€¼éƒ½æ˜¯ä¸€ä¸ªæ–°çš„Stringå¯¹è±¡ï¼Œæ²¡æœ‰ä¿®æ”¹åŸæœ‰å¯¹è±¡ï¼› å› æ­¤æ˜¯çº¿ç¨‹å®‰å…¨çš„ StringBuilderç±»æºç æ„é€ å‡½æ•°1 .é»˜è®¤æ„é€ å‡½æ•° Stringbuilderä½¿ç”¨äº†çˆ¶ç±»AbstractStringBuilderæ„é€ ï¼Œé»˜è®¤é•¿åº¦16.æ³¨æ„è¿™é‡Œçš„valueæ²¡æœ‰finalä¿®é¥°ï¼Œæƒé™ä¸ºé»˜è®¤ï¼Œå› æ­¤å†…éƒ¨æ•°å€¼å¯ä»¥æ”¹å˜Â· 123public StringBuilder() &#123; super(16);&#125; 1234/*çˆ¶ç±»*/ AbstractStringBuilder(int capacity) &#123; value = new char[capacity]; &#125; 2.ä¼ å…¥å­—ç¬¦ä¸²Â· ä¼šè®¾ç½®åˆå§‹å®¹é‡ä¸ºä¼ å…¥å­—ç¬¦ä¸²é•¿åº¦åŠ ä¸Š16ï¼Œå†é€šè¿‡appendå‡½æ•°å°†strå†™å…¥ï¼Œappendå‡½æ•°è§å¸¸ç”¨æ–¹æ³• 1234public StringBuilder(String str) &#123; super(str.length() + 16); append(str); &#125; å¸¸ç”¨å‡½æ•°append()appendå‡½æ•°è°ƒç”¨æ—¶ä¼šé¦–å…ˆæŸ¥çœ‹æ˜¯å¦è¶…å‡ºå®¹é‡ä¸Šé™ 1234567891011@Override public StringBuilder append(Object obj) &#123; return append(String.valueOf(obj)); &#125; @Override public StringBuilder append(String str) &#123; //è°ƒç”¨çˆ¶ç±» super.append(str); return this; &#125; 123456789public AbstractStringBuilder append(String str) &#123; if (str == null) return appendNull(); int len = str.length(); ensureCapacityInternal(count + len); str.getChars(0, len, value, count); count += len; return this; &#125; å®¹é‡æ£€æŸ¥å‡½æ•° å‚æ•°æ˜¯å½“å‰å¯¹è±¡çš„valueä¸­å­—ç¬¦é•¿åº¦ä¸ä¼ å…¥å­—ç¬¦ä¸²é•¿åº¦ä¹‹å’Œï¼Œä¹Ÿå³æ˜¯valueçš„å®¹é‡æœ€å°å€¼ã€‚ å¦‚æœéœ€è¦çš„å®¹é‡æœ€å°å€¼å¤§äºç›®å‰valueå®¹é‡ï¼Œæ–°ç”³è¯·ä¸€å—å†…å­˜å¤åˆ¶è¿›å» æ‰©å®¹çš„æ–°å®¹é‡ä¸ºå½“å‰valueçš„å®¹é‡2å€åŠ 2ï¼Œå¦‚æœæ‰©å®¹åçš„å®¹é‡è¿˜æ˜¯æ¯”éœ€è¦çš„æœ€å°å®¹é‡å°ï¼Œåˆ™ç›´æ¥æ‰©å®¹ä¸ºéœ€è¦çš„æœ€å°å®¹é‡ï¼Œå†å°†å½“å‰valueå†…å®¹å¤åˆ¶ç»™ä¸€ä¸ªæ–°çš„é•¿åº¦ä¸ºnewCapacityçš„å­—ç¬¦æ•°ç»„ï¼Œå†å°†valueæŒ‡å‘è¿™ä¸ªæ‰©å®¹åçš„æ–°æ•°ç»„ã€‚å³æ‰©å®¹æ˜¯é€šè¿‡å¼€è¾Ÿæ–°æ•°ç»„å®Œæˆçš„ï¼Œè¿”å›çš„ä¹Ÿæ˜¯æ–°åˆ›å»ºçš„æ–°æ•°ç»„ã€‚ 1234567891011121314151617181920private void ensureCapacityInternal(int minimumCapacity) &#123; // overflow-conscious code if (minimumCapacity - value.length &gt; 0) &#123; value = Arrays.copyOf(value, newCapacity(minimumCapacity)); &#125; &#125;//-----------------ä¸­é—´çœå»å¾ˆå¤šå‡½æ•°...---------private int newCapacity(int minCapacity) &#123; // overflow-conscious code int newCapacity = (value.length &lt;&lt; 1) + 2; if (newCapacity - minCapacity &lt; 0) &#123; newCapacity = minCapacity; &#125; return (newCapacity &lt;= 0 || MAX_ARRAY_SIZE - newCapacity &lt; 0) ? hugeCapacity(minCapacity) : newCapacity; &#125; æ‰§è¡Œå®ŒensureCapacityInternalå‡½æ•°åï¼Œthiså¯¹è±¡çš„valueæ•°ç»„å·²ç»æŒ‡å‘ä¸€ä¸ªæ‰©å®¹åçš„æ–°æ•°ç»„ï¼Œå¹¶ä¸”ä¹‹å‰çš„valueæ•°ç»„é‡Œçš„å€¼ä¹Ÿå¤åˆ¶åˆ°æ–°çš„valueæ•°ç»„ä¸­ï¼Œæ¥ä¸‹æ¥æ‰§è¡ŒgetCharså‡½æ•° å¤åˆ¶å­—ç¬¦å‡½æ•° è¯¥å‡½æ•°æ˜¯å°†è°ƒç”¨çš„stringå¯¹è±¡çš„valueæ•°ç»„ä»srcBeginåˆ°srcEndå¤åˆ¶ç»™ç›®æ ‡æ•°ç»„dstï¼Œä»dstæ•°ç»„çš„ç¬¬dstBeginä½ç½®å¼€å§‹ã€‚ appendå‡½æ•°ä¸­æ‰§è¡Œå®Œstr.getCharså‡½æ•°åå°±å°†å‚æ•°strçš„å†…å®¹è¿½åŠ åˆ°StringBuilderå¯¹è±¡çš„valueæ•°ç»„åé¢ï¼Œå†æ›´æ–°countå€¼ï¼Œè¿”å›è°ƒç”¨å¯¹è±¡ã€‚ 123456789101112public void getChars(int srcBegin, int srcEnd, char dst[], int dstBegin) &#123; if (srcBegin &lt; 0) &#123; throw new StringIndexOutOfBoundsException(srcBegin); &#125; if (srcEnd &gt; value.length) &#123; throw new StringIndexOutOfBoundsException(srcEnd); &#125; if (srcBegin &gt; srcEnd) &#123; throw new StringIndexOutOfBoundsException(srcEnd - srcBegin); &#125; System.arraycopy(value, srcBegin, dst, dstBegin, srcEnd - srcBegin);&#125; åˆ é™¤å‡½æ•°1234567891011@Override public StringBuilder delete(int start, int end) &#123; super.delete(start, end); return this; &#125; @Override public StringBuilder deleteCharAt(int index) &#123; super.deleteCharAt(index); return this; &#125; delete()å‡½æ•°é€šè¿‡è¦†ç›–åŸç†ï¼Œå°†åˆ é™¤çš„å…ƒç´ è¦†ç›–æ‰Â· deleteCharAt()åˆ é™¤ç´¢å¼•ä¸ºindexå¤„çš„å­—ç¬¦ã€‚é€šè¿‡è°ƒç”¨æ•°ç»„å¤åˆ¶å‡½æ•°æ¥å®Œæˆï¼Œå°†ç´¢å¼•åé¢çš„å†…å®¹ä¾æ¬¡å¤åˆ¶åˆ°ä»ç´¢å¼•å¼€å§‹çš„ä½ç½®ä¸Šï¼Œå³é€šè¿‡è¦†ç›–çš„åŸç†å®Œæˆï¼Œæ›´æ–°countã€‚ 1234567891011121314151617181920212223242526/*çˆ¶ç±»è°ƒç”¨å‡½æ•°*/ public AbstractStringBuilder delete(int start, int end) &#123; if (start &lt; 0) throw new StringIndexOutOfBoundsException(start); if (end &gt; count) end = count; if (start &gt; end) throw new StringIndexOutOfBoundsException(); int len = end - start; if (len &gt; 0) &#123; System.arraycopy(value, start+len, value, start, count-end); count -= len; &#125; return this; &#125;public AbstractStringBuilder deleteCharAt(int index) &#123; if ((index &lt; 0) || (index &gt;= count)) throw new StringIndexOutOfBoundsException(index); System.arraycopy(value, index+1, value, index, count-index-1); count--; return this; &#125; æ’å…¥å‡½æ•°123456789101112131415 @Override public StringBuilder insert(int index, char[] str, int offset, int len) &#123; super.insert(index, str, offset, len); return this; &#125;/*ç®€å•æ‹¿è¿™ä¸ªä¸¾ä¾‹å­ï¼Œåé¢charç±»å‹å¯ä»¥æ¢æˆå…¶ä»–ç±»å‹*/ @Override public StringBuilder insert(int offset, char c) &#123; super.insert(offset, c); return this; &#125; é¦–å…ˆç¡®ä¿valueæ•°ç»„å®¹é‡è¶³å¤Ÿï¼Œç„¶åé€šè¿‡æ•°ç»„å¤åˆ¶ï¼Œå°†ç´¢å¼•ä½ç½®å¼€å§‹å…¨éƒ¨å‘åç§»ä¸€ä½ï¼Œå†å°†ç´¢å¼•ä½ç½®èµ‹å€¼cï¼Œæ›´æ–°countã€‚ 12345678910/*çˆ¶ç±»è°ƒç”¨å‡½æ•°*/public AbstractStringBuilder insert(int offset, char c) &#123; ensureCapacityInternal(count + 1); System.arraycopy(value, offset, value, offset + 1, count - offset); value[offset] = c; count += 1; return this; &#125; å¯¹æ¯”StringBufferä»¥åæœ‰æœºä¼šåœ¨å†™å§ã€‚ã€‚ã€‚ å¯¹æ¯”æ¥æº å·®åˆ« String StringBuffer StringBuilder å¸¸é‡ / å˜é‡ å¸¸é‡ å˜é‡ å˜é‡ çº¿ç¨‹æ˜¯å¦å®‰å…¨ å®‰å…¨ å®‰å…¨ éå®‰å…¨ æ‰€åœ¨å†…å­˜åŒºåŸŸ Constant String Pool(å¸¸é‡æ± ) heap heap æ˜¯å¦èƒ½è¢«ç»§æ‰¿ å¦ å¦ å¦ ä»£ç è¡Œæ•° 3157 718 448 ä½¿ç”¨åœºæ™¯ åœ¨å­—ç¬¦ä¸²ä¸ç»å¸¸å˜åŒ–çš„åœºæ™¯ åœ¨é¢‘ç¹è¿›è¡Œå­—ç¬¦ä¸²è¿ç®—ï¼ˆå¦‚æ‹¼æ¥ã€æ›¿æ¢ã€åˆ é™¤ç­‰ï¼‰ï¼Œ å¹¶ä¸”è¿è¡Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒ åœ¨é¢‘ç¹è¿›è¡Œå­—ç¬¦ä¸²è¿ç®—ï¼ˆå¦‚æ‹¼æ¥ã€æ›¿æ¢ã€å’Œåˆ é™¤ç­‰ï¼‰ï¼Œ å¹¶ä¸”è¿è¡Œåœ¨å•çº¿ç¨‹çš„ç¯å¢ƒ åœºæ™¯ä¸¾ä¾‹ å¸¸é‡çš„å£°æ˜ã€å°‘é‡çš„å˜é‡è¿ç®— XML è§£æã€HTTP å‚æ•°è§£æå’Œå°è£… SQL è¯­å¥çš„æ‹¼è£…ã€JSON å°è£… AbstractStringBuilderï¼šStringBufferç±»ä¸StringBuilderç±»éƒ½ç»§æ‰¿äº†AbstractStringBuilderï¼ŒæŠ½è±¡çˆ¶ç±»é‡Œå®ç°äº†é™¤toStringä»¥å¤–çš„æ‰€æœ‰æ–¹æ³•ã€‚StringBuilderï¼šè‡ªå·±é‡å†™äº†æ–¹æ³•ä¹‹åï¼Œå…¨éƒ½åœ¨æ–¹æ³•å†…super.function()ï¼Œæœªåšä»»ä½•æ‰©å±•ã€‚åŒæ—¶ä»ç±»åè¯­ä¹‰ä¸Šæ¥è¯´Stringæ„å»ºè€…ï¼Œæ‰€ä»¥æ²¡æœ‰subStringæ–¹æ³•çœ‹æ¥ä¹Ÿåˆæƒ…åˆç†ï¼›StringBufferï¼šåœ¨é‡å†™æ–¹æ³•çš„åŒæ—¶ï¼Œå‡ ä¹æ‰€æœ‰æ–¹æ³•éƒ½æ·»åŠ äº†synchronizedåŒæ­¥å…³é”®å­—ï¼›]]></content>
      <categories>
        <category>å­¦ä¹ ç¬”è®°</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mybatisåŸºç¡€ç‰¹æ€§å’ŒsqlsessionåŸç†]]></title>
    <url>%2F2020%2F01%2F20%2Fmybatis%2F</url>
    <content type="text"><![CDATA[ä¸»è¦æ€»ç»“ä¸€ä¸‹mybaitisçš„åŸºç¡€é…ç½®ï¼ŒåŸºæœ¬ç‰¹æ€§ï¼Œæœ€åç®€å•åˆ†æä¸€ä¸‹sqlsessionçš„åŸç†ï¼Œäº†è§£äº†è¿è¡Œè¿‡ç¨‹ã€‚ var ap = new APlayer({ element: document.getElementById("aplayer-NgQswVho"), narrow: false, autoplay: false, showlrc: false, music: { title: "æ¼‚æµ", author: "è…åŸçº±ç”±ç†ï¼ˆTHE SxPLAYï¼‰", url: "http://music.163.com/song/media/outer/url?id=1397665609.mp3", pic: "http://p2.music.126.net/DpcMK6vdj7vD-yY3QUHwng==/109951164433935873.jpg?param=130y130", lrc: "" } }); window.aplayers || (window.aplayers = []); window.aplayers.push(ap); ç®€å•é…ç½®ä»‹ç»ç®€å•æ¥è¯´ï¼ŒMybatisçš„é…ç½®ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š ç¼–å†™POJOå³JavaBeanï¼Œæœ€ç»ˆçš„ç›®çš„æ˜¯å°†æ•°æ®åº“ä¸­çš„æŸ¥è¯¢ç»“æœæ˜ å°„åˆ°JavaBeanä¸Šï¼› é…ç½®ä¸POJOå¯¹åº”çš„Mapperæ¥å£ï¼šé‡Œé¢æœ‰å„ç§æ–¹æ³•ï¼Œå¯¹åº”mapper.xmlä¸­çš„æŸ¥è¯¢è¯­å¥ï¼› é…ç½®ä¸POJOå¯¹åº”çš„XMLæ˜ å°„ï¼šç¼–å†™ç¼“å­˜ï¼ŒSQLæŸ¥è¯¢ç­‰ï¼› é…ç½®mybatis-config.xmlä¸»è¦çš„Mybatisé…ç½®æ–‡ä»¶ï¼šé…ç½®æ•°æ®æºã€æ‰«æmapper.xmlç­‰ã€‚ æ³¨æ„ï¼šä»¥ä¸Šçš„é…ç½®å¹¶æ²¡æœ‰ä¸¥æ ¼çš„å‰åé¡ºåºï¼› å€Ÿç”¨ä¸€ä¸ªæ¯”è¾ƒæ¸…æ™°çš„é…ç½®æµç¨‹å›¾ å¯ä»¥çœ‹å‡ºmapperæ¥å£å®ç°ç±»çš„è·å¾—æ˜¯é€šè¿‡mybatis-config.xml-&gt;SqlSessionFactoryBuilder-&gt;SqlSessionFacotry-&gt;SqlSession-&gt;mapper ç”Ÿå‘½å‘¨æœŸ SqlSessionFactoryBuilderï¼šä½œç”¨å°±æ˜¯åˆ›å»ºä¸€ä¸ªæ„å»ºå™¨ï¼Œä¸€æ—¦åˆ›å»ºäº†SqlSessionFactoryï¼Œå®ƒçš„ä»»åŠ¡å°±ç®—å®Œæˆäº†ï¼Œå¯ä»¥å›æ”¶ã€‚ SqlSessionFactoryï¼šä½œç”¨æ˜¯åˆ›å»ºSqlSessionï¼Œè€ŒSqlSessionç›¸å½“äºJDBCçš„ä¸€ä¸ªConnectionå¯¹è±¡ï¼Œæ¯æ¬¡åº”ç”¨ç¨‹åºéœ€è¦è®¿é—®æ•°æ®åº“ï¼Œæˆ‘ä»¬å°±è¦é€šè¿‡SqlSessionFactoryåˆ›å»ºä¸€ä¸ªSqlSessionï¼Œæ‰€ä»¥SqlSessionFactoryåœ¨Mybatisæ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­å­˜åœ¨ï¼ˆæ¯ä¸ªæ•°æ®åº“å¯¹åº”ä¸€ä¸ªSqlSessionFactoryï¼Œæ˜¯å•ä¾‹äº§ç”Ÿçš„ï¼‰ã€‚ SqlSessionï¼šç”Ÿå‘½å‘¨æœŸæ˜¯å­˜åœ¨äºè¯·æ±‚æ•°æ®åº“å¤„ç†äº‹åŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œæ˜¯ä¸€ä¸ªçº¿ç¨‹ä¸å®‰å…¨çš„å¯¹è±¡ï¼ˆåœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„ï¼‰ï¼Œå³å­˜æ´»äºä¸€ä¸ªåº”ç”¨çš„è¯·æ±‚å’Œç”³è¯·ï¼Œå¯ä»¥æ‰§è¡Œå¤šæ¡SQLä¿è¯äº‹åŠ¡çš„ä¸€è‡´æ€§ã€‚ Mapperï¼šæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¹¶æ²¡æœ‰å®ç°ç±»ã€‚å®ƒçš„ä½œç”¨æ˜¯å‘é€SQLï¼Œè¿”å›æˆ‘ä»¬éœ€è¦çš„ç»“æœæˆ–è€…å‘é€SQLä¿®æ”¹æ•°æ®åº“è¡¨ï¼Œæ‰€ä»¥å®ƒå­˜æ´»äºä¸€ä¸ªSqlSessionå†…ï¼Œæ˜¯ä¸€ä¸ªæ–¹æ³•çº§åˆ«çš„ä¸œè¥¿ã€‚å½“SqlSessioné”€æ¯çš„æ—¶å€™ï¼ŒMapperä¹Ÿä¼šé”€æ¯ã€‚ åŸºç¡€ç‰¹æ€§å»¶è¿ŸåŠ è½½å³ç³»ç»Ÿå»¶è¿Ÿæ‰§è¡ŒæŸ¥è¯¢ï¼Œä¸€èˆ¬ç”¨äºåµŒå¥—æŸ¥è¯¢çš„æ—¶å€™ï¼ŒåµŒå¥—åœ¨å†…çš„SQLæŸ¥è¯¢ä¼šå»¶è¿ŸåŠ è½½ï¼Œç­‰åˆ°çœŸæ­£éœ€è¦ä½¿ç”¨è¯¥æŸ¥è¯¢çš„æ—¶å€™æ‰åŠ è½½ã€‚å°±åƒæ‡’äººä½ è¯´ä¸€ä¸‹ï¼Œä»–åŠ¨ä¸€ä¸‹ï¼Œç»ä¸ä¼šå¤šæ‰§è¡ŒåŠæ­¥ï¼Œå› æ­¤è¯¥ç‰¹æ€§ä¹Ÿç§°ä¹‹ä¸ºæ‡’åŠ è½½ã€‚ æ‡’åŠ è½½å¿…é¡»é…ç½®config.xmlï¼Œå¹¶ä¸”åªèƒ½é€šè¿‡associationæˆ–collectionå®ç°ï¼Œæ¯•ç«Ÿåªæœ‰åœ¨å­˜åœ¨æ˜ å°„å…³ç³»çš„ä¸šåŠ¡åœºæ™¯é‡Œä½ éœ€è¦ä½¿ç”¨æ‡’åŠ è½½ é…ç½®è¯­å¥ 123&lt;settings&gt; &lt;setting name="lazyLoadingEnabled" value="true"/&gt; &lt;setting name="aggressiveLazyLoading" value="false"/&gt; &lt;/settings&gt; ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„å»¶è¿ŸåŠ è½½å¿…é¡»ä½¿ç”¨resultMapï¼ŒresultTypeä¸å…·æœ‰å»¶è¿ŸåŠ è½½åŠŸèƒ½ã€‚ ä¸€çº§ç¼“å­˜ ç³»ç»Ÿé»˜è®¤å¼€å¯,ç¼“å­˜çš„èŒƒå›´ä¸ºä¸€ä¸ªSqlSession åªæœ‰ä¸€ä¸ªSqlSessionä¸‹çš„ç›¸åŒæŸ¥è¯¢æ‰ä¼šåº”ç”¨ç¼“å­˜ï¼Œä¸åŒsqlSessionä¸‹çš„å³ä½¿æŸ¥è¯¢ç›¸åŒä¸€çº§ç¼“å­˜ä¹Ÿä¸ä¼šç”Ÿæ•ˆ äºŒçº§ç¼“å­˜ è§£å†³SqlSessionç›¸äº’éš”ç¦»çš„æƒ…å†µï¼Œç¼“å­˜èŒƒå›´ä¸ºä¸€ä¸ªMapperæ¥å£ äºŒçº§ç¼“å­˜é»˜è®¤æ˜¯ä¸å¼€å¯çš„ï¼Œéœ€è¦è¿›è¡Œé…ç½®ï¼ŒMybatisè¦æ±‚è¿”å›çš„POJOå¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œå³POJOå®ç°Serializableæ¥å£ã€‚ ç¼“å­˜çš„é…ç½®åªéœ€è¦åœ¨XMLé…ç½®&lt;cache/&gt;å³å¯ï¼Œæˆ–è€…æŒ‡å®šç®—æ³•ï¼Œåˆ·æ–°æ—¶é—´é—´éš”ï¼Œç¼“å­˜çŠ¶æ€ï¼Œå¤§å°ç­‰ ä¾‹ï¼š æ˜ å°„è¯­å¥æ–‡ä»¶ä¸­æ‰€æœ‰selectè¯­å¥å°†ä¼šè¢«ç¼“å­˜ï¼› æ˜ å°„è¯­å¥æ–‡ä»¶ä¸­æ‰€æœ‰insertã€updateå’Œdeleteè¯­å¥ä¼šè¢«åˆ·æ–°ç¼“å­˜ï¼› ç¼“å­˜ä½¿ç”¨é»˜è®¤çš„LRUæœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•å›æ”¶ï¼› æ ¹æ®æ—¶é—´è¡¨ï¼Œç¼“å­˜ä¸ä¼šä»»ä½•æ—¶é—´é¡ºåºåˆ·æ–° ç¼“å­˜ä¼šå­˜å‚¨åˆ—è¡¨é›†åˆæˆ–å¯¹è±¡çš„1024ä¸ªå¼•ç”¨ ç¼“å­˜è¢«è§†ä¸ºå¯read/writeçš„ç¼“å­˜ï¼Œæ„å‘³ç€æ˜¯ä¸å¯ä»¥è¢«å…±äº«çš„ï¼Œè€Œå¯ä»¥è¢«å®‰å…¨åœ°ä¿®æ”¹ã€‚ è‡ªå®šä¹‰ç¼“å­˜é€šè¿‡Mybatiså®ç°çš„æ¥å£ï¼Œä½¿ç”¨redisç­‰è¿›è¡Œç¼“å­˜ å®è·µé…ç½®å¾…è¡¥å…… SqlSessionåŸç†SqlSessionæä¾›select/insert/update/deleteæ–¹æ³• æ˜ å°„å™¨ï¼ˆMapperï¼‰å…¶å®å°±æ˜¯ä¸€ä¸ªåŠ¨æ€ä»£ç†å¯¹è±¡ï¼Œè¿›å…¥åˆ°MapperMethodçš„executeæ–¹æ³•å°±èƒ½ç®€å•æ‰¾åˆ°SqlSessionçš„åˆ é™¤ã€æ›´æ–°ã€æŸ¥è¯¢ã€é€‰æ‹©æ–¹æ³•. ä»åº•å±‚å®ç°æ¥è¯´ï¼šé€šè¿‡åŠ¨æ€ä»£ç†æŠ€æœ¯ï¼Œè®©æ¥å£è·‘èµ·æ¥ï¼Œä¹‹åé‡‡ç”¨å‘½ä»¤æ¨¡å¼ï¼Œæœ€åè¿˜æ˜¯é‡‡ç”¨äº†SqlSessionçš„æ¥å£æ–¹æ³•ï¼ˆgetMapper()æ–¹æ³•ç­‰åˆ°Mapperï¼‰æ‰§è¡ŒSQLæŸ¥è¯¢ï¼ˆä¹Ÿå°±æ˜¯è¯´Mapperæ¥å£æ–¹æ³•çš„å®ç°åº•å±‚è¿˜æ˜¯é‡‡ç”¨SqlSessionæ¥å£æ–¹æ³•å®ç°çš„ï¼‰ã€‚ SqlSessioné‡è¦çš„å››ä¸ªå¯¹è±¡ Executeï¼šè°ƒåº¦æ‰§è¡ŒStatementHandlerã€ParmmeterHandlerã€ResultHandleræ‰§è¡Œç›¸åº”çš„SQLè¯­å¥ï¼› StatementHandlerï¼šä½¿ç”¨æ•°æ®åº“ä¸­Statementï¼ˆPrepareStatementï¼‰æ‰§è¡Œæ“ä½œï¼Œå³åº•å±‚æ˜¯å°è£…å¥½äº†çš„prepareStatement ParammeterHandlerï¼šå¤„ç†SQLå‚æ•° ResultHandlerï¼šç»“æœé›†ResultSetå°è£…å¤„ç†è¿”å›ã€‚ SqlSessionçš„å››å¤§å¯¹è±¡Executeèµ·javaå’Œæ•°æ®åº“äº¤äº’æ¡¥æ¢çš„ä½œç”¨ï¼Œå‚ä¸æ•´ä¸ªSQLæ‰§è¡Œè¿‡ç¨‹ã€‚åˆ†ç±» SIMPLEç®€æ˜“æ‰§è¡Œå™¨ï¼ˆé»˜è®¤ï¼‰ REUSEé‡ç”¨é¢„å¤„ç†æ‰§è¡Œå™¨ BATCHæ‰¹é‡æ›´æ–°ã€æ‰¹é‡ä¸“ç”¨å¤„ç†å™¨ æºç  12package org.apache.ibatis.session;public enum ExecutorType &#123; SIMPLE, REUSE, BATCH&#125; ä½œç”¨ è°ƒåº¦å…¶ä»–å¯¹è±¡ï¼Œå®Œæˆé¢„ç¼–è¯‘ã€é…ç½®å‚æ•°å’Œè¿”å›ç»“æœé›† StatementHanldeåˆ†ç±»(åˆ†åˆ«å¯¹åº”ä¸åŒæ‰§è¡Œå™¨) SimpleStatementHandler PrepareStatementHandler CallableStatementHandler ä½œç”¨ ä¸“é—¨å¤„ç†æ•°æ®åº“ä¼šè¯ã€‚è¿›è¡Œé¢„ç¼–è¯‘å¹¶è°ƒç”¨ParameterHandleré…ç½®å‚æ•°ã€‚å¤§è‡´æ¥è®²åªæ˜¯å¯¹æ•°æ®åº“çš„è¿æ¥åšäº†å°è£… å·¥ä½œæµç¨‹ é€šè¿‡è°ƒç”¨RoutingStatementHandlerå¯¹è±¡ç”ŸæˆStatemenetHandler RoutingStatementHandleræŸ¥æ‰¾ç›¸åº”çš„statementHandlerå¯¹è±¡ statementHandlerè°ƒç”¨æ•°æ®åº“çš„æ–¹æ³• ParameterHandlerä½œç”¨ å¯¹é¢„ç¼–è¯‘çš„å‚æ•°è¿›è¡Œè®¾ç½® å·¥ä½œæµç¨‹ ä»parameterObjectä¸­å–åˆ°å‚æ•°ï¼Œç„¶åä½¿ç”¨typeHandlerï¼ˆæ³¨å†Œåœ¨Configurationä¸­ï¼‰è¿›è¡Œå‚æ•°å¤„ç† ResultSetHandlerä½œç”¨ ç»„è£…ç»“æœè¿”å›ç»“æœé›† è¿è¡Œè¿‡ç¨‹æ€»ç»“ prepareé¢„ç¼–è¯‘ parameterizeè®¾ç½®å‚æ•° doUpdate/doQueryæ‰§è¡ŒSQL ç¥äººçš„æ€»ç»“ å‚è€ƒé“¾æ¥ Mybatisç¼“å­˜ï¼ˆ1ï¼‰â€”â€”â€“ç³»ç»Ÿç¼“å­˜åŠç®€å•é…ç½®ä»‹ç» Mybatisçš„SqlSessionè¿è¡ŒåŸç† MyBatisä»å…¥é—¨åˆ°æ”¾å¼ƒå…­ï¼šå»¶è¿ŸåŠ è½½ã€ä¸€çº§ç¼“å­˜ã€äºŒçº§ç¼“å­˜]]></content>
      <categories>
        <category>æŠ€æœ¯æ¢ç´¢</category>
      </categories>
      <tags>
        <tag>æ•°æ®åº“</tag>
        <tag>æ¡†æ¶</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[javaä¸­çš„é”]]></title>
    <url>%2F2020%2F01%2F09%2Fconcurrent5%2F</url>
    <content type="text"><![CDATA[ã€Šå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹é˜…è¯»ç¬”è®°ç¬¬äº”ç« ï¼Œå›¾æ–‡ç»é… ä½ é”æˆ‘ï¼Œæˆ‘é”ä½ ï¼Œä¸¤è€…äº’ä¸ç›¸è®©ï¼Œç„¶åå°±è¿›å…¥äº†æ­»å±€ï¼Œè¿™åƒæäº†çˆ±æƒ…ã€‚ ä¸€ã€Lockæ¥å£æä¾›äº†synchronizedä¸å…·æœ‰çš„ç‰¹æ€§ï¼š å°è¯•éé˜»å¡åœ°è·å–é”ï¼štryLock()ï¼Œè°ƒç”¨æ–¹æ³•åç«‹åˆ»è¿”å› èƒ½è¢«ä¸­æ–­åœ°è·å–é”ï¼šlockInterruptibly():åœ¨é”çš„è·å–ä¸­å¯ä»¥ä¸­æ–­å½“å‰çº¿ç¨‹ è¶…æ—¶è·å–é”:tryLock(time,unit)ï¼Œè¶…æ—¶è¿”å› Lockæ¥å£çš„å®ç°åŸºæœ¬éƒ½æ˜¯é€šè¿‡==èšåˆäº†ä¸€ä¸ªåŒæ­¥å™¨çš„å­ç±»æ¥å®Œæˆçº¿ç¨‹è®¿é—®æ§åˆ¶çš„ã€‚== ä½¿ç”¨æ³¨æ„äº‹é¡¹ unlockæ–¹æ³•è¦åœ¨finallyä¸­ä½¿ç”¨ï¼Œç›®çš„ä¿è¯åœ¨è·å–åˆ°é”ä¹‹åï¼Œæœ€ç»ˆèƒ½è¢«é‡Šæ”¾ lockæ–¹æ³•ä¸èƒ½æ”¾åœ¨tryå—ä¸­ï¼Œå› ä¸ºå¦‚æœtry catchæŠ›å‡ºå¼‚å¸¸ï¼Œä¼šå¯¼è‡´é”æ— æ•…é‡Šæ”¾ äºŒã€é˜Ÿåˆ—åŒæ­¥å™¨ é˜Ÿåˆ—åŒæ­¥å™¨AbstractQueuedSynchronizeræ˜¯ç”¨æ¥æ„å»ºé”æˆ–å…¶ä»–åŒæ­¥ç»„ä»¶çš„åŸºç¡€æ¡†æ¶ã€‚å®ƒä½¿ç”¨ä¸€ä¸ªintæˆå‘˜å˜é‡è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼Œé€šè¿‡å†…ç½®çš„FIFOé˜Ÿåˆ—æ¥å®Œæˆèµ„æºè·å–çº¿ç¨‹çš„æ’é˜Ÿå·¥ä½œã€‚ åŒæ­¥å™¨çš„ä¸»è¦ä½¿ç”¨æ–¹å¼æ˜¯ç»§æ‰¿ï¼Œå­ç±»é€šè¿‡ç»§æ‰¿åŒæ­¥å™¨å¹¶å®ç°å®ƒçš„æŠ½è±¡æ–¹æ³•æ¥ç®¡ç†åŒæ­¥çŠ¶æ€ã€‚åŒæ­¥å™¨æ—¢å¯ä»¥æ”¯æŒç‹¬å å¼åœ°è·å–åŒæ­¥çŠ¶æ€ï¼Œä¹Ÿå¯ä»¥æ”¯æŒå…±äº«å¼åœ°è·å–åŒæ­¥çŠ¶æ€,è¿™æ ·å°±å¯ä»¥æ–¹ä¾¿å®ç°ä¸åŒç±»å‹çš„åŒæ­¥ç»„ä»¶ï¼ˆReentrantLockã€ReentrantReadWriteLockå’ŒCountDownLatchç­‰ï¼‰ ==åŒæ­¥å™¨==æ˜¯å®ç°é”çš„å…³é”®ï¼Œåœ¨é”çš„å®ç°ä¸­èšåˆåŒæ­¥å™¨ï¼Œåˆ©ç”¨åŒæ­¥å™¨å®ç°é”çš„è¯­ä¹‰ã€‚ç†è§£ä¸¤è€…çš„å…³ç³»ï¼š é”æ˜¯é¢å‘ä½¿ç”¨è€…çš„ï¼Œå®ƒå®šä¹‰äº†ä½¿ç”¨è€…ä¸é”äº¤äº’çš„æ¥å£ï¼Œéšè—äº†å®ç°ç»†èŠ‚ï¼› åŒæ­¥å™¨æ˜¯é¢å‘é”çš„å®ç°è€…ï¼Œå®ƒç®€åŒ–äº†é”çš„å®ç°æ–¹å¼ï¼Œå±è”½äº†åŒæ­¥çŠ¶æ€ç®¡ç†ã€çº¿ç¨‹çš„æ’é˜Ÿã€ç­‰å¾…å’Œå”¤é†’ç­‰åº•å±‚æ“ä½œã€‚ é˜Ÿåˆ—åŒæ­¥å™¨çš„æ¥å£ä¸ç¤ºä¾‹ åŒæ­¥å™¨çš„è®¾è®¡æ˜¯åŸºäºæ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨è€…éœ€è¦ç»§æ‰¿åŒæ­¥å™¨å¹¶é‡å†™æŒ‡å®šçš„æ–¹æ³•ï¼Œéšåå°†åŒæ­¥å™¨ç»„åˆåœ¨è‡ªå®šä¹‰åŒæ­¥ç»„ä»¶çš„å®ç°ä¸­ï¼Œå¹¶è°ƒç”¨åŒæ­¥å™¨æä¾›çš„æ¨¡æ¿æ–¹æ³•ï¼Œè€Œè¿™äº›æ¨¡æ¿æ–¹æ³•å°†ä¼šè°ƒç”¨ä½¿ç”¨è€…é‡å†™çš„æ–¹æ³•ã€‚ é‡å†™åŒæ­¥å™¨æŒ‡å®šçš„æ–¹æ³•æ—¶ï¼Œéœ€è¦ä½¿ç”¨åŒæ­¥å™¨æä¾›çš„å¦‚ä¸‹3ä¸ªæ–¹æ³•æ¥è®¿é—®æˆ–ä¿®æ”¹åŒæ­¥çŠ¶æ€ getState()ï¼šè·å–å½“å‰åŒæ­¥çŠ¶æ€ã€‚ setState(int newState)ï¼šè®¾ç½®å½“å‰åŒæ­¥çŠ¶æ€ã€‚ compareAndSetState(int expect,int update)ï¼šä½¿ç”¨CASè®¾ç½®å½“å‰çŠ¶æ€ï¼Œè¯¥æ–¹æ³•èƒ½å¤Ÿä¿è¯çŠ¶æ€è®¾ç½®çš„åŸå­æ€§ã€‚ åŒæ­¥å™¨æä¾›çš„æ¨¡æ¿æ–¹æ³•åŸºæœ¬ä¸Šåˆ†ä¸º3ç±»ï¼š==ç‹¬å å¼è·å–ä¸é‡Šæ”¾åŒæ­¥çŠ¶æ€==ã€==å…±äº«å¼è·å–ä¸é‡Šæ”¾åŒæ­¥çŠ¶æ€==å’Œ==æŸ¥è¯¢åŒæ­¥é˜Ÿåˆ—ä¸­çš„ç­‰å¾…çº¿ç¨‹æƒ…å†µ==ã€‚è‡ªå®šä¹‰åŒæ­¥ç»„ä»¶å°†ä½¿ç”¨åŒæ­¥å™¨æä¾›çš„æ¨¡æ¿æ–¹æ³•æ¥å®ç°è‡ªå·±çš„åŒæ­¥è¯­ä¹‰ã€‚ å·¥ä½œåŸç†1MUtuxæºä»£ç ç•¥ é˜Ÿåˆ—åŒæ­¥å™¨çš„å®ç°åˆ†æ1.åŒæ­¥é˜Ÿåˆ—é€šè¿‡ä¸€ä¸ªFIFOåŒå‘é˜Ÿåˆ—æ¥å®ŒæˆåŒæ­¥çŠ¶æ€çš„ç®¡ç†ï¼Œå½“å‰çº¿ç¨‹è·å–åŒæ­¥çŠ¶æ€å¤±è´¥æ—¶ï¼ŒåŒæ­¥å™¨ä¼šå°†å½“å‰çº¿ç¨‹ä»¥åŠç­‰å¾…çŠ¶æ€ç­‰ä¿¡æ¯æ„é€ æˆä¸€ä¸ªNodeå¹¶å°†å…¶åŠ å…¥åŒæ­¥é˜Ÿåˆ—ï¼ŒåŒæ—¶ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œå½“åŒæ­¥çŠ¶æ€é‡Šæ”¾æ—¶ï¼Œä¼šæŠŠé¦–èŠ‚ç‚¹ä¸­çš„çº¿ç¨‹å”¤é†’ï¼Œä½¿å…¶å†æ¬¡å°è¯•è·å–åŒæ­¥çŠ¶æ€ã€‚ é¦–èŠ‚ç‚¹æ˜¯è·å–åŒæ­¥çŠ¶æ€æˆåŠŸçš„èŠ‚ç‚¹ï¼Œé¦–èŠ‚ç‚¹åœ¨é‡Šæ”¾åŒæ­¥çŠ¶æ€æ—¶ï¼Œä¼šå”¤é†’åç»§èŠ‚ç‚¹ï¼Œè€Œåç»§èŠ‚ç‚¹åœ¨è·å–åŒæ­¥çŠ¶æ€æˆåŠŸæ—¶å°†è‡ªå·±è®¾ç½®ä¸ºé¦–èŠ‚ç‚¹ã€‚ èŠ‚ç‚¹çš„å±æ€§ç±»å‹ä¸åç§°ä»¥åŠæè¿° 2.ç‹¬å å¼åŒæ­¥çŠ¶æ€è·å–å’Œé‡Šæ”¾123456 public final void acquire(int arg) &#123; if (!tryAcquire(arg) &amp;&amp;acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) //å¦‚æœä¸Šè¿°æ“ä½œå¤±è´¥ï¼Œåˆ™é˜»å¡çº¿ç¨‹ selfInterrupt(); &#125;//ä¸Šè¿°ä»£ç ä¸»è¦å®Œæˆäº†åŒæ­¥çŠ¶æ€è·å–ã€èŠ‚ç‚¹æ„é€ ã€åŠ å…¥åŒæ­¥é˜Ÿåˆ—ä»¥åŠåœ¨åŒæ­¥é˜Ÿåˆ—ä¸­è‡ªæ—‹ç­‰å¾…çš„ç›¸å…³å·¥ä½œï¼Œ ä»£ç åˆ†æï¼šé¦–å…ˆå°è¯•è·å–åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœè·å–å¤±è´¥ï¼Œæ„é€ ç‹¬å å¼åŒæ­¥èŠ‚ç‚¹(ç‹¬å å¼ Node.EXCLUSIVE)å¹¶å°†å…¶åŠ å…¥åˆ°èŠ‚ç‚¹çš„å°¾éƒ¨ï¼Œç„¶åè°ƒç”¨acquireQueuedï¼Œä½¿èŠ‚ç‚¹ä¸€æ­»å¾ªç¯çš„æ–¹å¼å»è·å–åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœè·å–ä¸åˆ°å°±é˜»å¡èŠ‚ç‚¹ä¸­çš„çº¿ç¨‹ã€‚ ä¸¤ä¸ªæ­»å¾ªç¯ï¼šå…¥é˜Ÿã€å…¥é˜Ÿå addWaiterå’Œenqæ–¹æ³•Â· åœ¨â€œæ­»å¾ªç¯â€ä¸­åªæœ‰é€šè¿‡CASå°†èŠ‚ç‚¹è®¾ç½®æˆä¸ºå°¾èŠ‚ç‚¹ä¹‹åï¼Œå½“å‰çº¿ç¨‹æ‰èƒ½ä»è¯¥æ–¹æ³•è¿”å›ï¼Œå¦åˆ™ï¼Œå½“å‰çº¿ç¨‹ä¸æ–­åœ°å°è¯•è®¾ç½®ã€‚å¯ä»¥çœ‹å‡ºï¼Œenq(final Node node)æ–¹æ³•å°†å¹¶å‘æ·»åŠ èŠ‚ç‚¹çš„è¯·æ±‚é€šè¿‡CASå˜å¾—â€œä¸²è¡ŒåŒ–â€äº† 1addWaiteræ–¹æ³•å°è¯•å¿«é€Ÿæ·»åŠ ï¼Œä½†æ˜¯å­˜åœ¨å‡ºç°å¹¶å‘å¯¼è‡´èŠ‚ç‚¹æ— æ³•æ­£å¸¸æ·»åŠ æˆåŠŸï¼ˆè·å–å°¾èŠ‚ç‚¹==nullï¼‰ï¼Œå› æ­¤enqæ–¹æ³•æ— é™å¾ªç¯æ·»åŠ èŠ‚ç‚¹ï¼Œå°†èŠ‚ç‚¹åŠ å…¥åˆ°å°¾éƒ¨ acquireQueuedæ–¹æ³• Â·==åªæœ‰å‰é©±èŠ‚ç‚¹æ˜¯å¤´ç»“ç‚¹æ‰èƒ½å°è¯•è·å–åŒæ­¥çŠ¶æ€==ï¼ŒåŸå› ï¼š å¤´ç»“ç‚¹æ˜¯æˆåŠŸè·å–åˆ°åŒæ­¥çŠ¶æ€çš„èŠ‚ç‚¹ï¼Œè€Œå¤´ç»“ç‚¹çš„çº¿ç¨‹é‡Šæ”¾äº†åŒæ­¥çŠ¶æ€åï¼Œå°†ä¼šå”¤é†’å…¶åç»§èŠ‚ç‚¹ï¼Œåç»§èŠ‚ç‚¹çš„çº¿ç¨‹è¢«å”¤é†’åéœ€è¦æ£€æŸ¥è‡ªå·±çš„å‰é©±èŠ‚ç‚¹æ˜¯å¦ä¸ºå¤´èŠ‚ç‚¹ã€‚ ç»´æŠ¤åŒæ­¥é˜Ÿåˆ—çš„FIFOåŸåˆ™ã€‚èŠ‚ç‚¹ä¹‹é—´äº’ä¸é€šä¿¡ï¼Œä¾¿äºå¯¹è¿‡æ—©é€šçŸ¥çš„å¤„ç†ï¼ˆè¿‡æ—©é€šçŸ¥æ˜¯æŒ‡å‰é©±èŠ‚ç‚¹ä¸æ˜¯å¤´èŠ‚ç‚¹çš„çº¿ç¨‹ç”±äºä¸­æ–­è€Œè¢«å”¤é†’ï¼‰ é‡Šæ”¾åŒæ­¥çŠ¶æ€ä½¿ç”¨releaseæ–¹æ³• 12345678910public final boolean release(int arg) &#123; if (tryRelease(arg)) &#123; Node h = head; if (h != null &amp;&amp; h.waitStatus != 0 //unparkSuccessor(Node node)æ–¹æ³•ä½¿ç”¨LockSupportï¼ˆåœ¨åé¢çš„ç« èŠ‚ä¼šä¸“é—¨ä»‹ç»ï¼‰æ¥å”¤é†’å¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ unparkSuccessor(h); return true; &#125; return false;&#125; æ€»ç»“ï¼šåœ¨è·å–åŒæ­¥çŠ¶æ€æ—¶ï¼ŒåŒæ­¥å™¨ç»´æŠ¤ä¸€ä¸ªåŒæ­¥é˜Ÿåˆ—ï¼Œè·å–çŠ¶æ€å¤±è´¥çš„çº¿ç¨‹éƒ½ä¼šè¢«åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­å¹¶åœ¨é˜Ÿåˆ—ä¸­è¿›è¡Œè‡ªæ—‹ï¼Œç§»å‡ºé˜Ÿåˆ—ï¼ˆåœæ­¢è‡ªæ—‹ï¼‰çš„æ¡ä»¶æ˜¯å‰é©±èŠ‚ç‚¹æ˜¯å¤´ç»“ç‚¹ä¸”æˆåŠŸè·å–äº†åŒæ­¥çŠ¶æ€ã€‚åœ¨é‡Šæ”¾åŒæ­¥çŠ¶æ€æ—¶ï¼ŒåŒæ­¥å™¨è°ƒç”¨tryReleaseæ–¹æ³•é‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œç„¶åå”¤é†’å¤´ç»“ç‚¹çš„åç»§èŠ‚ç‚¹ 3.å…±äº«å¼åŒæ­¥çŠ¶æ€è·å–å’Œé‡Šæ”¾ä¸»è¦åŒºåˆ«ï¼šåŒä¸€æ—¶åˆ»æ˜¯å¦æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶è·å–åˆ°åŒæ­¥çŠ¶æ€ å…±äº«å¼è®¿é—®èµ„æºæ—¶ï¼Œå…¶ä»–å…±äº«å¼çš„è®¿é—®å‡è¢«å…è®¸ï¼Œè€Œç‹¬å å¼è®¿é—®è¢«é˜»å¡ã€‚ç‹¬å å¼è®¿é—®èµ„æºæ—¶ï¼ŒåŒä¸€æ—¶åˆ»å…¶ä»–è®¿é—®å‡è¢«é˜»å¡ã€‚ tryAcquireShared(int arg)æ–¹æ³•è¿”å›å€¼ä¸ºintç±»å‹ï¼Œå½“è¿”å›å€¼å¤§äºç­‰äº0æ—¶ï¼Œè¡¨ç¤ºèƒ½å¤Ÿè·å–åˆ°åŒæ­¥çŠ¶æ€ releaseSharedÂ·æ–¹æ³•å’Œç‹¬å å¼ä¸»è¦åŒºåˆ«åœ¨äºtryReleaseShared(int arg)æ–¹æ³•å¿…é¡»ç¡®ä¿åŒæ­¥çŠ¶æ€ï¼ˆæˆ–è€…èµ„æºæ•°ï¼‰çº¿ç¨‹å®‰å…¨é‡Šæ”¾ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡å¾ªç¯å’ŒCASæ¥ä¿è¯çš„ï¼Œå› ä¸ºé‡Šæ”¾åŒæ­¥çŠ¶æ€çš„æ“ä½œä¼šåŒæ—¶æ¥è‡ªå¤šä¸ªçº¿ç¨‹ã€‚ 12æºç ç»†èŠ‚è¿˜æ˜¯æœ‰å¾ˆå¤šæ²¡æœ‰çœ‹æ‡‚æ¯”å¦‚interruptçš„æ”¾ç½®æ—¶æœºï¼Œå¦‚ä½•ä¿è¯å…±äº«çš„æ—¶å€™çº¿ç¨‹å®‰å…¨æ€§ã€å…±äº«è·å–åŒæ­¥çŠ¶æ€ä¸­çš„ä¼ æ’­å’Œä¿¡å·éƒ½æ˜¯ä»€ä¹ˆæ„æ€ã€‚ã€‚ã€‚ 4.ç‹¬å å¼è¶…æ—¶è·å–åŒæ­¥çŠ¶æ€ é€šè¿‡è°ƒç”¨åŒæ­¥å™¨çš„doAcquireNanos(int arg,long nanosTimeout)æ–¹æ³•å¯ä»¥è¶…æ—¶è·å–åŒæ­¥çŠ¶æ€ï¼Œå³åœ¨æŒ‡å®šçš„æ—¶é—´æ®µå†…è·å–åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœè·å–åˆ°åŒæ­¥çŠ¶æ€åˆ™è¿”å›trueï¼Œå¦åˆ™ï¼Œè¿”å›falseã€‚è¯¥æ–¹æ³•æä¾›äº†ä¼ ç»ŸJavaåŒæ­¥æ“ä½œï¼ˆæ¯”å¦‚synchronizedå…³é”®å­—ï¼‰æ‰€ä¸å…·å¤‡çš„ç‰¹æ€§ã€‚ å“åº”ä¸­æ–­çš„åŒæ­¥çŠ¶æ€è·å–è¿‡ç¨‹ åœ¨Java 5ä¸­ï¼ŒåŒæ­¥å™¨æä¾›äº†acquireInterruptibly(int arg)æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨ç­‰å¾…è·å–åŒæ­¥çŠ¶æ€æ—¶ï¼Œå¦‚æœå½“å‰çº¿ç¨‹è¢«ä¸­æ–­ï¼Œä¼šç«‹åˆ»è¿”å›ï¼Œå¹¶æŠ›å‡ºInterruptedExceptionã€‚ doAcquireNanos(int arg,long nanosTimeout)æ–¹æ³•åœ¨æ”¯æŒå“åº”ä¸­æ–­çš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº†è¶…æ—¶è·å–çš„ç‰¹æ€§ã€‚é’ˆå¯¹è¶…æ—¶è·å–ï¼Œä¸»è¦éœ€è¦è®¡ç®—å‡ºéœ€è¦ç¡çœ çš„æ—¶é—´é—´éš”nanosTimeoutï¼Œä¸ºäº†é˜²æ­¢è¿‡æ—©é€šçŸ¥ï¼ŒnanosTimeoutè®¡ç®—å…¬å¼ä¸ºï¼šnanosTimeout-=now-lastTimeï¼Œå…¶ä¸­nowä¸ºå½“å‰å”¤é†’æ—¶é—´ï¼ŒlastTimeä¸ºä¸Šæ¬¡å”¤é†’æ—¶é—´ï¼Œå¦‚æœnanosTimeoutå¤§äº0åˆ™è¡¨ç¤ºè¶…æ—¶æ—¶é—´æœªåˆ°ï¼Œéœ€è¦ç»§ç»­ç¡çœ nanosTimeoutçº³ç§’ï¼Œåä¹‹ï¼Œè¡¨ç¤ºå·²ç»è¶…æ—¶Â· 12345ç‹¬å å¼è¶…æ—¶è·å–åŒæ­¥çŠ¶æ€å’Œç‹¬å å¼è·å–åŒæ­¥çŠ¶æ€æµç¨‹ä¸Šéå¸¸ç›¸ä¼¼ä¸»è¦åŒºåˆ«åœ¨äºæœªè·å–åˆ°åŒæ­¥çŠ¶æ€æ—¶çš„å¤„ç†é€»è¾‘ã€‚acquire(int args)åœ¨æœªè·å–åˆ°åŒæ­¥çŠ¶æ€æ—¶ï¼Œå°†ä¼šä½¿å½“å‰çº¿ç¨‹ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ï¼Œè€ŒdoAcquireNanos(int arg,long nanosTimeout)ä¼šä½¿å½“å‰çº¿ç¨‹ç­‰å¾…nanosTimeoutçº³ç§’ï¼Œå¦‚æœå½“å‰çº¿ç¨‹åœ¨nanosTimeoutçº³ç§’å†…æ²¡æœ‰è·å–åˆ°åŒæ­¥çŠ¶æ€ï¼Œå°†ä¼šä»ç­‰å¾…é€»è¾‘ä¸­è‡ªåŠ¨è¿”å›å½“æ—¶é—´å°äºç­‰äºä¸€ä¸ªè¶…æ—¶è‡ªæ—‹é—¨é™æ—¶åˆ™ä¸å†è¿›è¡Œè¶…æ—¶ç­‰å¾…ï¼Œè€Œæ˜¯è¿›å…¥å¿«é€Ÿçš„è‡ªæ—‹è¿‡ç¨‹ ä¸‰ã€é‡å…¥é”ï¼ˆReentrantLockï¼‰ synchronizedå…³é”®å­—éšå¼åœ°æ”¯æŒé‡å…¥ ReentrantLockä¸åƒsynchronizedéšå¼æ”¯æŒï¼Œåœ¨è°ƒç”¨lockæ–¹æ³•æ—¶ï¼Œå·²ç»è·å–åˆ°é”çš„çº¿ç¨‹ï¼Œèƒ½å¤Ÿå†æ¬¡è°ƒç”¨lockæ–¹æ³•è·å–é”è€Œä¸è¢«é˜»å¡ã€‚ å…¬å¹³çš„è·å–é”ï¼Œä¹Ÿå°±æ˜¯ç­‰å¾…æ—¶é—´æœ€é•¿çš„çº¿ç¨‹æœ€ä¼˜å…ˆè·å–é”ï¼Œä¹Ÿå¯ä»¥è¯´é”è·å–æ˜¯é¡ºåºçš„ äº‹å®ä¸Šï¼Œå…¬å¹³çš„é”æœºåˆ¶å¾€å¾€æ²¡æœ‰éå…¬å¹³çš„æ•ˆç‡é«˜ï¼Œä½†æ˜¯å…¬å¹³é”çš„å¥½å¤„åœ¨äºï¼šå…¬å¹³é”èƒ½å¤Ÿå‡å°‘â€œé¥¥é¥¿â€å‘ç”Ÿçš„æ¦‚ç‡ï¼Œç­‰å¾…è¶Šä¹…çš„è¯·æ±‚è¶Šæ˜¯èƒ½å¤Ÿå¾—åˆ°ä¼˜å…ˆæ»¡è¶³ã€‚ 1.é‡å…¥çš„å®ç°ä¸¤ä¸ªé—®é¢˜ï¼š å†æ¬¡è·å–é” é”éœ€è¦è¯†åˆ«è·å–é”çš„çº¿ç¨‹æ˜¯å¦ä¸ºå½“å‰å æ®é”çš„çº¿ç¨‹ï¼Œå¦‚æœæ—¶ï¼Œå†æ¬¡æˆåŠŸè·å– æœ€ç»ˆé‡Šæ”¾ è¦æ±‚é”å¯¹äºè·å–è¿›è¡Œè‡ªå¢è®¡æ•° 12é—®é¢˜ï¼šæ„ä¹‰ä½•åœ¨ï¼Ÿé˜²æ­¢å‡ºç°å¾ªç¯è·å–é”å½±å“æ€§èƒ½æˆ–è€…é€ æˆæ­»é” 1å¯é‡å…¥è·å–é”çš„æœºåˆ¶ï¼Œåœ¨è·å–çš„æ—¶å€™å¦‚æœä¸æ˜¯ç¬¬ä¸€æ¬¡è·å–ï¼ŒçŠ¶æ€åŠ ä¸€ï¼Œå®é™…ä¸Šæ²¡æœ‰è¿›è¡ŒCASæ“ä½œï¼Œå› æ­¤åœ¨é‡Šæ”¾é”çš„æ—¶å€™è¦æ±‚stateä¸º0ï¼Œæ‰èƒ½å½»åº•é‡Šæ”¾é” 2.å…¬å¹³é”ä¸éå…¬å¹³é”çš„åŒºåˆ«ï¼šå¦‚æœä¸€ä¸ªé”æ˜¯å…¬å¹³çš„ï¼Œé‚£ä¹ˆé”çš„è·å–é¡ºåºå°±åº”è¯¥ç¬¦åˆè¯·æ±‚çš„ç»å¯¹æ—¶é—´é¡ºåºï¼Œä¹Ÿå°±æ˜¯FIFO å…¬å¹³é”ï¼šCASæˆåŠŸï¼Œä¸”æ˜¯é˜Ÿåˆ—çš„é¦–èŠ‚ç‚¹ï¼ˆåˆ¤æ–­å¤šäº†ä¸€å±‚å¯¹å‰å»å‰é©±èŠ‚ç‚¹çš„åˆ¤æ–­ï¼‰ éå…¬å¹³é”ï¼šCASæˆåŠŸå³å¯é‡å…¥é”çš„é»˜è®¤å®ç°æ˜¯éå…¬å¹³é”ï¼ŒåŸå› ï¼šè™½ç„¶ä¼šå¯¼è‡´é¥¥é¥¿ï¼Œä½†æ˜¯éå…¬å¹³é”çš„çš„å¼€é”€å°‘ï¼ˆçº¿ç¨‹åˆ‡æ¢æ¬¡æ•°å°‘ï¼‰ï¼Œä»è€Œå¯ä»¥æœ‰æ›´é«˜çš„ååé‡ã€‚ å››ã€è¯»å†™é”ï¼ˆReentrantReadWriteLockï¼‰ å‰æ–‡ä¸­çš„é”åŸºæœ¬éƒ½æ˜¯æ’ä»–é”ï¼Œåœ¨åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®ã€‚ è¯»å†™æ‰€åœ¨åŒä¸€æ—¶åˆ»å¯ä»¥å…è®¸å¤šä¸ªè¯»çº¿ç¨‹è®¿é—®ï¼Œä½†åœ¨å†™çº¿ç¨‹è®¿é—®æ—¶ï¼Œæ‰€æœ‰è¯»çº¿ç¨‹å’Œå…¶ä»–å†™çº¿ç¨‹å‡è¢«é˜»å¡ã€‚ï¼ˆä¿è¯äº†å†™æ“ä½œçš„å¯è§æ€§ï¼‰ è¯»å†™é”ç»´æŠ¤äº†ä¸€å¯¹é”ï¼Œä¸€ä¸ªè¯»é”å’Œä¸€ä¸ªå†™é”ï¼Œé€šè¿‡åˆ†ç¦»è¯»é”å’Œå†™é”ï¼Œä½¿å¾—å¹¶å‘æ€§ç›¸æ¯”ä¸€èˆ¬çš„æ’ä»–é”æœ‰äº†å¾ˆå¤§æå‡ã€‚ è¯»å†™é”çš„å®ç°åˆ†æ1.è¯»å†™çŠ¶æ€çš„è®¾è®¡ä¾èµ–è‡ªå®šä¹‰åŒæ­¥å™¨ï¼Œè¯»å†™é”çš„è‡ªå®šä¹‰åŒæ­¥å™¨éœ€è¦åœ¨åŒæ­¥çŠ¶æ€ï¼ˆä¸€ä¸ªintå€¼ï¼‰ä¸Šç»´æŠ¤å¤šä¸ªè¯»çº¿ç¨‹å’Œä¸€ä¸ªå†™çº¿ç¨‹çš„çŠ¶æ€ï¼Œé«˜16ä½è¡¨ç¤ºè¯»ï¼Œä½16ä½è¡¨ç¤ºå†™ã€‚ ä½è¿ç®— å½“å‰åŒæ­¥çŠ¶æ€è¡¨ç¤ºä¸€ä¸ªçº¿ç¨‹å·²ç»è·å–äº†å†™é”ï¼Œä¸”é‡è¿›å…¥äº†ä¸¤æ¬¡ï¼ŒåŒæ—¶ä¹Ÿè¿ç»­è·å–äº†ä¸¤æ¬¡ è¯»é”ã€‚è¯»å†™é”æ˜¯å¦‚ä½•è¿…é€Ÿç¡®å®šè¯»å’Œå†™å„è‡ªçš„çŠ¶æ€å‘¢ï¼Ÿç­”æ¡ˆæ˜¯é€šè¿‡ä½è¿ç®—ã€‚å‡è®¾å½“å‰åŒæ­¥çŠ¶æ€ å€¼ä¸ºSï¼Œå†™çŠ¶æ€ç­‰äºS&amp;0x0000FFFFï¼ˆå°†é«˜16ä½å…¨éƒ¨æŠ¹å»ï¼‰ï¼Œè¯»çŠ¶æ€ç­‰äºS&gt;&gt;&gt;16ï¼ˆæ— ç¬¦å·è¡¥0å³ç§»16ä½ï¼‰ã€‚å½“å†™çŠ¶æ€å¢åŠ 1æ—¶ï¼Œç­‰äºS+1ï¼Œå½“è¯»çŠ¶æ€å¢åŠ 1æ—¶ï¼Œç­‰äºS+(1&lt;&lt;16)ï¼Œä¹Ÿå°±æ˜¯ S+0x00010000ã€‚2.å†™é”çš„è·å–ä¸é‡Šæ”¾ å†™é”æ˜¯ä¸€ä¸ªæ”¯æŒé‡å…¥çš„æ’ä»–é”ï¼Œå¦‚æœå½“å‰çº¿ç¨‹å·²ç»è·å–äº†å†™é”ï¼Œåˆ™å¢åŠ å†™çŠ¶æ€ã€‚å¦‚æœå½“å‰çº¿ç¨‹åœ¨è·å–å†™é”æ—¶ï¼Œè¯»é”å·²ç»è¢«è·å–æˆ–è€…è¯¥çº¿ç¨‹ä¸æ˜¯å·²ç»è·å–å†™é”çš„çº¿ç¨‹ï¼Œåˆ™å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚ ==è¯»é”å­˜åœ¨ï¼Œå†™é”ä¸èƒ½è·å–ï¼š== 1è¯»å†™é”è¦ç¡®ä¿å†™é”çš„æ“ä½œå¯¹è¯»é”å¯è§ï¼Œå¦‚æœå…è®¸è¯»é”åœ¨å·²è¢«è·å–çš„æƒ…å†µä¸‹å¯¹å†™é”çš„è·å–ï¼Œé‚£ä¹ˆæ­£åœ¨è¿è¡Œçš„å…¶ä»–è¯»çº¿ç¨‹å°±æ— æ³•æ„ŸçŸ¥åˆ°å½“å‰å†™çº¿ç¨‹çš„æ“ä½œã€‚å› æ­¤ï¼Œåªæœ‰ç­‰å¾…å…¶ä»–è¯»çº¿ç¨‹éƒ½é‡Šæ”¾äº†è¯»é”ï¼Œå†™é”æ‰èƒ½è¢«å½“å‰çº¿ç¨‹è·å–ï¼Œè€Œå†™é”ä¸€æ—¦è¢«è·å–ï¼Œåˆ™å…¶ä»–è¯»å†™çº¿ç¨‹çš„åç»­è®¿é—®å‡è¢«é˜»å¡ã€‚ 3.è¯»é”çš„è·å–ä¸é‡Šæ”¾åœ¨æ²¡æœ‰å…¶ä»–å†™çº¿ç¨‹è®¿é—®æ—¶ï¼Œè¯»é”æ€»ä¼šè¢«æˆåŠŸåœ°è·å–ã€‚å¦‚æœå†™é”å·²ç»è¢«å…¶ä»–çº¿ç¨‹è·å–ï¼Œåˆ™è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚ è¯»é”çš„æ¯æ¬¡é‡Šæ”¾ï¼ˆçº¿ç¨‹å®‰å…¨çš„ï¼Œå¯èƒ½æœ‰å¤šä¸ªè¯»çº¿ç¨‹åŒæ—¶é‡Šæ”¾è¯»é”ï¼‰å‡å‡å°‘è¯»çŠ¶æ€ï¼Œå‡å°‘çš„å€¼æ˜¯ï¼ˆ1&lt;&lt;16ï¼‰ã€‚ ==è¯»çŠ¶æ€çš„çº¿ç¨‹å®‰å…¨ç”±CASä¿è¯== 4.é”é™çº§ï¼ˆå†™é”é™çº§æˆä¸ºè¯»é”ï¼‰å®šä¹‰ï¼š==æŠŠæŒä½å†™é”==ï¼Œå†è·å–åˆ°è¯»é”ï¼Œéšåé‡Šæ”¾å†™é”çš„è¿‡ç¨‹ writeLock.lock(); readLock.lock(); writeLock.unlock(); è¿™è¾¹ä¸æ˜¯å¾ˆç†è§£ã€‚ã€‚ã€‚ã€‚ é”é™çº§çš„å‰ææ˜¯æ‰€æœ‰çº¿ç¨‹éƒ½å¸Œæœ›å¯¹æ•°æ®å˜åŒ–æ•æ„Ÿï¼Œä½†æ˜¯å› ä¸ºå†™é”åªæœ‰ä¸€ä¸ªï¼Œæ‰€ä»¥ä¼šå‘ç”Ÿé™çº§ã€‚å¦‚æœå…ˆé‡Šæ”¾å†™é”ï¼Œå†è·å–è¯»é”ï¼Œå¯èƒ½åœ¨è·å–ä¹‹å‰ï¼Œä¼šæœ‰å…¶ä»–çº¿ç¨‹è·å–åˆ°å†™é”ï¼Œé˜»å¡è¯»é”çš„è·å–ï¼Œå°±æ— æ³•æ„ŸçŸ¥æ•°æ®å˜åŒ–äº†ã€‚æ‰€ä»¥éœ€è¦å…ˆholdä½å†™é”ï¼Œä¿è¯æ•°æ®æ— å˜åŒ–ï¼Œè·å–è¯»é”ï¼Œç„¶åå†é‡Šæ”¾å†™é”ã€‚é”é™çº§ä¸­è¯»é”è·å–çš„å¿…è¦æ€§ï¼š ä¸ºäº†ä¿è¯æ•°æ®çš„å¯è§æ€§ï¼Œå¦‚æœå½“å‰çº¿ç¨‹ä¸è·å–è¯»é”è€Œæ˜¯ç›´æ¥é‡Šæ”¾å†™é”ï¼Œå‡è®¾æ­¤åˆ»å¦ä¸€ä¸ªçº¿ç¨‹è·å–äº†å†™é”å¹¶ä¿®æ”¹äº†æ•°æ®ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹æ— æ³•æ„ŸçŸ¥åˆ°æ•°æ®çš„æ›´æ–°.å¦‚æœå½“å‰çº¿ç¨‹è·å–è¯»é”ï¼Œåˆ™å¦ä¸€ä¸ªçº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°å½“å‰çº¿ç¨‹ä½¿ç”¨æ•°æ®å¹¶é‡Šæ”¾é”ä¹‹åï¼Œå¦ä¸€ä¸ªçº¿ç¨‹æ‰èƒ½è·å–å†™é”è¿›è¡Œæ•°æ®æ›´æ–°ã€‚äº”ã€LockSupportå·¥å…· LockSupportå®šä¹‰äº†ä¸€ç»„çš„å…¬å…±é™æ€æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•æä¾›äº†æœ€åŸºæœ¬çš„çº¿ç¨‹é˜»å¡å’Œå”¤é†’åŠŸèƒ½ï¼Œè€ŒLockSupportä¹Ÿæˆä¸ºæ„å»ºåŒæ­¥ç»„ä»¶çš„åŸºç¡€å·¥å…· åœ¨Java 6ä¸­ï¼ŒLockSupportå¢åŠ äº†park(Object blocker)ã€parkNanos(Object blocker,long nanos)å’ŒparkUntil(Object blocker,long deadline)3ä¸ªæ–¹æ³•ï¼Œç”¨äºå®ç°é˜»å¡å½“å‰çº¿ç¨‹çš„åŠŸèƒ½ï¼Œå…¶ä¸­å‚æ•°blockeræ˜¯ç”¨æ¥æ ‡è¯†å½“å‰çº¿ç¨‹åœ¨ç­‰å¾…çš„å¯¹è±¡ï¼ˆä»¥ä¸‹ç§°ä¸ºé˜»å¡å¯¹è±¡ï¼‰ï¼Œè¯¥å¯¹è±¡ä¸»è¦ç”¨äºé—®é¢˜æ’æŸ¥å’Œç³»ç»Ÿç›‘æ§ã€‚ å…­ã€Conditionæ¥å£ Conditionæ¥å£ä¹Ÿæä¾›äº†ç±»ä¼¼Objectçš„ç›‘è§†å™¨æ–¹æ³•ï¼Œä¸Locké…åˆå¯ä»¥å®ç°ç­‰å¾…/é€šçŸ¥æ¨¡å¼ï¼Œä½†æ˜¯è¿™ä¸¤è€…åœ¨ä½¿ç”¨æ–¹å¼ä»¥åŠåŠŸèƒ½ç‰¹æ€§ä¸Šè¿˜æ˜¯æœ‰å·®åˆ«çš„ 1.Conditionæ¥å£å’Œç¤ºä¾‹ Conditionåœ¨è°ƒç”¨æ–¹æ³•ä¹‹å‰å…ˆè·å–é” 12åœ¨æ·»åŠ å’Œåˆ é™¤æ–¹æ³•ä¸­ä½¿ç”¨whileå¾ªç¯è€Œéifåˆ¤æ–­ï¼Œç›®çš„æ˜¯é˜²æ­¢è¿‡æ—©æˆ–æ„å¤–çš„é€šçŸ¥ï¼Œåªæœ‰æ¡ä»¶ç¬¦åˆæ‰èƒ½å¤Ÿé€€å‡ºå¾ªç¯ã€‚å›æƒ³ä¹‹å‰æåˆ°çš„ç­‰å¾…/é€šçŸ¥çš„ç»å…¸èŒƒå¼ï¼ŒäºŒè€…æ˜¯éå¸¸ç±»ä¼¼çš„ã€‚ 2.Conditionçš„å®ç°åˆ†æ ConditionObjectæ˜¯åŒæ­¥å™¨AbstractQueuedSynchronizerçš„å†…éƒ¨ç±»ï¼Œå› ä¸ºConditionçš„æ“ä½œéœ€è¦è·å–ç›¸å…³è”çš„é”ï¼Œæ‰€ä»¥ä½œä¸ºåŒæ­¥å™¨çš„å†…éƒ¨ç±»ä¹Ÿè¾ƒä¸ºåˆç†ã€‚æ¯ä¸ªConditionå¯¹è±¡éƒ½åŒ…å«ç€ä¸€ä¸ªé˜Ÿåˆ—ï¼ˆä»¥ä¸‹ç§°ä¸ºç­‰å¾…é˜Ÿåˆ—ï¼‰ï¼Œè¯¥é˜Ÿåˆ—æ˜¯Conditionå¯¹è±¡å®ç°ç­‰å¾…/é€šçŸ¥åŠŸèƒ½çš„å…³é”®ã€‚ ç­‰å¾…é˜Ÿåˆ— ç­‰å¾…é˜Ÿåˆ—æ˜¯ä¸€ä¸ªFIFOçš„é˜Ÿåˆ—ï¼Œåœ¨é˜Ÿåˆ—ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«äº†ä¸€ä¸ªçº¿ç¨‹å¼•ç”¨ï¼Œè¯¥çº¿ç¨‹å°±æ˜¯åœ¨Conditionå¯¹è±¡ä¸Šç­‰å¾…çš„çº¿ç¨‹ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹è°ƒç”¨äº†Condition.await()æ–¹æ³•ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹å°†ä¼šé‡Šæ”¾é”ã€æ„é€ æˆèŠ‚ç‚¹åŠ å…¥ç­‰å¾…é˜Ÿåˆ—å¹¶è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼ˆå’ŒåŒæ­¥é˜Ÿåˆ—ç±»ä¼¼ï¼‰ åœ¨Objectçš„ç›‘è§†å™¨æ¨¡å‹ä¸Šï¼Œä¸€ä¸ªå¯¹è±¡æ‹¥æœ‰ä¸€ä¸ªåŒæ­¥é˜Ÿåˆ—å’Œç­‰å¾…é˜Ÿåˆ—ï¼Œè€Œå¹¶å‘åŒ…ä¸­çš„Lockï¼ˆæ›´ç¡®åˆ‡åœ°è¯´æ˜¯åŒæ­¥å™¨ï¼‰æ‹¥æœ‰ä¸€ä¸ªåŒæ­¥é˜Ÿåˆ—å’Œå¤šä¸ªç­‰å¾…é˜Ÿåˆ— ä¸Šè¿°èŠ‚ç‚¹å¼•ç”¨æ›´æ–°çš„è¿‡ç¨‹å¹¶æ²¡æœ‰ä½¿ç”¨CASä¿è¯ï¼ŒåŸå› åœ¨äºè°ƒç”¨await()æ–¹æ³•çš„çº¿ç¨‹å¿…å®šæ˜¯è·å–äº†é”çš„çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥è¿‡ç¨‹æ˜¯ç”±é”æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ ç­‰å¾… è°ƒç”¨Conditionçš„signal()æ–¹æ³•ï¼Œå°†ä¼šå”¤é†’åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­ç­‰å¾…æ—¶é—´æœ€é•¿çš„èŠ‚ç‚¹ï¼ˆé¦–èŠ‚ç‚¹ï¼‰ï¼Œåœ¨å”¤é†’èŠ‚ç‚¹ä¹‹å‰ï¼Œä¼šå°†èŠ‚ç‚¹ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ã€‚ 1234æºç ç•¥1. ä½¿ç”¨locksupportä¸­çš„park()æ–¹æ³•è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œåˆ¤æ–­æ˜¯å¦å”¤é†’èŠ‚ç‚¹çš„æ ‡å¿—æ˜¯æŸ¥çœ‹èŠ‚ç‚¹æ˜¯å¦åœ¨åŒæ­¥é˜Ÿåˆ—ä¸Šï¼Œå› ä¸ºé€šçŸ¥conditionåœ¨å”¤é†’èŠ‚ç‚¹ä¹‹å‰åå°†èŠ‚ç‚¹è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ä¸Šå”¤é†’åæ³¨æ„è¿˜æœ‰åˆ¤æ–­å”¤é†’æ–¹å¼æ˜¯é€šçŸ¥è¿˜æ˜¯ä¸­æ–­2. ä»é˜Ÿåˆ—è§’åº¦ï¼Œçº¿ç¨‹åŠ å…¥Conditionçš„ç­‰å¾…é˜Ÿåˆ—å®è´¨æ˜¯æ„é€ äº†æ–°çš„èŠ‚ç‚¹åŠ å…¥ç­‰å¾…é˜Ÿåˆ— é€šçŸ¥ è°ƒç”¨Conditionçš„signal()æ–¹æ³•ï¼Œå°†ä¼šå”¤é†’åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­ç­‰å¾…æ—¶é—´æœ€é•¿çš„èŠ‚ç‚¹ï¼ˆé¦–èŠ‚ç‚¹ï¼‰ï¼Œåœ¨å”¤é†’èŠ‚ç‚¹ä¹‹å‰ï¼Œä¼šå°†èŠ‚ç‚¹ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ã€‚]]></content>
      <categories>
        <category>å­¦ä¹ ç¬”è®°</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>é«˜å¹¶å‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[çº¿ç¨‹é—´é€šä¿¡]]></title>
    <url>%2F2020%2F01%2F07%2Fconcurrent4%2F</url>
    <content type="text"><![CDATA[Javaå¹¶å‘ç¼–ç¨‹åŸºç¡€ã€Šå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹é˜…è¯»ç¬”è®°ç¬¬å››ç« ï¼Œé‡ç‚¹åœ¨äºçº¿ç¨‹é—´çš„é€šä¿¡ ä¸€ã€çº¿ç¨‹ç®€ä»‹é¦–å…ˆå¯¹çº¿ç¨‹åšä¸€ä¸ªç®€å•çš„ä»‹ç» ä½¿ç”¨å¤šçº¿ç¨‹çš„åŸå› ï¼š 1.æ›´å¤šçš„å¤„ç†å™¨æ ¸å¿ƒï¼šä¸€ä¸ªçº¿ç¨‹åœ¨ä¸€ä¸ªæ—¶åˆ»åªèƒ½è¿è¡Œåœ¨ä¸€ä¸ªå¤„ç†å™¨æ ¸å¿ƒä¸Š 2.æ›´å¿«çš„å“åº”æ—¶é—´ 3.æ›´å¥½çš„ç¼–ç¨‹æ¨¡å‹JAVAç¨‹åºè¿è¡Œæ‰€éœ€çº¿ç¨‹ï¼ˆjdk1.8ï¼‰ çº¿ç¨‹ä¼˜å…ˆçº§ æ“ä½œç³»ç»ŸåŸºæœ¬é‡‡ç”¨æ—¶åˆ†çš„å½¢å¼è°ƒåº¦è¿è¡Œçš„çº¿ç¨‹ï¼Œæ“ä½œç³»ç»Ÿä¼šåˆ†å‡ºä¸€ä¸ªä¸ªæ—¶é—´ç‰‡ï¼Œçº¿ç¨‹ä¼šåˆ†é…åˆ°è‹¥å¹²æ—¶é—´ç‰‡ï¼Œå½“çº¿ç¨‹çš„æ—¶é—´ç‰‡ç”¨å®Œäº†å°±ä¼šå‘ç”Ÿçº¿ç¨‹è°ƒåº¦ï¼Œå¹¶ç­‰å¾…ç€ä¸‹æ¬¡åˆ†é…ï¼Œçº¿ç¨‹åˆ†é…åˆ°çš„æ—¶é—´ç‰‡å¤šå°‘å°±å†³å®šäº†çº¿ç¨‹ä½¿ç”¨å¤„ç†å™¨èµ„æºçš„å¤šå°‘ã€‚ æœ‰äº›æ“ä½œç³»ç»Ÿä¼šå¿½ç•¥å¯¹çº¿ç¨‹ä¼˜å…ˆçº§çš„è®¾å®š åœ¨Javaçº¿ç¨‹ä¸­ï¼Œé€šè¿‡ä¸€ä¸ªæ•´å‹æˆå‘˜å˜é‡priorityæ¥æ§åˆ¶ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§çš„èŒƒå›´ä»1~10ï¼Œåœ¨çº¿ç¨‹æ„å»ºçš„æ—¶å€™å¯ä»¥é€šè¿‡setPriority(int)æ–¹æ³•æ¥ä¿®æ”¹ä¼˜å…ˆçº§ï¼Œé»˜è®¤ä¼˜å…ˆçº§æ˜¯5ï¼Œä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹åˆ†é…æ—¶é—´ç‰‡çš„æ•°é‡è¦å¤šäºä¼˜å…ˆçº§ä½çš„çº¿ç¨‹ çº¿ç¨‹çš„çŠ¶æ€ 6ç§ï¼Œåœ¨ç»™å®šçš„æ—¶åˆ»åªèƒ½å¤„äºä¸€ç§çŠ¶æ€ NEWï¼šåˆå§‹çŠ¶æ€ï¼Œçº¿ç¨‹è¢«æ„å»ºï¼Œä½†è¿˜æ²¡æœ‰è°ƒç”¨startæ–¹æ³• RUNNABLEï¼šè¿è¡ŒçŠ¶æ€ï¼Œjavaçº¿ç¨‹å°†==å°±ç»ªå’Œè¿è¡Œ==ä¸¤ç§çŠ¶æ€ç»Ÿç§°ä¸ºè¿è¡ŒçŠ¶æ€ ``BLOCKED`ï¼šé˜»å¡çŠ¶æ€ï¼Œè¡¨æ˜çº¿ç¨‹é˜»å¡äºé” WAITINGï¼šç­‰å¾…çŠ¶æ€ï¼Œç­‰å¾…å…¶ä»–çº¿ç¨‹çš„é€šçŸ¥æˆ–ä¸­æ–­ TIME_WAITINGï¼šè¶…æ—¶ç­‰å¾…çŠ¶æ€ï¼Œå¯ä»¥åœ¨æŒ‡å®šçš„æ—¶é—´è‡ªè¡Œè¿”å› TERMINATEDï¼šç»ˆæ­¢çŠ¶æ€ï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹å·²ç»æ‰§è¡Œå®Œæ¯• çº¿ç¨‹çŠ¶æ€å˜è¿ Javaå°†æ“ä½œç³»ç»Ÿä¸­çš„è¿è¡Œå’Œå°±ç»ªä¸¤ä¸ªçŠ¶æ€åˆå¹¶ç§°ä¸º==è¿è¡ŒçŠ¶æ€==ã€‚ ==é˜»å¡çŠ¶æ€==æ˜¯çº¿ç¨‹é˜»å¡åœ¨è¿›å…¥synchronizedå…³é”®å­—ä¿®é¥°çš„æ–¹æ³•æˆ–ä»£ç å—ï¼ˆè·å–é”ï¼‰æ—¶çš„çŠ¶æ€ ä½†æ˜¯==é˜»å¡==åœ¨java.concurrentåŒ…ä¸­Lockæ¥å£çš„çº¿ç¨‹çŠ¶æ€å´æ˜¯ç­‰å¾…çŠ¶æ€ï¼Œå› ä¸ºjava.concurrentåŒ…ä¸­Lockæ¥å£å¯¹äºé˜»å¡çš„å®ç°å‡ä½¿ç”¨äº†LockSupportç±»ä¸­çš„ç›¸å…³æ–¹æ³• Daemonçº¿ç¨‹ï¼ˆå®ˆæŠ¤çº¿ç¨‹ï¼‰ æŒ‡åœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™åœ¨åå°æä¾›ä¸€ç§é€šç”¨æœåŠ¡çš„çº¿ç¨‹ï¼Œæ¯”å¦‚åƒåœ¾å›æ”¶çº¿ç¨‹ã€‚ä¸å±äºç¨‹åºä¸­ä¸å¯æˆ–ç¼ºçš„éƒ¨åˆ†ã€‚ å½“ä¸€ä¸ªjavaè™šæ‹Ÿæœºä¸­ä¸å­˜åœ¨éå®ˆæŠ¤çº¿ç¨‹æ—¶ï¼Œè™šæ‹Ÿæœºå°†ä¼šé€€å‡ºã€‚å¯ä»¥é€šè¿‡è®¾ç½®Thread.setDaemon(true)å°†çº¿ç¨‹è®¾ç½®ä¸ºdaemonçº¿ç¨‹ï¼Œå¿…é¡»åœ¨çº¿ç¨‹å¯åŠ¨å‰è®¾ç½® ps. åœ¨æ„å»ºDaemonçº¿ç¨‹æ—¶ï¼Œä¸èƒ½ä¾é finallyå—ä¸­çš„å†…å®¹æ¥ç¡®ä¿æ‰§è¡Œå…³é—­æˆ–æ¸…ç†èµ„æºçš„é€»è¾‘,å¯èƒ½ä¸æ‰§è¡Œ äºŒã€å¯åŠ¨å’Œç»ˆæ­¢çº¿ç¨‹ä¸€ä¸ªæ–°æ„é€ çš„çº¿ç¨‹å¯¹è±¡æ˜¯==ç”±å…¶çˆ¶çº¿ç¨‹==æ¥è¿›è¡Œç©ºé—´åˆ†é…çš„ï¼Œè€Œå­çº¿ç¨‹çš„å„ç§å±æ€§==ç»§æ‰¿è‡ªçˆ¶çº¿ç¨‹ï¼ŒåŒæ—¶è¿˜ä¼šåˆ†é…ä¸€ä¸ªå”¯ä¸€çš„IDã€‚== 123çœ‹Thread.init()æºç jdk1.8çš„æºç ä¸­æ·»åŠ äº†å¾ˆå¤šå…³äºThreadGroupçš„åˆ¤æ–­æ“ä½œä¼°è®¡æ˜¯å¯¹çº¿ç¨‹çš„å®‰å…¨æ€§å’Œå¼‚å¸¸æƒ…å†µåšäº†æ›´å®Œå–„çš„åŒºåˆ† å¯åŠ¨çº¿ç¨‹ï¼šstartæ–¹æ³•ï¼šå½“å‰çº¿ç¨‹åŒæ­¥å‘ŠçŸ¥è™šæ‹Ÿæœºï¼šåªè¦çº¿ç¨‹è§„åˆ’å™¨ç©ºé—²ï¼Œåº”ç«‹å³å¯åŠ¨è°ƒç”¨startæ–¹æ³•çš„çº¿ç¨‹ï¼Œ==æœ€å¥½åœ¨çº¿ç¨‹åˆ›å»ºä¹‹å‰è®¾ç½®çº¿ç¨‹åç§°ï¼Œæœ‰åˆ©äºæ’æŸ¥é”™è¯¯== ä¸­æ–­ï¼š å¯ä»¥ç†è§£ä¸ºçº¿ç¨‹çš„ä¸€ä¸ªæ ‡è¯†ç¬¦å±æ€§ï¼Œå®ƒæ ‡è¯†ä¸€ä¸ªè¿è¡Œä¸­çš„çº¿ç¨‹æ˜¯å¦è¢«å…¶ä»–çº¿ç¨‹è¿›è¡Œäº†ä¸­æ–­æ“ä½œã€‚æ˜¯ä¸€ç§ç®€ä¾¿çš„çº¿ç¨‹é—´äº¤äº’æ–¹å¼ã€‚çº¿ç¨‹é€šè¿‡isInterruptedï¼ˆï¼‰æ–¹æ³•åˆ¤æ–­æ˜¯å¦è¢«ä¸­æ–­ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨é™æ€æ–¹æ³•Thread.interrupted()å¯¹å½“å‰çš„çº¿ç¨‹ä¸­æ–­æ ‡è¯†ä½è¿›è¡Œå¤ä½ã€‚ ä»javaçš„APIå¯ä»¥çœ‹å‡ºï¼Œè®¸å¤šå£°æ˜æŠ›å‡ºInterruptedExceptionçš„æ–¹æ³•åœ¨æŠ›å‡ºè¿™ä¸ªå¼‚å¸¸å‰ï¼Œjavaè™šæ‹Ÿæœºä¼šå…ˆå°†è¯¥çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—ä½æ¸…é™¤ï¼Œç„¶åå†æŠ›å¼‚å¸¸ã€‚æ­¤æ—¶è°ƒç”¨isInterruptedè¿”å›false å½“çº¿ç¨‹å¤„äºç­‰å¾…çŠ¶æ€æˆ–è€…æœ‰è¶…æ—¶çš„ç­‰å¾…çŠ¶æ€æ—¶ï¼ˆTIMED_WAITINGï¼ŒWAITINGï¼‰æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨çº¿ç¨‹çš„Â·interrupt()æ–¹æ³•æ¥ä¸­æ–­çº¿ç¨‹çš„ç­‰å¾…ï¼Œæ­¤æ—¶çº¿ç¨‹ä¼šæŠ›InterruptedExceptionå¼‚å¸¸ã€‚ ä½†æ˜¯å½“çº¿ç¨‹å¤„äºBLOCKEDçŠ¶æ€æˆ–è€…RUNNABLEï¼ˆRUNNINGï¼‰çŠ¶æ€æ—¶ï¼Œè°ƒç”¨çº¿ç¨‹çš„interrupt()æ–¹æ³•ä¹Ÿåªèƒ½å°†çº¿ç¨‹çš„çŠ¶æ€ä½è®¾ç½®ä¸ºtrueã€‚åœæ­¢çº¿ç¨‹çš„é€»è¾‘éœ€è¦æˆ‘ä»¬è‡ªå·±å»å®ç°ã€‚ è¿‡æœŸAPI:suspend(),resume(),stop() åŸå› ï¼šå æœ‰èµ„æºçš„æ—¶å€™å®¹æ˜“å‘ç”Ÿæ­»é”é—®é¢˜ï¼Œè®©çº¿ç¨‹å…±å·¥ä½œåœ¨ä¸ç¡®å®šçŠ¶æ€ä¸‹ ç»ˆæ­¢çº¿ç¨‹çš„åšæ³•:ä¸€ç§æ–¹æ³•å¯ä»¥ä½¿ç”¨interrupt()æ–¹æ³•ï¼Œæˆ–è€…åˆ©ç”¨ä¸€ä¸ªbooleanå˜é‡å°†çº¿ç¨‹ç»ˆæ­¢ï¼Œä½¿çº¿ç¨‹åœ¨ç»ˆæ­¢æ—¶æœ‰æœºä¼šå»æ¸…ç†èµ„æº ä¸‰ã€çº¿ç¨‹é—´é€šä¿¡ï¼ˆé‡ç‚¹ï¼‰1ã€volatileå’Œsynchronizedå…³é”®å­—volatile:å‘ŠçŸ¥ç¨‹åºä»»ä½•å¯¹è¯¥å˜é‡çš„è®¿é—®å‡éœ€è¦ä»å…±äº«å†…å­˜ä¸­è·å–ï¼Œè€Œå¯¹ä»–çš„æ”¹å˜å¿…é¡»åŒæ­¥åˆ·æ–°å›ä¸»å†…å­˜ï¼Œä»–èƒ½ä¿è¯æ‰€æœ‰çº¿ç¨‹å¯¹å˜é‡è®¿é—®çš„å¯è§æ€§ã€‚ synchronizedï¼šç¡®ä¿å¤šä¸ªçº¿ç¨‹åœ¨åŒä¸€ä¸ªæ—¶åˆ»ï¼Œåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¤„äºæ–¹æ³•æˆ–åŒæ­¥å—ä¸­ï¼Œä¿è¯äº†çº¿ç¨‹å¯¹å˜é‡è®¿é—®çš„å¯è§æ€§å’Œæ’ä»–æ€§ã€‚ä¸èƒ½ä¿è¯é‡æ’åºå…³äºsynchronizedï¼šæœ¬è´¨æ˜¯å¯¹ä¸€ä¸ªå¯¹è±¡çš„ç›‘è§†å™¨ï¼ˆmonitorï¼‰çš„è·å–ï¼Œè€Œè¿™ä¸ªè·å–è¿‡ç¨‹æ˜¯æ’ä»–çš„ï¼Œä¹Ÿå°±æ˜¯åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è·å–åˆ°æœ‰synchronizedæ‰€ä¿æŠ¤å¯¹è±¡çš„ç›‘è§†å™¨ã€‚ä»»æ„ä¸€ä¸ªå¯¹è±¡éƒ½æ‹¥æœ‰è‡ªå·±çš„ç›‘è§†å™¨ã€‚ ä»»æ„çº¿ç¨‹å¯¹Objectçš„è®¿é—®ï¼Œé¦–å…ˆè¦è·å¾—Objectçš„ç›‘è§†å™¨ã€‚å¦‚æœè·å–å¤±è´¥ï¼Œçº¿ç¨‹è¿›å…¥åŒæ­¥é˜Ÿåˆ—ï¼Œçº¿ç¨‹çŠ¶æ€å˜ä¸ºBLOCKEDã€‚å½“è®¿é—®Objectçš„å‰é©±ï¼ˆè·å¾—äº†é”çš„çº¿ç¨‹ï¼‰é‡Šæ”¾äº†é”ï¼Œåˆ™è¯¥é‡Šæ”¾æ“ä½œå”¤é†’é˜»å¡åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹ï¼Œä½¿å…¶é‡æ–°å°è¯•å¯¹ç›‘è§†å™¨çš„è·å–ã€‚ 2ã€ç­‰å¾…/é€šçŸ¥æœºåˆ¶ï¼ˆç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼‰ ç­‰å¾…/é€šçŸ¥æœºåˆ¶ï¼Œæ˜¯æŒ‡ä¸€ä¸ªçº¿ç¨‹Aè°ƒç”¨äº†å¯¹è±¡Oçš„waitæ–¹æ³•è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹Bè°ƒç”¨äº†å¯¹è±¡Oçš„notifyæˆ–notifyallæ–¹æ³•ï¼Œçº¿ç¨‹Aæ”¶åˆ°é€šçŸ¥åä»å¯¹è±¡Oçš„waitæ–¹æ³•è¿”å›ï¼Œè¿›è€Œæ‰§è¡Œåç»­æ“ä½œã€‚ 123æ­¤å¤„çš„ä»£ç ç¤ºä¾‹å¤±æ•ˆï¼Œwaitçº¿ç¨‹æ²¡æœ‰æ­£å¸¸è¢«å”¤é†’ï¼Œä¹Ÿæ²¡æœ‰å‘ç”Ÿé‡æ’åºåŸå› æ—¶å› ä¸ºè·å–çš„é”ä¸æ˜¯åŒä¸€ä¸ªé”ï¼Œå› æ­¤å¯¼è‡´æ— æ³•æ­£å¸¸è§£é”å’ŒåŠ é”ï¼Œéœ€è¦æŠŠåŒæ­¥çš„å¯¹è±¡è®¾ç½®ä¸ºpublic staticç¡®ä¿è·å¾—å¯¹è±¡æ˜¯åŒä¸€ä¸ª///ç¤ºä¾‹ä¸æ˜¯è¿™ä¸ªé—®é¢˜ï¼Œæ˜¯å› ä¸ºä¸€å¼€å§‹æ²¡æœ‰wait...ã€ğŸ˜‚ notifyæ— æ³•æ­£å¸¸å”¤é†’waitæ–¹æ³•çš„é—®é¢˜ æ³¨æ„ï¼š ï¼ˆ1ï¼‰ä½¿ç”¨waitã€notifyã€notifyAllæ—¶éœ€è¦å…ˆå¯¹è°ƒç”¨å¯¹è±¡åŠ é” ï¼ˆ2ï¼‰è°ƒç”¨waitæ–¹æ³•åï¼Œçº¿ç¨‹çŠ¶æ€ç”±RUNNINGå˜ä¸ºWAITINGï¼Œå¹¶å°†å½“å‰çº¿ç¨‹é˜²æ­¢åˆ°å¯¹è±¡çš„ç­‰å¾…é˜Ÿåˆ— ï¼ˆ3ï¼‰notifyæˆ–notifyAllæ–¹æ³•è°ƒç”¨åï¼Œç­‰å¾…çº¿ç¨‹ä¾æ—§ä¸ä¼šä»waitè¿”å›ï¼Œéœ€è¦è°ƒç”¨notifyæˆ–notifyAllçš„çº¿ç¨‹é‡Šæ”¾é”ä¹‹åï¼Œç­‰å¾…çº¿ç¨‹æ‰æœ‰æœºä¼šä»waitè¿”å› ï¼ˆ4ï¼‰notifyæ–¹æ³•å°†ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ç­‰å¾…çº¿ç¨‹ä»ç­‰å¾…é˜Ÿåˆ—ä¸­ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œè¢«ç§»åŠ¨çš„çº¿ç¨‹ä»WAITINGå˜ä¸ºBLOCKED ï¼ˆ5ï¼‰ä»waitæ–¹æ³•è¿”å›çš„å‰ææ˜¯è·å¾—äº†è°ƒç”¨å¯¹è±¡çš„é” 3ã€ç­‰å¾…/é€šçŸ¥ç»å…¸èŒƒå¼12345678910111213141516171819ç­‰å¾…æ–¹ï¼š1.è·å–å¯¹è±¡çš„é” 2.å¦‚æœæ¡ä»¶ä¸æ»¡è¶³ï¼Œé‚£ä¹ˆè°ƒç”¨å¯¹è±¡çš„waitæ–¹æ³•ï¼Œè¢«é€šçŸ¥åä»è¦æ£€æŸ¥æ¡ä»¶ 3.æ¡ä»¶æ»¡è¶³åˆ™æ‰§è¡Œå¯¹åº”çš„é€»è¾‘ ä¼ªä»£ç ï¼š synchronized(å¯¹è±¡)&#123; while(æ¡ä»¶ä¸æ»¡è¶³)&#123; å¯¹è±¡.wait(); &#125; å¯¹åº”çš„å¤„ç†é€»è¾‘ &#125;é€šçŸ¥æ–¹ï¼š1.è·å¾—å¯¹è±¡çš„é” 2.æ”¹å˜æ¡ä»¶ 3.é€šçŸ¥æ‰€æœ‰ç­‰å¾…åœ¨å¯¹è±¡ä¸Šçš„çº¿ç¨‹ ä¼ªä»£ç ï¼š synchronized(å¯¹è±¡)&#123; æ”¹å˜æ¡ä»¶ å¯¹è±¡.notify(); &#125; 4ã€ç®¡é“è¾“å…¥è¾“å‡ºæµ ç®¡é“è¾“å…¥/è¾“å‡ºæµå’Œ æ™®é€šçš„æ–‡ä»¶è¾“å…¥/è¾“å‡ºæµ æˆ–è€… ç½‘ç»œè¾“å…¥/è¾“å‡ºæµ ä¸åŒä¹‹å¤„åœ¨äºï¼Œå®ƒä¸»è¦ç”¨äºçº¿ç¨‹ä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼Œè€Œä¼ è¾“çš„åª’ä»‹ä¸ºå†…å­˜ PipedOutputStreamã€PipedInputStream(é¢å‘å­—èŠ‚æ•°æ®) PipedReaderã€PipedWriter(é¢å‘å­—ç¬¦) å¯¹äºpipedç±»å‹çš„æµï¼Œä½¿ç”¨æ—¶å¿…é¡»å…ˆè°ƒç”¨connectæ–¹æ³•è¿›è¡Œç»‘å®šï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ ç®¡é“è¾“å…¥ç¼“å†²åŒºå¤§å°é»˜è®¤1024å­—èŠ‚ ç®¡é“çš„è¯¦ç»†è§£æ 123å†™ç¤ºä¾‹ä»£ç çš„æ³¨æ„äº‹é¡¹ï¼š1. writeå†™å…¥ readè¯»å‡º2. æ‰“å°çš„æ—¶å€™ç”¨çš„æ˜¯System.out.print è€Œä¸æ˜¯ System.out.prineln.åè€…ä¼šæœ€ååŠ å›è½¦ 5ã€Thread.join()å«ä¹‰ï¼šå½“å‰çº¿ç¨‹ç­‰å¾…threadçº¿ç¨‹ç»ˆæ­¢ä¹‹åæ‰ä»thread.joinè¿”å›ã€‚å¦å¤–è¿˜æœ‰ä¸¤ä¸ªjoin(long millis)å’Œjoin(long millis,int nanos)å…·å¤‡==è¶…æ—¶ç‰¹æ€§==çš„æ–¹æ³•ï¼ˆå¦‚æœçº¿ç¨‹åœ¨ç»™å®šçš„æ—¶é—´å†…æ²¡æœ‰ç»ˆæ­¢ï¼Œé‚£ä¹ˆå°†ä¼šä»è¯¥è¶…æ—¶æ–¹æ³•è¿”å›ï¼‰ã€‚ 123join()ç­‰ä»·äºwait(0)ï¼Œåªè¦ç­‰æŒ‡å®šçº¿ç¨‹é”é‡Šæ”¾å°±å¯ä»¥æŠ¢å é”å¦‚æœæŒ‡å®šæ—¶é—´åï¼Œå°±éœ€è¦æŒ‡å®šæ—¶é—´ä¹‹åæ‰èƒ½é‡æ–°æ‹¥æœ‰é”ï¼ˆwaitåŠ å‚æ•°æœ¬è´¨ä¸Šè¿˜æ˜¯å®šæ—¶è°ƒç”¨notify()æ–¹æ³•ï¼Œåªæ˜¯è¿™æ®µä»£ç åœ¨JVMé‡Œé¢ï¼Œæ¯”è¾ƒåº•å±‚ï¼‰joinå¦‚æœåŠ å‚æ•°ï¼Œç¬¬ä¸€æ¬¡ä»£è¡¨æŒ‰ç…§å‚æ•°è®¾ç½®waitå”¤é†’æ—¶é—´ï¼Œä¹‹åå¾ªç¯æ£€æµ‹çº¿ç¨‹æ´»æ€§ï¼Œå¦‚æœçº¿ç¨‹å§‹ç»ˆå­˜æ´»ï¼Œæ‰å¼€å§‹ä¼ å…¥è®¾ç½®å€¼å’Œå½“å‰æ—¶é—´çš„å·®å€¼ 6ã€ThreadLocal ThreadLocalï¼Œå³çº¿ç¨‹å˜é‡ï¼Œæ˜¯ä¸€ä¸ªä»¥ThreadLocalå¯¹è±¡ä¸ºé”®ã€ä»»æ„å¯¹è±¡ä¸ºå€¼çš„å­˜å‚¨ç»“æ„ã€‚è¿™ä¸ªç»“æ„è¢«é™„å¸¦åœ¨çº¿ç¨‹ä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ ¹æ®ä¸€ä¸ªThreadLocalå¯¹è±¡æŸ¥è¯¢åˆ°ç»‘å®šåœ¨è¿™ä¸ªçº¿ç¨‹ä¸Šçš„ä¸€ä¸ªå€¼ã€‚ æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å±€éƒ¨å˜é‡ å››ã€åº”ç”¨å®ä¾‹ä¸€ã€ç­‰å¾…è¶…æ—¶æ¨¡å¼ è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ—¶ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼ˆä¸€èˆ¬æ¥è¯´æ˜¯ç»™å®šä¸€ä¸ªæ—¶é—´æ®µï¼‰ï¼Œå¦‚æœè¯¥æ–¹æ³•èƒ½å¤Ÿåœ¨ç»™å®šçš„æ—¶é—´æ®µä¹‹å†…å¾—åˆ°ç»“æœï¼Œé‚£ä¹ˆå°†ç»“æœç«‹åˆ»è¿”å›ï¼Œåä¹‹ï¼Œè¶…æ—¶è¿”å›é»˜è®¤ç»“æœã€‚ 12345678910public synchronized Object get(long mills) throws InterruptedException &#123; long future = System.currentTimeMillis() + mills; long remaining = mills; // å½“è¶…æ—¶å¤§äº0å¹¶ä¸”resultè¿”å›å€¼ä¸æ»¡è¶³è¦æ±‚ while ((result == null) &amp;&amp; remaining &gt; 0) &#123; wait(remaining); remaining = future - System.currentTimeMillis(); &#125; return result;&#125; å…¸å‹æ¡ˆä¾‹ï¼šæ•°æ®åº“è¿æ¥æ± æ¨¡å¼ 1æºç ç•¥ CountDownLatchï¼š countDownLatchè¿™ä¸ªç±»ä½¿ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹å„è‡ªæ‰§è¡Œå®Œæ¯•åå†æ‰§è¡Œã€‚ æ˜¯é€šè¿‡ä¸€ä¸ªè®¡æ•°å™¨æ¥å®ç°çš„ï¼Œè®¡æ•°å™¨çš„åˆå§‹å€¼æ˜¯çº¿ç¨‹çš„æ•°é‡ã€‚æ¯å½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•åï¼Œè®¡æ•°å™¨çš„å€¼å°±-1ï¼Œå½“è®¡æ•°å™¨çš„å€¼ä¸º0æ—¶ï¼Œè¡¨ç¤ºæ‰€æœ‰çº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•ï¼Œç„¶ååœ¨é—­é”ä¸Šç­‰å¾…çš„çº¿ç¨‹å°±å¯ä»¥æ¢å¤å·¥ä½œäº†ã€‚ äºŒã€çº¿ç¨‹æ± æŠ€æœ¯ å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡execute(Job)æ–¹æ³•å°†Jobæäº¤å…¥çº¿ç¨‹æ± æ‰§è¡Œï¼Œè€Œå®¢æˆ·ç«¯è‡ªèº«ä¸ç”¨ç­‰å¾…Jobçš„æ‰§è¡Œå®Œæˆã€‚é™¤äº†execute(Job)æ–¹æ³•ä»¥å¤–ï¼Œçº¿ç¨‹æ± æ¥å£æä¾›äº†å¢å¤§/å‡å°‘å·¥ä½œè€…çº¿ç¨‹ä»¥åŠå…³é—­çº¿ç¨‹æ± çš„æ–¹æ³•ã€‚ è¿™é‡Œå·¥ä½œè€…çº¿ç¨‹ä»£è¡¨ç€ä¸€ä¸ªé‡å¤æ‰§è¡ŒJobçš„çº¿ç¨‹ï¼Œè€Œæ¯ä¸ªç”±å®¢æˆ·ç«¯æäº¤çš„Jobéƒ½å°†è¿›å…¥åˆ°ä¸€ä¸ªå·¥ä½œé˜Ÿåˆ—ä¸­ç­‰å¾…å·¥ä½œè€…çº¿ç¨‹çš„å¤„ç†ã€‚ çº¿ç¨‹æ± çš„æœ¬è´¨å°±æ˜¯ä½¿ç”¨äº†ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å·¥ä½œé˜Ÿåˆ—è¿æ¥å·¥ä½œè€…çº¿ç¨‹å’Œå®¢æˆ·ç«¯çº¿ç¨‹ï¼Œå®¢æˆ·ç«¯çº¿ç¨‹å°†ä»»åŠ¡æ”¾å…¥å·¥ä½œé˜Ÿåˆ—åä¾¿è¿”å›ï¼Œè€Œå·¥ä½œè€…çº¿ç¨‹åˆ™ä¸æ–­åœ°ä»å·¥ä½œé˜Ÿåˆ—ä¸Šå–å‡ºå·¥ä½œå¹¶æ‰§è¡Œ å…¸å‹æ¡ˆä¾‹ï¼šå®ç°ä¸€ä¸ªwebæœåŠ¡å™¨ 1æºç ç•¥]]></content>
      <categories>
        <category>å­¦ä¹ ç¬”è®°</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>é«˜å¹¶å‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[2019å¹´ç»ˆæ€»ç»“]]></title>
    <url>%2F2020%2F01%2F05%2Fyear-end-summery%2F</url>
    <content type="text"><![CDATA[var ap = new APlayer({ element: document.getElementById("aplayer-qqqWfHgy"), narrow: false, autoplay: false, showlrc: false, music: { title: "Love Yourself", author: "J R Price", url: "http://music.163.com/song/media/outer/url?id=1381583209.mp3", pic: "http://p2.music.126.net/wR8cPX0w4gj179SCzUHI6A==/109951164258264118.jpg?param=130y130", lrc: "" } }); window.aplayers || (window.aplayers = []); window.aplayers.push(ap); 9102å¹´â€¦.ç„¶è€Œå·²ç»æ˜¯2020å¹´äº†ï¼Œæˆ‘è¿˜æ˜¯æ²¡æœ‰å…»æˆå‘¨è®°æœˆè®°çš„ä¹ æƒ¯ã€‚ã€‚æœ¬æ¥ä»¥ä¸ºåªä¼šæ‹–å‡ å¤©çš„åæœˆæ€»ç»“æ‹–åˆ°äº†åä¸€æœˆï¼Œåˆä»åä¸€æœˆæ‹–åˆ°äº†åäºŒæœˆâ€¦æœ€ç»ˆé¡ºåˆ©è·¨è¿‡æ–°å¹´ï¼Œä»æœˆåº¦æ€»ç»“ä¸Šå‡æˆäº†å¹´åº¦æ€»ç»“ã€‚ã€‚ã€‚çº¦å®šå¥½çš„äº‹æƒ…ä¸€å®šè¦åšåˆ°ï¼Œè¿™æ˜¯æˆ‘è¦è¯´çš„ç¬¬ä¸€ä»¶äº‹ï¼Œä¹Ÿæ˜¯2020å¹´æˆ‘çš„ç¬¬ä¸€ä¸ªFLAGã€‚ æ—¶é—´è¿‡çš„å¤ªå¿«çš„äº†ï¼Œå°½ç®¡æˆ‘æ¯å¤©éƒ½åœ¨æ„Ÿå¹æ—¶é—´çš„é£é€ï¼Œä½†è¿˜æ˜¯çœ¼ççåœ°çœ‹ç€æ—¶é—´ä¸€ç‚¹ç‚¹ä»æˆ‘æ‰‹ä¸­æµèµ°ã€‚ç¡®å®ï¼Œæˆ‘å¿ƒå¤ªå¤§äº†ï¼Œæƒ³äº†å¤ªå¤šäº‹æƒ…ä½†æ˜¯å®Œæˆçš„å´å¯¥å¯¥æ— å‡ ï¼Œä»¥ä¸º2019å¹´ä¸–ç•Œä¼šå‘ç”Ÿç¿»å¤©è¦†åœ°çš„å˜åŒ–ï¼Œä½†å®é™…ä¸Šï¼Œè‡ªå·±è¿˜æ˜¯é‚£ä¸ªè‡ªå·±ï¼Œæ²¡æœ‰ä»€ä¹ˆçªé£çŒ›è¿›çš„æˆå°±ï¼Œä¹Ÿæ²¡æœ‰è„±èƒæ¢éª¨çš„æ”¹å˜ï¼Œåªèƒ½è¯´åœ¨äººç”Ÿçš„è½¨è¿¹ä¸Šåˆå‘å‰æ»‘è¡Œäº†ä¸€å¹´ã€‚ä¼¼æ°´æµå¹´ï¼Œä¸€å¦‚æ—¢å¾€ï¼Œç›´è‡³ä»Šæ—¥æˆ‘ä¾ç„¶åœ¨ä¸ºè‡ªå·±çš„é€‰æ‹©è€ŒçŠ¹è±«ï¼Œå¹´åˆçš„è±ªè¨€å£®è¯­å¥½åƒä¹Ÿæˆä¸ºäº†è‡ªæˆ‘å¹å˜˜çš„ç©ºè¨€ï¼Œä½†æ˜¯å¹³æ·¡å½’å¹³æ·¡ï¼Œå¯¹æˆ‘è€Œè¨€ã€‚ä¾ç„¶æ˜¯æå…¶é‡è¦å’Œå……æ»¡æ„ä¹‰çš„ä¸€å¹´ã€‚ 2019ã®ç”Ÿæ´»å¹´åˆ,æˆ‘ä¸Šå¤§äºŒä¸‹ï¼Œå¯’å‡è¿˜åœ¨ICTè¿›è¡Œå­¦ä¹ ï¼Œå½“æ—¶çš„æˆ‘åˆšåˆšä»ç»„ç»‡éƒ¨ç¦»èŒä¸­è§£è„±å‡ºæ¥ï¼Œç»å†äº†ä¸€ç³»åˆ—çš„å¿ƒç†é—®é¢˜ï¼Œæœ€ç»ˆè¿˜æ˜¯å­¦ä¼šäº†å‹‡æ•¢é¢å¯¹ï¼Œå¹¶å†³å®šè¦å¾€æŠ€æœ¯æ–¹å‘å‘å±•ï¼ˆå°½ç®¡é‚£ä¸ªæ—¶å€™å¯¹åˆ°åº•èµ°ä»€ä¹ˆæŠ€æœ¯è¿˜æ˜¯æ²¡æœ‰å¾ˆæ˜ç¡®çš„æ¦‚å¿µï¼‰ â€‹ å››æœˆï¼Œç¬¬äºŒæ¬¡å‚åŠ æ ¡è¿ä¼šï¼Œè¿™æ¬¡çš„çŠ¶æ€å¤§ä¸å¦‚å‰ï¼Œå®Œå…¨æ²¡æœ‰äº†å¤§ä¸€æ—¶å€™çš„æ–—å¿—ï¼Œæ— è®ºä»å¢é‡åæ–¤çš„èº«ä½“è¿˜æ˜¯ä»æŠ—æ‹’è·‘æ­¥çš„å¿ƒæ€éƒ½å·²ç»æ˜¾ç¤ºäº†è‡ªå·±å¯¹æ±‚èƒœæ¬²æœ›çš„è¡°é€€ï¼Œæœ€åçš„ç»“æœå¯æƒ³è€ŒçŸ¥ï¼Œè‡ªå·±åœ¨æˆç»©ä¸Šå¤§å¹…é€€æ­¥ï¼Œæˆ‘ä»¬å­¦é™¢ä¹Ÿæ˜¯ä¸ƒå¹´æ¥ç¬¬ä¸€æ¬¡æ²¡æœ‰æ‹¿åˆ°ç¬¬ä¸€ã€‚ æœ€åè¿˜æ˜¯å’Œå¤§ä¸€æœŸæœ›çš„ä¸€æ ·å‚åŠ äº†å¸‚çº§çš„å¤§å­¦ç”Ÿè¿åŠ¨ä¼šï¼Œä½†æ˜¯æ„æ–™ä¹‹ä¸­æ²¡æœ‰å–å¾—åæ¬¡ï¼Œä¸€æ¥æ˜¯è‡ªå·±çš„èº«ä½“ç´ è´¨ç¡®å®ä¸æ¯”å¤§ä¸€çš„æ—¶å€™ï¼ŒäºŒæ¥æ˜¯è‡ªå·±æŠ—æ‹’è·‘æ­¥çš„æƒ…ç»ªåœ¨è®­ç»ƒä¸­å¾—åˆ°äº†æœ€å¤§çš„é‡Šæ”¾ï¼Œè®­ç»ƒèƒ½ä¸å»å°±ä¸å»ï¼Œå°±ç®—å»äº†ä¹Ÿæ²¡æœ‰å¾ˆè®¤çœŸçš„è®­ç»ƒï¼Œå› æ­¤æˆç»©å§‹ç»ˆæ²¡æœ‰å¾—åˆ°æé«˜ã€‚å¤§è¿ä¼šä¹Ÿæ˜¯æˆ‘ç›®å‰ä¸ºæ­¢è¿åŠ¨çš„é¡¶ç‚¹ï¼Œä¹‹åçš„ç”Ÿæ´»è™½ç„¶å’Œç”°å¾„é˜Ÿä¾ç„¶æœ‰äº¤é›†ï¼Œä½†æ˜¯è‡ªå·±çš„è®­ç»ƒé‡è¿˜æ˜¯å› ä¸ºè‡ªå·±çš„å­¦ä¹ é‡å¿ƒå’Œç›®æ ‡çš„è®¾å®šæ…¢æ…¢ä¸‹é™ï¼Œ2020å¹´çš„å¤§è¿ä¼šå¤§æ¦‚ç‡å°±ä¸ä¼šå»äº†ï¼Œæ‰€ä»¥ï¼Œæœ€åçš„è¾‰ç…Œï¼Œä¾ç„¶å€¼å¾—çºªå¿µã€‚ï¼ˆå¹³å¸¸ä¾ç„¶è¦é”»ç‚¼å•Šå–‚ï¼ï¼ï¼‰ äº”æœˆåŠ³åŠ¨èŠ‚å‡æœŸï¼Œçˆ¶æ¯è‡ªä»æŠŠæˆ‘é€åˆ°é‡åº†åç¬¬ä¸€æ¬¡æ¥çœ‹æˆ‘ï¼Œè¿™ä¸€æ¬¡ï¼Œæˆ‘åšäº†å……è¶³çš„è®¡åˆ’ï¼Œè™½ç„¶æœ€åå¾ˆå¤šå®‰æ’è¿˜æ˜¯æ²¡æœ‰å®ç°ï¼Œä½†æ€»ä½“è¿˜æ˜¯è¿‡çš„éå¸¸å¼€å¿ƒã€‚ å¤§å­¦å®¤å‹ï¼Œä¸€è¾ˆå­éƒ½ä¸ä¼šå¿˜è®°çš„æœ‹å‹ã€‚å°½ç®¡æœ‰çš„æ—¶å€™è¿˜æ˜¯ä¼šå«‰å¦’ä»–ä»¬çš„æ‰èƒ½ï¼Œä½†æ­£æ˜¯è¿™ç§â€å¦’å¿Œå¿ƒâ€ç£ä¿ƒç€æˆ‘è¿½èµ¶ä»–ä»¬çš„è„šæ­¥ æš‘å‡åˆšå›æ¥ï¼Œæˆä¸ºäº†ç­å­¦é•¿ï¼Œå¤§å­¦é‡ŒäºŒåº¦ä½“ä¼šåˆ°åˆå…¥å¤§å­¦çš„é’æ¶©æ—¶å…‰ã€‚ è®°å½•ä¸€æ¬¡5Gè¿›æ ¡å›­ï¼Œå®£ä¼ å™±å¤´å¤§äºå®é™…æ•ˆæœã€‚ å¤§ä¸‰ä¸Šæ‰ä½“ä¼šåˆ°äº†ç”µå½±è¿›æ ¡å›­çš„â€œå¤§å­¦ç”Ÿå¾…é‡â€ï¼Œçœ‹äº†ç½—å°é»‘ ICTæˆ˜é˜Ÿä¸¾åŠäº†ä¸€æ¬¡è¿‘ä¹æˆåŠŸçš„æ‹›æ–°ä¼šï¼Œä»æ­¤ä»å­¦å‘˜è§’åº¦çœ‹é—®é¢˜ä¸Šå‡åˆ°äº†ç®¡ç†è€…è§’åº¦çœ‹é—®é¢˜ï¼Œå…¶ä¸­ç»™æˆ‘æœ€å¤§å¯ç¤ºçš„æ˜¯é’æ¾ï¼Œä½œä¸ºæˆ‘ä»¬ä¹‹ä¸­çš„æ ¸å¿ƒï¼Œå‡èšäº†æˆ‘ä»¬ç®¡ç†å›¢é˜Ÿï¼ŒåŒæ—¶åœ¨èƒ½åŠ›ä¸Šåšäº†è¡¨ç‡ï¼Œå¹³æ—¶çœ‹ä»–ä¸“æ³¨å­¦ä¹ ï¼Œè¿˜ä»¥ä¸ºä»–ä¼šä¸é—»çª—å¤–äº‹ï¼Œäº‹å®ä¸Šï¼Œä»–çŸ¥é“çš„ï¼Œäº†è§£çš„ï¼Œè®¤è¯†çš„æ¯”æˆ‘ä»¬ä¹‹ä¸­ä»»ä½•äººéƒ½å¹¿æ³›ï¼Œæ·±åˆ»ã€‚è¿™æ˜¯æˆ‘æ‰€è¦å­¦ä¹ çš„ä¸œè¥¿ 225ä¸€æ¬¡ä»»æ€§çš„å‡ºè¡Œï¼Œä½“éªŒäº†æˆ‘2019æœ€å®Œç¾çš„ä¸€å¤©ï¼ˆæˆ–åŠå¤©ï¼‰ ictç®¡ç†ç»„å›¢å»º ç¬¬ä¸€æ¬¡å‚åŠ å¼‚åœ°æ¯”èµ›ï¼Œè™½ç„¶å¥–å°æ¯”èµ›è§„æ¨¡å°ï¼Œä½†æ˜¯è¿˜æ˜¯å¾ˆæœ‰æ„ä¹‰ï¼ˆå½¢å¼å¤§äºå†…å®¹ï¼‰ ç¬¬ä¸€æ¬¡å‚åŠ å¤§å‚å®£è®²ä¼šï¼Œé—æ†¾æ²¡æœ‰ä½“éªŒå¤§å‚ç¬”è¯•é¢˜ï¼Œè™½ç„¶æˆ‘ä¸€ç›´æƒ³è¡¨ç¤ºè‡ªå·±å¯¹è¿™äº›çš„æ¼ è§†ï¼Œä½†å†…å¿ƒæ·±å¤„è¿˜æ˜¯éå¸¸æ¸´æœ›ï¼ˆå°½ç®¡çŸ¥é“è‡ªå·±å°±ç®—æ‹¥æœ‰è¿™æ¬¡æœºä¼šï¼Œå‡­ç°åœ¨çš„èƒ½åŠ›ä¾ç„¶æ— æ³•åº”è¯•ï¼‰æ‰€ä»¥ï¼ŒåŠ æ²¹å§ï¼ï¼ æ­¤å¤–è¿˜æœ‰å°±ä¸šä¸­å¿ƒåŠ©ç†å›¢ï¼ŒåŒ†åŒ†èµ°æ¥åˆåŒ†åŒ†ç¦»å»ï¼Œæ˜¯å¯¹è‡ªå·±é€‰æ‹©ä¸æ…é‡çš„å›åº”ï¼Œå¥½åœ¨ç®—æ˜¯å’Œå¹³åˆ†æ‰‹ï¼Œæ²¡æœ‰ç»™åŒæ–¹å¸¦æ¥æ›´å¤§çš„é—æ†¾ã€‚ 2019ã®å­¦ä¹ å¤§äºŒä¸‹ä¾ç„¶åœ¨çº¢å²©åšé¡¹ç›®ï¼Œä½†æ˜¯å´å› ä¸ºè‡ªå·±æ„å¿—ä¸åšå®šå¯¼è‡´å·¥ä½œçš„æŠ•å…¥ä¸å¤Ÿã€‚å½“æ—¶çš„æˆ‘è¿·èŒ«äºè‡ªå·±çš„æœªæ¥æ–¹å‘ï¼Œè‡ªå‘äºè‡ªå·±çš„é€»è¾‘èƒ½åŠ›ä¸è¶³ä»è€Œå¼€å§‹æŠ—æ‹’æ·±å…¥å­¦ä¹ è®¡ç®—æœºèƒ½åŠ›ï¼Œä¸€ä¸ªé¢†å¥–å·¥å…·ï¼Œä¸€ä¸ªå•¦å•¦é˜ŸæŠ•ç¥¨éƒ½æ²¡æœ‰å¾—åˆ°å®Œç¾ç¨³å®šå®ç°ã€‚ æš‘å‡åŒ…æ‹¬å¤§ä¸‰å‰åŠæ®µå…¨èº«å¿ƒæŠ•å…¥ICTå­¦ä¹ ï¼Œä½†æ˜¯å­¦ä¹ çš„è¿›åº¦ä¾ç„¶ä¸è¾¾æ ‡ï¼Œä¸€æ¥æ˜¯è‡ªå·±çš„æ€åº¦æœ‰ç‚¹æ¾æ‡ˆï¼Œå¯¼è‡´å­¦ä¹ çš„è¿›åº¦æ”¾ç¼“ï¼Œå¦å¤–åˆ™æ˜¯å­¦ä¹ çš„æ–¹æ³•ä¸Šï¼Œæ­»é’»ä¸€ç‚¹ä¸æ‡‚å˜é€šå¯¼è‡´æ—¶é—´å¤§æŠŠæµªè´¹ã€‚æœ€åä¸€ä¸ªæš‘å‡çš„æœ€å¤§æˆæœå°±æ˜¯è€ƒè¿‡äº†ä¸€ä¸ªHCNP ä»€ä¹ˆæ—¶å€™å¼€å§‹å†³å®šæƒ³èµ°å¼€å‘æ–¹å‘çš„?å¤§æ¦‚æ˜¯åŠ å…¥å†·åˆƒçš„æ—¶å€™ï¼Œé‚£ä¸ªæ—¶å€™å…¶å®å·²ç»æœ‰äº†ç›¸å…³çš„å¿µå¤´ï¼Œä½†æ˜¯å†³å¿ƒä¸å¤Ÿï¼Œç›´åˆ°å†·åˆƒçš„åˆ›å§‹äººå•¸å‡¡å­¦é•¿ç”»äº†â€œå¤§é¥¼â€æ‰è®©æˆ‘æœ€åä¸‹å®šå†³å¿ƒã€‚ä»€ä¹ˆæ˜¯æœ€å®Œç¾çš„å¤§é¥¼ï¼Ÿå°±æ˜¯åˆ«äººçŸ¥é“è¿™ä¸ªæ˜¯å¤§é¥¼è¿˜åƒå¾—æ´¥æ´¥æœ‰å‘³ï¼Œè¿™å¤§æ¦‚å°±æ˜¯è¥é”€çš„æœ€é«˜å¢ƒç•Œäº†å§ï¼Œä¸å¾—ä¸è¯´è¿™æ¬¡æˆ‘æ˜¯çœŸçš„ä¸Šå¤´äº†ã€‚ ä½†æ˜¯å°½ç®¡åˆ°2019ç»“æŸï¼Œæˆ‘åœ¨è¿™æ–¹é¢æ‰€åšçš„åŠªåŠ›ä¾ç„¶æœ‰é™ï¼Œè™½ç„¶ä¸€ç›´ä»¥è‡ªå·±è¯¾å¤šï¼Œå†…å®¹éš¾åšå€Ÿå£ï¼Œä½†æ˜¯è‡ªå·±æ¸…æ¥šï¼Œå…¶å®è¿˜æ˜¯æœ‰å¾ˆå¤šé›¶æ•£æ—¶é—´å¯ä»¥åˆ©ç”¨èµ·æ¥å­¦ä¹ ã€‚ã€‚ã€‚ä¸ç®¡æ€æ ·ï¼Œç°åœ¨æ‰€æœ‰é˜»ç¢å·²ç»å‡ ä¹æ¶ˆå¤±äº†ï¼Œä½ æ²¡æœ‰ç†ç”±äº†å§ï¼Ÿ æ€»ç»“2019æœ‰å¾ˆå¤šéš¾å¿˜çš„ç»å†ï¼Œä½†æ˜¯æ›´å¤šæš´éœ²çš„æ˜¯å¿ƒæ€ï¼Œé€‰æ‹©ä¸Šçš„ç¼ºç‚¹ï¼Œè‡´ä½¿åœ¨è¿™å…³é”®çš„ä¸€å¹´é‡Œä»ç„¶é—æ†¾å¤šå¤šï¼Œä½†æˆ‘ä¸å¸Œæ±‚å‘½è¿ï¼Œä¸€åˆ‡é è‡ªå·±äº‰å–ã€‚åªè¦ä½ æ‹¼äº†ï¼Œæœºä¼šå°±ä¼šå‡ºç°ã€‚]]></content>
      <categories>
        <category>ä¸€å¦‚æ—¢å¾€ï¼Œåªæ˜¯æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>æ€»ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå†…å­˜æ¨¡å‹]]></title>
    <url>%2F2019%2F12%2F29%2Fconcurrent3%2F</url>
    <content type="text"><![CDATA[ã€Šå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹é˜…è¯»ç¬”è®°ç¬¬ä¸‰ç« ,å…ˆä»åº•å±‚è®²èµ·ã€‚ åŸºç¡€ä¸ç‰¢ï¼Œåœ°åŠ¨å±±æ‘‡ã€‚ ä¸€ã€åŸºç¡€1ã€å¹¶å‘çš„ä¸¤ä¸ªå…³é”®é—®é¢˜çº¿ç¨‹é—´é€šä¿¡å’Œçº¿ç¨‹é—´åŒæ­¥ çº¿ç¨‹é€šä¿¡æœºåˆ¶ï¼š ==å…±äº«å†…å­˜==ï¼šéšå¼é€šä¿¡ï¼Œæ˜¾å¼åŒæ­¥ ==æ¶ˆæ¯ä¼ é€’==ï¼šæ˜¾å¼é€šä¿¡ï¼Œéšå¼åŒæ­¥ Javaçš„å¹¶å‘é‡‡ç”¨çš„æ˜¯å…±äº«å†…å­˜æ¨¡å‹ã€‚ 2ã€javaå†…å­˜ç»“æ„ javaä¸­æ‰€æœ‰çš„å®ä¾‹åŸŸã€é™æ€åŸŸå’Œæ•°ç»„å…ƒç´ éƒ½å­˜å‚¨åœ¨å †å†…å­˜ä¸­ï¼›å±€éƒ¨å˜é‡ã€æ–¹æ³•å®šä¹‰å‚æ•°ã€å¼‚å¸¸å¤„ç†å™¨å‚æ•°ä¸ä¼šåœ¨çº¿ç¨‹ä¹‹é—´å…±äº« JMMå®šä¹‰äº†çº¿ç¨‹å’Œä¸»å†…å­˜ä¹‹é—´çš„æŠ½è±¡å…³ç³»ï¼šçº¿ç¨‹ä¹‹é—´çš„å…±äº«å˜é‡å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç§æœ‰çš„æœ¬åœ°å†…å­˜ï¼Œæœ¬åœ°å†…å­˜ä¸­å­˜å‚¨äº†è¯¥çº¿ç¨‹è¯»/å†™å…±äº«å˜é‡çš„å‰¯æœ¬ã€‚ æœ¬åœ°å†…å­˜æ˜¯JMMçš„ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå¹¶ä¸çœŸå®å­˜åœ¨ï¼Œæ¶µç›–äº†ç¼“å­˜ã€å†™ç¼“å†²åŒºã€å¯„å­˜å™¨ä»¥åŠå…¶ä»–çš„ç¡¬ä»¶å’Œç¼–è¯‘å™¨ä¼˜åŒ– çº¿ç¨‹Aä¸çº¿ç¨‹Bä¹‹é—´è¦é€šä¿¡å¿…é¡»ç»è¿‡ä¸¤ä¸ªæ­¥éª¤ï¼š çº¿ç¨‹AæŠŠæœ¬åœ°å†…å­˜Aä¸­æ›´æ–°è¿‡çš„å…±äº«å˜é‡åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­å» çº¿ç¨‹Båˆ°ä¸»å†…å­˜ä¸­å»è¯»å–Aä¹‹å‰å·²æ›´æ–°è¿‡çš„å…±äº«å˜é‡ JMMé€šè¿‡æ§åˆ¶ä¸»å†…å­˜ä¸æ¯ä¸ªçº¿ç¨‹çš„æœ¬åœ°å†…å­˜ä¹‹é—´çš„äº¤äº’æ¥ä¸ºjavaç¨‹åºå‘˜æä¾›å†…å­˜å¯è§æ€§ä¿è¯ 3ã€æŒ‡ä»¤é‡æ’åº ç¼–è¯‘å™¨ä¼˜åŒ–çš„é‡æ’åºã€‚ç¼–è¯‘å™¨åœ¨ä¸æ”¹å˜å•çº¿ç¨‹ç¨‹åºè¯­ä¹‰çš„å‰æä¸‹ï¼Œå¯ä»¥é‡æ–°å®‰æ’è¯­å¥çš„æ‰§è¡Œé¡ºåºã€‚ æŒ‡ä»¤çº§å¹¶è¡Œçš„é‡æ’åºã€‚ç°ä»£å¤„ç†å™¨é‡‡ç”¨äº†æŒ‡ä»¤çº§å¹¶è¡ŒæŠ€æœ¯ï¼ˆInstruction-Level Parallelismï¼ŒILPï¼‰æ¥å°†å¤šæ¡æŒ‡ä»¤é‡å æ‰§è¡Œã€‚å¦‚æœä¸å­˜åœ¨æ•°æ®ä¾èµ–æ€§ï¼Œå¤„ç†å™¨å¯ä»¥æ”¹å˜è¯­å¥å¯¹åº”æœºå™¨æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºã€‚ å†…å­˜ç³»ç»Ÿçš„é‡æ’åºã€‚ç”±äºå¤„ç†å™¨ä½¿ç”¨ç¼“å­˜å’Œè¯»/å†™ç¼“å†²åŒºï¼Œè¿™ä½¿å¾—åŠ è½½å’Œå­˜å‚¨æ“ä½œçœ‹ä¸Šå»å¯èƒ½æ˜¯åœ¨ä¹±åºæ‰§è¡Œã€‚ javaæœ€ç»ˆæ‰§è¡Œçš„æŒ‡ä»¤åºåˆ—: æºç â€”â€”â€“ã€‹ç¼–è¯‘å™¨ä¼˜åŒ–é‡æ’åºâ€”â€”-ã€‹æŒ‡ä»¤çº§å¹¶è¡Œé‡æ’åºâ€”â€”â€”-ã€‹å†…å­˜ç³»ç»Ÿé‡æ’åºâ€”â€”â€”ã€‹æœ€ç»ˆçš„æŒ‡ä»¤åºåˆ— ç¬¬ä¸€ä¸ªå±äº==ç¼–è¯‘å™¨é‡æ’åº==ï¼Œåé¢ä¸¤ä¸ªå±äº==å¤„ç†å™¨çš„é‡æ’åº==,JMMé€šè¿‡ç¦æ­¢ç‰¹å®šç±»å‹çš„ç¼–è¯‘å™¨é‡æ’åºå’Œå¤„ç†å™¨é‡æ’åºï¼Œä¸ºç¨‹åºå‘˜æä¾›ä¸€è‡´çš„å†…å­˜å¯è§æ€§ä¿è¯ å¯¹äºç¼–è¯‘å™¨ï¼ŒJMMçš„ç¼–è¯‘å™¨ä¼šç¦æ­¢ç‰¹å®šç±»å‹çš„ç¼–è¯‘å™¨é‡æ’åºã€‚==å¯¹äºå¤„ç†å™¨é‡æ’åºï¼ŒJMMçš„å¤„ç†å™¨é‡æ’åºè§„åˆ™ä¼šè¦æ±‚Javaç¼–è¯‘å™¨åœ¨ç”ŸæˆæŒ‡ä»¤åºåˆ—æ—¶ï¼Œæ’å…¥ç‰¹å®šçš„å†…å­˜å±éšœæŒ‡ä»¤==ï¼Œä»è€Œç¦æ­¢ç‰¹å®šç±»å‹çš„å¤„ç†å™¨é‡æ’åºã€‚ 4ã€å†…å­˜å±éšœåˆ†ç±»loadï¼šè¯»ç¼“å†²åŒº storeï¼šå†™ç¼“å†²åŒº å››ç§å†…å­˜å±éšœï¼š LoadLoad Barriersï¼šç¡®ä¿load1çš„æ•°æ®å…ˆäºlaod2åŠåç»­æ‰€æœ‰loadæŒ‡ä»¤è¿›è¡Œè£…è½½ StoreStore Barriersï¼šç¡®ä¿store1çš„æ•°æ®å¯¹å…¶ä»–å¤„ç†å™¨çš„å¯è§æ€§å…ˆäºstore2åŠåç»­æ‰€æœ‰å­˜å‚¨æŒ‡ä»¤ LoadStore Barriersï¼šç¡®ä¿loadè£…è½½å…ˆäºstoreçš„å­˜å‚¨åˆ·æ–°åˆ°å†…å­˜ StoreLoad Barriersï¼šè¯¥å±éšœå‰çš„æŒ‡ä»¤å…¨éƒ¨å®Œæˆä¹‹åæ‰ä¼šæ‰§è¡Œåé¢çš„æŒ‡ä»¤ï¼ˆå¼€é”€å¤§ï¼‰ 5ã€å…ˆè¡Œå‘ç”Ÿï¼ˆhappens-beforeï¼‰1ç¨‹åºå‘˜å¿…é¡»éµå¾ªçš„ç¼–ç¨‹åŸåˆ™ ==JMMä¸­ï¼Œå¦‚æœä¸€ä¸ªæ“ä½œæ‰§è¡Œçš„ç»“æœéœ€è¦å¯¹å¦ä¸€ä¸ªæ“ä½œå¯è§ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´å¿…é¡»å­˜åœ¨happens-beforeå…³ç³»ã€‚== å…¶ä¸­ä¸€äº›é¡ºåºè§„åˆ™ï¼ˆé’ˆå¯¹ç¨‹åºå‘˜ï¼‰ï¼š ç¨‹åºé¡ºåºè§„åˆ™ï¼šä¸€ä¸ªçº¿ç¨‹ä¸­çš„æ¯ä¸ªæ“ä½œï¼Œhappens-beforeäºè¯¥çº¿ç¨‹ä¸­çš„ä»»æ„åç»­æ“ä½œ ç›‘è§†å™¨é”è§„åˆ™ï¼šå¯¹ä¸€ä¸ªé”çš„è§£é”ï¼Œhappens-beforeäºéšåå¯¹è¿™ä¸ªé”çš„åŠ é”ã€‚ volatileå˜é‡è§„åˆ™ï¼šå¯¹ä¸€ä¸ªvolatileåŸŸçš„å†™ï¼Œhappens-beforeäºä»»æ„åç»­å¯¹è¿™ä¸ªvolatileåŸŸçš„è¯»ã€‚ ä¼ é€’æ€§ï¼šå¦‚æœA happens-before Bï¼Œä¸”B happens-before Cï¼Œé‚£ä¹ˆA happens-before Cã€‚ happens-beforeä»…ä»…è¦æ±‚å‰ä¸€ä¸ªæ“ä½œï¼ˆæ‰§è¡Œçš„ç»“æœï¼‰å¯¹åä¸€ä¸ªæ“ä½œå¯è§ï¼Œä¸”å‰ä¸€ä¸ªæ“ä½œæŒ‰é¡ºåºæ’åœ¨ç¬¬äºŒä¸ªæ“ä½œä¹‹å‰ï¼Œï¼Œå¹¶ä¸æ„å‘³ç€å‰ä¸€ä¸ªæ“ä½œå¿…é¡»è¦åœ¨åä¸€ä¸ªæ“ä½œä¹‹å‰æ‰§è¡Œï¼ 123å‰ä¸€ä¸ªè¦æ±‚å¯¹åä¸€ä¸ªæ“çºµå¯è§ä¸æ˜¯æ„å‘³ç€å‰ä¸€ä¸ªæ“ä½œå¿…é¡»åœ¨åä¸€ä¸ªæ“ä½œä¹‹å‰æ‰§è¡Œï¼ŸJMMè¦æ±‚å¦‚æœA happens-before Bé‚£ä¹ˆé¦–å…ˆå¿…é¡»ä¿è¯æ‰§è¡Œç»“æœï¼ˆAçš„æ‰§è¡Œç»“æœå¯¹B **ä¸ä¸€å®šå¯è§** ï¼‰å¿…é¡»å’Œé€»è¾‘ä¸­çš„happens-beforeç›¸åŒï¼Œå…¶æ¬¡ï¼ŒAçš„æ’åºé¡ºåºåœ¨Bä¹‹å‰ï¼ˆè¿™é‡Œæ˜¯æŒ‡é‡æ’åºä¹‹å‰çš„é¡ºåºï¼ŒåæœŸå…è®¸é€šè¿‡é‡æ’åºè°ƒæ•´Aå’ŒBçš„æ“ä½œé¡ºåºï¼‰ï¼Œä½†æ˜¯æœ€ç»ˆç»“æœå¿…é¡»å’Œé€»è¾‘ä¸Šçš„ä¿æŒä¸€è‡´ï¼Œå› æ­¤ä»è¡¨é¢ä¸Šçœ‹æ˜¯æŒ‰åºæ‰§è¡Œäº† äºŒã€é‡æ’åºæ•°æ®ä¾èµ–æ€§ åœ¨å•çº¿ç¨‹ç¨‹åºä¸­ï¼Œå¯¹å­˜åœ¨æ§åˆ¶ä¾èµ–çš„æ“ä½œé‡æ’åºä¸ä¼šæ”¹å˜æ‰§è¡Œç»“æœï¼›ä½†åœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­ï¼Œå¯¹å­˜åœ¨æ§åˆ¶ä¾èµ–çš„æ“ä½œé‡æ’åºï¼Œå¯èƒ½ä¼šæ”¹å˜ç¨‹åºçš„æ‰§è¡Œç»“æœã€‚ è¯¦è§30é¡µçš„ä¾‹å­as-if-serial ä¸ç®¡æ€ä¹ˆé‡æ’åºï¼ˆç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ºäº†æé«˜å¹¶è¡Œåº¦ï¼‰ï¼Œï¼ˆå•çº¿ç¨‹ï¼‰ç¨‹åºçš„æ‰§è¡Œç»“æœä¸èƒ½è¢«æ”¹å˜ã€‚ç¼–è¯‘å™¨ã€runtimeå’Œå¤„ç†å™¨éƒ½å¿…é¡»éµå®ˆas-if-serialè¯­ä¹‰ ä¸‰ã€é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹ å¦‚æœç¨‹åºæ˜¯æ­£ç¡®åŒæ­¥çš„ï¼Œç¨‹åºçš„æ‰§è¡Œå°†å…·æœ‰é¡ºåºä¸€è‡´æ€§ï¼ˆSequentially Consistentï¼‰â€”â€”å³ç¨‹åºçš„æ‰§è¡Œç»“æœä¸è¯¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹ä¸­çš„æ‰§è¡Œç»“æœç›¸åŒ ä¸€ä¸ªçº¿ç¨‹ä¸­çš„æ‰€æœ‰æ“ä½œå¿…é¡»æŒ‰ç…§ç¨‹åºçš„é¡ºåºæ¥æ‰§è¡Œã€‚ ï¼ˆä¸ç®¡ç¨‹åºæ˜¯å¦åŒæ­¥ï¼‰æ‰€æœ‰çº¿ç¨‹éƒ½åªèƒ½çœ‹åˆ°ä¸€ä¸ªå•ä¸€çš„æ“ä½œæ‰§è¡Œé¡ºåºã€‚åœ¨é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹ä¸­ï¼Œæ¯ä¸ªæ“ä½œéƒ½å¿…é¡»åŸå­æ‰§è¡Œä¸”ç«‹åˆ»å¯¹æ‰€æœ‰çº¿ç¨‹å¯è§ã€‚ æœªåŒæ­¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¸­ç»™è™½ç„¶æ•´ä½“æ‰§è¡Œé¡ºåºæ˜¯æ— åºçš„ä½†æ˜¯æ‰€æœ‰çº¿ç¨‹éƒ½åªèƒ½çœ‹è§ä¸€ä¸ªä¸€è‡´çš„çš„æ•´ä½“æ‰§è¡Œé¡ºåºã€‚ä¹‹æ‰€ä»¥èƒ½å¾—åˆ°è¿™ä¸ªä¿è¯æ˜¯å› ä¸ºé¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹ä¸­çš„æ¯ä¸ªæ“ä½œå¿…é¡»ç«‹å³å¯¹ä»»æ„çº¿ç¨‹å¯è§ JMMå°±æ²¡æœ‰è¿™ä¸ªä¿è¯ã€‚å› ä¸ºåªæœ‰å½“å‰çº¿ç¨‹æŠŠæœ¬åœ°å†…å­˜ä¸­å†™è¿‡çš„æ•°æ®åˆ·æ–°åˆ°ä¸»å†…å­˜ä¹‹åï¼Œè¿™ä¸ªå†™æ“ä½œæ‰èƒ½å¯¹å…¶ä»–çº¿ç¨‹å¯è§ã€‚ JMMçš„å¤„ç†é€»è¾‘ï¼šä¸´ç•ŒåŒºå†…çš„ä»£ç å¯ä»¥é‡æ’åºï¼›JMMä¼šåœ¨é€€å‡ºä¸´ç•ŒåŒºå’Œè¿›å…¥ä¸´ç•ŒåŒºè¿™ä¸¤ä¸ªå…³é”®æ—¶é—´ç‚¹åšä¸€äº›ç‰¹åˆ«å¤„ç†ï¼Œä½¿å¾—çº¿ç¨‹åœ¨è¿™ä¸¤ä¸ªæ—¶é—´ç‚¹å…·æœ‰ä¸é¡ºåºä¸€è‡´æ€§æ¨¡å‹ç›¸åŒçš„å†…å­˜è§†å›¾ JMMçš„å…·ä½“å®ç°çš„åŸºæœ¬æ–¹é’ˆï¼šåœ¨ä¸æ”¹å˜ï¼ˆæ­£ç¡®åŒæ­¥çš„ï¼‰ç¨‹åºæ‰§è¡Œç»“æœçš„å‰æä¸‹ï¼Œå°½å¯èƒ½åœ°ä¸ºç¼–è¯‘å™¨å’Œå¤„ç†å™¨çš„ä¼˜åŒ–æ‰“å¼€æ–¹ä¾¿ä¹‹é—¨ é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹å’ŒJMMåŒºåˆ« é¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¿è¯å•çº¿ç¨‹å†…çš„æ“ä½œä¼šæŒ‰ç¨‹åºçš„é¡ºåºæ‰§è¡Œï¼Œè€ŒJMMä¸ä¿è¯å•çº¿ç¨‹å†…çš„æ“ä½œä¼šæŒ‰ç¨‹åºçš„é¡ºåºæ‰§è¡Œï¼ˆæ¯”å¦‚ä¸Šé¢æ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºåœ¨ä¸´ç•ŒåŒºå†…çš„é‡æ’åºï¼‰ã€‚è¿™ä¸€ç‚¹å‰é¢å·²ç»è®²è¿‡äº†ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ã€‚ é¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¿è¯æ‰€æœ‰çº¿ç¨‹åªèƒ½çœ‹åˆ°ä¸€è‡´çš„æ“ä½œæ‰§è¡Œé¡ºåºï¼Œè€ŒJMMä¸ä¿è¯æ‰€æœ‰çº¿ç¨‹èƒ½çœ‹åˆ°ä¸€è‡´çš„æ“ä½œæ‰§è¡Œé¡ºåºã€‚è¿™ä¸€ç‚¹å‰é¢ä¹Ÿå·²ç»è®²è¿‡ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ã€‚ ==JMMä¸ä¿è¯å¯¹64ä½çš„longå‹å’Œdoubleå‹å˜é‡çš„å†™æ“ä½œå…·æœ‰åŸå­æ€§ï¼Œè€Œé¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¿è¯å¯¹æ‰€æœ‰çš„å†…å­˜è¯»/å†™æ“ä½œéƒ½å…·æœ‰åŸå­æ€§ã€‚== å¤„ç†å™¨æ€»çº¿å·¥ä½œæœºåˆ¶ åœ¨è®¡ç®—æœºä¸­ï¼Œæ•°æ®é€šè¿‡æ€»çº¿åœ¨å¤„ç†å™¨å’Œå†…å­˜ä¹‹é—´ä¼ é€’ã€‚æ¯æ¬¡å¤„ç†å™¨å’Œå†…å­˜ä¹‹é—´çš„æ•°æ®ä¼ é€’éƒ½æ˜¯é€šè¿‡ä¸€ç³»åˆ—æ­¥éª¤æ¥å®Œæˆçš„ æ€»çº¿äº‹åŠ¡åŒ…æ‹¬è¯»äº‹åŠ¡ï¼ˆRead Transactionï¼‰å’Œå†™äº‹åŠ¡ï¼ˆWrite Transactionï¼‰ã€‚è¯»äº‹åŠ¡ä»å†…å­˜ä¼ é€æ•°æ®åˆ°å¤„ç†å™¨ï¼Œå†™äº‹åŠ¡ä»å¤„ç†å™¨ä¼ é€æ•°æ®åˆ°å†…å­˜ï¼Œæ¯ä¸ªäº‹åŠ¡ä¼šè¯»/å†™å†…å­˜ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªç‰©ç†ä¸Šè¿ç»­çš„å­— æ€»çº¿ä¼šåŒæ­¥è¯•å›¾å¹¶å‘ä½¿ç”¨æ€»çº¿çš„äº‹åŠ¡ã€‚åœ¨ä¸€ä¸ªå¤„ç†å™¨æ‰§è¡Œæ€»çº¿äº‹åŠ¡æœŸé—´ï¼Œæ€»çº¿ä¼šç¦æ­¢å…¶ä»–çš„å¤„ç†å™¨å’ŒI/Oè®¾å¤‡æ‰§è¡Œå†…å­˜çš„è¯»/å†™ (ä»è€Œä¿è¯å½“å•ä¸ªæ€»çº¿äº‹åŠ¡ä¹‹ä¸­çš„å†…å­˜è¯»å†™å…·æœ‰åŸå­æ€§) åœ¨ä¸€äº›32ä½çš„å¤„ç†å™¨ä¸Šï¼Œå¦‚æœè¦æ±‚å¯¹64ä½æ•°æ®çš„å†™æ“ä½œå…·æœ‰åŸå­æ€§ï¼Œä¼šæœ‰æ¯”è¾ƒå¤§çš„å¼€é”€ã€‚==å½“JVMåœ¨è¿™ç§å¤„ç†å™¨ä¸Šè¿è¡Œæ—¶ï¼Œå¯èƒ½ä¼šæŠŠä¸€ä¸ª64ä½long/doubleå‹å˜é‡çš„å†™æ“ä½œæ‹†åˆ†ä¸ºä¸¤ä¸ª32ä½çš„å†™æ“ä½œæ¥æ‰§è¡Œ== æ³¨æ„ï¼Œåœ¨JSR-133ä¹‹å‰çš„æ—§å†…å­˜æ¨¡å‹ä¸­ï¼Œä¸€ä¸ª64ä½long/doubleå‹å˜é‡çš„è¯»/å†™æ“ä½œå¯ä»¥è¢«æ‹†åˆ†ä¸ºä¸¤ä¸ª32ä½çš„è¯»/å†™æ“ä½œæ¥æ‰§è¡Œã€‚ä»JSR-133å†…å­˜æ¨¡å‹å¼€å§‹ï¼ˆå³ä»JDK5å¼€å§‹ï¼‰ï¼Œä»…ä»…åªå…è®¸æŠŠä¸€ä¸ª64ä½long/doubleå‹å˜é‡çš„å†™æ“ä½œæ‹†åˆ†ä¸ºä¸¤ä¸ª32ä½çš„å†™æ“ä½œæ¥æ‰§è¡Œï¼Œä»»æ„çš„è¯»æ“ä½œåœ¨JSR-133ä¸­éƒ½å¿…é¡»å…·æœ‰åŸå­æ€§ï¼ˆå³ä»»æ„è¯»æ“ä½œå¿…é¡»è¦åœ¨å•ä¸ªè¯»äº‹åŠ¡ä¸­æ‰§è¡Œï¼‰ã€‚ å››ã€volatileå†…å­˜è¯­ä¹‰volatileå˜é‡ç‰¹æ€§ï¼š å¯è§æ€§ï¼šå¯¹ä¸€ä¸ªvolatileå˜é‡çš„è¯»ï¼Œæ€»æ˜¯èƒ½çœ‹åˆ°ï¼ˆä»»æ„çº¿ç¨‹ï¼‰å¯¹è¿™ä¸ªå˜é‡æœ€åçš„å†™å…¥ åŸå­æ€§ï¼šå¯¹ä»»æ„å•ä¸ªvolatileå˜é‡çš„è¯»ã€å†™å…·æœ‰åŸå­æ€§ï¼ˆåŒ…æ‹¬longã€doubleï¼‰ï¼Œä½†ç±»ä¼¼volatile++ è¿™ç§å¤åˆæ“ä½œä¸å…·æœ‰åŸå­æ€§ã€‚volatileå†™-è¯»çš„å†…å­˜è¯­ä¹‰ï¼š å†™ï¼šå½“å†™ä¸€ä¸ªvolatileå˜é‡æ—¶ï¼ŒJMMä¼šæŠŠçº¿ç¨‹å¯¹åº”çš„==æœ¬åœ°å†…å­˜ä¸­çš„å…±äº«å˜é‡å€¼åˆ·æ–°åˆ°ä¸»å†…å­˜== è¯»ï¼šå½“è¯»ä¸€ä¸ªvolatileå˜é‡æ—¶ï¼ŒJMMä¼šæŠŠè¯¥çº¿ç¨‹==å¯¹åº”çš„æœ¬åœ°å†…å­˜ç½®ä¸ºæ— æ•ˆ==ã€‚çº¿ç¨‹æ¥ä¸‹æ¥ä»ä¸»å†…å­˜ä¸­è¯»å–å…±äº«å˜é‡ 123volatileè¯»çš„æ—¶å€™å¿…é¡»ä¿è¯ä¸»å†…å­˜ä¸­çš„æ•°æ®ä¸ä¼šæ›´æ”¹ï¼Œå› æ­¤volatileè¯»å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªæ“ä½œæ€ä¸èƒ½å®ç°é‡æ’åºvolatileå†™çš„æ—¶å€™å¿…é¡»ä¿è¯ä¹‹å‰çš„æ•°æ®èƒ½æ­£å¸¸å†™å…¥ä¸»å†…å­˜ï¼Œå› æ­¤volatileå†™å¦‚æœæ˜¯ç¬¬äºŒä¸ªæ“ä½œçš„è¯ä¸èƒ½å®ç°é‡æ’åºæ™®é€šè¯»å†™æ˜¯åœ¨æœ¬åœ°å†…å­˜ï¼Œä½†æ˜¯æœ‰æ¦‚ç‡ä¼šå†™å…¥ä¸»å†…å­˜ï¼Œå› æ­¤å…·æœ‰éšæœºæ€§ volatileå†…å­˜è¯­ä¹‰çš„å®ç°ä¸ºäº†å®ç°volatileçš„å†…å­˜è¯­ä¹‰ï¼Œç¼–è¯‘å™¨åœ¨ç”Ÿæˆå­—èŠ‚ç æ—¶ï¼Œä¼šåœ¨æŒ‡ä»¤åºåˆ—ä¸­æ’å…¥å†…å­˜å±éšœæ¥ç¦æ­¢ç‰¹å®šç±»å‹çš„å¤„ç†å™¨é‡æ’åºã€‚ JMMå†…å­˜å±éšœæ’å…¥ç­–ç•¥(ä¿å®ˆ!)ï¼š åœ¨æ¯ä¸ªvolatileå†™æ“ä½œå‰é¢æ’å…¥StoreStoreå±éšœ åœ¨æ¯ä¸ªvolatileå†™æ“ä½œåé¢æ’å…¥StoreLoadå±éšœ åœ¨æ¯ä¸ªvolatileè¯»æ“ä½œåé¢æ’å…¥ä¸€ä¸ªLoadLoadã€ä¸€ä¸ªLoadStore 12ä¸ºä»€ä¹ˆvolatileå†™æ“ä½œä¹‹å‰ä¸ç”¨æ’å…¥loadstoreæ¥é¿å…æ™®é€šè¯»å’Œvolatileå†™ä¹‹é—´çš„é‡æ’åºï¼ŸçŒœæµ‹ï¼šå†…å­˜å±éšœä¹‹é—´å­˜åœ¨åŒ…å«å…³ç³»ï¼Œæ¯”å¦‚storeloadå°±å¯ä»¥å®ç°å…¶ä»–ä¸‰ä¸ªæ‰€æœ‰åŠŸèƒ½ volatileå†™-è¯»å†…å­˜è¯­ä¹‰çš„å¸¸è§ä½¿ç”¨æ¨¡å¼æ˜¯ï¼šä¸€ä¸ªå†™çº¿ç¨‹å†™volatileå˜é‡ï¼Œå¤šä¸ªè¯»çº¿ç¨‹è¯»åŒä¸€ä¸ªvolatileå˜é‡ã€‚å½“è¯»çº¿ç¨‹çš„æ•°é‡å¤§å¤§è¶…è¿‡å†™çº¿ç¨‹æ—¶ï¼Œé€‰æ‹©åœ¨volatileå†™ä¹‹åæ’å…¥StoreLoadå±éšœå°†å¸¦æ¥å¯è§‚çš„æ‰§è¡Œæ•ˆç‡çš„æå‡ å®é™…æƒ…å†µç¼–è¯‘å™¨åœ¨ç”Ÿæˆå­—èŠ‚ç çš„æ—¶å€™å¯ä»¥ä¼˜åŒ–é€‰æ‹©æ˜¯å¦æ·»åŠ å†…å­˜å±éšœï¼Œä½†æ˜¯æ³¨æ„ä¸€èˆ¬æœ€åä¸€ä¸ªstorelaodä¸èƒ½çœç•¥ï¼Œå› ä¸ºæ— æ³•åˆ¤æ–­returnåæ˜¯å¦è¿˜ä¼šæœ‰ä¸‹ä¸€ä¸ªvolatileè¯»/å†™å‡ºç° ä¸åŒçš„å¤„ç†å™¨å¹³å°ä¹Ÿä¼šå¯¹å†…å­˜å±éšœåšå‡ºä¼˜åŒ– åœ¨åŠŸèƒ½ä¸Šï¼Œé”æ¯”volatileæ›´å¼ºå¤§ï¼›åœ¨å¯ä¼¸ç¼©æ€§å’Œæ‰§è¡Œæ€§èƒ½ä¸Šï¼Œvolatileæ›´æœ‰ä¼˜åŠ¿ äº”ã€é”çš„å†…å­˜è¯­ä¹‰é”çš„é‡Šæ”¾å’Œè·å–çš„å†…å­˜è¯­ä¹‰ï¼ˆå’Œvolatileä¸€æ ·ï¼‰ çº¿ç¨‹é‡Šæ”¾é”æ—¶ï¼Œä¼šæŠŠæœ¬åœ°å†…å­˜ä¸­çš„å…±äº«å˜é‡åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼ˆå¯¹åº”volatileå†™ï¼‰ çº¿ç¨‹è·å–é”æ—¶ï¼Œä¼šå°†çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ç½®ä¸ºæ— æ•ˆï¼Œä»è€Œä¸´ç•ŒåŒºä»£ç å¿…é¡»ä»ä¸»å†…å­˜è¯»å–å…±äº«å˜é‡ï¼ˆå¯¹åº”volatileè¯»ï¼‰ é”å†…å­˜è¯­ä¹‰çš„å®ç°ï¼š åˆ†æReentrantLockæºç  ReentrantLockçš„å®ç°ä¾èµ–äºJavaåŒæ­¥å™¨æ¡†æ¶AbstractQueuedSynchronizerï¼ˆæœ¬æ–‡ç®€ç§°ä¹‹ä¸ºAQSï¼‰ã€‚AQSä½¿ç”¨ä¸€ä¸ªæ•´å‹çš„volatileå˜é‡ï¼ˆå‘½åä¸ºstateï¼‰æ¥ç»´æŠ¤åŒæ­¥çŠ¶æ€ï¼Œè¿™ä¸ªvolatileå˜é‡æ˜¯ReentrantLockå†…å­˜è¯­ä¹‰å®ç°çš„å…³é”®ã€‚ ReentrantLocké”åˆ†ä¸ºå…¬å¹³é”å’Œéå…¬å¹³é” å…¬å¹³é” 1ç°åœ¨tryAcqyuireæ–¹æ³•æœ‰ç‚¹å˜åŒ–ï¼Œåœ¨æŸ¥çœ‹æ˜¯ä¸æ˜¯ç¬¬ä¸€ä¸ªè·å–é”çš„å¯¹è±¡å¤„æ·»åŠ äº†hasQueuedPredecessors()æ–¹æ³•ï¼Œä¸€ä¸ªç”¨æ¥æŸ¥è¯¢æ˜¯å¦æœ‰çº¿ç¨‹æ¯”ç°åœ¨çº¿ç¨‹ç­‰å¾…æ—¶é—´æ›´é•¿ éå…¬å¹³é”è°ƒç”¨CASï¼šå¦‚æœå½“å‰çŠ¶æ€å€¼ç­‰äºé¢„æœŸå€¼ï¼Œåˆ™ä»¥åŸå­æ–¹å¼å°†åŒæ­¥çŠ¶æ€è®¾ç½®ä¸ºç»™å®šçš„æ›´æ–°å€¼ã€‚ å…¬å¹³é”å’Œéå…¬å¹³é”è¯­ä¹‰æ€»ç»“ï¼š å…¬å¹³é”å’Œéå…¬å¹³é”é‡Šæ”¾æ—¶ï¼Œ==æœ€åéƒ½è¦å†™ä¸€ä¸ªvolatileå˜é‡state== å…¬å¹³é”è·å–æ—¶ï¼Œ==é¦–å…ˆä¼šå»è¯»volatileå˜é‡== éå…¬å¹³é”è·å–æ—¶ï¼Œé¦–å…ˆä¼š==ç”¨CASæ›´æ–°volatileå˜é‡ï¼Œè¿™ä¸ªæ“ä½œåŒæ—¶å…·æœ‰volatileè¯»å’Œvolatileå†™çš„å†…å­˜è¯­ä¹‰== å¯ä»¥çœ‹å‡ºï¼šé”é‡Šæ”¾-è·å–çš„å†…å­˜è¯­ä¹‰çš„å®ç°è‡³å°‘æœ‰ä¸‹é¢ä¸¤ç§æ–¹å¼ åˆ©ç”¨volatileå˜é‡çš„å†™-è¯»æ‰€å…·æœ‰çš„å†…å­˜è¯­ä¹‰ åˆ©ç”¨CASæ‰€é™„å¸¦çš„volatileè¯»å’Œvolatileå†™çš„å†…å­˜è¯­ä¹‰ CASæ˜¯å¦‚ä½•åŒæ—¶å…·æœ‰volatileè¯»å’Œvolatileå†™çš„å†…å­˜è¯­ä¹‰çš„ï¼Ÿ å¤šå¤„ç†å™¨ç¯å¢ƒï¼Œä¼šä¸ºcmpxchgæŒ‡ä»¤åŠ ä¸Šlockå‰ç¼€ï¼Œå•å¤„ç†å™¨ä¸ç”¨åŠ ï¼ˆå•å¤„ç†å™¨ä¼šç»´æŠ¤è‡ªèº«çš„é¡ºåºä¸€è‡´æ€§ï¼‰ åŸå…ˆä½¿ç”¨æ€»çº¿é”å®šï¼Œåæ¥è€ƒè™‘å¼€é”€ä½¿ç”¨ç¼“å­˜é”å®šï¼Œå¤§å¤§é™ä½lockå‰ç¼€æŒ‡ä»¤çš„æ‰§è¡Œå¼€é”€ lockæŒ‡ä»¤èƒ½é˜²æ­¢é‡æ’åº æŠŠå†™ç¼“å†²åŒºä¸­çš„æ‰€æœ‰æ•°æ®åˆ·æ–°åˆ°å†…å­˜ä¸­ ä¸Šé¢2ã€3ä¸¤ç‚¹å…·æœ‰çš„å†…å­˜å±éšœæ•ˆæœï¼Œè¶³ä»¥åŒæ—¶å®ç°volatileè¯»å’Œvolatileå†™çš„å†…å­˜è¯­ä¹‰ concurrentåŒ…çš„é€šç”¨å®ç°æ¨¡å¼ ==é¦–å…ˆï¼Œå£°æ˜å…±äº«å˜é‡ä¸ºvolatile== ==ç„¶åï¼Œä½¿ç”¨CASçš„åŸå­æ¡ä»¶æ›´æ–°æ¥å®ç°çº¿ç¨‹ä¹‹é—´çš„åŒæ­¥== ==åŒæ—¶ï¼Œé…åˆä»¥volatileçš„è¯»ã€å†™å’ŒCASæ‰€å…·æœ‰çš„volatileè¯»å’Œå†™çš„å†…å­˜è¯­ä¹‰æ¥å®ç°çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡== å…­ã€finalåŸŸçš„å†…å­˜è¯­ä¹‰1ã€finalåŸŸçš„é‡æ’åºè§„åˆ™ï¼ˆ1ï¼‰å†™ï¼šåœ¨==æ„é€ å‡½æ•°å†…å¯¹==ä¸€ä¸ªfinalåŸŸçš„å†™å…¥ï¼Œä¸==éšåæŠŠè¿™ä¸ªè¢«æ„é€ å¯¹è±¡çš„å¼•ç”¨èµ‹å€¼ç»™ä¸€ä¸ªå¼•ç”¨å˜é‡==ï¼Œè¿™ä¸¤ä¸ªæ“ä½œä¸èƒ½é‡æ’åº ï¼ˆ2ï¼‰è¯»ï¼šåˆæ¬¡è¯»ä¸€ä¸ªåŒ…å«finalåŸŸçš„å¯¹è±¡çš„å¼•ç”¨ï¼Œä¸==éšååˆæ¬¡è¯»è¿™ä¸ªfinalåŸŸ==ï¼Œè¿™ä¸¤ä¸ªæ“ä½œä¸èƒ½é‡æ’åºã€‚ 2ã€å†™finalåŸŸçš„é‡æ’åºè§„åˆ™==ç¦æ­¢æŠŠfinalåŸŸçš„å†™é‡æ’åºåˆ°æ„é€ å‡½æ•°ä¹‹å¤–==åŒ…å«ä¸¤æ–¹é¢ï¼š 1ã€ç¼–è¯‘å™¨ï¼š JMMç¦æ­¢ç¼–è¯‘å™¨æŠŠfinalåŸŸçš„å†™é‡æ’åºåˆ°æ„é€ å‡½æ•°ä¹‹å¤– 2ã€å¤„ç†å™¨ï¼š ç¼–è¯‘å™¨ä¼šåœ¨finalåŸŸçš„å†™ä¹‹åï¼Œæ„é€ å‡½æ•°returnä¹‹å‰ï¼Œæ’å…¥ä¸€ä¸ªStoreStoreå±éšœã€‚è¿™ä¸ªå±éšœç¦æ­¢å¤„ç†å™¨æŠŠfinalåŸŸçš„å†™é‡æ’åºåˆ°æ„é€ å‡½æ•°ä¹‹å¤–ä¸Šè¿°è§„åˆ™å¯ä»¥ç¡®ä¿ï¼š åœ¨å¯¹è±¡å¼•ç”¨ä¸ºä»»æ„çº¿ç¨‹å¯è§ä¹‹å‰ï¼Œå¯¹è±¡çš„finalåŸŸå·²ç»è¢«æ­£ç¡®åˆå§‹åŒ–è¿‡äº†ï¼Œè€Œæ™®é€šåŸŸä¸å…·æœ‰è¿™ä¸ªä¿éšœã€‚ 3ã€è¯»finalåŸŸçš„é‡æ’åºè§„åˆ™å¤„ç†å™¨ï¼šåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œåˆæ¬¡è¯»å¯¹è±¡å¼•ç”¨ä¸åˆæ¬¡è¯»è¯¥å¯¹è±¡æ‰€åŒ…å«çš„finalåŸŸï¼ŒJMMç¦æ­¢å¤„ç†å™¨é‡æ’åºè¿™ä¸¤ä¸ªæ“ä½œ ç¼–è¯‘å™¨ï¼šç¼–è¯‘å™¨ä¼šåœ¨è¯»finalåŸŸæ“ä½œçš„å‰é¢æ’å…¥ä¸€ä¸ªLoadLoadå±éšœÂ· ä¸Šè¿°é‡æ’åºè§„åˆ™å¯ä»¥ç¡®ä¿ï¼šåœ¨è¯»ä¸€ä¸ªå¯¹è±¡çš„finalåŸŸä¹‹å‰ï¼Œä¸€å®šä¼šå…ˆè¯»åŒ…å«è¿™ä¸ªfinalåŸŸçš„å¯¹è±¡çš„å¼•ç”¨ï¼ˆé’ˆå¯¹å°‘æ•°å¤„ç†å™¨å­˜åœ¨é—´æ¥ä¾èµ–å…³ç³»çš„æ“ä½œåšé‡æ’åºï¼‰ 4ã€å½“finalåŸŸä¸ºå¼•ç”¨ç±»å‹å¯¹äºå¼•ç”¨ç±»å‹ï¼Œå†™finalåŸŸçš„é‡æ’åºè§„åˆ™å¢åŠ ä¸‹é¢çš„çº¦æŸï¼š åœ¨æ„é€ å‡½æ•°å†…å¯¹ä¸€ä¸ªfinalå¼•ç”¨å¯¹è±¡çš„æˆå‘˜åŸŸçš„å†™å…¥ï¼Œä¸éšååœ¨æ„é€ å‡½æ•°å¤–æŠŠè¿™ä¸ªè¢«æ„é€ å¯¹è±¡çš„å¼•ç”¨èµ‹å€¼ç»™ä¸€ä¸ªå¼•ç”¨å˜é‡ï¼Œè¿™ä¸¤ä¸ªæ“ä½œä¸èƒ½é‡æ’åºã€‚å¯¹äºå­˜åœ¨æ•°æ®ç«äº‰çš„çº¿ç¨‹æ— æ³•ä¿è¯å¯è§æ€§ 5ã€ä¸ºä»€ä¹ˆfinalåŸŸä¸èƒ½ä»æ„é€ å‡½æ•°å†…æº¢å‡ºåœ¨æ„é€ å‡½æ•°è¿”å›å‰ï¼Œè¢«æ„é€ å¯¹è±¡çš„å¼•ç”¨ä¸èƒ½ä¸ºå…¶ä»–çº¿ç¨‹æ‰€è§ï¼Œå› ä¸ºæ­¤æ—¶çš„finalåŸŸå¯èƒ½è¿˜æ²¡æœ‰åˆå§‹åŒ– (æ„é€ å‡½æ•°å†…å¯èƒ½å‘ç”Ÿé‡æ’åº)ã€‚ ==(åœ¨å¼•ç”¨å˜é‡ä¸ºä»»æ„çº¿ç¨‹å’Œå¯è§ä¹‹å‰ï¼Œå¼•ç”¨å˜é‡æ‰€æŒ‡å‘çš„å¯¹è±¡çš„finalåŸŸå¿…é¡»è¦æ­£ç¡®åˆå§‹åŒ–,è¿™æ˜¯å†™finalåŸŸçš„é‡æ’åºè§„åˆ™)== ä¸ƒã€happens-beforeas-if-serialè¯­ä¹‰ç»™ç¼–å†™å•çº¿ç¨‹ç¨‹åºçš„ç¨‹åºå‘˜åˆ›é€ äº†ä¸€ä¸ªå¹»å¢ƒï¼šå•çº¿ç¨‹ç¨‹åºæ˜¯æŒ‰ç¨‹åºçš„é¡ºåºæ‰§è¡Œçš„ã€‚ happens-beforeå…³ç³»ç»™ç¼–å†™æ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºå‘˜åˆ›é€ äº†ä¸€ä¸ªå¹»å¢ƒï¼šæ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºæ˜¯æŒ‰happens-beforeæŒ‡å®šçš„é¡ºåºæ‰§è¡Œçš„ã€‚ è¿™ä¹ˆåšçš„ç›®çš„ï¼šä¸ºäº†åœ¨ä¸æ”¹å˜ç¨‹åºçš„æ‰§è¡Œç»“æœçš„å‰æä¸‹ï¼Œå°½å¯èƒ½åœ°æé«˜ç¨‹åºæ‰§è¡Œçš„å¹¶è¡Œåº¦ã€‚ å®Œæ•´hgappen-beforeè§„åˆ™ ç¨‹åºé¡ºåºè§„åˆ™ï¼šä¸€ä¸ªçº¿ç¨‹ä¸­çš„æ¯ä¸ªæ“ä½œï¼Œhappens-beforeäºè¯¥çº¿ç¨‹ä¸­çš„ä»»æ„åç»­æ“ä½œ ç›‘è§†å™¨é”è§„åˆ™ï¼šå¯¹ä¸€ä¸ªé”çš„è§£é”ï¼Œhappens-beforeäºéšåå¯¹è¿™ä¸ªé”çš„åŠ é”ã€‚ volatileå˜é‡è§„åˆ™ï¼šå¯¹ä¸€ä¸ªvolatileåŸŸçš„å†™ï¼Œhappens-beforeäºä»»æ„åç»­å¯¹è¿™ä¸ªvolatileåŸŸçš„è¯»ã€‚ ä¼ é€’æ€§ï¼šå¦‚æœA happens-before Bï¼Œä¸”B happens-before Cï¼Œé‚£ä¹ˆA happens-before Cã€‚ start()è§„åˆ™ï¼šå¦‚æœçº¿ç¨‹Aæ‰§è¡Œæ“ä½œThreadB.start()ï¼ˆå¯åŠ¨çº¿ç¨‹Bï¼‰ï¼Œé‚£ä¹ˆAçº¿ç¨‹çš„ThreadB.start()æ“ä½œhappens-beforeäºçº¿ç¨‹Bä¸­çš„ä»»æ„æ“ä½œã€‚ join()è§„åˆ™ï¼šå¦‚æœçº¿ç¨‹Aæ‰§è¡Œæ“ä½œThreadB.join()å¹¶æˆåŠŸè¿”å›ï¼Œé‚£ä¹ˆçº¿ç¨‹Bä¸­çš„ä»»æ„æ“ä½œhappens-beforeäºçº¿ç¨‹Aä»ThreadB.join()æ“ä½œæˆåŠŸè¿”å› å…«ã€åŒé‡æ£€æŸ¥é”å®šä¸å»¶è¿Ÿåˆå§‹åŒ–åŒé‡æ£€æŸ¥é”å®š é—®é¢˜æè¿°ï¼š(ä¸€èˆ¬æ˜¯å•ä¾‹æ¨¡å¼)åœ¨ä¸Šé”ä¹‹å‰åŠ ä¸€ä¸ªéç©ºåˆ¤æ–­ï¼Œä¸Šé”åå†æ¬¡éç©ºåˆ¤æ–­ï¼Œå®ç°åŒé‡æ£€æŸ¥é”å®š åŸå› ï¼šåœ¨æ„é€ å®ä¾‹æ—¶ï¼Œå¯¹è±¡å¼•ç”¨æŒ‡é’ˆçš„æ“ä½œå’Œåˆå§‹åŒ–æ“ä½œå¯èƒ½ä¼šè¢«é‡æ’åºï¼Œè¿™å°±å¯¼è‡´åœ¨if(instance==null)çš„æ—¶å€™è®¤ä¸ºå¯¹è±¡å·²ç»åˆ›å»ºï¼Œä½†è¿™ä¸ªæ—¶å€™è¿˜æ²¡æœ‰è¿›è¡Œåˆå§‹åŒ– 1.åˆ†é…å¯¹è±¡çš„å†…å­˜ç©ºé—´ 2.åˆå§‹åŒ–å¯¹è±¡ 3.è®¾ç½®instanceæŒ‡å‘å†…å­˜ç©ºé—´ 4.åˆæ¬¡è®¿é—®å¯¹è±¡ 3å’Œ2å¯èƒ½ä¼šè¢«é‡æ’åºï¼Œå¯¼è‡´1342è¿™æ ·çš„é—®é¢˜ ä¸€å¼€å§‹å•ä¾‹æ¨¡å¼ä¸€æ—¦å‡ºç°å¹¶å‘ï¼Œå°±å¯èƒ½å‡ºç°åˆå§‹åŒ–ä¸¤ä¸ªå¯¹è±¡çš„é—®é¢˜ åæ¥é€‰æ‹©åŠ é”ï¼ŒåŠ é”èƒ½è§£å†³é—®é¢˜ï¼Œä½†æ˜¯å‡ºç°ä¸¥é‡çš„æ€§èƒ½å¼€é”€ åæ¥å°±é€‰æ‹©åœ¨åŠ é”å‰åŠ ä¸€å±‚éç©ºåˆ¤æ–­ï¼Œè¿™æ ·å°±å¯ä»¥åªåœ¨ç¬¬ä¸€æ¬¡åˆå§‹åŒ–ï¼ŒåæœŸä¸ç”¨åŠ é”ä½† æ˜¯æ­£æ˜¯ç”±äºæ·»åŠ äº†ä¸€å±‚éç©ºåˆ¤æ–­ï¼Œå¯¼è‡´å¤šçº¿ç¨‹åœ¨è¿›è¡Œè¿™ä¸ªåˆ¤æ–­çš„æ—¶å€™ï¼Œè¯»å–æ“ä½œè·³è¿‡äº†ç­‰å¾…æ—¶é—´ç›´æ¥è¯»å–å¯¹è±¡ï¼Œä½†æ­¤æ—¶ç”±äºé”å†…ç©ºé—´çš„é‡æ’åºï¼Œå¯¼è‡´æ­¤æ—¶å¯¹è±¡è¿˜æ²¡æœ‰åˆå§‹åŒ–å®Œæˆã€‚ä»è€Œé€ æˆä¸¥é‡çš„åæœ è§£å†³æ–¹å¼ï¼š volatileã€‚åˆ©ç”¨volatileçš„è¯­ä¹‰ç¦æ­¢é‡æ’åºã€‚åœ¨å•ä¾‹çš„æ‡’æ±‰æ¨¡å¼ä¸­ï¼Œå¿…é¡»ç»™å®ä¾‹æ·»åŠ volatileä¿®é¥°ç¬¦ ä¼˜åŠ¿: ==é™¤äº†å¯ä»¥å¯¹é™æ€å­—æ®µå®ç°å»¶è¿Ÿåˆå§‹åŒ–å¤–ï¼Œè¿˜å¯ä»¥å¯¹å®ä¾‹å­—æ®µå®ç°å»¶è¿Ÿåˆå§‹åŒ–ã€‚== åŸºäºç±»åˆå§‹åŒ–çš„è§£å†³æ–¹æ¡ˆ,ä½¿å¾—çº¿ç¨‹è®¿é—®ä¹‹å‰å°±å®Œæˆåˆå§‹åŒ– JVMåœ¨ç±»çš„åˆå§‹åŒ–é˜¶æ®µï¼ˆå³åœ¨Classè¢«åŠ è½½åï¼Œä¸”è¢«çº¿ç¨‹ä½¿ç”¨ä¹‹å‰ï¼‰ï¼Œä¼šæ‰§è¡Œç±»çš„åˆå§‹åŒ–ã€‚åœ¨æ‰§è¡Œç±»çš„åˆå§‹åŒ–æœŸé—´ï¼ŒJVMä¼šå»è·å–ä¸€ä¸ªé”ã€‚è¿™ä¸ªé”å¯ä»¥åŒæ­¥å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªç±»çš„åˆå§‹åŒ–ã€‚ 123456å¤‡æ³¨ï¼šç±»åˆå§‹åŒ–çš„å‡ ç§æƒ…å†µ1ï¼‰Tæ˜¯ä¸€ä¸ªç±»ï¼Œè€Œä¸”ä¸€ä¸ªTç±»å‹çš„å®ä¾‹è¢«åˆ›å»ºã€‚2ï¼‰Tæ˜¯ä¸€ä¸ªç±»ï¼Œä¸”Tä¸­å£°æ˜çš„ä¸€ä¸ªé™æ€æ–¹æ³•è¢«è°ƒç”¨ã€‚3ï¼‰Tä¸­å£°æ˜çš„ä¸€ä¸ªé™æ€å­—æ®µè¢«èµ‹å€¼ã€‚4ï¼‰Tä¸­å£°æ˜çš„ä¸€ä¸ªé™æ€å­—æ®µè¢«ä½¿ç”¨ï¼Œè€Œä¸”è¿™ä¸ªå­—æ®µä¸æ˜¯ä¸€ä¸ªå¸¸é‡å­—æ®µã€‚5ï¼‰Tæ˜¯ä¸€ä¸ªé¡¶çº§ç±»ï¼ˆTop Level Classï¼Œè§Javaè¯­è¨€è§„èŒƒï¼‰ï¼Œè€Œä¸”ä¸€ä¸ªæ–­è¨€è¯­å¥åµŒå¥—åœ¨Tå†…éƒ¨è¢«æ‰§è¡Œã€‚ JVMåˆå§‹åŒ–æœŸé—´çš„åŒæ­¥è¿‡ç¨‹åˆå§‹åŒ–é˜¶æ®µ ç¬¬1é˜¶æ®µï¼šé€šè¿‡åœ¨Classå¯¹è±¡ä¸ŠåŒæ­¥ï¼ˆå³è·å–Classå¯¹è±¡çš„==åˆå§‹åŒ–é”==ï¼‰ï¼Œæ¥æ§åˆ¶ç±»æˆ–æ¥å£çš„åˆå§‹åŒ–ã€‚è¿™ä¸ªè·å–é”çš„çº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°å½“å‰çº¿ç¨‹èƒ½å¤Ÿè·å–åˆ°è¿™ä¸ªåˆå§‹åŒ–é”ã€‚ ==æ­¤æ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹ç»™èƒ½è·å¾—åˆå§‹åŒ–é”== ç¬¬2é˜¶æ®µï¼šçº¿ç¨‹Aæ‰§è¡Œç±»çš„åˆå§‹åŒ–,ï¼ŒåŒæ—¶çº¿ç¨‹Båœ¨åˆå§‹åŒ–é”å¯¹åº”çš„conditionä¸Šç­‰å¾… åˆå§‹åŒ–instanceè¿‡ç¨‹(==å¯èƒ½å‘ç”Ÿé‡æ’åºï¼Œä½†æ˜¯å¯¹äºå…¶ä»–çº¿ç¨‹ä¸å¯è§==) åˆ†é…å†…å­˜ç©ºé—´ å¤åˆ¶ç»™å¼•ç”¨å˜é‡ åˆå§‹åŒ–å¯¹è±¡ ç¬¬3é˜¶æ®µï¼šçº¿ç¨‹Aè®¾ç½®åˆå§‹åŒ–å®Œæˆæ ‡å¿—ï¼Œç„¶åå”¤é†’åœ¨conditionä¸­ç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹ã€‚ ç¬¬4é˜¶æ®µï¼šçº¿ç¨‹Bç»“æŸç±»çš„åˆå§‹åŒ–å¤„ç†ã€‚ çº¿ç¨‹Aåœ¨ç¬¬2é˜¶æ®µçš„A1æ‰§è¡Œç±»çš„åˆå§‹åŒ–ï¼Œå¹¶åœ¨ç¬¬3é˜¶æ®µçš„A4é‡Šæ”¾åˆå§‹åŒ–é”ï¼› çº¿ç¨‹Båœ¨ç¬¬4æ®µçš„B1è·å–==åŒä¸€ä¸ªåˆå§‹åŒ–é”==ï¼Œå¹¶åœ¨ç¬¬4é˜¶æ®µçš„B4ä¹‹åæ‰å¼€å§‹è®¿é—®è¿™ä¸ªç±» ç¬¬5é˜¶æ®µï¼šçº¿ç¨‹Cæ‰§è¡Œç±»çš„åˆå§‹åŒ–çš„å¤„ç†ã€‚ çº¿ç¨‹Aåœ¨ç¬¬2é˜¶æ®µçš„A1æ‰§è¡Œç±»çš„åˆå§‹åŒ–ï¼Œå¹¶åœ¨ç¬¬3é˜¶æ®µçš„A4é‡Šæ”¾é”ï¼›`` çº¿ç¨‹Cåœ¨ç¬¬5é˜¶æ®µçš„C1è·å–==åŒä¸€ä¸ªé”==ï¼Œå¹¶åœ¨åœ¨ç¬¬5é˜¶æ®µçš„C4ä¹‹åæ‰å¼€å§‹è®¿é—®è¿™ä¸ªç±» ä¹ã€JAVAå†…å­˜æ¨¡å‹ç»¼è¿°å¤„ç†å™¨å†…å­˜æ¨¡å‹å¸¸è§ å¤„ç†å™¨å†…å­˜æ¨¡å‹ Total Store Orderingå†…å­˜æ¨¡å‹(TSO) æ”¾æ¾ç¨‹åºä¸­==å†™-è¯»==æ“ä½œçš„é¡ºåº Total Store Orderingå†…å­˜æ¨¡å‹ï¼ˆPSO) ç»§ç»­æ”¾æ¾ç¨‹åºä¸­==å†™-å†™==æ“ä½œçš„é¡ºåº Relaxed Memory Orderå†…å­˜æ¨¡å‹ï¼ˆRMOï¼‰ ç»§ç»­æ”¾æ¾ç¨‹åºä¸­==è¯»-å†™==æ“ä½œçš„é¡ºåº PowerPCå†…å­˜æ¨¡å‹ ç»§ç»­æ”¾æ¾==è¯»-è¯»==æ“ä½œçš„é¡ºåº æ‰€æœ‰å¤„ç†å™¨å†…å­˜æ¨¡å‹éƒ½å…è®¸å†™-è¯»é‡æ’åºï¼ŒåŸå› ï¼šå®ƒä»¬éƒ½ä½¿ç”¨äº†å†™ç¼“å­˜åŒº. å†™ç¼“å­˜åŒºå¯èƒ½å¯¼è‡´å†™-è¯»æ“ä½œé‡æ’åº ç”±äºå†™ç¼“å­˜åŒºä»…å¯¹å½“å‰å¤„ç†å™¨å¯è§ï¼Œè¿™ä¸ªç‰¹æ€§å¯¼è‡´å½“å‰å¤„ç†å™¨å¯ä»¥æ¯”å…¶ä»–å¤„ç†å™¨å…ˆçœ‹åˆ°ä¸´æ—¶ä¿å­˜åœ¨è‡ªå·±å†™ç¼“å­˜åŒºä¸­çš„å†™ã€‚ å†…å­˜æ¨¡å‹ä¹‹é—´å…³ç³»åŒå¤„ç†å™¨å†…å­˜æ¨¡å‹ä¸€æ ·ï¼Œè¶Šæ˜¯è¿½æ±‚æ‰§è¡Œæ€§èƒ½çš„è¯­è¨€ï¼Œå†…å­˜æ¨¡å‹è®¾è®¡å¾—ä¼šè¶Šå¼±ã€‚ JMMçš„å†…å­˜å¯è§æ€§ä¿è¯æŒ‰ç¨‹åºç±»å‹å¯åˆ†ä¸º å•çº¿ç¨‹ç¨‹åºï¼š ä¸ä¼šå‡ºç°å†…å­˜å¯è§æ€§é—®é¢˜ æ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åº å…·æœ‰é¡ºåºä¸€è‡´æ€§ï¼ˆç¨‹åºçš„æ‰§è¡Œç»“æœä¸è¯¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹ä¸­çš„æ‰§è¡Œç»“æœç›¸åŒï¼‰ æœªåŒæ­¥/æœªæ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åº JMMä¸ºå®ƒä»¬æä¾›äº†æœ€å°å®‰å…¨æ€§ä¿éšœï¼šçº¿ç¨‹æ‰§è¡Œæ—¶è¯»å–åˆ°çš„å€¼ï¼Œè¦ä¹ˆæ˜¯ä¹‹å‰æŸä¸ªçº¿ç¨‹å†™å…¥çš„å€¼ï¼Œè¦ä¹ˆæ˜¯é»˜è®¤å€¼ï¼ˆ0ã€nullã€falseï¼‰ã€‚ ä½†æœ€å°å®‰å…¨æ€§å¹¶ä¸ä¿è¯çº¿ç¨‹è¯»å–åˆ°çš„å€¼ï¼Œä¸€å®šæ˜¯æŸä¸ªçº¿ç¨‹å†™å®Œåçš„å€¼ã€‚==æœ€å°å®‰å…¨æ€§ä¿è¯çº¿ç¨‹è¯»å–åˆ°çš„å€¼ä¸ä¼šæ— ä¸­ç”Ÿæœ‰çš„å†’å‡ºæ¥ï¼Œä½†å¹¶ä¸ä¿è¯çº¿ç¨‹è¯»å–åˆ°çš„å€¼ä¸€å®šæ˜¯æ­£ç¡®çš„==ã€‚ æ—§å†…å­˜æ¨¡å‹çš„ä¿®è¡¥JDK1.5ä¹‹åå¯¹volatileçš„å†…å­˜è¯­ä¹‰ã€finalçš„å†…å­˜è¯­ä¹‰åšäº†å¢å¼º]]></content>
      <categories>
        <category>å­¦ä¹ ç¬”è®°</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>é«˜å¹¶å‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¹¶å‘æœºåˆ¶çš„åº•å±‚å®ç°åŸç†]]></title>
    <url>%2F2019%2F12%2F15%2Fconcurrent2%2F</url>
    <content type="text"><![CDATA[ã€Šå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹é˜…è¯»ç¬”è®°ç¬¬äºŒç« ã€‚ä¸»è¦é’ˆå¯¹volatiileå’Œsynchronizedåšäº†æ€»ç»“ ä¸€ã€volatileçš„åº”ç”¨å¦‚æœvolatileå˜é‡ä¿®é¥°ç¬¦ä½¿ç”¨å¾—å½“ï¼Œå®ƒæ¯”synchronizedçš„ä½¿ç”¨å’Œæ‰§è¡Œæˆæœ¬æ›´ä½ï¼Œå› ä¸ºå®ƒä¸ä¼šå¼•èµ·çº¿ç¨‹ä¸Šä¸‹æ–‡çš„åˆ‡æ¢å’Œè°ƒåº¦ã€‚ 1. volatileçš„å®šä¹‰å’Œå®ç°åŸç†æœ‰volatileå˜é‡ä¿®é¥°ç¬¦çš„å…±äº«å˜é‡è¿›è¡Œå†™æ“ä½œçš„æ—¶å€™ä¼šå¤šå‡ºä¸€ä¸ªlockå‰ç¼€çš„æŒ‡ä»¤ lockå‰ç¼€çš„æŒ‡ä»¤åœ¨å¤šæ ¸å¤„ç†å™¨ä¸­å¼•å‘ä¸¤ä»¶äº‹æƒ… ï¼ˆ1ï¼‰å°†å½“å‰å¤„ç†å™¨ç¼“å­˜è¡Œçš„æ•°æ®å†™å›å†…å­˜ ä½†æ˜¯é”æ€»çº¿å¼€é”€æ¯”è¾ƒå¤§ï¼Œå› æ­¤ç°åœ¨çš„LOCKä¿¡å·åŸºæœ¬é”ç¼“å­˜ï¼Œä½¿ç”¨ç¼“å­˜ä¸€è‡´æ€§æœºåˆ¶ç¡®ä¿ä¿®æ”¹çš„åŸå­æ€§ï¼ˆç¼“å­˜é”å®šï¼‰ ï¼ˆ2ï¼‰è¿™ä¸ªå†™å›å†…å­˜çš„æ“ä½œä¼šä½¿åœ¨å…¶ä»–CPUé‡Œç¼“å­˜äº†è¯¥å†…å­˜åœ°å€çš„æ•°æ®æ— æ•ˆ MESI(ä¿®æ”¹ã€ç‹¬å ã€å…±äº«ã€æ— æ•ˆ)æ§åˆ¶åè®®ç»´æŠ¤å†…å­˜å’Œå…¶ä»–å¤„ç†å™¨ç¼“å­˜ä¸€è‡´æ€§ å—…æ¢æŠ€æœ¯ä¿è¯å†…éƒ¨ç¼“å­˜ã€ç³»ç»Ÿå†…å­˜å’Œå…¶ä»–æ•°æ®ç¼“å­˜åœ¨æ€»çº¿ä¸Šä¿æŒä¸€è‡´ ä¸ºäº†æé«˜å¤„ç†é€Ÿåº¦ï¼Œå¤„ç†å™¨ä¸ç›´æ¥å’Œå†…å­˜é€šä¿¡ï¼Œè€Œæ˜¯å…ˆå°†å†…å­˜ä¸­çš„æ•°æ®è¯»åˆ°cacheä¸­å†è¿›è¡Œæ“ä½œï¼Œä½†æ“ä½œå®Œå…¨ä¸çŸ¥é“ä½•æ—¶ä¼šå†™åˆ°å†…å­˜ã€‚å¦‚æœå¯¹å£°æ˜äº†volatileå˜é‡çš„è¿›è¡Œå†™æ“ä½œï¼ŒJVMå°±ä¼šå‘å¤„ç†å™¨å‘é€ä¸€æ¡Lockå‰ç¼€çš„æŒ‡ä»¤ï¼Œå°†è¿™ä¸ªå˜é‡æ‰€åœ¨ç¼“å­˜è¡Œçš„æ•°æ®å†™å›åˆ°ç³»ç»Ÿå†…å­˜ã€‚ä½†æ˜¯ï¼Œå°±ç®—å†™å›åˆ°å†…å­˜ï¼Œå¦‚æœå…¶ä»–å¤„ç†å™¨ç¼“å­˜çš„å€¼è¿˜æ˜¯æ—§çš„ï¼Œå†è¿›è¡Œè®¡ç®—æ“ä½œå°±ä¼šæœ‰é—®é¢˜ã€‚æ‰€ä»¥ï¼Œå¤šå¤„ç†å™¨ä¸‹ï¼Œè¦å®è¡Œç¼“å­˜ä¸€è‡´æ€§åè®®ï¼Œæ¯ä¸ªå¤„ç†å™¨é€šè¿‡å—…æ¢åœ¨æ€»çº¿ä¸Šä¼ æ’­çš„æ•°æ®æ¥æ£€æŸ¥è‡ªå·±ç¼“å­˜çš„å€¼æ˜¯ä¸æ˜¯è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸï¼Œå°±å°†å½“å‰å¤„ç†å™¨çš„ç¼“å­˜è¡Œè®¾ç½®æˆæ— æ•ˆçŠ¶æ€ï¼Œå½“å¤„ç†å™¨å¯¹è¿™ä¸ªæ•°æ®è¿›è¡Œä¿®æ”¹æ“ä½œçš„æ—¶å€™ï¼Œä¼šé‡æ–°ä»ç³»ç»Ÿå†…å­˜ä¸­æŠŠæ•°æ®è¯»åˆ°å¤„ç†å™¨ç¼“å­˜ä¸­ã€‚ 2. volatileä½¿ç”¨ä¼˜åŒ–å°†å…±äº«å˜é‡è¿½åŠ åˆ°64å­—èŠ‚(è²Œä¼¼ä¸ç”Ÿæ•ˆäº†ï¼Œåœ¨æºç ä¸­æ²¡çœ‹åˆ°) LinkedTransferQueue ä¸€äº›å¤„ç†å™¨çš„Cacheçš„é«˜é€Ÿç¼“å­˜è¡Œæ˜¯64å­—èŠ‚ï¼Œä¸æ”¯æŒéƒ¨åˆ†å¡«å……ç¼“å­˜è¡Œã€‚é€šè¿‡è¿½åŠ åˆ°64å­—èŠ‚çš„æ–¹å¼æ¥å¡«æ»¡é«˜é€Ÿç¼“å†²åŒºçš„ç¼“å­˜è¡Œï¼Œé¿å…å¤´ç»“ç‚¹å’Œå°¾èŠ‚ç‚¹åŠ è½½åˆ°åŒä¸€ä¸ªç¼“å­˜è¡Œï¼Œä½¿å¤´ã€å°¾èŠ‚ç‚¹åœ¨ä¿®æ”¹æ—¶ä¸ä¼šäº’ç›¸é”å®šã€‚ å¹¶ä¸æ˜¯æ‰€æœ‰ä½¿ç”¨volatileå˜é‡çš„æ—¶å€™éƒ½è¦è¿½åŠ åˆ°64å­—èŠ‚ ç¼“å­˜è¡Œé64å­—èŠ‚å®½çš„å¤„ç†å™¨ä¸é€‚ç”¨ å…±äº«å˜é‡ä¸ä¼šè¢«é¢‘ç¹è¯»å†™çš„æƒ…å†µä¸é€‚ç”¨ï¼Œåè€Œä¼šå› ä¸ºè¿½åŠ å­—èŠ‚å¯¼è‡´æ€§èƒ½æ¶ˆè€—å¢åŠ  äºŒã€synchronizedçš„å®ç°åŸç†ä¸åº”ç”¨ï¼ˆé‡é‡çº§é”ï¼‰synchronizeåŸºç¡€ï¼šjavaä¸­çš„æ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºé”ã€‚å…·ä½“è¡¨ç°ä¸º3ç§å½¢å¼ï¼š å¯¹äºæ™®é€šåŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰å®ä¾‹å¯¹è±¡ å¯¹äºé™æ€åŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰ç±»çš„classå¯¹è±¡ å¯¹äºåŒæ­¥æ–¹æ³•å—ï¼Œé”æ˜¯synchronizeæ‹¬å·é‡Œçš„å¯¹è±¡ é”åˆ°åº•å­˜åœ¨å“ªé‡Œï¼Ÿé”é‡Œé¢ä¼šå­˜å‚¨ä»€ä¹ˆä¿¡æ¯ï¼ŸÂ· Synchronizedåœ¨JVMä¸­çš„å®ç°åŸç†JVMåŸºäºè¿›å…¥å’Œé€€å‡ºMonitorå¯¹è±¡æ¥å®ç°æ–¹æ³•åŒæ­¥å’Œä»£ç å—åŒæ­¥ï¼Œä½†ä¸¤è€…çš„è¡¨ç°ç»†èŠ‚ä¸åŒã€‚ ä»£ç å—åŒæ­¥ä½¿ç”¨monitorenterå’ŒmonitorexitæŒ‡ä»¤å®ç°ï¼Œè€Œæ–¹æ³•åŒæ­¥æ˜¯ä½¿ç”¨å¦å¤–ä¸€ç§å®ç°æ–¹å¼å®ç°çš„ï¼Œç»†èŠ‚å¹¶æ²¡æœ‰åœ¨JVMä¸­è¯´æ˜ã€‚ä½†æ˜¯ï¼Œæ–¹æ³•åŒæ­¥åŒæ ·å¯ä»¥ä½¿ç”¨ä¸Šè¿°ä¸¤ä¸ªæŒ‡ä»¤å®ç°ã€‚ monitorenteræŒ‡ä»¤æ˜¯åœ¨ç¼–è¯‘åæ’å…¥åˆ°åŒæ­¥ä»£ç å—çš„å¼€å§‹ä½ç½®ï¼Œè€Œmonitorexitæ˜¯æ’å…¥åˆ°æ–¹æ³•ç»“æŸå¤„å’Œå¼‚å¸¸å¤„ï¼ŒJVMè¦ä¿è¯æ¯ä¸ªmonitorenterå¿…é¡»æœ‰å¯¹åº”çš„monitorexitä¸ä¹‹é…å¯¹ã€‚ ä»»ä½•å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªmonitorä¸ä¹‹å…³è”ï¼Œä¸”å½“ä¸€ä¸ªmonitorè¢«æŒæœ‰åï¼Œå®ƒå°†å¤„äºé”å®šçŠ¶æ€ã€‚çº¿ç¨‹æ‰§è¡Œåˆ°monitorenteræŒ‡ä»¤æ—¶ï¼Œå°†ä¼šå°è¯•è·å–å¯¹è±¡æ‰€å¯¹åº”çš„monitorçš„æ‰€æœ‰æƒï¼Œå³å°è¯•è·å¾—å¯¹è±¡çš„é”ã€‚ åŒæ­¥æ–¹æ³•:JVMä½¿ç”¨ACC_SYNCHRONIZEDæ ‡è¯†æ¥å®ç°ã€‚å³JVMé€šè¿‡åœ¨æ–¹æ³•è®¿é—®æ ‡è¯†ç¬¦(flags)ä¸­åŠ å…¥ACC_SYNCHRONIZEDæ¥å®ç°åŒæ­¥åŠŸèƒ½ã€‚åŒæ­¥æ–¹æ³•ä¼šåœ¨classæ–‡ä»¶ä¸­çš„access_flagsä¸­å­˜æ”¾ACC_SYNCHRONIZEDï¼Œè€Œaccess_flagsæ˜¯å­˜æ”¾åœ¨å¸¸é‡æ± çš„ åŒæ­¥æ–¹æ³•æ˜¯éšå¼çš„ã€‚ä¸€ä¸ªåŒæ­¥æ–¹æ³•ä¼šåœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­çš„method_infoç»“æ„ä½“ä¸­å­˜æ”¾ACC_SYNCHRONIZEDæ ‡è¯†ç¬¦ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®æ–¹æ³•æ—¶ï¼Œä¼šå»æ£€æŸ¥æ˜¯å¦å­˜åœ¨ACC_SYNCHRONIZEDæ ‡è¯†ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™å…ˆè¦è·å¾—å¯¹åº”çš„monitoré”ï¼Œç„¶åæ‰§è¡Œæ–¹æ³•ã€‚å½“æ–¹æ³•æ‰§è¡Œç»“æŸ(ä¸ç®¡æ˜¯æ­£å¸¸returnè¿˜æ˜¯æŠ›å‡ºå¼‚å¸¸)éƒ½ä¼šé‡Šæ”¾å¯¹åº”çš„monitoré”ã€‚å¦‚æœæ­¤æ—¶æœ‰å…¶ä»–çº¿ç¨‹ä¹Ÿæƒ³è¦è®¿é—®è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œä¼šå› å¾—ä¸åˆ°monitoré”è€Œé˜»å¡ã€‚å½“åŒæ­¥æ–¹æ³•ä¸­æŠ›å‡ºå¼‚å¸¸ä¸”æ–¹æ³•å†…æ²¡æœ‰æ•è·ï¼Œåˆ™åœ¨å‘å¤–æŠ›å‡ºæ—¶ä¼šå…ˆé‡Šæ”¾å·²è·å¾—çš„monitoré” monitor ç®¡ç¨‹ (è‹±è¯­ï¼šMonitorsï¼Œä¹Ÿç§°ä¸ºç›‘è§†å™¨) æ˜¯ä¸€ç§ç¨‹åºç»“æ„ï¼Œç»“æ„å†…çš„å¤šä¸ªå­ç¨‹åºï¼ˆå¯¹è±¡æˆ–æ¨¡å—ï¼‰å½¢æˆçš„å¤šä¸ªå·¥ä½œçº¿ç¨‹äº’æ–¥è®¿é—®å…±äº«èµ„æºã€‚ è¿™æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œç›®çš„æ˜¯ä¸ºäº†ç®€åŒ–åŒæ­¥è°ƒç”¨çš„è¿‡ç¨‹ï¼Œå°è£…äº†åŒæ­¥æ“ä½œï¼Œé¿å…ç›´æ¥ä½¿ç”¨PVä¿¡å·é‡ã€‚åœ¨javaä¸­çš„å…·ä½“å®ç°å°±æ˜¯ObjectMonitor ObjcetMonitorçš„å…³é”®å­—æ®µ _countï¼šè®°å½•ownerçº¿ç¨‹è·å–é”çš„æ¬¡æ•°ã€‚è¿™å¥è¯å¾ˆå¥½ç†è§£ï¼Œè¿™ä¹Ÿå†³å®šäº†synchronizedæ˜¯å¯é‡å…¥çš„ã€‚ _ownerï¼šæŒ‡å‘æ‹¥æœ‰è¯¥å¯¹è±¡çš„çº¿ç¨‹ _WaitSetï¼šå­˜æ”¾å¤„äºwaitçŠ¶æ€çš„çº¿ç¨‹é˜Ÿåˆ—ã€‚ _EntryListï¼šå­˜æ”¾ç­‰å¾…é”è€Œè¢«blockçš„çº¿ç¨‹é˜Ÿåˆ—ã€‚ æƒ³è¦è·å–monitorçš„çº¿ç¨‹å…ˆè¿›å…¥monitorçš„__EntryListé˜Ÿåˆ—é˜»å¡ç­‰å¾… å¦‚æœåœ¨ç¨‹åºé‡Œè°ƒç”¨äº†wait()æ–¹æ³•ï¼Œåˆ™è¯¥çº¿ç¨‹è¿›å…¥_WaitSeté˜Ÿåˆ—ï¼Œwait()ä¼šé‡Šæ”¾monitoré”ï¼Œå³å°†_ownerèµ‹å€¼ä¸ºnullå¹¶è¿›å…¥_WaitSeté˜Ÿåˆ—é˜»å¡ç­‰å¾… å½“ç¨‹åºé‡Œå…¶ä»–çº¿ç¨‹è°ƒç”¨äº†notify/notifyAllæ–¹æ³•æ—¶ï¼Œå°±ä¼šå”¤é†’_WaitSetä¸­çš„æŸä¸ªçº¿ç¨‹ï¼Œè¿™ä¸ªçº¿ç¨‹å°±ä¼šå†æ¬¡å°è¯•è·å–monitoré”ã€‚å¦‚æœæˆåŠŸï¼Œåˆ™å°±ä¼šæˆä¸ºmonitorçš„ownerã€‚ å…·ä½“å®ç° åœ¨åšå®¢ä¸Šæ‰¾ä¸€ä¸‹1ã€javaå¯¹è±¡å¤´synchronizedç”¨çš„é”æ˜¯å­˜åœ¨javaå¯¹è±¡å¤´é‡Œçš„ æ•°ç»„ç±»å‹3ä¸ªå­—å®½ï¼ˆ3*4å­—èŠ‚ï¼‰ éæ•°å­—ç±»å‹2ä¸ªå­—å®½ï¼ˆ2*4å­—èŠ‚ï¼‰ mark wordé‡Œå­˜å‚¨çš„æ•°æ®ä¼šéšç€é”æ ‡å¿—ä½çš„å˜åŒ–è€Œå˜åŒ– 64ä½è™šæ‹Ÿæœºä¸‹çš„å­˜å‚¨ç»“æ„ 2ã€é”çš„å‡çº§ä¸å¯¹æ¯” from JDK1.6 é”ä¸€å…±æœ‰4ä¸­çŠ¶æ€ï¼Œç”±ä½åˆ°é«˜ä¸ºï¼šæ— é”ã€åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”ï¼Œè¿™å‡ ä¸ªçŠ¶æ€ä¼šéšç€ç«äº‰æƒ…å†µé€æ¸å‡çº§ã€‚é”å¯ä»¥å‡çº§ä½†ä¸èƒ½é™çº§ï¼ˆæé«˜è·å¾—é”å’Œé‡Šæ”¾é”çš„æ•ˆç‡ï¼‰ åå‘é”ï¼šå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé”ä¸ä»…ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œè€Œä¸”æ€»æ˜¯ç”±åŒä¸€çº¿ç¨‹å¤šæ¬¡è·å¾—ï¼Œä¸ºäº†è®©çº¿ç¨‹è·å¾—é”çš„ä»£ä»·æ›´ä½ï¼Œå¼•å…¥äº†åå‘é”ã€‚ å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥å—å¹¶è·å–é”æ—¶ï¼Œä¼šåœ¨å¯¹è±¡å¤´å’Œæ ˆå¸§çš„é”è®°å½•é‡Œå­˜å‚¨é”åå‘çš„çº¿ç¨‹IDï¼Œä»¥åè¯¥çº¿ç¨‹åœ¨è¿›å…¥å’Œé€€å‡ºåŒæ­¥å—æ—¶ä¸éœ€è¦è¿›è¡ŒCASæ“ä½œæ¥åŠ é”å’Œè§£é”ï¼Œåªéœ€ç®€å•æµ‹è¯•å¯¹è±¡å¤´é‡Œçš„mark wordé‡Œæ˜¯å¦å­˜å‚¨ç€æŒ‡å‘å½“å‰çº¿ç¨‹çš„åå‘é”ã€‚ å¦‚æœæµ‹è¯•æˆåŠŸï¼Œè¡¨ç¤ºçº¿ç¨‹å·²ç»è·å¾—äº†é”ã€‚å¦‚æœæµ‹è¯•å¤±è´¥ï¼Œåˆ™éœ€è¦å†æµ‹è¯•ä¸€ä¸‹mark wordä¸­åå‘é”çš„æ ‡è¯†æ˜¯å¦è®¾ç½®æˆ1ï¼šå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™ä½¿ç”¨CASç«äº‰é”ï¼›å¦‚æœè®¾ç½®äº†ï¼Œåˆ™å°è¯•ä½¿ç”¨CASå°†å¯¹è±¡å¤´çš„åå‘é”æŒ‡å‘å½“å‰çº¿ç¨‹ã€‚ ï¼ˆ1ï¼‰åå‘é”çš„æ’¤é”€ åå‘é”ä½¿ç”¨äº†ä¸€ç§ç­‰åˆ°ç«äº‰å‡ºç°æ‰é‡Šæ”¾é”çš„æœºåˆ¶ï¼Œæ‰€ä»¥å½“å…¶ä»–çº¿ç¨‹å°è¯•ç«äº‰åå‘é”æ—¶ï¼ŒæŒæœ‰åå‘é”çš„çº¿ç¨‹æ‰ä¼šé‡Šæ”¾é”ã€‚åå‘é”çš„æ’¤é”€ï¼Œéœ€è¦ç­‰å¾…å…¨å±€å®‰å…¨ç‚¹ï¼ˆåœ¨è¿™ä¸ªæ—¶é—´ä¸Šæ²¡æœ‰æ­£åœ¨æ‰§è¡Œçš„å­—èŠ‚ç ï¼‰ã€‚ é¦–å…ˆ==æš‚åœ==æ‹¥æœ‰åå‘é”çš„çº¿ç¨‹ï¼Œç„¶åæ£€æŸ¥æŒæœ‰åå‘é”çš„çº¿ç¨‹æ˜¯å¦æ´»ç€ï¼Œå¦‚æœçº¿ç¨‹ä¸å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œåˆ™å°†å¯¹è±¡å¤´è®¾ç½®æˆæ— é”çŠ¶æ€ï¼›å¦‚æœçº¿ç¨‹ä»ç„¶æ´»ç€ï¼Œæ‹¥æœ‰åå‘é”çš„æ ˆä¼šè¢«æ‰§è¡Œï¼Œéå†åå‘å¯¹è±¡çš„é”è®°å½•ï¼Œæ ˆä¸­çš„é”è®°å½•å’Œå¯¹è±¡å¤´çš„mark wordè¦ä¹ˆé‡æ–°åå‘äºå…¶ä»–çº¿ç¨‹ï¼Œè¦ä¹ˆæ¢å¤åˆ°æ— é”æˆ–è€…æ ‡è®°å¯¹è±¡ä¸é€‚åˆä½œä¸ºåå‘é”ã€‚ è¿™ä¸€å—è¿˜æ˜¯ä¸æ¸…æ¥šï¼Œå¾—ä¸Šç½‘å†çœ‹çœ‹ å¦‚æœå¦å¤–çš„çº¿ç¨‹å’Œç°æœ‰çº¿ç¨‹ç«äº‰åå‘é”ï¼Œæ˜¯å¦‚ä½•åˆ¤æ–­æ˜¯å¦ç»§ç»­åå‘çš„ï¼Ÿï¼ˆ2ï¼‰å…³é—­åå‘é” java6ã€7é»˜è®¤å¯ç”¨åå‘é”ï¼Œä½†æ˜¯åœ¨ç¨‹åºå¯åŠ¨åä¼šæœ‰å‡ ç§’å»¶è¿Ÿï¼Œå¦‚æœ‰å¿…è¦å¯ä»¥å…³é—­å»¶è¿Ÿ-XX:BiasedLockingStartupDelay=0,å¦‚æœç¡®å®šç¨‹åºé‡Œæ‰€æœ‰çš„é”é€šå¸¸å¤„äºç«äº‰çŠ¶æ€ï¼Œå¯ä»¥é€šè¿‡JVMå‚æ•°å…³é—­åå‘é”ï¼š-XX:UseBaisedLocking=false,é‚£ä¹ˆç¨‹åºä¼šé»˜è®¤è¿›å…¥è½»é‡çº§é”çŠ¶æ€ è½»é‡çº§é”ï¼ˆ1ï¼‰åŠ é” çº¿ç¨‹åœ¨æ‰§è¡ŒåŒæ­¥å—ä¹‹å‰ï¼ŒJVMä¼šå…ˆåœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­åˆ›å»ºç”¨äºå­˜å‚¨é”è®°å½•çš„ç©ºé—´ï¼Œå¹¶å°†å¯¹è±¡å¤´ä¸­çš„Mark wordå¤åˆ¶åˆ°é”è®°å½•ä¸­ï¼ˆDisplaced Mark Worldï¼‰ã€‚ç„¶åçº¿ç¨‹å°è¯•ä½¿ç”¨CASå°†å¯¹è±¡å¤´ä¸­çš„Mark wordæ›¿æ¢ä¸ºæŒ‡å‘é”è®°å½•çš„æŒ‡é’ˆã€‚å¦‚æœæˆåŠŸï¼Œå½“å‰çº¿ç¨‹è·å¾—é”ï¼Œå¦‚æœå¤±è´¥ï¼Œè¡¨ç¤ºå…¶ä»–çº¿ç¨‹ç«äº‰é”ï¼Œå½“å‰çº¿ç¨‹ä¾¿å°è¯•ä½¿ç”¨è‡ªæ—‹æ¥è·å–é”ã€‚ ï¼ˆ2ï¼‰è§£é” è§£é”æ—¶ï¼Œä¼šä½¿ç”¨åŸå­çš„CASæ“ä½œå°†Displaced Mark Wordæ›¿æ¢å›åˆ°å¯¹è±¡å¤´ï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™è¡¨ç¤ºæ²¡æœ‰ç«äº‰å‘ç”Ÿã€‚å¦‚æœå¤±è´¥ï¼Œè¡¨ç¤ºå½“å‰é”å­˜åœ¨ç«äº‰ï¼Œé”å°±ä¼šè†¨èƒ€æˆé‡é‡çº§é”ã€‚ å› ä¸ºè‡ªæ—‹ä¼šæ¶ˆè€—CPUï¼Œä¸ºäº†é¿å…æ— ç”¨çš„è‡ªæ—‹ï¼Œä¸€æ—¦å‡çº§æˆé‡é‡çº§é”ï¼Œå°±ä¸ä¼šå†æ¢å¤åˆ°è½»é‡çº§é”çŠ¶æ€ã€‚å½“é”å¤„äºè¿™ä¸ªçŠ¶æ€ä¸‹ï¼Œå…¶ä»–çº¿ç¨‹è¯•å›¾è·å–é”æ—¶ï¼Œéƒ½ä¼šè¢«é˜»å¡ä½ï¼Œå½“æŒæœ‰é”çš„çº¿ç¨‹é‡Šæ”¾é”ä¹‹åä¼šå”¤é†’è¿™äº›çº¿ç¨‹ï¼Œè¢«å”¤é†’çš„çº¿ç¨‹å°±ä¼šè¿›è¡Œæ–°ä¸€è½®çš„å¤ºé”ä¹‹äº‰ã€‚ 3ã€é”çš„ä¼˜ç¼ºç‚¹å¯¹æ¯” åå‘é”ï¼š ä¼˜ç‚¹ï¼šåŠ é”è§£é”ä¸éœ€è¦é¢å¤–çš„æ¶ˆè€— ç¼ºç‚¹ï¼šå¦‚æœçº¿ç¨‹é—´å­˜åœ¨é”ç«äº‰ï¼Œä¼šå¸¦æ¥é¢å¤–çš„é”æ’¤é”€çš„æ¶ˆè€—â€‹ é€‚ç”¨åœºæ™¯ï¼šé€‚ç”¨äºåªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥å—çš„åœºæ™¯ è½»é‡çº§é”ï¼š ä¼˜ç‚¹ï¼šç«äº‰çš„çº¿ç¨‹&lt;mark&gt;ä¸ä¼šé˜»å¡&lt;/mark&gt;ï¼Œæé«˜äº†ç¨‹åºçš„å“åº”é€Ÿåº¦ ç¼ºç‚¹ï¼šå¦‚æœå§‹ç»ˆå¾—ä¸åˆ°é”ç«äº‰çš„çº¿ç¨‹ï¼Œä½¿ç”¨è‡ªæ—‹ä¼šæ¶ˆè€—CPU ä½¿ç”¨åœºæ™¯ï¼šè¿½æ±‚**å“åº”æ—¶é—´**ï¼ŒåŒæ­¥æ‰§è¡Œé€Ÿåº¦éå¸¸å¿« é‡é‡çº§é”ï¼š ä¼˜ç‚¹ï¼š&lt;mark&gt;çº¿ç¨‹ç«äº‰ä¸ä½¿ç”¨è‡ªæ—‹ï¼Œä¸ä¼šæ¶ˆè€—CPU&lt;/mark&gt; ç¼ºç‚¹ï¼šçº¿ç¨‹é˜»å¡ï¼Œå“åº”æ—¶é—´æ…¢ é€‚ç”¨åœºæ™¯ï¼šè¿½æ±‚**ååé‡**ï¼ŒåŒæ­¥å—æ‰§è¡Œæ—¶é—´è¾ƒé•¿ è‡ªæˆ‘ç†è§£ åå‘é”ä¸€å¼€å§‹æŒ‡å‘æŒæœ‰é”çš„çº¿ç¨‹ï¼Œä¹‹åå‡ºç°é”ç«äº‰åæ’¤é”€åå‘é”ï¼Œåå‘é”æ˜¯å¦ä¼šè¿›åŒ–åˆ°è½»é‡çº§é”å­˜ç–‘ã€‚ è½»é‡çº§é”ä¸€å¼€å§‹éœ€è¦å¤åˆ¶ä¸€ä»½markworldå†…å®¹ï¼ˆå³hashcodeæˆ–è€…å…¶ä»–æ‰€é”ä¿¡æ¯ï¼‰åˆ°æœ¬åœ°çº¿ç¨‹æ ˆå¸§ï¼Œç„¶åmarkworldä¿®æ”¹ä¸ºæŒ‡å‘çº¿ç¨‹çš„æŒ‡é’ˆ å¦‚æœå‡ºç°é”ç«äº‰ï¼Œmarkworldå°†è†¨èƒ€ä¸ºé‡é‡çº§é” ä¸‰ã€åŸå­æ“ä½œçš„å®ç°åŸç†1ã€æœ¯è¯­CASï¼šæ¯”è¾ƒå¹¶äº¤æ¢ ç¼“å­˜è¡Œï¼šç¼“å­˜çš„æœ€å°æ“ä½œå•ä½ å†…å­˜é¡ºåºå†²çªï¼šä¸€èˆ¬ç”±å‡å…±äº«å¼•èµ·ï¼Œå‡ºç°å†…å­˜é¡ºåºå†²çªæ—¶ï¼ŒCPUå¿…é¡»æ¸…ç©ºæµæ°´çº¿ å‡å…±äº«ï¼šå¤šä¸ªCPUåŒæ—¶ä¿®æ”¹åŒä¸€ä¸ªç¼“å­˜è¡Œçš„ä¸åŒéƒ¨åˆ†è€Œå¼•èµ·å…¶ä¸­ä¸€ä¸ªCPUçš„æ“ä½œæ— æ•ˆ2ã€å¤„ç†å™¨å®ç°åŸå­æ“ä½œï¼ˆ1ï¼‰é€šè¿‡æ€»çº¿é”ä¿è¯åŸå­æ€§ å¦‚æœå¤šä¸ªå¤„ç†å™¨åŒæ—¶å¯¹å…±äº«å˜é‡è¿›è¡Œè¯»æ”¹å†™æ“ä½œï¼ˆi++ï¼‰ï¼Œé‚£ä¹ˆå…±äº«å˜é‡å°±ä¼šè¢«å¤šä¸ªå¤„ç†å™¨åŒæ—¶è¿›è¡Œæ“ä½œï¼Œè¿™æ ·è¯»æ”¹å†™æ“ä½œå°±ä¸æ˜¯åŸå­çš„ï¼Œæ“ä½œå®Œä¹‹åå…±äº«å˜é‡çš„å€¼ä¼šå’ŒæœŸæœ›çš„ä¸ä¸€è‡´ã€‚ æ€»çº¿é”ï¼šå½“ä¸€ä¸ªå¤„ç†å™¨åœ¨æ€»çº¿ä¸Šè¾“å‡ºLOCK#ä¿¡å·æ—¶ï¼Œå…¶ä»–å¤„ç†å™¨çš„è¯·æ±‚å°†è¢«é˜»å¡ä½ï¼Œé‚£ä¹ˆè¯¥å¤„ç†å™¨å¯ä»¥ç‹¬å å…±äº«å†…å­˜ã€‚ ï¼ˆ2ï¼‰ä½¿ç”¨ç¼“å­˜é”ä¿è¯åŸå­æ€§ æ€»çº¿é”å®šæŠŠCPUå’Œå†…å­˜ä¹‹é—´çš„é€šä¿¡é”ä½äº†ï¼Œé”å®šæœŸé—´ï¼Œå…¶ä»–å¤„ç†å™¨ä¸èƒ½æ“ä½œå…¶ä»–å†…å­˜åœ°å€çš„æ•°æ®ï¼Œå› æ­¤æ€»çº¿é”å®šçš„å¼€é”€æ¯”è¾ƒå¤§ã€‚ ç¼“å­˜é”å®šï¼šå†…å­˜åŒºåŸŸå¦‚æœè¢«ç¼“å­˜åœ¨å¤„ç†å™¨çš„ç¼“å­˜è¡Œä¸­ï¼Œå¹¶ä¸”åœ¨LOCKæœŸé—´è¢«é”å®šï¼Œé‚£ä¹ˆå½“ä»–æ‰§è¡Œé”æ“ä½œä¼šå†™åˆ°å†…å­˜æ—¶ï¼Œå¤„ç†å™¨ä¸åœ¨æ€»çº¿ä¸Šå£°è¨€LOCK #ä¿¡å·ï¼Œè€Œæ˜¯ä¿®æ”¹å†…éƒ¨çš„å†…å­˜åœ°å€ï¼Œå¹¶å…è®¸å®ƒçš„ç¼“å­˜ä¸€è‡´æ€§æœºåˆ¶æ¥ä¿è¯æ“ä½œçš„åŸå­æ€§ï¼Œå› ä¸ºç¼“å­˜ä¸€è‡´æ€§æœºåˆ¶ä¼šé˜»æ­¢åŒæ—¶ä¿®æ”¹ç”±ä¸¤ä¸ªä»¥ä¸Šå¤„ç†å™¨ç¼“å­˜çš„å†…å­˜åŒºåŸŸæ•°æ®ï¼Œå½“å…¶ä»–å¤„ç†å™¨å›å†™å·²è¢«é”å®šçš„ç¼“å­˜è¡Œçš„æ•°æ®æ—¶ï¼Œä¼šä½¿ç¼“å­˜è¡Œæ— æ•ˆã€‚ ä¸¤ç§æƒ…å†µä¸ä¼šä½¿ç”¨ç¼“å­˜é”å®šï¼š 1ã€æ•°æ®ä¸èƒ½è¢«ç¼“å­˜åœ¨å¤„ç†å™¨å†…éƒ¨ï¼Œæˆ–æ“ä½œçš„æ•°æ®è·¨å¤šä¸ªç¼“å­˜è¡Œï¼Œæ­¤æ—¶ç”¨æ€»çº¿é”å®š 2ã€æœ‰äº›å¤„ç†å™¨ä¸æ”¯æŒç¼“å­˜é”å®š3ã€Javaå®ç°åŸå­æ“ä½œï¼ˆé”å’Œå¾ªç¯CASï¼‰ï¼ˆ1ï¼‰å¾ªç¯CASæœºåˆ¶ å¤„ç†å™¨çš„CMPXCHGæŒ‡ä»¤ è‡ªæ—‹CASï¼šå¾ªç¯è¿›è¡ŒCASæ“ä½œç›´è‡³æˆåŠŸä¸ºæ­¢ CASå®ç°åŸå­æ“ä½œçš„ä¸‰å¤§é—®é¢˜ï¼š ABAé—®é¢˜ï¼šAåˆ°Bå†åˆ°Aï¼ŒCASæ£€æŸ¥å€¼æ—¶ä¼šä»¥ä¸ºæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå®é™…å´å‘ç”Ÿäº†å˜åŒ–ï¼Œè§£å†³æ–¹å¼æ˜¯åœ¨å˜é‡å‰é¢è¿½åŠ ç‰ˆæœ¬å·ï¼š1Aåˆ°2Båˆ°3C AtomicStampedReferenceç±»è§£å†³æ–¹æ³•ï¼š å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§ï¼šè‡ªæ—‹CASå¦‚æœé•¿æ—¶é—´ä¸æˆåŠŸï¼Œä¼šç»™CPUå¸¦æ¥éå¸¸å¤§çš„æ‰§è¡Œå¼€é”€ã€‚ åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œï¼šæ­¤æ—¶ç”¨é”æˆ–è€…å°†å‡ ä¸ªå…±äº«å˜é‡åˆå¹¶ ï¼ˆ2ï¼‰é”æœºåˆ¶ é™¤äº†åå‘é”ï¼Œå¦å¤–ä¸¤ç§é”éƒ½ä½¿ç”¨äº†å¾ªç¯CASæœºåˆ¶,å³å½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥åŒæ­¥å—çš„æ—¶å€™ä½¿ç”¨å¾ªç¯CASçš„æ–¹å¼è·å–é”ï¼Œå½“ä»–é€€å‡ºåŒæ­¥å—çš„æ—¶å€™ä½¿ç”¨å¾ªç¯CASé‡Šæ”¾é”ã€‚]]></content>
      <categories>
        <category>å­¦ä¹ ç¬”è®°</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>é«˜å¹¶å‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[IPv6åœ°å€è§£æ]]></title>
    <url>%2F2019%2F12%2F10%2Fipv6%2F</url>
    <content type="text"><![CDATA[ä¸ºæˆ˜é˜Ÿä¸Šäº¤çš„å¾®ä¿¡æ¨é€ä»»åŠ¡ï¼Œè¿™é‡Œåšä¸€ä¸‹æ¬è¿ã€‚ æ®ç§°ï¼Œ11æœˆ26æ—¥ï¼Œè´Ÿè´£è‹±å›½ã€æ¬§æ´²ã€ä¸­ä¸œå’Œéƒ¨åˆ†ä¸­äºšåœ°åŒºäº’è”ç½‘èµ„æºåˆ†é…çš„æ¬§æ´²ç½‘ç»œåè°ƒä¸­å¿ƒå®£å¸ƒï¼Œå…¨çƒæ‰€æœ‰43äº¿ä¸ªIPv4åœ°å€å·²å…¨éƒ¨åˆ†é…å®Œæ¯•ã€‚æ„å‘³ç€å†ä¹Ÿæ²¡æœ‰æ–°æ¥å…¥çš„äº’è”ç½‘è®¾å¤‡åœ¨ä¹Ÿæ— æ³•åˆ†é…åˆ°æ–°çš„IPåœ°å€ã€‚åœ¨ç›®å‰çš„å½¢åŠ¿ä¸‹ï¼Œåˆ©ç›Šç›¸å…³çš„åŒå­¦ä»¬ç¬¬ä¸€ååº”ä¼šæƒ³åˆ°ä»€ä¹ˆå‘¢ï¼Ÿæ˜¯æé«˜IPåœ°å€åˆ©ç”¨ç‡çš„æ— ç±»åŸŸé—´è·¯ç”±è¿˜æ˜¯ä¸ºIPv4ç»­å‘½ç«‹ä¸‹æ±—é©¬åŠŸåŠ³çš„NATæŠ€æœ¯ï¼Ÿ ä¸å¾—ä¸è¯´ï¼Œé IPv4åè®®ä¹Ÿå°±å›¾ä¸ªä¹å‘µï¼Œæƒ³è¦å½»åº•è§£å†³åœ°å€åˆ†é…é—®é¢˜è¿˜å¾—çœ‹æˆ‘IPv6åè®® ä»Šå¤©ç”±äºç¯‡å¹…æœ‰é™ï¼Œä¸»è¦ä¸“æ³¨äºIPv6çš„åœ°å€è§£æ IPv6çš„ä¼˜åŠ¿ åœ°å€ç©ºé—´å¤§ï¼Œç†è®ºä¸Šå­˜åœ¨2^128ä¸ªåœ°å€ï¼Œå‡ ä¹ä¸ç”¨æ‹…å¿ƒåœ°å€çŸ­ç¼ºé—®é¢˜ å‡å°‘è·¯ç”±è¡¨å¤§å°ï¼Œè·¯ç”±å™¨å¤„ç†æŠ¥æ–‡æ€§èƒ½æé«˜ å®‰å…¨æ€§å¾—åˆ°æé«˜ æœåŠ¡è´¨é‡å¥½ï¼ŒæœåŠ¡ç±»å‹æ‰©å±•çµæ´»ä¸°å¯Œ æ”¯æŒå¯ç§»åŠ¨ä¸»æœºå’Œç½‘ç»œ å…¼å®¹æ€§å¼ºï¼Œå¯å®Œå…¨å‘ä¸‹å…¼å®¹IPv4 â€¦ IPv6åœ°å€IPv6åœ°å€çš„128ä½åœ°å€è¢«åˆ†æˆ8æ®µï¼Œæ¯16ä½ä¸€æ®µï¼Œåˆ†åˆ«è¢«è½¬æˆ4ä½åå…­è¿›åˆ¶æ•°è¿™ç§è¡¨ç¤ºæ–¹æ³•ç§°ä¹‹ä¸ºâ€œå†’å·åå…­è¿›åˆ¶è¡¨ç¤ºæ³•â€ã€‚ åœ°å€æ ¼å¼ï¼š X:X:X:X:X:X:X:X å‹ç¼©è¡¨ç¤º åœ°å€ä¸­åŒ…å«çš„è¿ç»­ä¸¤ä¸ªæˆ–å¤šä¸ªå‡ä¸º0çš„ç»„ï¼Œå¯ä»¥ç”¨åŒå†’å·â€œ::â€æ¥ä»£æ›¿ã€‚ å¦‚FC00:0:130F:0:0:9C0:876A:130Bå¯å†™ä½œFC00:0:130F::9C0:876A:130B æ³¨æ„ï¼š ::ä»£è¡¨çš„0ä½æ•°å¿…é¡»æœ€å¤§åŒ–ï¼› é”™è¯¯ç¤ºä¾‹ï¼šFC00:0:130F:0:0:9C0:876A:130Bä¸èƒ½å†™ä½œFC00:0:130F::0:9C0:876A:130B ä¸èƒ½åªä»£è¡¨ä¸€ä¸ªå…¨0æ®µï¼› é”™è¯¯ç¤ºä¾‹ï¼šFC00:1:130F:0:1:9C0:876A:130Bä¸èƒ½å†™ä½œFC00:1:130F::1:9C0:876A:130B å¦‚æœå¤šä¸ªè¿ç»­å…¨0æ®µé•¿åº¦ç›¸åŒï¼Œå¿…é¡»çš„ä»£è¡¨æœ€å‰é¢çš„é‚£ä¸ª é”™è¯¯ç¤ºä¾‹ï¼šFC00:0:130F:0:0:9C0:0:0ä¸èƒ½å†™ä½œFC00:0:130F:0:0:9C0:: å‰å¯¼0å¯ä»¥çœç•¥ å¦‚FC00:0000:130F:0000:0000:09C0:876A:130Bå¯ä»¥å†™ä½œFC00:0:130F:0:0:9C0:876A:130B åœ°å€ç»“æ„ ä¸€ä¸ªIPv6åœ°å€å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹ä¸¤éƒ¨åˆ†ï¼š ç½‘ç»œå‰ç¼€ï¼šnæ¯”ç‰¹ï¼Œç›¸å½“äºIPv4åœ°å€ä¸­çš„ç½‘ç»œID æ¥å£æ ‡è¯†ï¼š128-næ¯”ç‰¹ï¼Œç›¸å½“äºIPv4åœ°å€ä¸­çš„ä¸»æœºID è¡¨ç¤ºå½¢å¼å¦‚FF00::/8ä»£è¡¨åœ°å€/å‰ç¼€é•¿åº¦ æ¥å£æ ‡è¯†å¯é€šè¿‡ä¸‰ç§æ–¹æ³•ç”Ÿæˆï¼šæ‰‹å·¥é…ç½®ã€ç³»ç»Ÿé€šè¿‡è½¯ä»¶è‡ªåŠ¨ç”Ÿæˆæˆ–IEEE EUI-64è§„èŒƒç”Ÿæˆã€‚å…¶ä¸­ï¼ŒEUI-64è§„èŒƒè‡ªåŠ¨ç”Ÿæˆæœ€ä¸ºå¸¸ç”¨ åœ°å€åˆ†ç±» å•æ’­åœ°å€ ä¸€å¯¹ä¸€ å¸¸è§çš„å•æ’­åœ°å€ æœªæŒ‡å®šåœ°å€::/128 è¯¥åœ°å€å¯ä»¥è¡¨ç¤ºæŸä¸ªæ¥å£æˆ–è€…èŠ‚ç‚¹è¿˜æ²¡æœ‰IPåœ°å€ï¼Œå¯ä»¥ä½œä¸ºæŸäº›æŠ¥æ–‡çš„æºIPåœ°å€ ç¯å›åœ°å€::1/128 å°±æ˜¯æœ¬åœ°åœ°å€ å…¨çƒå•æ’­åœ°å€:å¸¦æœ‰å…¨çƒå•æ’­å‰ç¼€,ç›®å‰å·²ç»åˆ†é…çš„å…¨çƒè·¯ç”±å‰ç¼€çš„å‰3bitå‡ä¸º001 å¸¦æœ‰å…¨çƒå•æ’­å‰ç¼€çš„IPv6åœ°å€ï¼Œå…¶ä½œç”¨ç±»ä¼¼äºIPv4ä¸­çš„å…¬ç½‘åœ°å€ é“¾è·¯æœ¬åœ°åœ°å€ ï¼šä½¿ç”¨äº†ç‰¹å®šçš„æœ¬åœ°é“¾è·¯å‰ç¼€FE80::/10 é“¾è·¯æœ¬åœ°åœ°å€æ˜¯IPv6ä¸­çš„åº”ç”¨èŒƒå›´å—é™åˆ¶çš„åœ°å€ç±»å‹ï¼Œåªèƒ½åœ¨è¿æ¥åˆ°åŒä¸€æœ¬åœ°é“¾è·¯çš„èŠ‚ç‚¹ä¹‹é—´ä½¿ç”¨ å”¯ä¸€æœ¬åœ°åœ°å€ï¼šå‰ç¼€å›ºå®šä¸ºÂ·FC00::/7 ä¹Ÿæ˜¯ä¸€ç§åº”ç”¨èŒƒå›´å—é™çš„åœ°å€ï¼Œå®ƒä»…èƒ½åœ¨ä¸€ä¸ªç«™ç‚¹å†…ä½¿ç”¨ï¼Œç±»ä¼¼äºIPv4ä¸­çš„ç§ç½‘åœ°å€ ç»„æ’­åœ°å€ IPv6çš„ç»„æ’­ä¸IPv4ç›¸åŒï¼Œç”¨æ¥æ ‡è¯†ä¸€ç»„æ¥å£ï¼Œä¸€èˆ¬è¿™äº›æ¥å£å±äºä¸åŒçš„èŠ‚ç‚¹. IPv6ç»„æ’­åœ°å€çš„å‰ç¼€æ˜¯FF00::/8 æ ‡å¿—ç”¨æ¥æ ‡è¯†ç»„æ’­åœ°å€èº«ä»½ scopç”¨æ¥é™åˆ¶ç»„æ’­æ•°æ®æµåœ¨ç½‘ç»œä¸­å‘é€çš„èŒƒå›´ group IDæ ‡è¯†ç»„æ’­ç»„ ä»»æ’­åœ°å€ ä»»æ’­åœ°å€æ ‡è¯†ä¸€ç»„ç½‘ç»œæ¥å£ï¼ˆé€šå¸¸å±äºä¸åŒçš„èŠ‚ç‚¹ï¼‰ã€‚ç›®æ ‡åœ°å€æ˜¯ä»»æ’­åœ°å€çš„æ•°æ®åŒ…å°†å‘é€ç»™å…¶ä¸­è·¯ç”±æ„ä¹‰ä¸Šæœ€è¿‘çš„ä¸€ä¸ªç½‘ç»œæ¥å£ã€‚ä¸»è¦ç”¨æ¥åœ¨ç»™å¤šä¸ªä¸»æœºæˆ–è€…èŠ‚ç‚¹æä¾›ç›¸åŒæœåŠ¡æ—¶æä¾›å†—ä½™åŠŸèƒ½å’Œè´Ÿè½½åˆ†æ‹…åŠŸèƒ½ã€‚ æ³¨ï¼šIPv6ä»»æ’­åœ°å€ä»…å¯ä»¥è¢«åˆ†é…ç»™è·¯ç”±è®¾å¤‡ï¼Œä¸èƒ½åº”ç”¨äºä¸»æœºã€‚ä»»æ’­åœ°å€ä¸èƒ½ä½œä¸ºIPv6æŠ¥æ–‡çš„æºåœ°å€ æ•´ç†äº†ä¸€ä¸‹ä¸€ä¸ªIPv6ä¸»æœºä¸Šä¸€ä¸ªæ¥å£å¯ä»¥å…·å¤‡çš„å¸¸è§IPv6åœ°å€]]></content>
      <categories>
        <category>æŠ€æœ¯æ¢ç´¢</category>
      </categories>
      <tags>
        <tag>ICT</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¹¶å‘ç¼–ç¨‹çš„æŒ‘æˆ˜]]></title>
    <url>%2F2019%2F12%2F07%2Fconcurrent1%2F</url>
    <content type="text"><![CDATA[å¼€å‘ï¼ä»ä»Šå¤©èµ·å¼€å§‹çœ‹ã€Šå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹ï¼Œè¿™æœ¬ä¹¦æ˜¯ç»è¿‡å­¦é•¿çš„æ¨èæ‰å¾—çŸ¥çš„ï¼Œæ­£å¥½èƒ½è®©æˆ‘å¯¹å¹¶å‘ç¼–ç¨‹æœ‰æ›´æ·±å…¥çš„äº†è§£ã€‚å…¶å®é¡¹ç›®ä¸­å·²ç»å¼€å§‹é‡åˆ°å¹¶å‘é—®é¢˜äº†ï¼Œä½†æ˜¯è¿™æ–¹é¢ä¸€ç›´æ²¡æœ‰å¾—åˆ°ç³»ç»Ÿçš„å­¦ä¹ ã€‚ç°åœ¨å¿™é‡Œå·é—²ï¼Œèµ¶ç´§è¡¥ä¸Šã€‚PS: ç‰¹æ„æ‰¾äº†ä¸€å¼ å’Œé”ç›¸å…³çš„å›¾ç‰‡ï¼ŒåŒæ—¶ä¹Ÿå¯“æ„ç€ç²¾è¯šæ‰€è‡³ï¼Œé‡‘é”ä¸ºå¼€ğŸ”’ ä¸€ã€ä¸Šä¸‹æ–‡åˆ‡æ¢å³ä½¿æ˜¯å•æ ¸å¤„ç†å™¨ä¹Ÿæ”¯æŒå¤šçº¿ç¨‹æ‰§è¡Œä»£ç ï¼ŒCPUé€šè¿‡ç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…CPUæ—¶é—´ç‰‡ï¼ˆä¸€èˆ¬ä¸ºå‡ åæ¯«ç§’ï¼‰å®ç°è¿™ä¸ªæœºåˆ¶ã€‚ å½“å‰ä»»åŠ¡æ‰§è¡Œä¸€ä¸ªæ—¶é—´ç‰‡åä¼šåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚åœ¨åˆ‡æ¢å‰ä¼šä¿å­˜ä¸Šä¸€ä¸ªä»»åŠ¡çš„çŠ¶æ€ï¼Œä»¥ä¾¿ä¸‹æ¬¡åˆ‡æ¢å›è¿™ä¸ªä»»åŠ¡æ—¶ï¼Œå¯ä»¥å†åŠ è½½è¿™ä¸ªä»»åŠ¡çš„çŠ¶æ€ã€‚ä»»åŠ¡ä»ä¿å­˜åˆ°å†åŠ è½½çš„è¿‡ç¨‹å°±æ˜¯ä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ å¦‚ä½•å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Ÿ æ— é”å¹¶å‘ç¼–ç¨‹ã€‚å¤šçº¿ç¨‹ç«äº‰é”æ—¶ï¼Œä¼šå¼•èµ·ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¯ä»¥ç”¨ä¸€äº›åŠæ³•é¿å…ä½¿ç”¨é”ï¼Œå¦‚å°†æ•°æ®çš„idå–æ¨¡åˆ†æ®µï¼Œä¸åŒçš„çº¿ç¨‹å¤„ç†ä¸åŒæ®µçš„æ•°æ® CASç®—æ³•ï¼šJavaçš„AtomicåŒ…ä½¿ç”¨CASç®—æ³•æ¥æ›´æ–°æ•°æ®ï¼Œä¸éœ€è¦åŠ é” ä½¿ç”¨æœ€å°‘çº¿ç¨‹ï¼Œé¿å…åˆ›å»ºä¸éœ€è¦çš„çº¿ç¨‹ åœ¨å•çº¿ç¨‹é‡Œå®ç°å¤šä»»åŠ¡çš„è°ƒåº¦ï¼Œå¹¶åœ¨å•çº¿ç¨‹é‡Œç»´æŒå¤šä¸ªä»»åŠ¡é—´çš„åˆ‡æ¢ äºŒã€æ­»é”é¿å…æ­»é”çš„å‡ ä¸ªå¸¸è§æ–¹æ³•ï¼š é¿å…ä¸€ä¸ªçº¿ç¨‹è·å–å¤šä¸ªé” é¿å…ä¸€ä¸ªçº¿ç¨‹åœ¨é”å†…åŒæ—¶å ç”¨å¤šä¸ªèµ„æºï¼Œå°½é‡ä¿è¯æ¯ä¸ªé”åªå ç”¨ä¸€ä¸ªèµ„æº å°è¯•ä½¿ç”¨å®šæ—¶é”ï¼Œä½¿ç”¨lock.tryLock(timeout)æ¥æ›¿ä»£ä½¿ç”¨å†…éƒ¨é”æœºåˆ¶ å¯¹äºæ•°æ®åº“é”ï¼ŒåŠ é”å’Œè§£é”å¿…é¡»åœ¨ä¸€ä¸ªæ•°æ®åº“è¿æ¥é‡Œï¼Œå¦åˆ™ä¼šå‡ºç°è§£é”å¤±è´¥çš„æƒ…å†µ ä¸‰ã€èµ„æºé™åˆ¶çš„æŒ‘æˆ˜é—®é¢˜ï¼šå¦‚æœå°†æŸæ®µä¸²è¡Œçš„ä»£ç å¹¶å‘æ‰§è¡Œï¼Œå› ä¸ºå—é™äºèµ„æºï¼Œä»ç„¶åœ¨ä¸²è¡Œæ‰§è¡Œï¼Œè¿™æ—¶å€™ç¨‹åºä¸ä»…ä¸ä¼šåŠ å¿«æ‰§è¡Œï¼Œåè€Œä¼šæ›´æ…¢ï¼Œå› ä¸ºå¢åŠ äº†ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œèµ„æºè°ƒåº¦çš„æ—¶é—´ã€‚ å¦‚ä½•è§£å†³ï¼š å¯¹äºç¡¬ä»¶èµ„æºçš„é™åˆ¶ï¼Œä½¿ç”¨æœºç¾¤å¹¶è¡Œæ‰§è¡Œç¨‹åºï¼Œé€šè¿‡æ­å»ºæœåŠ¡å™¨é›†ç¾¤ï¼Œä¸åŒçš„æœºå™¨å¤„ç†ä¸åŒçš„æ•°æ® å¯¹äºè½¯ä»¶èµ„æºçš„é™åˆ¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨èµ„æºæ± å°†èµ„æºå¤ç”¨ æ ¹æ®ä¸åŒçš„èµ„æºé™åˆ¶è°ƒæ•´ç¨‹åºçš„å¹¶å‘åº¦]]></content>
      <categories>
        <category>å­¦ä¹ ç¬”è®°</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>é«˜å¹¶å‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å°±ä¸šä¸­å¿ƒå‡‰é¢å¤ç›˜]]></title>
    <url>%2F2019%2F10%2F27%2Fcenter-of-job%2F</url>
    <content type="text"><![CDATA[console.error("Error: [hexo-tag-aplayer] Unrecognized tag argument(2): autoplay=false"); ä»Šå¤©ç»“æŸäº†å­¦æ ¡å°±ä¸šæŒ‡å¯¼æœåŠ¡ä¸­å¿ƒçš„ç¬¬ä¸‰æ¬¡é¢è¯•ï¼Œç®—æ˜¯ä½“éªŒäº†ä¸€æŠŠæ¯”è¾ƒæ­£å¼çš„é¢è¯•è¿‡ç¨‹ï¼Œè™½ç„¶æœ€åé“å®šæ˜¯è¿›ä¸äº†äº†ï¼Œè¿˜æ˜¯æ”¶è·é¢‡ä¸°ï¼Œä¹Ÿç®—æ˜¯ä¸€æ®µååˆ†éš¾å¾—çš„ç»å†äº†ã€‚è¿™æ˜¯åšä¸€ä¸‹æ€»ç»“ï¼Œå¸Œæœ›å¯¹æœªæ¥çš„æˆ‘æœ‰æ‰€å¸®åŠ©ã€‚ å®£è®²ä¼šå®£è®²ä¼šçš„å¸ƒç½®éå¸¸ä¸“ä¸šï¼Œä¸­é€”æ²¡æœ‰å‡ºç°è¾ƒå¤§çš„å·®é”™ï¼Œæ•´åœºæ°”æ°›çš„æŠŠæ¡éå¸¸å¥½ã€‚ å…¥åœºæœ‰ä¸“é—¨çš„æ¥å¾…äººå‘˜ï¼ŒåŒæ—¶ä¼šå‘æ”¾ä¸€äº›å°ç¤¼å“ã€‚å¯¹äºç›¸å¯¹é‡è¦çš„æŠ½å¥–passç»¿å¡é‡‡ç”¨çš„ä¹Ÿæ˜¯ä¸“é—¨çš„æŠ½å¥–åˆ¸ï¼Œä¿è¯äº†ç»“æœç›¸å¯¹å…¬å¹³ã€‚ å…¥åœºåæŒ‰éŸ³å“ã€ç‰©èµ„ç­‰å‡å·²è°ƒåˆ¶å®Œå–„ï¼Œé…å¤‡æœ‰è‡ªå¸¦çš„å±å¹•ï¼ˆæ ¡çº§ç»„ç»‡çš„åœŸè±ªæ°”æ¯~ï¼‰ æµç¨‹å¤§åŒå°å¼‚ï¼Œå…ˆæ˜¯å°±ä¸šä¸­å¿ƒçš„è§†é¢‘ä»‹ç»ï¼Œç„¶åæ˜¯å­¦é•¿å­¦å§ä»‹ç»ï¼Œç„¶åæ˜¯è€å¸ˆä»‹ç»ï¼Œæ¥ç€æ˜¯æœºæ„åŠŸèƒ½ä»‹ç»å’Œè€å¸ˆæ€»ç»“ï¼Œæœ€åå…¬å¸ƒæ‹›æ–°æµç¨‹ï¼Œä¸­é—´ç©¿æ’äº†å‡ æ¬¡æŠ½å¥–ï¼Œæœ€åçš„é—®ç­” ä¹Ÿæ˜¯æ°åˆ°å¥½å¤„ã€‚ä¸»æŒäººä¹Ÿç®—æ˜¯æœ‰æ°´å¹³ã€‚ è€ƒè¯•æŒ‰ ç¼–å·ï¼Œæ— ç‰¹åˆ«ä¹‹å¤„ è€ƒè¯•é¢˜ç›®ä¹Ÿæ˜¯æ¯”è¾ƒå¸¸è§„ï¼Œä»ä»–ä»¬ä¸€æ™šä¸Šæ”¹å®Œä¹Ÿèƒ½çŸ¥é“è‚¯å®šæ²¡ä»”ç»†çœ‹~~ ä¸€é¢ï¼ˆç¾¤é¢ï¼‰ é¢˜ç›®ï¼šã€Šä¸­å›½æœºé•¿ã€‹èƒŒæ™¯ï¼Œæªæ–½é‡è¦æ€§æ’åºï¼Œé›†ä½“è®¨è®ºè§£å†³ é¢˜ç›®è¿˜ç®—æœ‰æ–°æ„ï¼Œå±äºé›†ä½“è®¨è®ºè§£å†³é—®é¢˜ï¼Œè€Œä¸”æ— æ³•ç§»åŠ¨ä½ç½®ï¼Œåªèƒ½é€šè¿‡è¯­è¨€è¯´æœå¯¹æ–¹ é¢è¯•é€‰æ‹©æ˜¯åäºŒäººè®¨è®ºå½¢å¼ å¥½å¤„æ˜¯è®¨è®ºäººæ•°å¢åŠ ï¼ŒåŒæ—¶è®¨è®ºçš„ä½ç½®ç›¸å¯¹å›ºå®šï¼Œæ›´è€ƒéªŒè¯´æœèƒ½åŠ› åå¤„æ˜¯æ— æ³•ä½¿ç”¨è‚¢ä½“è¯­è¨€ä¸°å¯Œæè¿° é¢è¯•å®˜æçš„é—®é¢˜å¾ˆå¸¸è§„ï¼Œè€Œä¸”åªäº‰å¯¹å¯èƒ½é€‰å‡ºçš„äººï¼Œæ²¡æœ‰é¢é¢ä¿±åˆ°ã€‚ æœ€åç»™å‡ºäº†å°ç»„çš„æ•´ä½“è¯„ä»·ï¼Œå¹¶ç»™å‡ºäº†äººæ€§åŒ–å»ºè®® æ”¶è· å¼€åœºè¿˜æ˜¯æƒ¯æ€§æ€ç»´äº†ï¼Œæ²¡æœ‰æŠŠé¢†å¯¼åˆ°ç‚¹ä¸Šã€‚å½“leaderä¹‹å‰è¦åšå¥½å‡†å¤‡ ï¼Œé¢å¯¹é¢˜ç›®å˜åŒ–è¦æœ‰åº”å¯¹æªæ–½ ä¸­é€”æ²¡æœ‰æŠŠå±€åŠ¿æŒæ¡ä½ï¼Œè¿˜æ˜¯ä¸æ•¢æ‰“æ–­å¯¹æ–¹ï¼Œå°±åƒå­¦é•¿è¯´çš„ï¼Œè¿™æ ·çš„è¯å®¹æ˜“äº§ç”Ÿå†…è€— æœ€åæ²¡æœ‰å»æŠ¢æœºä¼šï¼Œå…¶å®è‡ªå·±è¿˜æ˜¯é£é™©å¾ˆå¤§çš„ï¼Œæœ€å¥½è¿˜æ˜¯è¦å»äº‰å–ä¸€ä¸‹ï¼ŒæŠŠè‡ªå·±åœ¨ç¾¤é¢çš„æ„Ÿæƒ³è¯´å‡ºæ¥ äºŒé¢ï¼ˆå•é¢ï¼‰æ— ç‰¹åˆ«ä¹‹å¤„ï¼Œå…¨åœ¨æ„æ–™ä¹‹ä¸­ã€‚ï¼ˆå±…ç„¶çœŸçš„è¦æˆ‘åšè‹±è¯­é¢è¯•ã€‚ã€‚Orzï¼‰ ä¸‰é¢ï¼ˆå³å…´æ¼”è®²ï¼‰é‡ç‚¹ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘è¿™æ¬¡é¢è¯•æœ€æœŸå¾…çš„åœ°æ–¹ï¼ï¼å› ä¸ºä¹ æƒ¯äº†ç¾¤é¢å•é¢ï¼Œå…¶å®è¿™äº›é¢è¯•å‡ ä¹å¯¹æˆ‘å·²ç»é€ æˆä¸äº†å½±å“ï¼ŒåŠ ä¸Šæˆ‘çš„ç®€å†åœ¨æ ¡å†…è¿˜æ˜¯èƒ½æ‰“ï¼Œæ‰€ä»¥å¯ä»¥è¯´æ˜¯ç•…é€šæ— é˜»ã€‚ä½†æ˜¯ä¸‰é¢ä¸ä¸€æ ·ï¼Œå³å…´æ¼”è®²è®©æ‰€æœ‰çš„åŒ…è£…éƒ½æ¶ˆå¤±æ— å½¢ï¼Œä½ åªæœ‰é€šè¿‡è‡ªå·±çš„çœŸå®å®åŠ›å±•ç°è‡ªå·±ã€‚ å¥½åœ¨è¿™æ¬¡ç¡®å®ä¸è™šæ­¤è¡Œï¼Œæˆ‘æ—¢çœ‹åˆ°äº†å³å…´æ¼”è®²çš„åŸºæœ¬æ“ä½œè¿‡ç¨‹ï¼Œä¹Ÿç¡®å®ä»æ¼”è®²ä¸­å‘ç°äº†è‡ªå·±çš„ä¸è¶³ã€‚å¯ä»¥è¯´è¿™æ˜¯ä¸€æ¬¡éå¸¸æœ‰æ„ä¹‰çš„è‡ªæˆ‘å‰–æè¿‡ç¨‹ã€‚ é¢è¯•æµç¨‹é¦–å…ˆæ˜¯åœºåœ°ï¼Œå³å…´æ¼”è®²è®²ç©¶é«˜å‹ç¯å¢ƒä¸‹é”»ç‚¼ä¸´åœºåº”å˜èƒ½åŠ›ï¼Œå› æ­¤è¿™æ¬¡å¤§çº¦70ä¸ªäººå…¨éƒ¨ååœ¨ä¼šè®®å…ï¼ŒåŠ ä¸Šé¢è¯•å®˜ï¼Œå¤§æ¦‚æœ‰100å¤šäººï¼ŒåŒå¤§çš„ä¼šè®®å…ç¬é—´è¢«æŒ¤å¾—æ»¡æ»¡å½“å½“ï¼Œå¯ä»¥è¯´æ˜¯ç›¸å½“å‹æŠ‘äº†ã€‚ é¢è¯•å®˜åˆ†åˆ«ä½äºåæ’å’Œä¸¤è¾¹ï¼Œå¹¶ç”±ä¸€ä¸ª ä¸»é¢è¯•å®˜è¿›è¡ŒéšæœºæŠ½äººï¼Œä¸€ä¸ªè®¡æ—¶é¢è¯•å®˜è®°å½•æ—¶é—´ã€‚äººåˆ†ä¸‰åˆ—ä¾æ¬¡å¸¦å…¥é˜²æ­¢å‡ºç°æ‹¥æŒ¤ç°è±¡ã€‚æ¼”è®²æµç¨‹æ˜¯ä¸€ä¸ªäººå‡†å¤‡åœ¨å°ä¸‹å‡†å¤‡ä¸‰åˆ†é’Ÿï¼Œç„¶åä¸Šå°è¿›è¡Œä¸‰åˆ†é’Ÿæ¼”è®²ï¼Œæ¼”è®²åŒæ—¶ä¸‹ä¸€ä¸ªäººåœ¨å°ä¸‹è¿›è¡Œä¸‰åˆ†é’Ÿçš„å‡†å¤‡ï¼Œå¦å¤–æå‰å«äº†ä¸‹ä¸‹ä¸ªäººè¿›è¡Œå‡†å¤‡ã€‚æ¼”è®²æœ€å30sä¼šæœ‰æé†’ï¼Œå½“æ—¶é—´è¿˜å‰©è¶…è¿‡30sä½†æ¼”è®²ç»“æŸåï¼Œé¢è¯•å®˜ä¼šæé†’æ¼”è®²ç»§ç»­ï¼Œè¶…æ—¶æ‰“æ–­ã€‚å¦å¤–è¿˜æœ‰å‡ ä¸ªå­¦é•¿è´Ÿè´£å”±é»‘è„¸ï¼Œç¦æ­¢è¿‡ç¨‹äº¤å¤´æ¥è€³ã€çœ‹æ‰‹æœºæˆ–è€…é¼“æŒã€‚ç”±äºäººæ•°ä¼—å¤šï¼Œé¢è¯•æ—¶é•¿å¤§è‡´ä¸º5~6å°æ—¶ï¼Œä¸­é—´ä¼‘æ¯äº†ä¸¤æ¬¡ï¼Œæ—¶é•¿ä¸º5minï¼ˆå…¶å®ä¸æ­¢ï¼Œå¤§è‡´ä¸º10minå·¦å³ï¼‰ é¢è¯•æ„Ÿå— æˆ‘æŠ½åˆ°çš„é¢˜ç›®æ˜¯â€”â€”â€œä½ æœ€å¤§çš„è´£ä»»æ˜¯æŠŠä½ é“¸é€ æˆå™¨â€ é¢è¯•è¿‡ç¨‹å´©äº†ï¼Œå…¶å®å¿ƒæ€è°ƒæ•´çš„è¿˜å¥½ï¼Œä½†ä¸»è¦è¿˜æ˜¯ç¡¬å®åŠ›ä¸è¶³ï¼Œæ²¡æœ‰åŠæ³•ç»„ç»‡è¯­è¨€ã€‚å…¶å®æˆ‘æŠ½åˆ°çš„é¢˜è¿˜ç®—æ¯”è¾ƒå¸¸è§„ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šç´ æå¯ä»¥è¯´ã€‚æˆ‘ä¹Ÿç¡®å®åœ¨å‰æœŸåˆ—å¥½äº†æçº²ã€‚ä½†æ˜¯ï¼Œä¸Šåœºåæ˜æ˜¾æ„Ÿè§‰åˆ°è¯­è¨€è¡¨è¾¾çš„åŒ®ä¹ï¼Œæ— æ³•ç”¨ä¸°å¯Œçš„è¯­è¨€å»å±•ç°è‡ªå·±çš„æƒ³æ³•ï¼Œå¯¼è‡´å‡ºç°äº†å¾ˆå¤šé‡å¤çš„è¯­å¥ï¼Œæ€è·¯ä¹Ÿæ²¡æœ‰å®Œå…¨æ‰“å¼€ï¼Œå¯¼è‡´åœ¨ç¬¬ä¸€ä¸ªè®ºç‚¹ä¸Šå…œå…œè½¬è½¬äº†å¾ˆä¹…è€Œä¸”å¿˜è®°äº†ç´ æå¼•ç”¨ã€‚ç›´åˆ°æç¤º30sæ—¶æˆ‘è¿˜åœ¨è¯´ç¬¬ä¸€ä¸ªè®ºç‚¹ï¼Œå¯¼è‡´åé¢å®Œå…¨æ²¡æœ‰æ—¶é—´ã€‚å°½ç®¡æˆ‘ä¸»åŠ¨æ”¾å¼ƒäº†ç¬¬äºŒä¸ªè®ºç‚¹ï¼Œä½†è¿˜æ˜¯æ— æ³•åœ¨30sçš„æ—¶é—´è¿›è¡Œç»“é¢˜ï¼Œå¯¼è‡´å…¨ç¨‹å´©ç›˜ã€‚ é—®é¢˜ è¯­è¨€é€»è¾‘ä¸æ¸… è¡¨è¾¾è¯è¯­åŒ®ä¹ æ—¶é—´æŒæ¡ä¸è¶³ æ²¡æœ‰ç»“é¢˜ æ”¶è· éœ€è¦é”»ç‚¼è¾ƒé•¿æ—¶é—´çš„æ¼”è®²èƒ½åŠ›ï¼Œä¸»è¦æ˜¯é”»ç‚¼é€»è¾‘ç»„ç»‡èƒ½åŠ›ï¼Œä»ä»Šå¤©çš„é¢è¯•æ¥çœ‹ï¼Œå…¶å®ç”Ÿæ´»å¤„å¤„éƒ½å¯ä»¥ä½œä¸ºæ¼”è®²çš„ä¸»é¢˜ï¼Œåº”è¯¥åœ¨å¹³æ—¶å°±æ³¨æ„ç§¯ç´¯è¿™äº›è§‚ç‚¹çš„ç§¯ç´¯å’Œè¡¨è¾¾ æ—¶é—´æŒæ¡é—®é¢˜ï¼Œè¿˜æ˜¯æœ€åé€‰æ‹©çš„é—®é¢˜ï¼Œå¦‚æœæˆ‘èƒ½ç›´æ¥ç»“é¢˜ï¼Œæˆ–è®¸è¿˜èƒ½æœ‰æ‰€æŒ½å›ï¼Œå¯æƒœæ²¡æœ‰åšå¥½é€‰æ‹©ï¼Œå¯¼è‡´è¿˜æ˜¯è¶…æ—¶äº†ï¼Œåè€Œä¼šå› ä¸ºè¯­é€ŸåŠ å¿«è€Œæ˜¾ç¤ºæˆ‘çš„ç„¦è™‘ å…¶å®è¿™äº›é—®é¢˜å•é¢çš„æ—¶å€™æˆ‘éƒ½æœ‰æ‰€æåŠï¼Œçœ‹æ¥è¿™æ¬¡ç¡®å®æ˜¯ä¸€è¯­æˆè°¶ã€‚ğŸ˜“ å³å…´æ¼”è®²çš„é¢˜ç›® æ¥ä¸‹æ¥åˆ†äº«ä¸€ä¸‹å³å…´æ¼”è®²çš„é¢˜ç›®ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘æ”¶è·æœ€å¤§çš„åœ°æ–¹ï¼Œå¯ä»¥è¯´å‡ºçš„ç¡®å®æ˜¯ç›¸å½“æœ‰è¶£ï¼š ä¸‡æ¶ä¹‹æºã€‚å¯ä»¥è¯´æ˜¯ç›¸å½“æœ‰è¶£çš„é¢˜ç›® äººç±»çš„æœ¬è´¨æ˜¯é¸½å­è¿˜æ˜¯å¤è¯»æœº çœŸé¦™ ç™¾å› å¿…æœ‰æœ è¡¬è¡«çš„ä»·æ ¼æ˜¯ä¹é•‘åäº”ä¾¿å£« ï¼ˆæ— é¢˜ï¼‰ ç²¾ç¥å°ä¼™ é£åç»ä»£ä¹”ç¢§è çªçªå¤´ï¼Œä¸€å—é’±å››ä¸ª è‹¦ç»ƒä¸ƒåäºŒå˜ï¼Œç¬‘å¯¹å…«åä¸€éš¾ awsl è¿™ç››ä¸–ï¼Œå¦‚ä½ æ‰€æ„¿ è¾©é¢˜å°æ”¹ï¼Œè¿˜æ˜¯èƒ½åæ˜ ä¸€å®šçš„æ€ç»´èƒ½åŠ› ä¸ªäººè§‰å¾—è¿˜æ˜¯å¥½è®²çš„ è´ªå©ªæ˜¯å¯¼è‡´è´«ç©·çš„åŸå› å— çŸ¥æ˜“è¡Œéš¾ åˆ†æ‰‹éœ€è¦è¯´å‡ºæ¥å— 00åå’Œ90åä¹‹é—´æœ‰ä»£æ²Ÿå— å¦‚ä½•çœ‹å¾…ç”µå­ç«æŠ€ å¾®ä¿¡å’ŒQQæœ‰ä»€ä¹ˆåŒºåˆ« å¦‚ä½•çœ‹å¾…TFBoys å’ªè’™çš„ä¼ªå¿ƒçµé¸¡æ±¤ ä¸ºä»€ä¹ˆé²è¿…çš„è¯­å¥è¿™ä¹ˆå‡ºå ä½ è§‰å¾—åŒæ€§æ‹æ˜¯è‡ªæ„¿çš„è¿˜æ˜¯è·Ÿé£ æœ‹å‹å’Œæ‹äººå“ªä¸ªæ›´é‡è¦ ç½‘ä¸ŠåŸé¢˜ï¼Œç»å…¸ ä½ æœ€å¤§çš„è´£ä»»æ˜¯æŠŠä½ é“¸é€ æˆå™¨ å¤§æµ· äº‘ é²œèŠ± æ·é” å¦‚ä½•çœ‹å¾…æ ¡å›­æš´åŠ› æ²¡æœ‰æ¯”äººæ›´é«˜çš„å±± äººç”Ÿå¤„å¤„æ˜¯è€ƒåœº æ—¶é—´çš„é‡é‡ ä»¥è²Œå–äººæ˜¯å…¬å¹³çš„å— ä½ æ›¾ç»æœ€ç»å¢ƒçš„æ—¶åˆ» æ¯ä¸€ç§åˆ›ä¼¤ï¼Œéƒ½æ˜¯ä¸€ ç§æˆç†Ÿ è‡ªå·±å‡ºçš„ï¼Œè¿˜æ˜¯æœ‰ç‚¹æƒ³æ³•çš„ æˆ‘å’Œæˆ‘çš„ç¥–å›½ æˆ‘çˆ±é‡é‚® å¤§äºŒçš„ä½ å¦‚ä½•è¿‡å¤§ä¸‰çš„ç”Ÿæ´» ä½ åœ¨å°±ä¸šä¸­å¿ƒé¢è¯•çš„XXå°æ—¶XXåˆ†é‡Œä½ çš„æ„Ÿå— å…¼èŒå’Œå®ä¹ ]]></content>
      <categories>
        <category>ä¸€å¦‚æ—¢å¾€ï¼Œåªæ˜¯æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>é¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JAVAçŸ¥è¯†ç‚¹æ€»ç»“]]></title>
    <url>%2F2019%2F10%2F15%2Fjava-note%2F</url>
    <content type="text"><![CDATA[æ„Ÿè§‰å­¦äº†ä¸€æ®µæ—¶é—´javaï¼Œæ€»æ˜¯é¡¾ç€å‰å°±å¿˜äº†åï¼Œæ˜¯æ—¶å€™å°†å¸¸è§çš„çŸ¥è¯†ç‚¹åšä¸€ä¸‹æ•´ç†ï¼Œä¹Ÿå¯ä»¥åŠ æ·±ä¸€ä¸‹å°è±¡ã€‚ å°±è¿™ä¹ˆæ„‰å¿«çš„å†³å®šäº†ã€‚ å˜é‡ä¸€ã€ä¸€ä¸ªæ•´æ•°å­—é¢å€¼æ˜¯longç±»å‹ï¼Œå¦åˆ™å°±æ˜¯intç±»å‹ã€‚ å»ºè®®ä½¿ç”¨å¤§å†™çš„L äºŒã€é™æ€å˜é‡å’Œå®ä¾‹å˜é‡åŒºåˆ«ï¼Ÿ é™æ€å˜é‡å­˜åœ¨æ–¹æ³•åŒºï¼Œå±äºç±»æ‰€æœ‰ï¼Œå®ä¾‹å˜é‡å­˜å‚¨åœ¨å †ä¸­ï¼Œå¼•ç”¨å­˜åœ¨å½“å‰çº¿ç¨‹æ ˆ ä¸‰ã€java åˆ›å»ºå¯¹è±¡çš„å‡ ç§æ–¹å¼ é‡‡ç”¨new é€šè¿‡åå°„ é‡‡ç”¨clone(å®ç°clonableæ¥å£ç„¶åé‡å†™cloneæ–¹æ³•) é€šè¿‡åºåˆ—åŒ–æœºåˆ¶(å®ç°åºåˆ—åŒ–æ¥å£ç„¶åæµå¼è¾“å‡º) å››ã€å­—ç¬¦ä¸²å¸¸é‡æ± è®¾è®¡æ€æƒ³ ä¸ºå­—ç¬¦ä¸²å¼€è¾Ÿä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œç±»ä¼¼äºç¼“å­˜åŒº åˆ›å»ºå­—ç¬¦ä¸²å¸¸é‡æ—¶ï¼Œé¦–å…ˆåšæŒå­—ç¬¦ä¸²å¸¸é‡æ± æ˜¯å¦å­˜åœ¨è¯¥å­—ç¬¦ä¸² å­˜åœ¨è¯¥å­—ç¬¦ä¸²ï¼Œè¿”å›å¼•ç”¨å®ä¾‹ï¼Œä¸å­˜åœ¨ï¼Œå®ä¾‹åŒ–è¯¥å­—ç¬¦ä¸²å¹¶æ”¾å…¥æ± ä¸­ å®ç°åŸºç¡€ å­—ç¬¦ä¸²æ˜¯ä¸å˜çš„ï¼Œä¸ç”¨æ‹…å¿ƒæ•°æ®å†²çªè¿›è¡Œå…±äº« å®ä¾‹åˆ›å»ºçš„å…¨å±€å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æœ‰ä¸€ä¸ªè¡¨ï¼Œä¸ºæ± ä¸­å”¯ä¸€çš„å­—ç¬¦ä¸²å¯¹è±¡ç»´æŠ¤ä¸€ä¸ªå¼•ç”¨ï¼Œå› æ­¤ä¸ä¼šè¢«åƒåœ¾å›æ”¶ å¸¸é‡æ± å­˜æ”¾åœ¨æ–¹æ³•å»ï¼Œå’Œå †åŒºéƒ½å±äºçº¿ç¨‹å…±äº«çš„ åˆ›å»ºå¯¹è±¡è¿‡ç¨‹ï¼šString str4 = new String(â€œabcâ€) åœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾æ˜¯å¦æœ‰â€œabcâ€å¯¹è±¡ æœ‰åˆ™è¿”å›å¯¹åº”çš„å¼•ç”¨å®ä¾‹ æ²¡æœ‰åˆ™åˆ›å»ºå¯¹åº”çš„å®ä¾‹å¯¹è±¡ åœ¨å †ä¸­ new ä¸€ä¸ª String(â€œabcâ€) å¯¹è±¡ å°†å¯¹è±¡åœ°å€èµ‹å€¼ç»™str4,åˆ›å»ºä¸€ä¸ªå¼•ç”¨ ä¾‹ï¼š 12345678910111213141516String str1 = new String("A"+"B") ;// ä¼šåˆ›å»ºå¤šå°‘ä¸ªå¯¹è±¡? String str2 = new String("ABC") + "ABC" ;// ä¼šåˆ›å»ºå¤šå°‘ä¸ªå¯¹è±¡?/** str1ï¼šå­—ç¬¦ä¸²å¸¸é‡æ± ï¼š"A","B","AB" : 3ä¸ªå †ï¼šnew String("AB") ï¼š1ä¸ªå¼•ç”¨ï¼š str1 ï¼š1ä¸ªæ€»å…± ï¼š 5ä¸ª*//**str2 ï¼šå­—ç¬¦ä¸²å¸¸é‡æ± ï¼š"ABC" : 1ä¸ªå †ï¼šnew String("ABC") ï¼š1ä¸ªå¼•ç”¨ï¼š str2 ï¼š1ä¸ªæ€»å…± ï¼š 3ä¸ª*/ String.intern() intern()æ–¹æ³•ä¼šé¦–å…ˆä»å¸¸é‡æ± ä¸­æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨è¯¥å¸¸é‡å€¼,å¦‚æœå¸¸é‡æ± ä¸­ä¸å­˜åœ¨åˆ™ç°åœ¨å¸¸é‡æ± ä¸­åˆ›å»º,å¦‚æœå·²ç»å­˜åœ¨åˆ™ç›´æ¥è¿”å›. äº”ã€å„ç±»å‹å­—èŠ‚æ•° å…­ã€String,StringBufferå’ŒStringBuilderåŒºåˆ« Stringæ˜¯å­—ç¬¦ä¸²å¸¸é‡,finalä¿®é¥°; StringBufferå­—ç¬¦ä¸²å˜é‡(çº¿ç¨‹å®‰å…¨); StringBuilder å­—ç¬¦ä¸²å˜é‡(çº¿ç¨‹ä¸å®‰å…¨). StringBufferæ˜¯å¯¹å¯¹è±¡æœ¬èº«æ“ä½œ,è€Œä¸æ˜¯äº§ç”Ÿæ–°çš„å¯¹è±¡,å› æ­¤åœ¨æœ‰å¤§é‡æ‹¼æ¥çš„æƒ…å†µä¸‹,æˆ‘ä»¬å»ºè®®ä½¿ç”¨StringBuffer. StringBufferæ˜¯çº¿ç¨‹å®‰å…¨çš„å¯å˜å­—ç¬¦ä¸²,å…¶å†…éƒ¨å®ç°æ˜¯å¯å˜æ•°ç»„. StringBuilderæ˜¯jdk 1.5æ–°å¢çš„,å…¶åŠŸèƒ½å’ŒStringBufferç±»ä¼¼,ä½†æ˜¯éçº¿ç¨‹å®‰å…¨.å› æ­¤,åœ¨æ²¡æœ‰å¤šçº¿ç¨‹é—®é¢˜çš„å‰æä¸‹,ä½¿ç”¨StringBuilderä¼šå–å¾—æ›´å¥½çš„æ€§èƒ½. ä¸ƒã€ä»€ä¹ˆæ˜¯ç¼–è¯‘å™¨å¸¸é‡?ä½¿ç”¨å®ƒæœ‰ä»€ä¹ˆé£é™©?å…¬å…±é™æ€ä¸å¯å˜ï¼ˆpublic static final ï¼‰å˜é‡ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„ç¼–è¯‘æœŸå¸¸é‡ï¼Œè¿™é‡Œçš„ public å¯é€‰çš„ã€‚å®é™…ä¸Šè¿™äº›å˜é‡åœ¨ç¼–è¯‘æ—¶ä¼šè¢«æ›¿æ¢æ‰ï¼Œå› ä¸ºç¼–è¯‘å™¨çŸ¥é“è¿™äº›å˜é‡çš„å€¼ï¼Œå¹¶ä¸”çŸ¥é“è¿™äº›å˜é‡åœ¨è¿è¡Œæ—¶ä¸èƒ½æ”¹å˜ã€‚ è¿™ç§æ–¹å¼å­˜åœ¨çš„ä¸€ä¸ªé—®é¢˜æ˜¯ä½ ä½¿ç”¨äº†ä¸€ä¸ªå†…éƒ¨çš„æˆ–ç¬¬ä¸‰æ–¹åº“ä¸­çš„å…¬æœ‰ç¼–è¯‘æ—¶å¸¸é‡ï¼Œä½†æ˜¯è¿™ä¸ªå€¼åé¢è¢«å…¶ä»–äººæ”¹å˜äº†ï¼Œä½†æ˜¯ä½ çš„å®¢æˆ·ç«¯ä»ç„¶åœ¨ä½¿ç”¨è€çš„å€¼ï¼Œç”šè‡³ä½ å·²ç»éƒ¨ç½²äº†ä¸€ä¸ªæ–°çš„jarã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå½“ä½ åœ¨æ›´æ–°ä¾èµ– JAR æ–‡ä»¶æ—¶ï¼Œç¡®ä¿é‡æ–°ç¼–è¯‘ä½ çš„ç¨‹åºã€‚ å…«ã€byte[] è½¬String å¯ä»¥ä½¿ç”¨Stringçš„æ„é€ å™¨ï¼Œä½†æ˜¯æ³¨æ„ä½¿ç”¨æ­£ç¡®ç¼–ç  åŸºæœ¬ç‰¹æ€§é¢å‘å¯¹è±¡ä¸‰ç‰¹æ€§ å°è£…,ç»§æ‰¿,å¤šæ€ å¤šæ€çš„å¥½å¤„ å¯æ›¿æ¢æ€§ å¯æ‰©å……æ€§ï¼šå¢åŠ æ–°çš„å­ç±»ä¸å½±å“å·²ç»å­˜åœ¨çš„ç±»ç»“æ„ æ¥å£æ€§ï¼šå¤šæ€æ˜¯è¶…ç´¯é€šè¿‡æ–¹æ³•ç­¾åï¼Œå‘å­ç±»æä¾›ä¸€ä¸ªå…¬å…±æ¥å£ çµæ´»æ€§ ç®€åŒ–æ€§ å¦‚ä½•å®ç°å¤šæ€ æ¥å£å®ç° ç»§æ‰¿çˆ¶ç±»é‡å†™æ–¹æ³• æŠ½è±¡ç±»æ„ä¹‰ ä¸ºå…¶ä»–å­ç±»æä¾›ä¸€ä¸ªå…¬å…±çš„ç±»å‹ å°è£…å­ç±»ä¸­é‡å¤å®šä¹‰çš„å†…å®¹ å®šä¹‰æŠ½è±¡æ–¹æ³•,å­ç±»è™½ç„¶æœ‰ä¸åŒçš„å®ç°,ä½†æ˜¯å®šä¹‰æ˜¯ä¸€è‡´çš„ ä¸€ã€æŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«æŠ½è±¡ç±»å’Œæ¥å£åŒºåˆ« ä¸€ä¸ªç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªç±»ï¼Œä½†æ˜¯å¯ä»¥å®ç°å¤šä¸ªæ¥å£ æ¥å£ç±»åªèƒ½åšæ–¹æ³•ç”³æ˜ï¼ŒæŠ½è±¡ç±»å¯ä»¥åšæ–¹æ³•ç”³æ˜ä¹Ÿå¯ä»¥åšæ–¹æ³•å®ç° æ¥å£ç±»å®šä¹‰çš„å˜é‡æ˜¯å…¬å…±çš„é™æ€å¸¸é‡ï¼ŒæŠ½è±¡ç±»ä¸­çš„å˜é‡æ˜¯æ™®é€šå˜é‡ æŠ½è±¡ç±»çš„æŠ½è±¡æ–¹æ³•å¿…é¡»å…¨éƒ¨è¢«å­ç±»å®ç°ï¼Œå¦‚æœæ²¡æœ‰å®ç°ï¼Œå­ç±»åªèƒ½æ˜¯æŠ½è±¡ç±»ï¼›åŒæ ·å®ç°ä¸€ä¸ªæ¥å£æ—¶ä¸å®ç°å…¨éƒ¨æ–¹æ³•ï¼Œè¯¥ç±»åªèƒ½æ˜¯æŠ½è±¡ç±» æŠ½è±¡æ–¹æ³•åªèƒ½ç”³æ˜ï¼Œä¸èƒ½å®ç°ï¼Œæ¥å£æ˜¯è®¾è®¡çš„ç»“æœï¼ŒæŠ½è±¡ç±»æ˜¯é‡æ„çš„ç»“æœ ==æŠ½è±¡ç±»ä¸­å¯ä»¥æ²¡æœ‰æŠ½è±¡æ–¹æ³•==ï¼ŒæŠ½è±¡æ–¹æ³•è¦è¢«å®ç°ï¼Œä¸èƒ½æ˜¯é™æ€çš„ä¹Ÿä¸èƒ½æ˜¯ç§æœ‰çš„ æ¥å£å¯ç»§æ‰¿æ¥å£ï¼Œç±»åªèƒ½å•æ ¹ç»§æ‰¿ ==æ¥å£ä¸­çš„å˜é‡ä¼šè¢«éšå¼åœ°æŒ‡å®šä¸ºpublic static finalå˜é‡== è¯­æ³•å±‚çº§åŒºåˆ« æŠ½è±¡ç±»æä¾›ç»™æˆå‘˜æ–¹æ³•çš„å®ç°ç»†èŠ‚ï¼Œæ¥å£ä¸­åªå­˜publi abstractæ–¹æ³• æŠ½è±¡ç±»ä¸­çš„æˆå‘˜å˜é‡å¯ä»¥æ˜¯å„ç§ç±»å‹çš„ï¼Œæ¥å£ä¸­çš„æˆå‘˜å˜é‡åªèƒ½æ˜¯public static final æ¥å£ä¸­ä¸èƒ½æœ‰é™æ€ä»£ç å—ï¼ŒæŠ½è±¡ç±»ä¸­å¯ä»¥æœ‰ ä¸€ä¸ªç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä½†æ˜¯å¯ä»¥å®ç°å¤šä¸ªæ¥å£ è®¾è®¡å±‚æ¬¡åŒºåˆ« æŠ½è±¡åˆ—æ˜¯å¯¹ç±»æ•´ä½“æŠ½è±¡ï¼Œæ¥å£äº‹å¯¹å±€éƒ¨çš„è¡Œä¸ºè¿›è¡ŒæŠ½è±¡ æŠ½è±¡ç±»æ˜¯æ¨¡æ¿å¼è®¾è®¡ï¼Œæ¥å£æ˜¯è¡Œä¸ºè§„èŒƒ äºŒã€shortç±»å‹åœ¨è¿›è¡Œè¿ç®—æ—¶ä¼šè‡ªåŠ¨æå‡ä¸ºintç±»å‹ ä¸‰ã€final,finalizeå’Œfinallyçš„ä¸åŒä¹‹å¤„ final æ˜¯ä¸€ä¸ªä¿®é¥°ç¬¦ï¼Œå¯ä»¥ä¿®é¥°å˜é‡ã€æ–¹æ³•å’Œç±»ã€‚å¦‚æœ final ä¿®é¥°å˜é‡ï¼Œæ„å‘³ç€è¯¥å˜é‡çš„å€¼åœ¨åˆå§‹åŒ–åä¸èƒ½è¢«æ”¹å˜ã€‚ finalize æ–¹æ³•æ˜¯åœ¨å¯¹è±¡è¢«å›æ”¶ä¹‹å‰è°ƒç”¨çš„æ–¹æ³•ï¼Œç»™å¯¹è±¡è‡ªå·±æœ€åä¸€ä¸ªå¤æ´»çš„æœºä¼šï¼Œä½†æ˜¯ä»€ä¹ˆæ—¶å€™è°ƒç”¨ finalize æ²¡æœ‰ä¿è¯ã€‚ finally æ˜¯ä¸€ä¸ªå…³é”®å­—ï¼Œä¸ try å’Œ catch ä¸€èµ·ç”¨äºå¼‚å¸¸çš„å¤„ç†ã€‚finally å—ä¸€å®šä¼šè¢«æ‰§è¡Œï¼Œæ— è®ºåœ¨ try å—ä¸­æ˜¯å¦æœ‰å‘ç”Ÿå¼‚å¸¸ã€‚ finalçš„ç”¨æ³• 1.è¢«finalä¿®é¥°çš„ç±»ä¸å¯ä»¥è¢«ç»§æ‰¿2.è¢«finalä¿®é¥°çš„æ–¹æ³•ä¸å¯ä»¥è¢«é‡å†™3.è¢«finalä¿®é¥°çš„å˜é‡ä¸å¯ä»¥è¢«æ”¹å˜.å¦‚æœä¿®é¥°å¼•ç”¨,é‚£ä¹ˆè¡¨ç¤ºå¼•ç”¨ä¸å¯å˜,å¼•ç”¨æŒ‡å‘çš„å†…å®¹å¯å˜.4.è¢«finalä¿®é¥°çš„æ–¹æ³•,JVMä¼šå°è¯•å°†å…¶å†…è”,ä»¥æé«˜è¿è¡Œæ•ˆç‡5.è¢«finalä¿®é¥°çš„å¸¸é‡,åœ¨ç¼–è¯‘é˜¶æ®µä¼šå­˜å…¥å¸¸é‡æ± ä¸­. ç¼–è¯‘å™¨å¯¹finalåŸŸè¦éµå®ˆçš„ä¸¤ä¸ªé‡æ’åºè§„åˆ™ï¼š 1.åœ¨æ„é€ å‡½æ•°å†…å¯¹ä¸€ä¸ªfinalåŸŸçš„å†™å…¥,ä¸éšåæŠŠè¿™ä¸ªè¢«æ„é€ å¯¹è±¡çš„å¼•ç”¨èµ‹å€¼ç»™ä¸€ä¸ªå¼•ç”¨å˜é‡,è¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´ä¸èƒ½é‡æ’åº.2.åˆæ¬¡è¯»ä¸€ä¸ªåŒ…å«finalåŸŸçš„å¯¹è±¡çš„å¼•ç”¨,ä¸éšååˆæ¬¡è¯»è¿™ä¸ªfinalåŸŸ,è¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´ä¸èƒ½é‡æ’åº. å››ã€å¦‚ä½•æ­£ç¡®çš„é€€å‡ºå¤šå±‚åµŒå¥—å¾ªç¯. ä½¿ç”¨æ ‡å·labelå’Œbreak; é€šè¿‡åœ¨å¤–å±‚å¾ªç¯ä¸­æ·»åŠ æ ‡è¯†ç¬¦ äº”ã€æ·±æ‹·è´å’Œæµ…æ‹·è´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ? æµ…æ‹·è´ï¼šè¢«å¤åˆ¶å¯¹è±¡çš„æ‰€æœ‰å˜é‡éƒ½å«æœ‰ä¸åŸæ¥çš„å¯¹è±¡ç›¸åŒçš„å€¼ï¼Œè€Œæ‰€æœ‰çš„å¯¹å…¶ä»–å¯¹è±¡çš„å¼•ç”¨ä»ç„¶æŒ‡å‘åŸæ¥çš„å¯¹è±¡ã€‚æ¢è¨€ä¹‹ï¼Œæµ…æ‹·è´ä»…ä»…å¤åˆ¶æ‰€è€ƒè™‘çš„å¯¹è±¡ï¼Œè€Œä¸å¤åˆ¶å®ƒæ‰€å¼•ç”¨çš„å¯¹è±¡ã€‚ æ·±æ‹·è´ï¼šè¢«å¤åˆ¶å¯¹è±¡çš„æ‰€æœ‰å˜é‡éƒ½å«æœ‰ä¸åŸæ¥çš„å¯¹è±¡ç›¸åŒçš„å€¼ï¼Œè€Œé‚£äº›å¼•ç”¨å…¶ä»–å¯¹è±¡çš„å˜é‡å°†æŒ‡å‘è¢«å¤åˆ¶è¿‡çš„æ–°å¯¹è±¡ï¼Œè€Œä¸å†æ˜¯åŸæœ‰çš„é‚£äº›è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚æ¢è¨€ä¹‹ï¼Œæ·±æ‹·è´æŠŠè¦å¤åˆ¶çš„å¯¹è±¡æ‰€å¼•ç”¨çš„å¯¹è±¡éƒ½å¤åˆ¶äº†ä¸€éã€‚ å…­ã€staticéƒ½æœ‰å“ªäº›ç”¨æ³•? é™æ€å˜é‡å’Œé™æ€æ–¹æ³•ï¼šä¹Ÿå°±æ˜¯è¢«staticæ‰€ä¿®é¥°çš„å˜é‡/æ–¹æ³•éƒ½å±äºç±»çš„é™æ€èµ„æº,ç±»å®ä¾‹æ‰€å…±äº«. åˆå§‹åŒ–æ“ä½œï¼Œé™æ€å—ï¼š 123456public calss PreCache&#123; static&#123; //æ‰§è¡Œç›¸å…³æ“ä½œ &#125;&#125; staticä¹Ÿå¤šç”¨äºä¿®é¥°å†…éƒ¨ç±» é™æ€å¯¼åŒ…ï¼šimport staticæ˜¯åœ¨JDK 1.5ä¹‹åå¼•å…¥çš„æ–°ç‰¹æ€§,å¯ä»¥ç”¨æ¥æŒ‡å®šå¯¼å…¥æŸä¸ªç±»ä¸­çš„é™æ€èµ„æº,å¹¶ä¸”ä¸éœ€è¦ä½¿ç”¨ç±»å.èµ„æºå,å¯ä»¥ç›´æ¥ä½¿ç”¨èµ„æºå ä¸ƒã€è¿›ç¨‹ã€çº¿ç¨‹ç›¸å…³è¿›ç¨‹,çº¿ç¨‹,åç¨‹ä¹‹é—´çš„åŒºåˆ« è¿›ç¨‹æ˜¯==ç¨‹åºè¿è¡Œå’Œèµ„æºåˆ†é…==çš„åŸºæœ¬å•ä½,ä¸€ä¸ªç¨‹åºè‡³å°‘æœ‰ä¸€ä¸ªè¿›ç¨‹,ä¸€ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚è¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ‹¥æœ‰==ç‹¬ç«‹çš„å†…å­˜å•å…ƒ==,è€Œå¤šä¸ªçº¿ç¨‹å…±äº«å†…å­˜èµ„æº,==å‡å°‘åˆ‡æ¢æ¬¡æ•°,ä»è€Œæ•ˆç‡æ›´é«˜.== çº¿ç¨‹æ˜¯è¿›ç¨‹çš„ä¸€ä¸ªå®ä½“,æ˜¯==cpuè°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½==,æ˜¯æ¯”ç¨‹åºæ›´å°çš„èƒ½ç‹¬ç«‹è¿è¡Œçš„åŸºæœ¬å•ä½.åŒä¸€è¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹ä¹‹é—´å¯ä»¥å¹¶å‘æ‰§è¡Œ. åç¨‹ï¼Œæ˜¯ä¸€ç§æ¯”çº¿ç¨‹æ›´åŠ è½»é‡çº§çš„å­˜åœ¨ï¼Œåç¨‹ä¸==æ˜¯è¢«æ“ä½œç³»ç»Ÿå†…æ ¸æ‰€ç®¡ç†==ï¼Œè€Œ==å®Œå…¨æ˜¯ç”±ç¨‹åºæ‰€æ§åˆ¶==ï¼ˆä¹Ÿå°±æ˜¯åœ¨ç”¨æˆ·æ€æ‰§è¡Œï¼‰ åç¨‹åœ¨å­ç¨‹åºå†…éƒ¨æ˜¯å¯ä¸­æ–­çš„ï¼Œç„¶åè½¬è€Œæ‰§è¡Œåˆ«çš„å­ç¨‹åºï¼Œåœ¨é€‚å½“çš„æ—¶å€™å†è¿”å›æ¥æ¥ç€æ‰§è¡Œã€‚ç”±ç¨‹åºè‡ªèº«æ§åˆ¶ï¼Œæ²¡æœ‰çº¿ç¨‹åˆ‡æ¢ï¼Œæ‰§è¡Œæ•ˆç‡é«˜ã€‚ å› ä¸ºåªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿä¸å­˜åœ¨åŒæ—¶å†™å˜é‡å†²çªï¼Œå› æ­¤åœ¨åç¨‹ä¸­æ§åˆ¶å…±äº«èµ„æºä¸åŠ é” javaä¸ºä»€ä¹ˆåšæŒç”¨å¤šçº¿ç¨‹ä¸ç”¨åç¨‹? ä¸€ä¸ªtomcatä¸Šçš„wokerçº¿ç¨‹æ± çš„æœ€å¤§çº¿ç¨‹æ•°ä¸€èˆ¬ä¼šé…ç½®ä¸º50ï½500ä¹‹é—´ï¼ˆç›®å‰springbootçš„é»˜è®¤å€¼ç»™çš„200ï¼‰,å®é™…å†…å­˜å¢å¹…å¯¹æ•´ä½“æ€§èƒ½å½±å“ä¸å¤§ ä½¿ç”¨nettyï¼ŒNIO+worker threadå¯ä»¥å¤§è‡´ç­‰äºä¸€å¥—åç¨‹ é€šè¿‡çº¿ç¨‹æ± å¯ä»¥å¾ˆå¥½åˆ›å»ºé”€æ¯çº¿ç¨‹å¼€é”€ çº¿ç¨‹çš„åˆ‡æ¢å®é™…ä¸Šåªä¼šå‘ç”Ÿåœ¨é‚£äº›â€œæ´»è·ƒâ€çš„çº¿ç¨‹ä¸Šã€‚java webä¸­å¤§é‡å­˜åœ¨çš„æ˜¯IOè¯·æ±‚æŒ‚èµ·çš„çº¿ç¨‹ï¼Œä¸ä¼šå‚ä¸OSçš„çº¿ç¨‹åˆ‡æ¢ å®ˆæŠ¤çº¿ç¨‹å’Œéå®ˆæŠ¤çº¿ç¨‹åŒºåˆ« ç¨‹åºè¿è¡Œå®Œæ¯•,jvmä¼šç­‰å¾…éå®ˆæŠ¤çº¿ç¨‹å®Œæˆåå…³é—­,ä½†æ˜¯jvmä¸ä¼šç­‰å¾…å®ˆæŠ¤çº¿ç¨‹.å®ˆæŠ¤çº¿ç¨‹æœ€å…¸å‹çš„ä¾‹å­å°±æ˜¯GCçº¿ç¨‹ å¤šçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ å¤šçº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯æŒ‡CPUæ§åˆ¶æƒç”±ä¸€ä¸ªå·²ç»æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹åˆ‡æ¢åˆ°å¦å¤–ä¸€ä¸ªå°±ç»ªå¹¶ç­‰å¾…è·å–CPUæ‰§è¡Œæƒçš„çº¿ç¨‹çš„è¿‡ç¨‹ã€‚ java.lang.Runnableæ¯”java.lang.Threadä¼˜åŠ¿ï¼Ÿ Javaä¸æ”¯æŒå¤šç»§æ‰¿.å› æ­¤ç»§æ‰¿Threadç±»å°±ä»£è¡¨è¿™ä¸ªå­ç±»ä¸èƒ½æ‰©å±•å…¶ä»–ç±».è€Œå®ç°Runnableæ¥å£çš„ç±»è¿˜å¯èƒ½æ‰©å±•å¦ä¸€ä¸ªç±». ç±»å¯èƒ½åªè¦æ±‚å¯æ‰§è¡Œå³å¯,å› æ­¤ç»§æ‰¿æ•´ä¸ªThreadç±»çš„å¼€é”€è¿‡å¤§. Threadç±»ä¸­çš„start()å’Œrun()æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«? start()æ–¹æ³•è¢«ç”¨æ¥å¯åŠ¨æ–°åˆ›å»ºçš„çº¿ç¨‹ï¼Œè€Œä¸”start()å†…éƒ¨è°ƒç”¨äº†run()æ–¹æ³•ï¼Œè¿™å’Œç›´æ¥è°ƒç”¨run()æ–¹æ³•çš„æ•ˆæœä¸ä¸€æ ·ã€‚==å½“ä½ è°ƒç”¨run()æ–¹æ³•çš„æ—¶å€™ï¼Œåªä¼šæ˜¯åœ¨åŸæ¥çš„çº¿ç¨‹ä¸­è°ƒç”¨ï¼Œæ²¡æœ‰æ–°çš„çº¿ç¨‹å¯åŠ¨==ï¼Œstart()æ–¹æ³•æ‰ä¼šå¯åŠ¨æ–°çº¿ç¨‹ã€‚ æ€ä¹ˆæ£€æµ‹ä¸€ä¸ªçº¿ç¨‹æ˜¯å¦æŒæœ‰å¯¹è±¡ç›‘è§†å™¨ Threadç±»æä¾›äº†ä¸€ä¸ªÂ·holdsLock(Object obj)æ–¹æ³•ï¼Œå½“ä¸”ä»…å½“å¯¹è±¡objçš„ç›‘è§†å™¨è¢«æŸæ¡çº¿ç¨‹æŒæœ‰çš„æ—¶å€™æ‰ä¼šè¿”å›trueï¼Œæ³¨æ„è¿™æ˜¯ä¸€ä¸ªstaticæ–¹æ³•ï¼Œè¿™æ„å‘³ç€â€æŸæ¡çº¿ç¨‹â€æŒ‡çš„æ˜¯å½“å‰çº¿ç¨‹ã€‚ å¯¹è±¡ç›‘è§†å™¨ ç›‘è§†å™¨æ˜¯==ä¸€ç§åŒæ­¥ç»“æ„ï¼Œå®ƒåŸºäºäº’æ–¥é”==ï¼Œå…è®¸çº¿ç¨‹åŒæ—¶äº’æ–¥ï¼ˆä½¿ç”¨é”ï¼‰å’Œåä½œï¼ŒÂ· å½“ä¸€ä¸ªçº¿ç¨‹éœ€è¦æ•°æ®åœ¨æŸä¸€ä¸ªçŠ¶æ€ä¸‹å®ƒæ‰èƒ½æ‰§è¡Œï¼Œé‚£ä¹ˆå¦ä¸€ä¸ªçº¿ç¨‹è´Ÿè´£å°†æ•°æ®æ”¹å˜åˆ°æ­¤çŠ¶æ€ï¼Œ å¸¸è§çš„å¦‚ç”Ÿäº§è€…/æ¶ˆè´¹è€…çš„é—®é¢˜ï¼Œå½“è¯»çº¿ç¨‹éœ€è¦ç¼“å†²åŒºå¤„äºâ€œä¸ç©ºâ€çš„çŠ¶æ€å®ƒæ‰å¯ä»¥ä»ç¼“å†²åŒºä¸­è¯»å–ä»»ä½•æ•°æ®ï¼Œå¦‚æœå®ƒå‘ç°ç¼“å†²åŒºä¸ºç©ºï¼Œåˆ™è¿›å…¥wait-setç­‰å¾…ã€‚å¾…å†™çº¿ç¨‹ç”¨æ•°æ®å¡«å……ç¼“å†²åŒºï¼Œå†é€šçŸ¥è¯»çº¿ç¨‹è¿›è¡Œè¯»å–ã€‚è¿™ç§æœºåˆ¶è¢«ç§°ä¸ºâ€œWait and Notifyâ€æˆ–â€œSignal and Continueâ€ Callableæ¥å£ä¸­çš„call()æ–¹æ³•æ˜¯æœ‰è¿”å›å€¼çš„ï¼Œæ˜¯ä¸€ä¸ªæ³›å‹ï¼Œå’ŒFutureã€FutureTaské…åˆå¯ä»¥ç”¨æ¥è·å–å¼‚æ­¥æ‰§è¡Œçš„ç»“æœã€‚ ä»€ä¹ˆå¯¼è‡´çº¿ç¨‹é˜»å¡ é˜»å¡æŒ‡çš„æ˜¯æš‚åœä¸€ä¸ªçº¿ç¨‹çš„æ‰§è¡Œä»¥ç­‰å¾…æŸä¸ªæ¡ä»¶å‘ç”Ÿï¼ˆå¦‚æŸèµ„æºå°±ç»ªï¼‰ sleep()ï¼šè¢«ç”¨åœ¨ç­‰å¾…æŸä¸ªèµ„æºå°±ç»ªçš„æƒ…å½¢ï¼šæµ‹è¯•å‘ç°æ¡ä»¶ä¸æ»¡è¶³åï¼Œè®©çº¿ç¨‹é˜»å¡ä¸€æ®µæ—¶é—´åé‡æ–°æµ‹è¯•ï¼Œç›´åˆ°æ¡ä»¶æ»¡è¶³ä¸ºæ­¢ suspend() å’Œ resume()ï¼šsuspend()ä½¿å¾—çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå¹¶ä¸”ä¸ä¼šè‡ªåŠ¨æ¢å¤ï¼Œå¿…é¡»å…¶å¯¹åº”çš„resume() è¢«è°ƒç”¨ï¼Œæ‰èƒ½ä½¿å¾—çº¿ç¨‹é‡æ–°è¿›å…¥å¯æ‰§è¡ŒçŠ¶æ€ã€‚ yield()ï¼šä½¿å½“å‰çº¿ç¨‹æ”¾å¼ƒå½“å‰å·²ç»åˆ†å¾—çš„CPU æ—¶é—´ï¼Œ==ä½†ä¸ä½¿å½“å‰çº¿ç¨‹é˜»å¡==ï¼Œå³çº¿ç¨‹ä»å¤„äºå¯æ‰§è¡ŒçŠ¶æ€ï¼Œéšæ—¶å¯èƒ½å†æ¬¡åˆ†å¾— CPU æ—¶é—´ wait() å’Œ notify()ï¼šwait() ä½¿å¾—çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå®ƒæœ‰ä¸¤ç§å½¢å¼ï¼Œä¸€ç§å…è®¸æŒ‡å®šä»¥==æ¯«ç§’==ä¸ºå•ä½çš„ä¸€æ®µæ—¶é—´ä½œä¸ºå‚æ•°ï¼Œå¦ä¸€ç§æ²¡æœ‰å‚æ•°ï¼Œå‰è€…å½“å¯¹åº”çš„ notify() è¢«è°ƒç”¨æˆ–è€…è¶…å‡ºæŒ‡å®šæ—¶é—´æ—¶çº¿ç¨‹é‡æ–°è¿›å…¥å¯æ‰§è¡ŒçŠ¶æ€ï¼Œåè€…åˆ™å¿…é¡»å¯¹åº”çš„ notify() è¢«è°ƒç”¨. wait(),notify()å’Œsuspend(),resume()ä¹‹é—´çš„åŒºåˆ« wait(),notify()å±äºObjectç±»ï¼Œæ‰€æœ‰å¯¹è±¡éƒ½æ‹¥æœ‰è¿™ä¸€å¯¹æ–¹æ³•ï¼›ï¼ˆå› ä¸ºé”æ˜¯ä»»ä½•å¯¹è±¡å…·æœ‰çš„ï¼‰å…¶ä»–æ–¹æ³•å±äºthreadç±»ã€‚å…¶ä»–æ–¹æ³•é˜»å¡æ—¶éƒ½ä¸ä¼šé‡Šæ”¾å ç”¨çš„é”ï¼ˆå¦‚æœå ç”¨äº†çš„è¯ï¼‰ï¼Œè¿™ä¸€å¯¹ä¼šé‡Šæ”¾å ç”¨é” wait(),notify()å¿…é¡»åœ¨ synchronizedæ–¹æ³•æˆ–å—ä¸­è°ƒç”¨ï¼Œå…¶ä»–æ‰€æœ‰æ–¹æ³•å¯åœ¨ä»»ä½•ä½ç½®è°ƒç”¨ã€‚ï¼ˆå› ä¸ºåœ¨synchronizedæ–¹æ³•æˆ–å—ä¸­å½“å‰çº¿ç¨‹æ‰å æœ‰é”ï¼Œæ‰æœ‰é”å¯ä»¥é‡Šæ”¾ã€‚åŒæ ·çš„é“ç†ï¼Œè°ƒç”¨è¿™ä¸€å¯¹æ–¹æ³•çš„å¯¹è±¡ä¸Šçš„é”å¿…é¡»ä¸ºå½“å‰çº¿ç¨‹æ‰€æ‹¥æœ‰ï¼Œè¿™æ ·æ‰æœ‰é”å¯ä»¥é‡Šæ”¾ï¼‰å¦‚æœæ²¡æœ‰æ”¾åœ¨åŒæ­¥æ–¹æ³•æˆ–åŒæ­¥å—ä¸­ï¼Œä¼šæŠ¥IllegalMonitorStateException å…³äº wait() å’Œ notify() æ–¹æ³•æœ€åå†è¯´æ˜ä¸¤ç‚¹ï¼šç¬¬ä¸€ï¼šè°ƒç”¨notify() æ–¹æ³•å¯¼è‡´è§£é™¤é˜»å¡çš„çº¿ç¨‹æ˜¯ä»å› è°ƒç”¨è¯¥å¯¹è±¡çš„ wait() æ–¹æ³•è€Œé˜»å¡çš„çº¿ç¨‹ä¸­==éšæœºé€‰å–==çš„ï¼Œæˆ‘ä»¬æ— æ³•é¢„æ–™å“ªä¸€ä¸ªçº¿ç¨‹å°†ä¼šè¢«é€‰æ‹©ï¼Œæ‰€ä»¥ç¼–ç¨‹æ—¶è¦ç‰¹åˆ«å°å¿ƒï¼Œé¿å…å› è¿™ç§ä¸ç¡®å®šæ€§è€Œäº§ç”Ÿé—®é¢˜ã€‚ ç¬¬äºŒï¼šé™¤äº† notify()ï¼Œè¿˜æœ‰ä¸€ä¸ªæ–¹æ³• notifyAll()ä¹Ÿå¯èµ·åˆ°ç±»ä¼¼ä½œç”¨ï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºï¼Œè°ƒç”¨ notifyAll()æ–¹æ³•å°†æŠŠå› è°ƒç”¨è¯¥å¯¹è±¡çš„ wait()æ–¹æ³•è€Œé˜»å¡çš„æ‰€æœ‰çº¿ç¨‹ä¸€æ¬¡æ€§å…¨éƒ¨è§£é™¤é˜»å¡ã€‚å½“ç„¶ï¼Œåªæœ‰è·å¾—é”çš„é‚£ä¸€ä¸ªçº¿ç¨‹æ‰èƒ½è¿›å…¥å¯æ‰§è¡ŒçŠ¶æ€ã€‚ ç‰¹åˆ«æ³¨æ„ï¼šuspend() æ–¹æ³•å’Œä¸æŒ‡å®šè¶…æ—¶æœŸé™çš„ wait() æ–¹æ³•çš„è°ƒç”¨éƒ½å¯èƒ½äº§ç”Ÿæ­»é” wait()æ–¹æ³•å’Œnotify()/notifyAll()æ–¹æ³•åœ¨æ”¾å¼ƒå¯¹è±¡ç›‘è§†å™¨æ—¶æœ‰ä»€ä¹ˆåŒºåˆ« wait()æ–¹æ³•==ç«‹å³é‡Šæ”¾å¯¹è±¡ç›‘è§†å™¨==ï¼Œnotify()/notifyAll()æ–¹æ³•åˆ™ä¼š==ç­‰å¾…çº¿ç¨‹å‰©ä½™ä»£ç æ‰§è¡Œå®Œ==æ¯•æ‰ä¼šæ”¾å¼ƒå¯¹è±¡ç›‘è§†å™¨ã€‚ æ ‡å‡†ä½¿ç”¨waitç¤ºä¾‹ 12345synchronized (obj) &#123;while (condition does not hold) obj.wait(); // (Releases lock, and reacquires on wakeup)... // Perform action appropriate to condition&#125; å…«ã€äº§ç”Ÿæ­»é”çš„æ¡ä»¶ ==äº’æ–¥æ¡ä»¶==ï¼šä¸€ä¸ªèµ„æºæ¯æ¬¡åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ã€‚ ==è¯·æ±‚ä¸ä¿æŒæ¡ä»¶ï¼š==ä¸€ä¸ªè¿›ç¨‹å› è¯·æ±‚èµ„æºè€Œé˜»å¡æ—¶ï¼Œå¯¹å·²è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ã€‚ ==ä¸å‰¥å¤ºæ¡ä»¶:è¿›ç¨‹å·²è·å¾—çš„èµ„æº==ï¼Œåœ¨æœ«ä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸èƒ½å¼ºè¡Œå‰¥å¤ºã€‚ ==å¾ªç¯ç­‰å¾…æ¡ä»¶==:è‹¥å¹²è¿›ç¨‹ä¹‹é—´å½¢æˆä¸€ç§å¤´å°¾ç›¸æ¥çš„å¾ªç¯ç­‰å¾…èµ„æºå…³ç³»ã€‚ synchronizedå’ŒReentrantLockçš„åŒºåˆ«Â· synchronizedæ˜¯å’Œifã€elseã€forã€whileä¸€æ ·çš„==å…³é”®å­—==ï¼ŒReentrantLockæ˜¯==ç±»==ï¼Œè¿™æ˜¯äºŒè€…çš„æœ¬è´¨åŒºåˆ«ã€‚æ—¢ç„¶ReentrantLockæ˜¯ç±»ï¼Œé‚£ä¹ˆå®ƒå°±æä¾›äº†æ¯”synchronizedæ›´å¤šæ›´çµæ´»çš„ç‰¹æ€§ï¼Œå¯ä»¥è¢«ç»§æ‰¿ã€å¯ä»¥æœ‰æ–¹æ³•ã€å¯ä»¥æœ‰å„ç§å„æ ·çš„ç±»å˜é‡ï¼ŒReentrantLockæ¯”synchronizedçš„æ‰©å±•æ€§ä½“ç°åœ¨å‡ ç‚¹ä¸Šï¼šï¼ˆ1ï¼‰ReentrantLockå¯ä»¥å¯¹è·å–é”çš„ç­‰å¾…æ—¶é—´è¿›è¡Œè®¾ç½®ï¼Œè¿™æ ·å°±==é¿å…äº†æ­»é”==ï¼ˆ2ï¼‰ReentrantLockå¯ä»¥è·å–å„ç§é”çš„ä¿¡æ¯ï¼ˆ3ï¼‰ReentrantLockå¯ä»¥çµæ´»åœ°å®ç°==å¤šè·¯é€šçŸ¥==å¦å¤–ï¼ŒäºŒè€…çš„é”æœºåˆ¶å…¶å®ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„:ReentrantLockåº•å±‚è°ƒç”¨çš„æ˜¯Unsafeçš„parkæ–¹æ³•åŠ é”ï¼Œsynchronizedæ“ä½œçš„åº”è¯¥æ˜¯å¯¹è±¡å¤´ä¸­mark ``word. Javaå¯¹è±¡ç»“æ„ä¸é”å®ç°åŸç†åŠMarkWordè¯¦è§£ ä¸€ä¸ªçº¿ç¨‹å¦‚æœå‡ºç°äº†è¿è¡Œæ—¶å¼‚å¸¸æ€ä¹ˆåŠ? å¦‚æœè¿™ä¸ªå¼‚å¸¸æ²¡æœ‰è¢«æ•è·çš„è¯ï¼Œè¿™ä¸ªçº¿ç¨‹å°±åœæ­¢æ‰§è¡Œäº†ã€‚å¦å¤–é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼šå¦‚æœè¿™ä¸ªçº¿ç¨‹æŒæœ‰æŸä¸ªæŸä¸ªå¯¹è±¡çš„ç›‘è§†å™¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡ç›‘è§†å™¨ä¼šè¢«ç«‹å³é‡Šæ”¾ çº¿ç¨‹å…±äº«æ•°æ®æ–¹æ³• é€šè¿‡åœ¨çº¿ç¨‹ä¹‹é—´å…±äº«å¯¹è±¡å°±å¯ä»¥äº†ï¼Œç„¶åé€šè¿‡wait/notify/notifyAllã€await/signal/signalAllè¿›è¡Œå”¤èµ·å’Œç­‰å¾…ï¼Œæ¯”æ–¹è¯´é˜»å¡é˜Ÿåˆ—BlockingQueueå°±æ˜¯ä¸ºçº¿ç¨‹ä¹‹é—´å…±äº«æ•°æ®è€Œè®¾è®¡çš„ ä¹ã€javaä¸­é”ç§ç±»é”æä¾›äº†ä¸¤ç§ä¸»è¦ç‰¹æ€§ï¼šäº’æ–¥ï¼ˆmutual exclusionï¼‰ å’Œå¯è§æ€§ï¼ˆvisibilityï¼‰ é”çš„çŠ¶æ€ è‡ªæ—‹é” ==å…±äº«æ•°æ®çš„é”å®šçŠ¶æ€==åªä¼šæŒç»­å¾ˆçŸ­çš„æ—¶é—´ï¼Œä¸ºäº†è¿™ä¸€å°æ®µæ—¶é—´è€Œå»æŒ‚èµ·å’Œæ¢å¤çº¿ç¨‹æœ‰ç‚¹æµªè´¹ï¼Œæ‰€ä»¥è¿™é‡Œå°±åšäº†ä¸€ä¸ªå¤„ç†ï¼Œè®©åé¢è¯·æ±‚é”çš„é‚£ä¸ªçº¿ç¨‹åœ¨ç¨ç­‰ä¸€ä¼šï¼Œä½†æ˜¯ä¸æ”¾å¼ƒå¤„ç†å™¨çš„æ‰§è¡Œæ—¶é—´ï¼Œçœ‹çœ‹æŒæœ‰é”çš„çº¿ç¨‹èƒ½å¦å¿«é€Ÿé‡Šæ”¾ ==ä¸ºäº†è®©çº¿ç¨‹ç­‰å¾…ï¼Œæ‰€ä»¥éœ€è¦è®©çº¿ç¨‹æ‰§è¡Œä¸€ä¸ªå¿™å¾ªç¯ä¹Ÿå°±æ˜¯è‡ªæ—‹æ“ä½œ== åœ¨jdk6ä¹‹åï¼Œå¼•å…¥äº†è‡ªé€‚åº”çš„è‡ªæ—‹é”ï¼Œä¹Ÿå°±æ˜¯ç­‰å¾…çš„æ—¶é—´ä¸å†å›ºå®šäº†ï¼Œè€Œæ˜¯ç”±ä¸Šä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªæ—‹æ—¶é—´åŠé”çš„æ‹¥æœ‰è€…çŠ¶æ€æ¥å†³å®š ==å¥½å¤„æ˜¯å‡å°‘çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¶ˆè€—ï¼Œç¼ºç‚¹æ˜¯å¾ªç¯ä¼šæ¶ˆè€—CPUã€‚== åå‘é” ç›®çš„æ˜¯æ¶ˆé™¤æ•°æ®åœ¨æ— ç«äº‰æƒ…å†µä¸‹çš„åŒæ­¥åŸè¯­ã€‚è¿›ä¸€æ­¥æå‡ç¨‹åºçš„è¿è¡Œæ€§èƒ½ã€‚ ==è¿™ä¸ªé”ä¼šåå‘ç¬¬ä¸€ä¸ªè·å¾—ä»–çš„çº¿ç¨‹ï¼Œå¦‚æœæ¥ä¸‹æ¥çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè¯¥é”æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹è·å–ï¼Œåˆ™æŒæœ‰åå‘é”çš„çº¿ç¨‹å°†æ°¸è¿œä¸éœ€è¦å†è¿›è¡ŒåŒæ­¥ã€‚== åå‘é”å¯ä»¥æé«˜å¸¦æœ‰åŒæ­¥ä½†æ— ç«äº‰çš„ç¨‹åºæ€§èƒ½ï¼Œä¹Ÿå°±æ˜¯è¯´ä»–å¹¶ä¸ä¸€å®šæ€»æ˜¯å¯¹ç¨‹åºè¿è¡Œæœ‰åˆ©ï¼Œå¦‚æœç¨‹åºä¸­å¤§å¤šæ•°çš„é”éƒ½æ˜¯è¢«å¤šä¸ªä¸åŒçš„çº¿ç¨‹è®¿é—®ï¼Œé‚£åå‘æ¨¡å¼å°±æ˜¯å¤šä½™çš„ï¼Œåœ¨å…·ä½“é—®é¢˜å…·ä½“åˆ†æçš„å‰æä¸‹ï¼Œå¯ä»¥è€ƒè™‘æ˜¯å¦ä½¿ç”¨åå‘é”ã€‚ è½»é‡çº§é”/é‡é‡çº§é” ä¸ºäº†å‡å°‘è·å¾—é”å’Œé‡Šæ”¾é”å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€— åœ¨Java SE1.6é‡Œé”ä¸€å…±æœ‰å››ç§çŠ¶æ€ï¼Œæ— é”çŠ¶æ€ï¼Œåå‘é”çŠ¶æ€ï¼Œè½»é‡çº§é”çŠ¶æ€å’Œé‡é‡çº§é”çŠ¶æ€ï¼Œå®ƒä¼šéšç€ç«äº‰æƒ…å†µé€æ¸å‡çº§ã€‚==é”å¯ä»¥å‡çº§ä½†ä¸èƒ½é™çº§==ï¼Œæ„å‘³ç€åå‘é”å‡çº§æˆè½»é‡çº§é”åä¸èƒ½é™çº§æˆåå‘é” å››ç§é”çš„çŠ¶æ€æ˜¯é€šè¿‡å¯¹è±¡ç›‘è§†å™¨åœ¨å¯¹è±¡å¤´ä¸­çš„å­—æ®µæ¥è¡¨æ˜çš„ã€‚ åå‘é”æ˜¯æŒ‡ä¸€æ®µåŒæ­¥ä»£ç ä¸€ç›´è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€è®¿é—®ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹ä¼šè‡ªåŠ¨è·å–é”ã€‚é™ä½è·å–é”çš„ä»£ä»·ã€‚ è½»é‡çº§é”æ˜¯æŒ‡å½“é”æ˜¯åå‘é”çš„æ—¶å€™ï¼Œè¢«å¦ä¸€ä¸ªçº¿ç¨‹æ‰€è®¿é—®ï¼Œåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œå…¶ä»–çº¿ç¨‹ä¼šé€šè¿‡è‡ªæ—‹çš„å½¢å¼å°è¯•è·å–é”ï¼Œä¸ä¼šé˜»å¡ï¼Œæé«˜æ€§èƒ½ã€‚ é‡é‡çº§é”æ˜¯æŒ‡å½“é”ä¸ºè½»é‡çº§é”çš„æ—¶å€™ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹è™½ç„¶æ˜¯è‡ªæ—‹ï¼Œä½†è‡ªæ—‹ä¸ä¼šä¸€ç›´æŒç»­ä¸‹å»ï¼Œå½“è‡ªæ—‹ä¸€å®šæ¬¡æ•°çš„æ—¶å€™ï¼Œè¿˜æ²¡æœ‰è·å–åˆ°é”ï¼Œå°±ä¼šè¿›å…¥é˜»å¡ï¼Œè¯¥é”è†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚==é‡é‡çº§é”ä¼šè®©ä»–ç”³è¯·çš„çº¿ç¨‹è¿›å…¥é˜»å¡ï¼Œæ€§èƒ½é™ä½ã€‚== é”çš„ç§ç±» ç‹¬äº«é”/å…±äº«é”ï¼šç‹¬äº«é”æ˜¯æŒ‡==è¯¥é”ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€æŒæœ‰==ï¼›å…±äº«é”æ˜¯æŒ‡==è¯¥é”å¯è¢«å¤šä¸ªçº¿ç¨‹æ‰€æŒæœ‰==ã€‚ å¯¹äºJava ReentrantLockè€Œè¨€ï¼Œå…¶æ˜¯ç‹¬äº«é”ã€‚ä½†æ˜¯å¯¹äºLockçš„å¦ä¸€ä¸ªå®ç°ç±»ReadWriteLockï¼Œå…¶è¯»é”æ˜¯å…±äº«é”ï¼Œå…¶å†™é”æ˜¯ç‹¬äº«é”ã€‚ å¯¹äºSynchronizedè€Œè¨€ï¼Œå½“ç„¶æ˜¯ç‹¬äº«é”ã€‚ è¯»é”çš„å…±äº«é”å¯ä¿è¯å¹¶å‘è¯»æ˜¯éå¸¸é«˜æ•ˆçš„ï¼Œè¯»å†™ï¼Œå†™è¯»ï¼Œå†™å†™çš„è¿‡ç¨‹æ˜¯äº’æ–¥çš„ã€‚ ç‹¬äº«é”ä¸å…±äº«é”ä¹Ÿæ˜¯é€šè¿‡AQSæ¥å®ç°çš„ï¼Œé€šè¿‡å®ç°ä¸åŒçš„æ–¹æ³•ï¼Œæ¥å®ç°ç‹¬äº«æˆ–è€…å…±äº«ã€‚ äº’æ–¥é”/è¯»å†™é”:å³ç‹¬äº«é”å’Œå…±äº«é”çš„å…·ä½“å®ç° å¯é‡å…¥é”ï¼šåˆåé€’å½’é”ï¼Œæ˜¯æŒ‡åœ¨åŒä¸€ä¸ªçº¿ç¨‹åœ¨å¤–å±‚æ–¹æ³•è·å–é”çš„æ—¶å€™ï¼Œåœ¨è¿›å…¥å†…å±‚æ–¹æ³•ä¼šè‡ªåŠ¨è·å–é” å¯¹äºJava ReetrantLockè€Œè¨€ï¼Œä»åå­—å°±å¯ä»¥çœ‹å‡ºæ˜¯ä¸€ä¸ªé‡å…¥é”ï¼Œå…¶åå­—æ˜¯Re entrant Lock é‡æ–°è¿›å…¥é”ã€‚ å¯¹äºSynchronizedè€Œè¨€ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¯é‡å…¥é”ã€‚å¯é‡å…¥é”çš„ä¸€ä¸ªå¥½å¤„æ˜¯==å¯ä¸€å®šç¨‹åº¦é¿å…æ­»é”ã€‚== 12345678synchronized void setA() throws Exception&#123; Thread.sleep(1000); setB();&#125;//å¦‚æœä¸æ˜¯å¯é‡å…¥é”çš„è¯ï¼ŒsetBå¯èƒ½ä¸ä¼šè¢«å½“å‰çº¿ç¨‹æ‰§è¡Œï¼Œå¯èƒ½é€ æˆæ­»é”ã€‚synchronized void setB() throws Exception&#123; Thread.sleep(1000);&#125; å…¬å¹³é”å’Œéå…¬å¹³é”ï¼š å…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹æŒ‰ç…§==ç”³è¯·é”çš„é¡ºåº==æ¥è·å–é”ã€‚ éå…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹è·å–é”çš„é¡ºåºå¹¶ä¸æ˜¯æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºï¼Œæœ‰å¯èƒ½åç”³è¯·çš„çº¿ç¨‹æ¯”å…ˆç”³è¯·çš„çº¿ç¨‹ä¼˜å…ˆè·å–é”ã€‚æœ‰å¯èƒ½ï¼Œä¼šé€ æˆä¼˜å…ˆçº§åè½¬æˆ–è€…é¥¥é¥¿ç°è±¡ã€‚ å¯¹äºJava ReetrantLockè€Œè¨€ï¼Œé€šè¿‡æ„é€ å‡½æ•°æŒ‡å®šè¯¥é”æ˜¯å¦æ˜¯å…¬å¹³é”ï¼Œé»˜è®¤æ˜¯éå…¬å¹³é”ã€‚éå…¬å¹³é”çš„ä¼˜ç‚¹åœ¨äº==ååé‡æ¯”å…¬å¹³é”å¤§==ã€‚ å¯¹äºSynchronizedè€Œè¨€ï¼Œä¹Ÿæ˜¯ä¸€ç§éå…¬å¹³é”ã€‚ç”±äºå…¶å¹¶ä¸åƒReentrantLockæ˜¯é€šè¿‡AQSçš„æ¥å®ç°çº¿ç¨‹è°ƒåº¦ï¼Œæ‰€ä»¥==å¹¶æ²¡æœ‰ä»»ä½•åŠæ³•ä½¿å…¶å˜æˆå…¬å¹³é”==ã€‚ é”çš„è®¾è®¡ ä¹è§‚é”/æ‚²è§‚é”ï¼šä¸»è¦æ˜¯æŒ‡çœ‹å¾…==å¹¶å‘åŒæ­¥==çš„è§’åº¦ ==æ‚²è§‚é”é€‚åˆå†™æ“ä½œéå¸¸å¤šçš„åœºæ™¯ï¼Œä¹è§‚é”é€‚åˆè¯»æ“ä½œéå¸¸å¤šçš„åœºæ™¯ï¼Œä¸åŠ é”ä¼šå¸¦æ¥å¤§é‡çš„æ€§èƒ½æå‡ã€‚== ä¹è§‚é”ï¼šé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆä¹è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œ==ä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®==ï¼Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·ç­‰æœºåˆ¶ã€‚ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡ï¼Œåœ¨Javaä¸­java.util.concurrent.atomicåŒ…ä¸‹é¢çš„==åŸå­å˜é‡ç±»==å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é”çš„ä¸€ç§å®ç°æ–¹å¼==CAS(Compare and Swap)== æ¯”è¾ƒå¹¶äº¤æ¢)å®ç°çš„ã€‚ ä¹è§‚é”åœ¨Javaä¸­çš„ä½¿ç”¨ï¼Œæ˜¯==æ— é”ç¼–ç¨‹==ï¼Œå¸¸å¸¸é‡‡ç”¨çš„æ˜¯==CASç®—æ³•==ï¼Œå…¸å‹çš„ä¾‹å­å°±æ˜¯åŸå­ç±»ï¼Œé€šè¿‡==CASè‡ªæ—‹==å®ç°åŸå­æ“ä½œçš„æ›´æ–°ã€‚ æ•°æ®ç‰ˆæœ¬æœºåˆ¶ å®ç°æ•°æ®ç‰ˆæœ¬ä¸€èˆ¬æœ‰ä¸¤ç§ï¼Œç¬¬ä¸€ç§æ˜¯ä½¿ç”¨ç‰ˆæœ¬å·ï¼Œç¬¬äºŒç§æ˜¯ä½¿ç”¨æ—¶é—´æˆ³ã€‚ä»¥ç‰ˆæœ¬å·æ–¹å¼ä¸ºä¾‹ã€‚ ç‰ˆæœ¬å·æ–¹å¼ï¼šä¸€èˆ¬æ˜¯åœ¨æ•°æ®è¡¨ä¸­åŠ ä¸Šä¸€ä¸ªæ•°æ®ç‰ˆæœ¬å·versionå­—æ®µï¼Œè¡¨ç¤ºæ•°æ®è¢«ä¿®æ”¹çš„æ¬¡æ•°ï¼Œå½“æ•°æ®è¢«ä¿®æ”¹æ—¶ï¼Œversionå€¼ä¼šåŠ ä¸€ã€‚å½“çº¿ç¨‹Aè¦æ›´æ–°æ•°æ®å€¼æ—¶ï¼Œåœ¨è¯»å–æ•°æ®çš„åŒæ—¶ä¹Ÿä¼šè¯»å–versionå€¼ï¼Œåœ¨æäº¤æ›´æ–°æ—¶ï¼Œè‹¥åˆšæ‰è¯»å–åˆ°çš„versionå€¼ä¸ºå½“å‰æ•°æ®åº“ä¸­çš„versionå€¼ç›¸ç­‰æ—¶æ‰æ›´æ–°ï¼Œå¦åˆ™é‡è¯•æ›´æ–°æ“ä½œï¼Œç›´åˆ°æ›´æ–°æˆåŠŸã€‚ æ ¸å¿ƒSQLä»£ç ï¼š 1update table set xxx=#&#123;xxx&#125;, version=version+1 where id=#&#123;id&#125; and version=#&#123;version&#125;; CASæ“ä½œ CASï¼ˆCompare and Swap æ¯”è¾ƒå¹¶äº¤æ¢ï¼‰ï¼Œå½“å¤šä¸ªçº¿ç¨‹å°è¯•ä½¿ç”¨CASåŒæ—¶æ›´æ–°åŒä¸€ä¸ªå˜é‡æ—¶ï¼Œåªæœ‰å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹èƒ½æ›´æ–°å˜é‡çš„å€¼ï¼Œè€Œå…¶å®ƒçº¿ç¨‹éƒ½å¤±è´¥ï¼Œ==å¤±è´¥çš„çº¿ç¨‹å¹¶ä¸ä¼šè¢«æŒ‚èµ·ï¼Œè€Œæ˜¯è¢«å‘ŠçŸ¥è¿™æ¬¡ç«äº‰ä¸­å¤±è´¥ï¼Œå¹¶å¯ä»¥å†æ¬¡å°è¯•ã€‚== CASæ“ä½œä¸­åŒ…å«ä¸‰ä¸ªæ“ä½œæ•°â€”â€”==éœ€è¦è¯»å†™çš„å†…å­˜ä½ç½®(V)==ã€==è¿›è¡Œæ¯”è¾ƒçš„é¢„æœŸåŸå€¼(A)==å’Œ==æ‹Ÿå†™å…¥çš„æ–°å€¼(B)==ã€‚å¦‚æœå†…å­˜ä½ç½®Vçš„å€¼ä¸é¢„æœŸåŸå€¼Aç›¸åŒ¹é…ï¼Œé‚£ä¹ˆå¤„ç†å™¨ä¼šè‡ªåŠ¨å°†è¯¥ä½ç½®å€¼æ›´æ–°ä¸ºæ–°å€¼Bï¼Œå¦åˆ™å¤„ç†å™¨ä¸åšä»»ä½•æ“ä½œã€‚ ä»¥java.util.concurrentåŒ…ä¸­çš„AtomicIntegerä¸ºä¾‹ï¼Œçœ‹ä¸€ä¸‹åœ¨ä¸ä½¿ç”¨é”çš„æƒ…å†µä¸‹æ˜¯å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä¸»è¦ç†è§£getAndIncrementæ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„ä½œç”¨ç›¸å½“äº++iæ“ä½œ 12345678910111213141516171819public class AtomicInteger extends Number implements java.io.Serializable&#123; private volatile int value; //CASä¸­å¿…é¡»ä½¿ç”¨volatileå˜é‡ï¼Œä¿è¯æ‹¿åˆ°çš„å˜é‡æ—¶ä¸»å†…å­˜ä¸­æœ€æ–°å€¼ public final int get()&#123; return value; &#125; public final int getAndIncrement()&#123; for (;;)&#123; int current = get(); int next = current + 1; if (compareAndSet(current, next)) //è·å–å€¼åæŸ¥çœ‹å€¼æ˜¯å¦æ›´æ–° return current; &#125; &#125; public final boolean compareAndSet(int expect, int update)&#123; return unsafe.compareAndSwapInt(this, valueOffset, expect, update); &#125;&#125; æ‚²è§‚é”ï¼šæ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šé˜»å¡ç›´åˆ°å®ƒæ‹¿åˆ°é”ã€‚æ¯”å¦‚Javaé‡Œé¢çš„åŒæ­¥åŸè¯­synchronizedå…³é”®å­—çš„å®ç°å°±æ˜¯æ‚²è§‚é”ã€‚ æ‚²è§‚é”åœ¨Javaä¸­çš„ä½¿ç”¨ï¼Œå°±æ˜¯åˆ©ç”¨å„ç§é” åœ¨å¯¹ä»»æ„è®°å½•è¿›è¡Œä¿®æ”¹å‰ï¼Œå…ˆå°è¯•ä¸ºè¯¥è®°å½•åŠ ä¸Šæ’ä»–é”ï¼ˆexclusive lockingï¼‰ã€‚ å¦‚æœåŠ é”å¤±è´¥ï¼Œè¯´æ˜è¯¥è®°å½•æ­£åœ¨è¢«ä¿®æ”¹ï¼Œé‚£ä¹ˆå½“å‰æŸ¥è¯¢å¯èƒ½è¦==ç­‰å¾…==æˆ–è€…==æŠ›å‡ºå¼‚å¸¸==ã€‚å…·ä½“å“åº”æ–¹å¼ç”±å¼€å‘è€…æ ¹æ®å®é™…éœ€è¦å†³å®šã€‚ å¦‚æœæˆåŠŸåŠ é”ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¯¹è®°å½•åšä¿®æ”¹ï¼Œäº‹åŠ¡å®Œæˆåå°±ä¼šè§£é”äº†ã€‚ æœŸé—´å¦‚æœæœ‰å…¶ä»–å¯¹è¯¥è®°å½•åšä¿®æ”¹æˆ–åŠ æ’ä»–é”çš„æ“ä½œï¼Œéƒ½ä¼š==ç­‰å¾…==æˆ‘ä»¬è§£é”æˆ–ç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚ åˆ†æ®µé”ï¼šå¯¹äºConcurrentHashMapè€Œè¨€ï¼Œå…¶å¹¶å‘çš„å®ç°å°±æ˜¯==é€šè¿‡åˆ†æ®µé”çš„å½¢å¼==æ¥å®ç°é«˜æ•ˆçš„å¹¶å‘æ“ä½œ ä»¥ConcurrentHashMapæ¥è¯´ä¸€ä¸‹åˆ†æ®µé”çš„å«ä¹‰ä»¥åŠè®¾è®¡æ€æƒ³ï¼ŒConcurrentHashMapä¸­çš„åˆ†æ®µé”ç§°ä¸ºSegmentï¼Œå®ƒå³ç±»ä¼¼äºHashMapï¼ˆJDK7å’ŒJDK8ä¸­HashMapçš„å®ç°ï¼‰çš„ç»“æ„ï¼Œå³==å†…éƒ¨æ‹¥æœ‰ä¸€ä¸ªEntryæ•°ç»„ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ åˆæ˜¯ä¸€ä¸ªé“¾è¡¨ï¼›åŒæ—¶åˆæ˜¯ä¸€ä¸ªReentrantLockï¼ˆSegmentç»§æ‰¿äº†ReentrantLockï¼‰==ã€‚ å½“éœ€è¦putå…ƒç´ çš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯å¯¹æ•´ä¸ªhashmapè¿›è¡ŒåŠ é”ï¼Œè€Œæ˜¯å…ˆé€šè¿‡hashcodeæ¥çŸ¥é“ä»–è¦æ”¾åœ¨å“ªä¸€ä¸ªåˆ†æ®µä¸­ï¼Œç„¶åå¯¹è¿™ä¸ªåˆ†æ®µè¿›è¡ŒåŠ é”ï¼Œæ‰€ä»¥å½“å¤šçº¿ç¨‹putçš„æ—¶å€™ï¼Œåªè¦ä¸æ˜¯æ”¾åœ¨ä¸€ä¸ªåˆ†æ®µä¸­ï¼Œå°±å®ç°äº†çœŸæ­£çš„å¹¶è¡Œçš„æ’å…¥ ä½†æ˜¯ï¼Œåœ¨ç»Ÿè®¡sizeçš„æ—¶å€™ï¼Œå¯å°±æ˜¯è·å–hashmapå…¨å±€ä¿¡æ¯çš„æ—¶å€™ï¼Œå°±éœ€è¦è·å–æ‰€æœ‰çš„åˆ†æ®µé”æ‰èƒ½ç»Ÿè®¡ã€‚ åˆ†æ®µé”çš„è®¾è®¡ç›®çš„æ˜¯==ç»†åŒ–é”çš„ç²’åº¦==ï¼Œå½“æ“ä½œä¸éœ€è¦æ›´æ–°æ•´ä¸ªæ•°ç»„çš„æ—¶å€™ï¼Œå°±ä»…ä»…é’ˆå¯¹æ•°ç»„ä¸­çš„ä¸€é¡¹è¿›è¡ŒåŠ é”æ“ä½œã€‚ é”çš„ä½¿ç”¨javaé”çš„ä½¿ç”¨å’Œç§ç±» é¢„å¤‡çŸ¥è¯† AQSï¼šAbstractQueuedSynchronized æŠ½è±¡é˜Ÿåˆ—å¼çš„åŒæ­¥å™¨ï¼ŒAQSå®šä¹‰äº†ä¸€å¥—==å¤šçº¿ç¨‹è®¿é—®å…±äº«èµ„æºçš„åŒæ­¥å™¨æ¡†æ¶==ï¼Œè®¸å¤šåŒæ­¥ç±»å®ç°éƒ½ä¾èµ–äºå®ƒï¼Œå¦‚å¸¸ç”¨çš„ReentrantLock/Semaphore/CountDownLatchâ€¦ AQSç»´æŠ¤äº†ä¸€ä¸ªvolatile int state(ä»£è¡¨==å…±äº«èµ„æº)==å’Œä¸€ä¸ªFIFOçº¿ç¨‹ç­‰å¾…é˜Ÿåˆ—ï¼ˆ==å¤šçº¿ç¨‹äº‰ç”¨èµ„æºè¢«é˜»å¡æ—¶ä¼šè¿›å…¥æ­¤é˜Ÿåˆ—==ï¼‰ã€‚ stateçš„è®¿é—®æ–¹å¼ï¼š 123getState();setState();compareAndSetState(); AQSå®šä¹‰ä¸¤ç§èµ„æºå…±äº«æ–¹å¼ï¼šExclusiveï¼ˆç‹¬å ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‰§è¡Œï¼Œå¦‚ReentrantLockï¼‰å’ŒShareï¼ˆå…±äº«ï¼Œå¤šä¸ªçº¿ç¨‹å¯åŒæ—¶æ‰§è¡Œï¼Œå¦‚Semaphore/CountDownLatchï¼‰ã€‚ è‡ªå®šä¹‰åŒæ­¥å™¨å®ç°æ—¶ä¸»è¦å®ç°ä»¥ä¸‹å‡ ç§æ–¹æ³• 12345isHeldExclusively()//è¯¥çº¿ç¨‹æ˜¯å¦æ­£åœ¨ç‹¬å èµ„æºã€‚åªæœ‰ç”¨åˆ°conditionæ‰éœ€è¦å»å®ç°å®ƒã€‚tryAquire(int)//ç‹¬å æ–¹å¼ã€‚å°è¯•è·å–èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›falseã€‚tryRelease(int)//ç‹¬å æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›falseã€‚tryAcquireShared(int)//å…±äº«æ–¹å¼ã€‚å°è¯•è·å–èµ„æºã€‚è´Ÿæ•°è¡¨ç¤ºå¤±è´¥ï¼›0è¡¨ç¤ºæˆåŠŸï¼Œä½†æ²¡æœ‰å‰©ä½™å¯ç”¨èµ„æºï¼›æ­£æ•°è¡¨ç¤ºæˆåŠŸï¼Œä¸”æœ‰å‰©ä½™èµ„æºã€‚tryReleaseShared(int)//å…±äº«æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼Œå¦‚æœé‡Šæ”¾åå…è®¸å”¤é†’åç»­ç­‰å¾…ç»“ç‚¹è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚ ä»¥ReentrantLockä¸ºä¾‹ï¼Œstateåˆå§‹åŒ–ä¸º0ï¼Œè¡¨ç¤ºæœªé”å®šçŠ¶æ€ã€‚Açº¿ç¨‹lock()æ—¶ï¼Œä¼šè°ƒç”¨tryAcquire()ç‹¬å è¯¥é”å¹¶å°†state+1ã€‚æ­¤åï¼Œå…¶ä»–çº¿ç¨‹å†tryAcquire()æ—¶å°±ä¼šå¤±è´¥ï¼Œç›´åˆ°Açº¿ç¨‹unlock()åˆ°state=0ï¼ˆå³é‡Šæ”¾é”ï¼‰ä¸ºæ­¢ï¼Œå…¶ä»–çº¿ç¨‹æ‰æœ‰æœºä¼šè·å–è¯¥é”ã€‚å½“ç„¶ï¼Œé‡Šæ”¾é”ä¹‹å‰ï¼ŒAçº¿ç¨‹è‡ªå·±æ˜¯å¯ä»¥é‡å¤è·å–æ­¤é”çš„ï¼ˆstateä¼šç´¯åŠ ï¼‰ï¼Œè¿™å°±æ˜¯å¯é‡å…¥çš„æ¦‚å¿µã€‚ä½†è¦æ³¨æ„ï¼Œè·å–å¤šå°‘æ¬¡å°±è¦é‡Šæ”¾å¤šå°‘æ¬¡ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯stateæ˜¯èƒ½å›åˆ°é›¶æ€çš„ã€‚ å†ä»¥CountDownLatchä¸ºä¾‹ï¼Œä»»åŠ¡åˆ†ä¸ºNä¸ªå­çº¿ç¨‹å»æ‰§è¡Œï¼Œstateä¸ºåˆå§‹åŒ–ä¸ºNï¼ˆæ³¨æ„Nè¦ä¸çº¿ç¨‹ä¸ªæ•°ä¸€è‡´ï¼‰ã€‚è¿™Nä¸ªå­çº¿ç¨‹æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼Œæ¯ä¸ªå­çº¿ç¨‹æ‰§è¡Œå®ŒåcountDown()ä¸€æ¬¡ï¼Œstateä¼šCASå‡1ã€‚ç­‰åˆ°æ‰€æœ‰å­çº¿ç¨‹éƒ½æ‰§è¡Œå®Œåï¼ˆå³state=0ï¼‰ï¼Œä¼šunpark()ä¸»è°ƒç”¨çº¿ç¨‹ï¼Œç„¶åä¸»è°ƒç”¨çº¿ç¨‹å°±ä¼šawait()å‡½æ•°è¿”å›ï¼Œç»§ç»­åä½™åŠ¨ä½œã€‚ æ³¨ ï¼šAQSä¹Ÿæ”¯æŒè‡ªå®šä¹‰åŒæ­¥å™¨åŒæ—¶å®ç°ç‹¬å å’Œå…±äº«ä¸¤ç§æ–¹å¼ï¼Œå¦‚ReentrantReadWriteLockã€‚ åã€ ThreadLocalçº¿ç¨‹å±€éƒ¨å˜é‡æ˜¯å±€é™äºçº¿ç¨‹å†…éƒ¨çš„å˜é‡ï¼Œå±äºçº¿ç¨‹è‡ªèº«æ‰€æœ‰ï¼Œä¸åœ¨å¤šä¸ªçº¿ç¨‹é—´å…±äº«ï¼ŒJavaæä¾›ThreadLocalç±»æ¥æ”¯æŒçº¿ç¨‹å±€éƒ¨å˜é‡ï¼Œæ˜¯ä¸€ç§å®ç°çº¿ç¨‹å®‰å…¨çš„æ–¹å¼ã€‚ ä½†æ˜¯åœ¨ç®¡ç†ç¯å¢ƒä¸‹ï¼ˆå¦‚ web æœåŠ¡å™¨ï¼‰ä½¿ç”¨çº¿ç¨‹å±€éƒ¨å˜é‡çš„æ—¶å€™è¦ç‰¹åˆ«å°å¿ƒï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå·¥ä½œçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸæ¯”ä»»ä½•åº”ç”¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸéƒ½è¦é•¿ã€‚==ä»»ä½•çº¿ç¨‹å±€éƒ¨å˜é‡ä¸€æ—¦åœ¨å·¥ä½œå®Œæˆåæ²¡æœ‰é‡Šæ”¾ï¼ŒJava åº”ç”¨å°±å­˜åœ¨å†…å­˜æ³„éœ²çš„é£é™©ã€‚== ä½œç”¨ï¼šç®€å•è¯´ThreadLocalå°±æ˜¯ä¸€ç§ä»¥==ç©ºé—´æ¢æ—¶é—´==çš„åšæ³•åœ¨æ¯ä¸ªThreadé‡Œé¢ç»´æŠ¤äº†ä¸€ä¸ªThreadLocal.ThreadLocalMapæŠŠæ•°æ®è¿›è¡Œéš”ç¦»ï¼Œæ•°æ®ä¸å…±äº«ï¼Œè‡ªç„¶å°±æ²¡æœ‰çº¿ç¨‹å®‰å…¨æ–¹é¢çš„é—®é¢˜äº†. åä¸€ã€ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ ä½œç”¨ï¼š ï¼ˆ1ï¼‰é€šè¿‡==å¹³è¡¡ç”Ÿäº§è€…çš„ç”Ÿäº§èƒ½åŠ›å’Œæ¶ˆè´¹è€…çš„æ¶ˆè´¹èƒ½åŠ›æ¥æå‡æ•´ä¸ªç³»ç»Ÿçš„è¿è¡Œæ•ˆç‡==ï¼Œè¿™æ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹æœ€é‡è¦çš„ä½œç”¨ï¼ˆ2ï¼‰è§£è€¦ï¼Œè¿™æ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹é™„å¸¦çš„ä½œç”¨ï¼Œè§£è€¦æ„å‘³ç€ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´çš„è”ç³»å°‘ï¼Œè”ç³»è¶Šå°‘è¶Šå¯ä»¥ç‹¬è‡ªå‘å±•è€Œä¸éœ€è¦æ”¶åˆ°ç›¸äº’çš„åˆ¶çº¦ å†™ä¸€ä¸ªç”Ÿäº§è€…-æ¶ˆè´¹è€…é˜Ÿåˆ—æ–¹æ³• å¯ä»¥é€šè¿‡é˜»å¡é˜Ÿåˆ—å®ç°,ä¹Ÿå¯ä»¥é€šè¿‡wait-notifyæ¥å®ç°. 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970//é˜»å¡é˜Ÿåˆ—å®ç°ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹//æ¶ˆè´¹è€…public class Producer implements Runnable&#123; private final BlockingQueue&lt;Integer&gt; queue; public Producer(BlockingQueue q)&#123; this.queue=q; &#125; @Override public void run() &#123; try &#123; while (true)&#123; Thread.sleep(1000);//æ¨¡æ‹Ÿè€—æ—¶ queue.put(produce()); &#125; &#125;catch (InterruptedException e)&#123; &#125; &#125; private int produce() &#123; int n=new Random().nextInt(10000); System.out.println("Thread:" + Thread.currentThread().getId() + " produce:" + n); return n; &#125;&#125;//æ¶ˆè´¹è€…public class Consumer implements Runnable &#123; private final BlockingQueue&lt;Integer&gt; queue; public Consumer(BlockingQueue q)&#123; this.queue=q; &#125; @Override public void run() &#123; while (true)&#123; try &#123; Thread.sleep(2000);//æ¨¡æ‹Ÿè€—æ—¶ consume(queue.take()); &#125;catch (InterruptedException e)&#123; &#125; &#125; &#125; private void consume(Integer n) &#123; System.out.println("Thread:" + Thread.currentThread().getId() + " consume:" + n); &#125;&#125;//æµ‹è¯•public class Main &#123; public static void main(String[] args) &#123; BlockingQueue&lt;Integer&gt; queue=new ArrayBlockingQueue&lt;Integer&gt;(100); Producer p=new Producer(queue); Consumer c1=new Consumer(queue); Consumer c2=new Consumer(queue); new Thread(p).start(); new Thread(c1).start(); new Thread(c2).start(); &#125;&#125; åäºŒã€javaä¸­çš„çº¿ç¨‹è°ƒåº¦ç®—æ³• æŠ¢å å¼ã€‚ä¸€ä¸ªçº¿ç¨‹ç”¨å®ŒCPUä¹‹åï¼Œæ“ä½œç³»ç»Ÿä¼šæ ¹æ®==çº¿ç¨‹ä¼˜å…ˆçº§ã€çº¿ç¨‹é¥¥é¥¿æƒ…å†µ==ç­‰æ•°æ®ç®—å‡ºä¸€ä¸ª==æ€»çš„ä¼˜å…ˆçº§==å¹¶åˆ†é…ä¸‹ä¸€ä¸ªæ—¶é—´ç‰‡ç»™æŸä¸ªçº¿ç¨‹æ‰§è¡Œã€‚ åä¸‰ã€Thread.sleep(0)çš„ä½œç”¨æ˜¯ä»€ä¹ˆ ç”±äºJavaé‡‡ç”¨æŠ¢å å¼çš„çº¿ç¨‹è°ƒåº¦ç®—æ³•ï¼Œå› æ­¤å¯èƒ½ä¼šå‡ºç°æŸæ¡çº¿ç¨‹å¸¸å¸¸è·å–åˆ°CPUæ§åˆ¶æƒçš„æƒ…å†µï¼Œä¸ºäº†è®©æŸäº›ä¼˜å…ˆçº§æ¯”è¾ƒä½çš„çº¿ç¨‹ä¹Ÿèƒ½è·å–åˆ°CPUæ§åˆ¶æƒï¼Œå¯ä»¥ä½¿ç”¨==Thread.sleep(0)æ‰‹åŠ¨è§¦å‘ä¸€æ¬¡æ“ä½œç³»ç»Ÿåˆ†é…æ—¶é—´ç‰‡çš„æ“ä½œ==ï¼Œè¿™ä¹Ÿæ˜¯å¹³è¡¡CPUæ§åˆ¶æƒçš„ä¸€ç§æ“ä½œã€‚ åå››ã€ConcurrentHashMapConcurrentHashMapçš„å¹¶å‘åº¦æ˜¯ä»€ä¹ˆ? ConcurrentHashMapçš„å¹¶å‘åº¦å°±æ˜¯segmentçš„å¤§å°ï¼Œé»˜è®¤ä¸º==16==ï¼Œè¿™æ„å‘³ç€æœ€å¤šåŒæ—¶å¯ä»¥æœ‰16æ¡çº¿ç¨‹æ“ä½œConcurrentHashMapï¼Œè¿™ä¹Ÿæ˜¯ConcurrentHashMapå¯¹Hashtableçš„æœ€å¤§ä¼˜åŠ¿ï¼Œä»»ä½•æƒ…å†µä¸‹ï¼ŒHashtableèƒ½åŒæ—¶æœ‰ä¸¤æ¡çº¿ç¨‹è·å–Hashtableä¸­çš„æ•°æ®å—ï¼Ÿ ConcurrentHashMapçš„å·¥ä½œåŸç† jdk 1.6: ConcurrentHashMapæ˜¯==çº¿ç¨‹å®‰å…¨==çš„ï¼Œä½†æ˜¯ä¸Hashtableaç›¸æ¯”ï¼Œå®ç°çº¿ç¨‹å®‰å…¨çš„æ–¹å¼ä¸åŒã€‚ Hashtableæ˜¯é€šè¿‡å¯¹hashè¡¨ç»“æ„è¿›è¡Œé”å®šï¼Œæ˜¯==é˜»å¡å¼==çš„ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹å æœ‰è¿™ä¸ªé”æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¿…é¡»é˜»å¡ç­‰å¾…å…¶é‡Šæ”¾é”ã€‚ ConcurrentHashMapæ˜¯é‡‡ç”¨==åˆ†ç¦»é”==çš„æ–¹å¼ï¼Œå®ƒå¹¶æ²¡æœ‰å¯¹æ•´ä¸ªhashè¡¨è¿›è¡Œé”å®šï¼Œè€Œæ˜¯å±€éƒ¨é”å®šï¼Œä¹Ÿå°±æ˜¯è¯´å½“ä¸€ä¸ªçº¿ç¨‹å æœ‰è¿™ä¸ªå±€éƒ¨é”æ—¶ï¼Œä¸å½±å“å…¶ä»–çº¿ç¨‹å¯¹hashè¡¨å…¶ä»–åœ°æ–¹çš„è®¿é—®ã€‚ jdk1.7 åœ¨JDK1.7ç‰ˆæœ¬ä¸­ï¼ŒConcurrentHashMapçš„æ•°æ®ç»“æ„æ˜¯ç”±ä¸€ä¸ªSegmentæ•°ç»„å’Œå¤šä¸ªHashEntryç»„æˆ jdk 1.8 åœ¨jdk 8ä¸­ï¼ŒConcurrentHashMapä¸å†ä½¿ç”¨Segmentåˆ†ç¦»é”ï¼Œè€Œæ˜¯é‡‡ç”¨ä¸€ç§ä¹è§‚é”CASç®—æ³•æ¥å®ç°åŒæ­¥é—®é¢˜ï¼Œä½†å…¶åº•å±‚è¿˜æ˜¯â€œ==æ•°ç»„+é“¾è¡¨-&gt;çº¢é»‘æ ‘==â€çš„å®ç°,æ¡¶ä¸­çš„ç»“æ„å¯èƒ½æ˜¯é“¾è¡¨ï¼Œä¹Ÿå¯èƒ½æ˜¯çº¢é»‘æ ‘ï¼Œçº¢é»‘æ ‘æ˜¯ä¸ºäº†æé«˜æŸ¥æ‰¾æ•ˆç‡ã€‚ æ€»ç»“ï¼š ç›¸å¯¹è€Œè¨€ï¼ŒConcurrentHashMapåªæ˜¯å¢åŠ äº†åŒæ­¥çš„æ“ä½œæ¥æ§åˆ¶å¹¶å‘ï¼Œä»JDK1.7ç‰ˆæœ¬çš„==ReentrantLock+Segment+HashEntry==ï¼Œåˆ°JDK1.8ç‰ˆæœ¬ä¸­==synchronized+CAS+HashEntry+çº¢é»‘æ ‘==,ç›¸å¯¹è€Œè¨€ï¼Œæ€»ç»“å¦‚ä¸‹æ€è€ƒ: JDK1.8çš„å®ç°é™ä½é”çš„ç²’åº¦ï¼ŒJDK1.7ç‰ˆæœ¬é”çš„ç²’åº¦æ˜¯åŸºäºSegmentçš„ï¼ŒåŒ…å«å¤šä¸ªHashEntryï¼Œè€ŒJDK1.8é”çš„ç²’åº¦å°±æ˜¯HashEntryï¼ˆé¦–èŠ‚ç‚¹ï¼‰ JDK1.8ç‰ˆæœ¬çš„æ•°æ®ç»“æ„å˜å¾—æ›´åŠ ç®€å•ï¼Œä½¿å¾—æ“ä½œä¹Ÿæ›´åŠ æ¸…æ™°æµç•…ï¼Œå› ä¸ºå·²ç»ä½¿ç”¨synchronizedæ¥è¿›è¡ŒåŒæ­¥ï¼Œæ‰€ä»¥ä¸éœ€è¦åˆ†æ®µé”çš„æ¦‚å¿µï¼Œä¹Ÿå°±ä¸éœ€è¦Segmentè¿™ç§æ•°æ®ç»“æ„äº†ï¼Œç”±äºç²’åº¦çš„é™ä½ï¼Œå®ç°çš„å¤æ‚åº¦ä¹Ÿå¢åŠ äº† JDK1.8ä½¿ç”¨çº¢é»‘æ ‘æ¥ä¼˜åŒ–é“¾è¡¨ï¼ŒåŸºäºé•¿åº¦å¾ˆé•¿çš„é“¾è¡¨çš„éå†æ˜¯ä¸€ä¸ªå¾ˆæ¼«é•¿çš„è¿‡ç¨‹ï¼Œè€Œçº¢é»‘æ ‘çš„éå†æ•ˆç‡æ˜¯å¾ˆå¿«çš„ï¼Œä»£æ›¿ä¸€å®šé˜ˆå€¼çš„é“¾è¡¨ï¼Œè¿™æ ·å½¢æˆä¸€ä¸ªæœ€ä½³æ‹æ¡£ JDK1.8ä¸ºä»€ä¹ˆä½¿ç”¨å†…ç½®é”synchronizedæ¥ä»£æ›¿é‡å…¥é”ReentrantLockï¼Œæˆ‘è§‰å¾—æœ‰ä»¥ä¸‹å‡ ç‚¹ å› ä¸ºç²’åº¦é™ä½äº†ï¼Œåœ¨ç›¸å¯¹è€Œè¨€çš„ä½ç²’åº¦åŠ é”æ–¹å¼ï¼Œsynchronizedå¹¶ä¸æ¯”ReentrantLockå·®ï¼Œåœ¨==ç²—ç²’åº¦åŠ é”ä¸­ReentrantLockå¯èƒ½é€šè¿‡Conditionæ¥æ§åˆ¶å„ä¸ªä½ç²’åº¦çš„è¾¹ç•Œï¼Œæ›´åŠ çš„çµæ´»ï¼Œè€Œåœ¨ä½ç²’åº¦ä¸­ï¼ŒConditionçš„ä¼˜åŠ¿å°±æ²¡æœ‰äº†== JVMçš„å¼€å‘å›¢é˜Ÿä»æ¥éƒ½æ²¡æœ‰æ”¾å¼ƒsynchronizedï¼Œè€Œä¸”==åŸºäºJVMçš„synchronizedä¼˜åŒ–ç©ºé—´æ›´å¤§==ï¼Œä½¿ç”¨å†…åµŒçš„å…³é”®å­—æ¯”ä½¿ç”¨APIæ›´åŠ è‡ªç„¶ åœ¨å¤§é‡çš„æ•°æ®æ“ä½œä¸‹ï¼Œå¯¹äºJVMçš„å†…å­˜å‹åŠ›==ï¼ŒåŸºäºAPIçš„ReentrantLockä¼šå¼€é”€æ›´å¤šçš„å†…å­˜==ï¼Œè™½ç„¶ä¸æ˜¯ç“¶é¢ˆï¼Œä½†æ˜¯ä¹Ÿæ˜¯ä¸€ä¸ªé€‰æ‹©ä¾æ® åäº”ã€CyclicBarrierå’ŒCountDownLatchåŒºåˆ« è¿™ä¸¤ä¸ªç±»éå¸¸ç±»ä¼¼ï¼Œéƒ½åœ¨java.util.concurrentä¸‹ï¼Œéƒ½å¯ä»¥ç”¨æ¥è¡¨ç¤ºä»£ç è¿è¡Œåˆ°æŸä¸ªç‚¹ä¸Šï¼ŒäºŒè€…çš„åŒºåˆ«åœ¨äºï¼š CyclicBarrierçš„æŸä¸ªçº¿ç¨‹è¿è¡Œåˆ°æŸä¸ªç‚¹ä¸Šä¹‹åï¼Œ==è¯¥çº¿ç¨‹å³åœæ­¢è¿è¡Œï¼Œç›´åˆ°æ‰€æœ‰çš„çº¿ç¨‹éƒ½åˆ°è¾¾äº†è¿™ä¸ªç‚¹ï¼Œæ‰€æœ‰çº¿ç¨‹æ‰é‡æ–°è¿è¡Œ==ï¼›CountDownLatchåˆ™ä¸æ˜¯ï¼ŒæŸçº¿ç¨‹è¿è¡Œåˆ°æŸä¸ªç‚¹ä¸Šä¹‹åï¼Œ==åªæ˜¯ç»™æŸä¸ªæ•°å€¼-1è€Œå·²ï¼Œè¯¥çº¿ç¨‹ç»§ç»­è¿è¡Œ== CyclicBarrieråªèƒ½å”¤èµ·ä¸€ä¸ªä»»åŠ¡ï¼ŒCountDownLatchå¯ä»¥å”¤èµ·å¤šä¸ªä»»åŠ¡ CyclicBarrierå¯é‡ç”¨ï¼ŒCountDownLatchä¸å¯é‡ç”¨ï¼Œè®¡æ•°å€¼ä¸º0è¯¥CountDownLatchå°±ä¸å¯å†ç”¨äº† åå…­ã€javaä¸­çš„++æ“ä½œç¬¦çº¿ç¨‹å®‰å…¨ä¹ˆ? ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„æ“ä½œã€‚å®ƒæ¶‰åŠåˆ°å¤šä¸ªæŒ‡ä»¤ï¼Œå¦‚==è¯»å–å˜é‡å€¼ï¼Œå¢åŠ ï¼Œç„¶åå­˜å‚¨å›å†…å­˜ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šå‡ºç°å¤šä¸ªçº¿ç¨‹äº¤å·®== åä¸ƒã€å¤šçº¿ç¨‹å¼€å‘è‰¯å¥½ä¹ æƒ¯ ç»™çº¿ç¨‹å‘½å æœ€å°åŒ–åŒæ­¥èŒƒå›´ ä¼˜å…ˆä½¿ç”¨volatile å°½å¯èƒ½ä½¿ç”¨æ›´é«˜å±‚æ¬¡çš„å¹¶å‘å·¥å…·è€Œéwaitå’Œnotify()æ¥å®ç°çº¿ç¨‹é€šä¿¡,å¦‚BlockingQueue,Semeaphore ä¼˜å…ˆä½¿ç”¨å¹¶å‘å®¹å™¨è€ŒéåŒæ­¥å®¹å™¨. è€ƒè™‘ä½¿ç”¨çº¿ç¨‹æ±  åå…«ã€volatileå…³é”®å­—æŒ‡ä»¤é‡æ’åºå’Œå†…å­˜å¯è§æ€§ï¼Œvolatile ç±»å‹å˜é‡å³ä½¿åœ¨æ²¡æœ‰åŒæ­¥å—çš„æƒ…å†µä¸‹èµ‹å€¼ä¹Ÿä¸ä¼šä¸å…¶ä»–è¯­å¥é‡æ’åºã€‚ volatile æä¾› happens-before çš„ä¿è¯ï¼Œç¡®ä¿ä¸€ä¸ªçº¿ç¨‹çš„ä¿®æ”¹èƒ½å¯¹å…¶ä»–çº¿ç¨‹æ˜¯å¯è§çš„ã€‚ ==Volatile å˜é‡å…·æœ‰ synchronized çš„å¯è§æ€§ç‰¹æ€§ï¼Œä½†æ˜¯ä¸å…·å¤‡åŸå­ç‰¹æ€§== å¯ä»¥åˆ›å»ºVolatileæ•°ç»„å—? Java ä¸­å¯ä»¥åˆ›å»º volatileç±»å‹æ•°ç»„ï¼Œä¸è¿‡åªæ˜¯ä¸€ä¸ªæŒ‡å‘æ•°ç»„çš„å¼•ç”¨ï¼Œè€Œä¸æ˜¯æ•´ä¸ªæ•°ç»„ã€‚å¦‚æœæ”¹å˜å¼•ç”¨æŒ‡å‘çš„æ•°ç»„ï¼Œå°†ä¼šå—åˆ°volatile çš„ä¿æŠ¤ï¼Œä½†æ˜¯å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ”¹å˜æ•°ç»„çš„å…ƒç´ ï¼Œvolatileæ ‡ç¤ºç¬¦å°±ä¸èƒ½èµ·åˆ°ä¹‹å‰çš„ä¿æŠ¤ä½œç”¨äº† å¦‚ä½•ä½¿éåŸå­æ“ä½œå˜æˆåŸå­æ“ä½œ å…¸å‹æ¡ˆä¾‹ï¼š double å’Œ long éƒ½æ˜¯64ä½å®½ï¼Œå› æ­¤å¯¹è¿™ä¸¤ç§ç±»å‹çš„è¯»æ˜¯åˆ†ä¸ºä¸¤éƒ¨åˆ†çš„ï¼Œç¬¬ä¸€æ¬¡è¯»å–ç¬¬ä¸€ä¸ª 32 ä½ï¼Œç„¶åå†è¯»å‰©ä¸‹çš„ 32 ä½ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸æ˜¯åŸå­çš„ã€‚å¦‚æœçŸ¥é“è¦è¢«å¤šçº¿ç¨‹è®¿é—®ï¼Œåº”è¯¥åŠ volatileå…³é”®å­— æä¾›å†…å­˜å±éšœï¼ˆmemory barrierï¼‰ åœ¨å†™ä¸€ä¸ª volatile å˜é‡ä¹‹å‰ï¼ŒJava å†…å­˜æ¨¡å‹ä¼šæ’å…¥ä¸€ä¸ªå†™å±éšœï¼ˆwrite barrierï¼‰ï¼Œè¯»ä¸€ä¸ª volatile å˜é‡ä¹‹å‰ï¼Œä¼šæ’å…¥ä¸€ä¸ªè¯»å±éšœï¼ˆread barrierï¼‰å³åœ¨==ä½ å†™ä¸€ä¸ª volatile åŸŸæ—¶ï¼Œèƒ½ä¿è¯ä»»ä½•çº¿ç¨‹éƒ½èƒ½çœ‹åˆ°ä½ å†™çš„å€¼==ï¼ŒåŒæ—¶ï¼Œåœ¨==å†™ä¹‹å‰ï¼Œä¹Ÿèƒ½ä¿è¯ä»»ä½•æ•°å€¼çš„æ›´æ–°å¯¹æ‰€æœ‰çº¿ç¨‹æ˜¯å¯è§çš„==ï¼Œå› ä¸ºå†…å­˜å±éšœä¼šå°†å…¶ä»–æ‰€æœ‰å†™çš„å€¼æ›´æ–°åˆ°ç¼“å­˜ ä½¿ç”¨æ¡ä»¶ å¯¹å˜é‡çš„å†™æ“ä½œä¸ä¾èµ–äºå½“å‰å€¼ã€‚ è¯¥å˜é‡æ²¡æœ‰åŒ…å«åœ¨å…·æœ‰å…¶ä»–å˜é‡çš„ä¸å˜å¼ä¸­ã€‚ åä¹ã€å¼‚å¸¸ç™½è¯å¼‚å¸¸æœºåˆ¶ throwå’Œthrowsçš„åŒºåˆ« throwç”¨äºä¸»åŠ¨æŠ›å‡ºjava.lang.Throwable ç±»çš„ä¸€ä¸ªå®ä¾‹åŒ–å¯¹è±¡ï¼Œæ„æ€æ˜¯è¯´ä½ å¯ä»¥é€šè¿‡å…³é”®å­— throw æŠ›å‡ºä¸€ä¸ª Error æˆ–è€… ä¸€ä¸ªExceptionï¼Œå¦‚ï¼š throw new IllegalArgumentException(â€œsize must be multiple of 2â€³) è€Œthrows çš„ä½œç”¨æ˜¯ä½œä¸ºæ–¹æ³•å£°æ˜å’Œç­¾åçš„ä¸€éƒ¨åˆ†ï¼Œæ–¹æ³•è¢«æŠ›å‡ºç›¸åº”çš„å¼‚å¸¸ä»¥ä¾¿è°ƒç”¨è€…èƒ½å¤„ç†ã€‚Java ä¸­ï¼Œä»»ä½•æœªå¤„ç†çš„å—æ£€æŸ¥å¼‚å¸¸å¼ºåˆ¶åœ¨ throws å­å¥ä¸­å£°æ˜ã€‚ äºŒåã€Java ä¸­ï¼ŒSerializable ä¸ Externalizable çš„åŒºåˆ« Serializableæ¥å£æ˜¯ä¸€ä¸ªåºåˆ—åŒ– Java ç±»çš„æ¥å£ï¼Œä»¥ä¾¿äºå®ƒä»¬å¯ä»¥åœ¨ç½‘ç»œä¸Šä¼ è¾“æˆ–è€…å¯ä»¥å°†å®ƒä»¬çš„çŠ¶æ€ä¿å­˜åœ¨ç£ç›˜ä¸Šï¼Œæ˜¯==JVM å†…åµŒçš„é»˜è®¤åºåˆ—åŒ–æ–¹å¼==ï¼Œæˆæœ¬é«˜ã€è„†å¼±è€Œä¸”ä¸å®‰å…¨ã€‚Externalizableå…è®¸ä½ æ§åˆ¶æ•´ä¸ªåºåˆ—åŒ–è¿‡ç¨‹ï¼ŒæŒ‡å®šç‰¹å®šçš„äºŒè¿›åˆ¶æ ¼å¼ï¼Œå¢åŠ å®‰å…¨æœºåˆ¶ã€‚ æ–¹æ³•ä¸€ã€switch åœ¨1.7åæ”¯æŒStringç±»å‹ï¼Œæ”¯æŒbyteç±»å‹ä½†æ˜¯ä¸æ”¯æŒlongç±»å‹ äºŒã€a.hashCode()æœ‰ä»€ä¹ˆç”¨?ä¸a.equals(b)æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ hashCode() æ–¹æ³•æ˜¯ç›¸åº”å¯¹è±¡æ•´å‹çš„ hash å€¼ã€‚å®ƒå¸¸ç”¨äºåŸºäº hash çš„é›†åˆç±»ï¼Œå¦‚ Hashtableã€HashMapã€LinkedHashMapç­‰ç­‰ã€‚å®ƒä¸ equals() æ–¹æ³•å…³ç³»ç‰¹åˆ«ç´§å¯†ã€‚æ ¹æ® Java è§„èŒƒï¼Œä½¿ç”¨ equal() æ–¹æ³•æ¥åˆ¤æ–­ä¸¤ä¸ªç›¸ç­‰çš„å¯¹è±¡ï¼Œå¿…é¡»å…·æœ‰ç›¸åŒçš„ hashcodeã€‚ ä¸‰ã€a==bä¸a.equals(b)æœ‰ä»€ä¹ˆåŒºåˆ« å¦‚æœa å’Œb éƒ½æ˜¯å¯¹è±¡ï¼Œåˆ™ a==b æ˜¯æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œåªæœ‰å½“ a å’Œ b æŒ‡å‘çš„æ˜¯å †ä¸­çš„åŒä¸€ä¸ªå¯¹è±¡æ‰ä¼šè¿”å› trueï¼Œè€Œ a.equals(b) æ˜¯è¿›è¡Œé€»è¾‘æ¯”è¾ƒï¼Œæ‰€ä»¥é€šå¸¸éœ€è¦é‡å†™è¯¥æ–¹æ³•æ¥æä¾›é€»è¾‘ä¸€è‡´æ€§çš„æ¯”è¾ƒã€‚ä¾‹å¦‚ï¼ŒString ç±»é‡å†™ equals() æ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥ç”¨äºä¸¤ä¸ªä¸åŒå¯¹è±¡ï¼Œä½†æ˜¯åŒ…å«çš„å­—æ¯ç›¸åŒçš„æ¯”è¾ƒã€‚ å››ã€+=æ“ä½œç¬¦ä¼šè¿›è¡Œéšå¼è‡ªåŠ¨ç±»å‹è½¬æ¢ äº”ã€ä½è¿ç®— 12name!=null&amp;userName.equals("") //è¦æŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸ å…­ã€æ—¥æœŸè®¡ç®—SimpleDateFormatæ˜¯çº¿ç¨‹å®‰å…¨çš„å—? DateFormatçš„æ‰€æœ‰å®ç°ï¼ŒåŒ…æ‹¬ SimpleDateFormatéƒ½ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› æ­¤ä½ ä¸åº”è¯¥åœ¨å¤šçº¿ç¨‹åºä¸­ä½¿ç”¨ï¼Œé™¤éæ˜¯åœ¨å¯¹å¤–çº¿ç¨‹å®‰å…¨çš„ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œå¦‚å°† SimpleDateFormaté™åˆ¶åœ¨ ThreadLocalä¸­ã€‚å¦‚æœä½ ä¸è¿™ä¹ˆåšï¼Œåœ¨è§£ææˆ–è€…æ ¼å¼åŒ–æ—¥æœŸçš„æ—¶å€™ï¼Œå¯èƒ½ä¼šè·å–åˆ°ä¸€ä¸ªä¸æ­£ç¡®çš„ç»“æœã€‚å› æ­¤ï¼Œä»æ—¥æœŸã€æ—¶é—´å¤„ç†çš„æ‰€æœ‰å®è·µæ¥è¯´ï¼Œæˆ‘å¼ºåŠ›æ¨è joda-time åº“ã€‚ ä¸ƒã€å¤šæ€å¤šæ€è¡¨ç¤ºå½“åŒä¸€ä¸ªæ“ä½œä½œç”¨åœ¨ä¸åŒå¯¹è±¡æ—¶ï¼Œä¼šæœ‰ä¸åŒçš„è¯­ä¹‰ï¼Œä»è€Œäº§ç”Ÿä¸åŒçš„ç»“æœã€‚3+4å’Œâ€œ3â€+â€œ4â€ Javaçš„å¤šæ€æ€§å¯ä»¥æ¦‚æ‹¬æˆâ€ä¸€ä¸ªæ¥å£,ä¸¤ç§æ–¹æ³•â€åˆ†ä¸ºä¸¤ç§ ç¼–è¯‘æ—¶çš„å¤šæ€ ç¼–è¯‘æ—¶çš„å¤šæ€ä¸»è¦æ˜¯æŒ‡æ–¹æ³•çš„é‡è½½ï¼ˆoverloadï¼‰ è¿è¡Œæ—¶çš„å¤šæ€ã€‚ è¿è¡Œæ—¶çš„å¤šæ€ä¸»è¦æ˜¯æŒ‡æ–¹æ³•çš„è¦†ç›–ï¼ˆoverrideï¼‰ï¼Œæ¥å£ä¹Ÿæ˜¯è¿è¡Œæ—¶çš„å¤šæ€ è¿è¡Œæ—¶çš„å¤šæ€çš„ä¸‰ç§æƒ…å†µï¼š1ã€çˆ¶ç±»æœ‰æ–¹æ³•ï¼Œå­ç±»æœ‰è¦†ç›–æ–¹æ³•ï¼šç¼–è¯‘é€šè¿‡ï¼Œæ‰§è¡Œå­ç±»æ–¹æ³•ã€‚2ã€çˆ¶ç±»æœ‰æ–¹æ³•ï¼Œå­ç±»æ²¡è¦†ç›–æ–¹æ³•ï¼šç¼–è¯‘é€šè¿‡ï¼Œæ‰§è¡Œçˆ¶ç±»æ–¹æ³•ï¼ˆå­ç±»ç»§æ‰¿ï¼‰ã€‚3ã€çˆ¶ç±»æ²¡æ–¹æ³•ï¼Œå­ç±»æœ‰æ–¹æ³•ï¼šç¼–è¯‘å¤±è´¥ï¼Œæ— æ³•æ‰§è¡Œã€‚==æ–¹æ³•å¸¦finalã€staticã€privateæ—¶æ˜¯ç¼–è¯‘æ—¶å¤šæ€ï¼Œå› ä¸ºå¯ä»¥ç›´æ¥ç¡®å®šè°ƒç”¨å“ªä¸ªæ–¹æ³•ã€‚== é›†åˆ ä¸€ã€ArrayListå’ŒLinkedListçš„åŒºåˆ«? æœ€æ˜æ˜¾çš„åŒºåˆ«æ˜¯ ArrrayListåº•å±‚çš„æ•°æ®ç»“æ„æ˜¯æ•°ç»„ï¼Œæ”¯æŒéšæœºè®¿é—®ï¼Œè€Œ LinkedList çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯åŒå‘å¾ªç¯é“¾è¡¨ï¼Œä¸æ”¯æŒéšæœºè®¿é—®ã€‚ä½¿ç”¨ä¸‹æ ‡è®¿é—®ä¸€ä¸ªå…ƒç´ ï¼ŒArrayList çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ï¼Œè€Œ LinkedList æ˜¯ O(n)ã€‚ äºŒã€ArrayListå’ŒArrayæœ‰ä»€ä¹ˆåŒºåˆ«? Arrayå¯ä»¥å®¹çº³åŸºæœ¬ç±»å‹å’Œå¯¹è±¡ï¼Œè€ŒArrayListåªèƒ½å®¹çº³å¯¹è±¡ã€‚ Arrayæ˜¯æŒ‡å®šå¤§å°çš„ï¼Œè€ŒArrayListå¤§å°æ˜¯å›ºå®šçš„ ä¸‰ã€Comparatorå’ŒComparableçš„åŒºåˆ«? Comparable æ¥å£ç”¨äºå®šä¹‰å¯¹è±¡çš„Â·è‡ªç„¶é¡ºåºï¼Œè€Œ comparator é€šå¸¸ç”¨äºå®šä¹‰ç”¨æˆ·å®šåˆ¶çš„é¡ºåºã€‚==Comparable æ€»æ˜¯åªæœ‰ä¸€ä¸ª==ï¼Œä½†æ˜¯å¯ä»¥æœ‰å¤šä¸ª comparator æ¥å®šä¹‰å¯¹è±¡çš„é¡ºåºã€‚ å››ã€å¦‚ä½•æ‰“å°æ•°ç»„å†…å®¹ ä½ å¯ä»¥ä½¿ç”¨Arrays.toString()å’ŒArrays.deepToString() æ–¹æ³•æ¥æ‰“å°æ•°ç»„ã€‚ç”±äºæ•°ç»„æ²¡æœ‰å®ç° toString() æ–¹æ³•ï¼Œæ‰€ä»¥å¦‚æœå°†æ•°ç»„ä¼ é€’ç»™System.out.println()æ–¹æ³•ï¼Œå°†æ— æ³•æ‰“å°å‡ºæ•°ç»„çš„å†…å®¹ï¼Œä½†æ˜¯ Arrays.toString()å¯ä»¥æ‰“å°æ¯ä¸ªå…ƒç´ ã€‚ æ•°æ®åº“ä¸€ã€ä½¿ç”¨Integerå’ŒLongè¿›è¡Œæ•°æ®åº“æ•°æ®å­˜å€¼ï¼Œå› ä¸ºè¿™äº›æ˜¯å¯¹è±¡ï¼Œå¦‚æœä½¿ç”¨intæˆ–è€…longä¼šè·å–ä¸åˆ°å€¼ æ³¨æ„ä¸è¦å’Œmysqlçš„å…³é”®å­—å†²çªäº†ï¼ï¼ äºŒã€ä¸‰èŒƒå¼ç¬¬ä¸€èŒƒå¼(1NF): æŒ‡çš„æ˜¯æ•°æ®åº“è¡¨çš„ä¸­çš„æ¯ä¸€åˆ—éƒ½æ˜¯ä¸å¯åˆ†å‰²çš„åŸºæœ¬æ•°æ®é¡¹,åŒä¸€åˆ—ä¸­ä¸èƒ½æœ‰å¤šä¸ªå€¼ã€‚ç¬¬ä¸€èŒƒå¼è¦æ±‚å±æ€§å€¼æ˜¯ä¸å¯å†åˆ†å‰²æˆçš„æ›´å°çš„éƒ¨åˆ†ã€‚ç¬¬ä¸€èŒƒå¼ç®€è€Œè¨€ä¹‹å°±æ˜¯å¼ºè°ƒçš„æ˜¯åˆ—çš„åŸå­æ€§ï¼Œå³åˆ—ä¸èƒ½å¤Ÿå†åˆ†æˆå…¶ä»–å‡ åˆ—ã€‚ä¾‹å¦‚æœ‰ä¸€ä¸ªåˆ—æ˜¯ç”µè¯å·ç ä¸€ä¸ªäººå¯èƒ½æœ‰ä¸€ä¸ªåŠå…¬ç”µè¯ä¸€ä¸ªç§»åŠ¨ç”µè¯ã€‚ç¬¬ä¸€èŒƒå¼å°±éœ€è¦æ‹†å¼€æˆä¸¤ä¸ªå±æ€§ã€‚ ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰ï¼š ç¬¬äºŒèŒƒå¼é¦–å…ˆæ˜¯ç¬¬ä¸€èŒƒå¼ï¼ŒåŒæ—¶è¿˜éœ€è¦åŒ…å«ä¸¤ä¸ªæ–¹é¢çš„å†…å®¹ï¼Œä¸€æ˜¯è¡¨å¿…é¡»è¦æœ‰ä¸€ä¸ªä¸»é”®ï¼›äºŒæ˜¯æ²¡æœ‰åŒ…å«ä¸»é”®ä¸­çš„åˆ—å¿…é¡»å®Œå…¨ä¾èµ–ä¸»é”®ï¼Œè€Œä¸èƒ½åªæ˜¯ä¾èµ–äºä¸»é”®çš„ä¸€éƒ¨åˆ†ã€‚ä¾‹å¦‚åœ¨ä¸€ä¸ªè®¢å•ä¸­å¯ä»¥è®¢è´­å¤šç§äº§å“ï¼Œæ‰€ä»¥å•å•ä¸€ä¸ª OrderID æ˜¯ä¸è¶³ä»¥æˆä¸ºä¸»é”®çš„ï¼Œä¸»é”®åº”è¯¥æ˜¯ï¼ˆOrderIDï¼ŒProductIDï¼‰ã€‚æ˜¾è€Œæ˜“è§ Discountï¼ˆæŠ˜æ‰£ï¼‰ï¼ŒQuantityï¼ˆæ•°é‡ï¼‰å®Œå…¨ä¾èµ–ï¼ˆå–å†³ï¼‰äºä¸»é”®ï¼ˆOderIDï¼ŒProductIDï¼‰ï¼Œè€Œ UnitPriceï¼ŒProductName åªä¾èµ–äº ProductIDã€‚æ‰€ä»¥ OrderDetail è¡¨ä¸ç¬¦åˆ 2NFã€‚ ä¸ç¬¦åˆ 2NF çš„è®¾è®¡å®¹æ˜“äº§ç”Ÿå†—ä½™æ•°æ®ã€‚ å¯ä»¥æŠŠã€OrderDetailã€‘è¡¨æ‹†åˆ†ä¸ºã€OrderDetailã€‘ï¼ˆOrderIDï¼ŒProductIDï¼ŒDiscountï¼ŒQuantityï¼‰å’Œã€Productã€‘ï¼ˆProductIDï¼ŒUnitPriceï¼ŒProductNameï¼‰æ¥æ¶ˆé™¤åŸè®¢å•è¡¨ä¸­UnitPriceï¼ŒProductNameå¤šæ¬¡é‡å¤çš„æƒ…å†µã€‚ ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰ï¼š é¦–å…ˆæ˜¯ç¬¬äºŒèŒƒå¼ï¼Œä¾‹å¤–éä¸»é”®åˆ—å¿…é¡»ä¾èµ–äºä¸»é”®ï¼Œä¸èƒ½å­˜åœ¨ä¼ é€’ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸èƒ½å­˜åœ¨éä¸»é”®åˆ—Aä¾èµ–äºéä¸»é”®åˆ—Bï¼Œç„¶åBä¾èµ–äºä¸»é”®åˆ—è€ƒè™‘ä¸€ä¸ªè®¢å•è¡¨ã€Orderã€‘ï¼ˆOrderIDï¼ŒOrderDateï¼ŒCustomerIDï¼ŒCustomerNameï¼ŒCustomerAddrï¼ŒCustomerCityï¼‰ä¸»é”®æ˜¯ï¼ˆOrderIDï¼‰ã€‚å…¶ä¸­ OrderDateï¼ŒCustomerIDï¼ŒCustomerNameï¼ŒCustomerAddrï¼ŒCustomerCity ç­‰éä¸»é”®åˆ—éƒ½å®Œå…¨ä¾èµ–äºä¸»é”®ï¼ˆOrderIDï¼‰ï¼Œæ‰€ä»¥ç¬¦åˆ 2NFã€‚ä¸è¿‡é—®é¢˜æ˜¯ CustomerNameï¼ŒCustomerAddrï¼ŒCustomerCity ç›´æ¥ä¾èµ–çš„æ˜¯ CustomerIDï¼ˆéä¸»é”®åˆ—ï¼‰ï¼Œè€Œä¸æ˜¯ç›´æ¥ä¾èµ–äºä¸»é”®ï¼Œå®ƒæ˜¯é€šè¿‡ä¼ é€’æ‰ä¾èµ–äºä¸»é”®ï¼Œæ‰€ä»¥ä¸ç¬¦åˆ 3NFã€‚é€šè¿‡æ‹†åˆ†ã€Orderã€‘ä¸ºã€Orderã€‘ï¼ˆOrderIDï¼ŒOrderDateï¼ŒCustomerIDï¼‰å’Œã€Customerã€‘ï¼ˆCustomerIDï¼ŒCustomerNameï¼ŒCustomerAddrï¼ŒCustomerCityï¼‰ä»è€Œè¾¾åˆ° 3NFã€‚==äºŒèŒƒå¼ï¼ˆ2NFï¼‰å’Œç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰çš„æ¦‚å¿µå¾ˆå®¹æ˜“æ··æ·†ï¼ŒåŒºåˆ†å®ƒä»¬çš„å…³é”®ç‚¹åœ¨äºï¼Œ2NFï¼šéä¸»é”®åˆ—æ˜¯å¦å®Œå…¨ä¾èµ–äºä¸»é”®ï¼Œè¿˜æ˜¯ä¾èµ–äºä¸»é”®çš„ä¸€éƒ¨åˆ†ï¼›3NFï¼šéä¸»é”®åˆ—æ˜¯ç›´æ¥ä¾èµ–äºä¸»é”®ï¼Œè¿˜æ˜¯ç›´æ¥ä¾èµ–äºéä¸»é”®åˆ—ã€‚== ä¸‰ã€å†…å¤–è¿æ¥ å››ã€äº‹åŠ¡ åŸå­æ€§:å³äº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„æ•´ä½“,æ•°æ®ä¿®æ”¹æ—¶è¦ä¹ˆéƒ½æ“ä½œä¸€éè¦ä¹ˆéƒ½ä¸æ“ä½œ ä¸€è‡´æ€§:ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå‰åæ•°æ®åº“çš„æ•°æ®å¿…é¡»ä¿æŒä¸€è‡´æ€§çŠ¶æ€ éš”ç¦»æ€§:å½“ä¸¤ä¸ªæˆ–è€…ä»¥ä¸Šçš„äº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶,ä¸ºäº†ä¿è¯æ•°æ®çš„å®‰å…¨æ€§,å°†ä¸€ä¸ªäº‹åŠ¡çš„å†…éƒ¨çš„æ“ä½œä¸äº‹åŠ¡æ“ä½œéš”ç¦»èµ·æ¥ä¸è¢«å…¶ä»–äº‹åŠ¡çœ‹åˆ° æŒä¹…æ€§:æ›´æ”¹æ˜¯æ°¸è¿œå­˜åœ¨çš„ éš”ç¦»çº§åˆ« è¯»æœªæäº¤ï¼šäº‹åŠ¡ä¸­çš„ä¿®æ”¹ï¼Œå³ä½¿æ²¡æœ‰æäº¤ï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿå¯ä»¥çœ‹å¾—åˆ°ï¼Œè„è¯»ã€‚å¦‚æœä¸€ä¸ªäº‹åŠ¡å·²ç»å¼€å§‹å†™æ•°æ®ï¼Œåˆ™å¦å¤–ä¸€ä¸ªäº‹åŠ¡åˆ™ä¸å…è®¸åŒæ—¶è¿›è¡Œå†™æ“ä½œï¼Œä½†å…è®¸å…¶ä»–äº‹åŠ¡è¯»æ­¤è¡Œæ•°æ®ã€‚è¯¥éš”ç¦»çº§åˆ«å¯ä»¥é€šè¿‡â€œæ’ä»–å†™é”â€å®ç°ã€‚ä¸€ä¸ªåœ¨å†™äº‹åŠ¡å¦ä¸€ä¸ªè™½ç„¶ä¸èƒ½å†™ä½†æ˜¯èƒ½è¯»åˆ°è¿˜æ²¡æœ‰æäº¤çš„æ•°æ® è¯»å·²æäº¤ï¼šå¯ä»¥é¿å…è„è¯»ä½†æ˜¯å¯èƒ½å‡ºç°ä¸å¯é‡å¤è¯»ã€‚å…è®¸å†™äº‹åŠ¡ï¼Œè¯»å–æ•°æ®çš„äº‹åŠ¡å…è®¸å…¶ä»–äº‹åŠ¡ç»§ç»­è®¿é—®è¯¥è¡Œæ•°æ®ï¼Œä½†æ˜¯æœªæäº¤çš„å†™äº‹åŠ¡å°†ä¼šç¦æ­¢å…¶ä»–äº‹åŠ¡è®¿é—®è¯¥è¡Œã€‚äº‹åŠ¡T1è¯»å–æ•°æ®ï¼ŒT2ç´§æ¥ç€æ›´æ–°æ•°æ®å¹¶æäº¤æ•°æ®ï¼Œäº‹åŠ¡T1å†æ¬¡è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œå’Œç¬¬ä¸€æ¬¡è¯»çš„ä¸ä¸€æ ·ã€‚å³è™šè¯» å¯é‡å¤è¯»ï¼šç¦æ­¢å†™äº‹åŠ¡ï¼Œè¯»äº‹åŠ¡ä¼šç¦æ­¢æ‰€æœ‰çš„å†™äº‹åŠ¡ï¼Œä½†æ˜¯å…è®¸è¯»äº‹åŠ¡ï¼Œé¿å…äº†ä¸å¯é‡å¤è¯»å’Œè„è¯»ï¼Œä½†æ˜¯ä¼šå‡ºç°å¹»è¯»ï¼Œå³ç¬¬äºŒæ¬¡æŸ¥è¯¢æ•°æ®æ—¶ä¼šåŒ…å«ç¬¬ä¸€æ¬¡æŸ¥è¯¢ä¸­æœªå‡ºç°çš„æ•°æ® åºåˆ—åŒ–ï¼šç¦æ­¢ä»»ä½•äº‹åŠ¡ï¼Œä¸€ä¸ªä¸€ä¸ªè¿›è¡Œï¼›æä¾›ä¸¥æ ¼çš„äº‹åŠ¡éš”ç¦»ã€‚å®ƒè¦æ±‚äº‹åŠ¡åºåˆ—åŒ–æ‰§è¡Œï¼Œäº‹åŠ¡åªèƒ½ä¸€ä¸ªæ¥ç€ä¸€ä¸ªåœ°æ‰§è¡Œï¼Œä½†ä¸èƒ½å¹¶å‘æ‰§è¡Œã€‚å¦‚æœä»…ä»…é€šè¿‡â€œè¡Œçº§é”â€æ˜¯æ— æ³•å®ç°äº‹åŠ¡åºåˆ—åŒ–çš„ï¼Œå¿…é¡»é€šè¿‡å…¶ä»–æœºåˆ¶ä¿è¯æ–°æ’å…¥çš„æ•°æ®ä¸ä¼šè¢«åˆšæ‰§è¡ŒæŸ¥è¯¢æ“ä½œçš„äº‹åŠ¡è®¿é—®åˆ°ã€‚ ç´¢å¼•ç´¢å¼• 7.6.1ä¼˜ç¼ºç‚¹ï¼š ä¼˜ç‚¹ï¼š å¯ä»¥å¿«é€Ÿæ£€ç´¢ï¼Œå‡å°‘I/Oæ¬¡æ•°ï¼ŒåŠ å¿«æ£€ç´¢é€Ÿåº¦ï¼›æ ¹æ®ç´¢å¼•åˆ†ç»„å’Œæ’åºï¼Œå¯ä»¥åŠ å¿«åˆ†ç»„å’Œæ’åºç¼ºç‚¹ï¼š ç´¢å¼•æœ¬çœä¹Ÿæ˜¯è¡¨ä¼šå ç”¨å†…å­˜ï¼Œç´¢å¼•è¡¨å ç”¨çš„ç©ºé—´æ˜¯æ•°æ®è¡¨çš„1.5å€ï¼›ç´¢å¼•è¡¨çš„åˆ›å»ºå’Œç»´æŠ¤éœ€è¦æ—¶é—´æˆæœ¬ï¼Œè¿™ä¸ªæˆæœ¬éšç€æ•°æ®é‡çš„å¢å¤§è€Œå¢å¤§ã€‚ 7.6.2ç´¢å¼•çš„åº•å±‚å®ç°åŸç†ï¼š å“ˆå¸Œç´¢å¼•ï¼š åªæœ‰memoryï¼ˆå†…å­˜ï¼‰å­˜å‚¨å¼•æ“æ”¯æŒå“ˆå¸Œç´¢å¼•ï¼Œå“ˆå¸Œç´¢å¼•ç”¨ç´¢å¼•åˆ—çš„å€¼è®¡ç®—è¯¥å€¼çš„hashCodeï¼Œç„¶ååœ¨hashCodeç›¸åº”çš„ä½ç½®å­˜æ‰§è¯¥å€¼æ‰€åœ¨è¡Œæ•°æ®çš„ç‰©ç†ä½ç½®ï¼Œå› ä¸ºä½¿ç”¨æ•£åˆ—ç®—æ³•ï¼Œå› æ­¤è®¿é—®é€Ÿåº¦éå¸¸å¿«ï¼Œä½†æ˜¯ä¸€ä¸ªå€¼åªèƒ½å¯¹åº”ä¸€ä¸ªhashCodeï¼Œè€Œä¸”æ˜¯æ•£åˆ—çš„åˆ†å¸ƒæ–¹å¼ï¼Œå› æ­¤å“ˆå¸Œç´¢å¼•ä¸æ”¯æŒèŒƒå›´æŸ¥æ‰¾å’Œæ’åºçš„åŠŸèƒ½ã€‚ Btreeç´¢å¼•ï¼š Bæ ‘æ˜¯ä¸€ä¸ªå¹³è¡¡å¤šå‰æ ‘ï¼Œè®¾æ ‘çš„åº¦ä¸º2dï¼Œé«˜åº¦ä¸ºhï¼Œé‚£ä¹ˆBæ ‘éœ€è¦æ»¡è¶³æ¯ä¸ªå¶å­èŠ‚ç‚¹çš„é«˜åº¦éƒ½ä¸€æ ·ç­‰äºhï¼Œæ¯ä¸ªéå¶å­èŠ‚ç‚¹ç”±n-1ä¸ªkeyå’Œnä¸ªpointç»„æˆï¼Œd&lt; = n&lt;=2d ã€‚æ‰€æœ‰å¶å­èŠ‚ç‚¹æŒ‡é’ˆå‡ä¸ºç©ºï¼Œéå¶å­ç»“ç‚¹çš„keyéƒ½æ˜¯[key,data]äºŒå…ƒç»„ï¼Œå…¶ä¸­keyè¡¨ç¤ºä½œä¸ºç´¢å¼•çš„é”®ï¼Œdataä¸ºé”®å€¼æ‰€åœ¨è¡Œçš„æ•°æ®ã€‚ B+Treeç´¢å¼• B+Treeæ˜¯BTreeçš„ä¸€ä¸ªå˜ç§ï¼Œè®¾dä¸ºæ ‘çš„åº¦æ•°ï¼Œhä¸ºæ ‘çš„é«˜åº¦ï¼ŒB+Treeå’ŒBTreeçš„ä¸åŒä¸»è¦åœ¨äºï¼šB+Treeä¸­çš„éå¶å­ç»“ç‚¹ä¸å­˜å‚¨æ•°æ®ï¼Œåªå­˜å‚¨é”®å€¼ï¼›B+Treeçš„å¶å­ç»“ç‚¹æ²¡æœ‰æŒ‡é’ˆï¼Œæ‰€æœ‰é”®å€¼éƒ½ä¼šå‡ºç°åœ¨å¶å­ç»“ç‚¹ä¸Šï¼Œä¸”keyå­˜å‚¨çš„é”®å€¼å¯¹åº”dataæ•°æ®çš„ç‰©ç†åœ°å€ï¼›B+Treeçš„æ¯ä¸ªéå¶å­èŠ‚ç‚¹ç”±nä¸ªé”®å€¼keyå’Œnä¸ªæŒ‡é’ˆpointç»„æˆï¼›ä¼˜ç‚¹ï¼šæŸ¥è¯¢é€Ÿåº¦æ›´åŠ ç¨³å®šï¼Œç£ç›˜çš„è¯»å†™ä»£ä»·æ›´ä½ èšç°‡ç´¢å¼•ä¸éèšç°‡ç´¢å¼• èšç°‡ç´¢å¼•çš„è§£é‡Šæ˜¯:èšç°‡ç´¢å¼•çš„é¡ºåºå°±æ˜¯æ•°æ®çš„ç‰©ç†å­˜å‚¨é¡ºåºéèšç°‡ç´¢å¼•çš„è§£é‡Šæ˜¯:ç´¢å¼•é¡ºåºä¸æ•°æ®ç‰©ç†æ’åˆ—é¡ºåºæ— å…³ MyISAMâ€”â€”éèšç°‡ç´¢å¼• MyISAMå­˜å‚¨å¼•æ“é‡‡ç”¨çš„æ˜¯éèšç°‡ç´¢å¼•ï¼Œéèšç°‡ç´¢å¼•çš„ä¸»ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•å‡ ä¹æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯ä¸»ç´¢å¼•ä¸å…è®¸é‡å¤ï¼Œä¸å…è®¸ç©ºå€¼ï¼Œä»–ä»¬çš„å¶å­ç»“ç‚¹çš„keyéƒ½å­˜å‚¨æŒ‡å‘é”®å€¼å¯¹åº”çš„æ•°æ®çš„ç‰©ç†åœ°å€ã€‚éèšç°‡ç´¢å¼•çš„æ•°æ®è¡¨å’Œç´¢å¼•è¡¨æ˜¯åˆ†å¼€å­˜å‚¨çš„ã€‚ innoDBâ€”â€”èšç°‡ç´¢å¼• èšç°‡ç´¢å¼•çš„ä¸»ç´¢å¼•çš„å¶å­ç»“ç‚¹å­˜å‚¨çš„æ˜¯é”®å€¼å¯¹åº”çš„æ•°æ®æœ¬èº«ï¼Œè¾…åŠ©ç´¢å¼•çš„å¶å­ç»“ç‚¹å­˜å‚¨çš„æ˜¯é”®å€¼å¯¹åº”çš„æ•°æ®çš„ä¸»é”®é”®å€¼ã€‚å› æ­¤ä¸»é”®çš„å€¼é•¿åº¦è¶Šå°è¶Šå¥½ï¼Œç±»å‹è¶Šç®€å•è¶Šå¥½ã€‚èšç°‡ç´¢å¼•çš„æ•°æ®å’Œä¸»é”®ç´¢å¼•å­˜å‚¨åœ¨ä¸€èµ·ã€‚ 7.6.3 è”åˆç´¢å¼•(é¡ºä¸°) åˆ©ç”¨æœ€å·¦å‰ç¼€åŸåˆ™ 7.7.æ•°æ®åº“é” é”æ˜¯è®¡ç®—æœºåè°ƒå¤šä¸ªè¿›ç¨‹æˆ–è€…çº¯çº¿ç¨‹å¹¶å‘è®¿é—®æŸä¸€èµ„æºçš„æœºåˆ¶ 7.7.1Mysqlçš„é”ç§ç±» Mysqlçš„é”æœºåˆ¶æ¯”è¾ƒç®€å•ï¼Œä¸åŒçš„æœç´¢å¼•æ“æ”¯æŒä¸åŒçš„é”æœºåˆ¶è¡¨çº§é”ï¼šå¼€é”€å°ï¼ŒåŠ é”å¿«ï¼›ä¸ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦å¤§ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡é«˜ï¼Œå¹¶å‘åº¦æœ€ä½è¡Œçº§é”ï¼šå¼€é”€å¤§ï¼ŒåŠ é”æ…¢ï¼›ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦æœ€å°ï¼Œå‘ç”Ÿé”å†²çªæ¦‚ç‡æœ€ä½ï¼Œå¹¶å‘åº¦ä¹Ÿæœ€é«˜é¡µé¢é”ï¼šå¼€é”€å’ŒåŠ é”é€Ÿåº¦ä½äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼Œä¼šå‡ºç°æ­»é”ï¼Œé”å®šç²’åº¦ä¹Ÿä½äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼Œå¹¶å‘åº¦ä¸€èˆ¬ 7.7.2Mysqlè¡¨çº§é”çš„é”æ¨¡å¼ï¼ˆMyISAMï¼‰ Mysqlè¡¨çº§é”æœ‰ä¸¤ç§æ¨¡å¼ï¼šè¡¨å…±äº«é”ï¼ˆTable Read Lockï¼‰å’Œè¡¨ç‹¬å é”ï¼ˆTable Write Lockï¼‰ 7.8.having å’Œgroup byå››ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ä¸€ä¸ªäº‹åŠ¡Aå¼€å¯åï¼Œç¬¬ä¸€æ¬¡è¯»å–åˆ°ä¸€äº›æ•°æ®ä¹‹åï¼Œå°±å¯¹è¿™äº›æ•°æ®è¿›è¡ŒåŠ è¡Œé”ï¼Œå¯¼è‡´å…¶ä»–äº‹åŠ¡Bæ— æ³•ä¿®æ”¹ï¼ˆæ›´æ–°æˆ–è€…åˆ é™¤ï¼‰æ•°æ®ï¼Œäºæ˜¯Aäº‹åŠ¡ä¸ç®¡æ€ä¹ˆè¯»ï¼Œè¿”å›çš„éƒ½æ˜¯ä¸€æ ·çš„æ•°æ®ï¼Œè¿™å°±å®ç°äº†â€œå¯é‡å¤è¯»â€è¿™ä¸ªéš”ç¦»çº§åˆ« â€œå…¶ä»–äº‹åŠ¡Bæ— æ³•ä¿®æ”¹è¿™äº›æ•°æ®ï¼ˆæ›´æ–°æˆ–åˆ é™¤ï¼‰â€ï¼Œä¸ä»£è¡¨å…¶ä»–äº‹åŠ¡Bä¸èƒ½insertä¸€äº›è®°å½•å¹¶æäº¤ã€‚è¿™æ ·ä¸€æ¥äº‹åŠ¡Aè¿˜æ˜¯å¯ä»¥è¯»å–åˆ°ä¸€æ¡ä¹‹å‰æ²¡æœ‰å‡ºç°çš„æ•°æ®ï¼Œè¿™å°±äº§ç”Ÿäº†â€œå¹»è¯»â€ã€‚ è¡Œçº§é”æ˜¯æ— æ³•è§£å†³å¹»è¯»é—®é¢˜çš„ã€‚è¦æƒ³è§£å†³è¿™ä¸ªé—®é¢˜å¿…é¡»å®ç°Serializableéš”ç¦»çº§åˆ«ã€‚ ä½¿ç”¨é—´éš™é”å¯ä»¥è§£å†³æ’å…¥å¯¼è‡´çš„å¹»è¯» äº”ã€åˆ†å¸ƒå¼IDç”Ÿæˆæ–¹æ¡ˆæ€»ç»“åˆ†å¸ƒå¼IDç”Ÿæˆæ–¹æ¡ˆæ€»ç»“ ç”Ÿæˆå…¨å±€ id æœ‰ä¸‹é¢è¿™å‡ ç§æ–¹å¼ï¼š UUIDï¼šä¸é€‚åˆä½œä¸ºä¸»é”®ï¼Œå› ä¸ºå¤ªé•¿äº†ï¼Œå¹¶ä¸”æ— åºä¸å¯è¯»ï¼ŒæŸ¥è¯¢æ•ˆç‡ä½ã€‚æ¯”è¾ƒé€‚åˆç”¨äºç”Ÿæˆå”¯ä¸€çš„åå­—çš„æ ‡ç¤ºæ¯”å¦‚æ–‡ä»¶çš„åå­—ã€‚ æ•°æ®åº“è‡ªå¢ id : ä¸¤å°æ•°æ®åº“åˆ†åˆ«è®¾ç½®ä¸åŒæ­¥é•¿ï¼Œç”Ÿæˆä¸é‡å¤IDçš„ç­–ç•¥æ¥å®ç°é«˜å¯ç”¨ã€‚è¿™ç§æ–¹å¼ç”Ÿæˆçš„ id æœ‰åºï¼Œä½†æ˜¯éœ€è¦ç‹¬ç«‹éƒ¨ç½²æ•°æ®åº“å®ä¾‹ï¼Œæˆæœ¬é«˜ï¼Œè¿˜ä¼šæœ‰æ€§èƒ½ç“¶é¢ˆã€‚ åˆ©ç”¨ redis ç”Ÿæˆ id : æ€§èƒ½æ¯”è¾ƒå¥½ï¼Œçµæ´»æ–¹ä¾¿ï¼Œä¸ä¾èµ–äºæ•°æ®åº“ã€‚ä½†æ˜¯ï¼Œå¼•å…¥äº†æ–°çš„ç»„ä»¶é€ æˆç³»ç»Ÿæ›´åŠ å¤æ‚ï¼Œå¯ç”¨æ€§é™ä½ï¼Œç¼–ç æ›´åŠ å¤æ‚ï¼Œå¢åŠ äº†ç³»ç»Ÿæˆæœ¬ã€‚ Twitterçš„snowflakeç®—æ³• ï¼šGithub åœ°å€ï¼šhttps://github.com/twitter-archive/snowflakeã€‚ ç¾å›¢çš„Leafåˆ†å¸ƒå¼IDç”Ÿæˆç³»ç»Ÿ ï¼šLeaf æ˜¯ç¾å›¢å¼€æºçš„åˆ†å¸ƒå¼IDç”Ÿæˆå™¨ï¼Œèƒ½ä¿è¯å…¨å±€å”¯ä¸€æ€§ã€è¶‹åŠ¿é€’å¢ã€å•è°ƒé€’å¢ã€ä¿¡æ¯å®‰å…¨ï¼Œé‡Œé¢ä¹Ÿæåˆ°äº†å‡ ç§åˆ†å¸ƒå¼æ–¹æ¡ˆçš„å¯¹æ¯”ï¼Œä½†ä¹Ÿéœ€è¦ä¾èµ–å…³ç³»æ•°æ®åº“ã€Zookeeperç­‰ä¸­é—´ä»¶ã€‚æ„Ÿè§‰è¿˜ä¸é”™ã€‚ ã€‚ å…­ã€å¸¸ç”¨å‘½ä»¤MySQLå¸¸ç”¨æ“ä½œå‘½ä»¤ MySQLæŸ¥çœ‹æ•°æ®åº“æ€§èƒ½å¸¸ç”¨å‘½ä»¤ ä¸ƒã€æŠŠå­æŸ¥è¯¢ä¼˜åŒ–ä¸º join æ“ä½œé€šå¸¸å­æŸ¥è¯¢åœ¨ in å­å¥ä¸­ï¼Œä¸”å­æŸ¥è¯¢ä¸­ä¸ºç®€å• SQL(ä¸åŒ…å« unionã€group byã€order byã€limit ä»å¥) æ—¶,æ‰å¯ä»¥æŠŠå­æŸ¥è¯¢è½¬åŒ–ä¸ºå…³è”æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ã€‚ å­æŸ¥è¯¢æ€§èƒ½å·®çš„åŸå› ï¼š å­æŸ¥è¯¢çš„ç»“æœé›†æ— æ³•ä½¿ç”¨ç´¢å¼•ï¼Œé€šå¸¸å­æŸ¥è¯¢çš„ç»“æœé›†ä¼šè¢«å­˜å‚¨åˆ°ä¸´æ—¶è¡¨ä¸­ï¼Œä¸è®ºæ˜¯å†…å­˜ä¸´æ—¶è¡¨è¿˜æ˜¯ç£ç›˜ä¸´æ—¶è¡¨éƒ½ä¸ä¼šå­˜åœ¨ç´¢å¼•ï¼Œæ‰€ä»¥æŸ¥è¯¢æ€§èƒ½ä¼šå—åˆ°ä¸€å®šçš„å½±å“ã€‚ç‰¹åˆ«æ˜¯å¯¹äºè¿”å›ç»“æœé›†æ¯”è¾ƒå¤§çš„å­æŸ¥è¯¢ï¼Œå…¶å¯¹æŸ¥è¯¢æ€§èƒ½çš„å½±å“ä¹Ÿå°±è¶Šå¤§ã€‚ ç”±äºå­æŸ¥è¯¢ä¼šäº§ç”Ÿå¤§é‡çš„ä¸´æ—¶è¡¨ä¹Ÿæ²¡æœ‰ç´¢å¼•ï¼Œæ‰€ä»¥ä¼šæ¶ˆè€—è¿‡å¤šçš„ CPU å’Œ IO èµ„æºï¼Œäº§ç”Ÿå¤§é‡çš„æ…¢æŸ¥è¯¢ã€‚ å…«ã€ä¸´æ—¶è¡¨ä½¿ç”¨ä¸´æ—¶è¡¨çš„åœºæ™¯ 1)ORDER BYå­å¥å’ŒGROUP BYå­å¥ä¸Â·åŒï¼Œ ä¾‹å¦‚ï¼šORDERY BY price GROUP BY nameï¼› 2)åœ¨JOINæŸ¥è¯¢ä¸­ï¼ŒORDER BYæˆ–è€…GROUP BYä½¿ç”¨äº†ä¸æ˜¯ç¬¬ä¸€ä¸ªè¡¨çš„åˆ— ä¾‹å¦‚ï¼š 1SELECT * from TableA, TableB ORDER BY TableA.price GROUP by TableB.name 3)ORDER BYä¸­ä½¿ç”¨äº†DISTINCTå…³é”®å­— ORDERY BY DISTINCT(price) 4)SELECTè¯­å¥ä¸­æŒ‡å®šäº†SQL_SMALL_RESULTå…³é”®å­— SQL_SMALL_RESULTçš„æ„æ€å°±æ˜¯å‘Šè¯‰MySQLï¼Œç»“æœä¼šå¾ˆå°ï¼Œè¯·ç›´æ¥ä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨ï¼Œä¸éœ€è¦ä½¿ç”¨ç´¢å¼•æ’åº SQL_SMALL_RESULTå¿…é¡»å’ŒGROUP BYã€DISTINCTæˆ–DISTINCTROWä¸€èµ·ä½¿ç”¨ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ²¡æœ‰å¿…è¦ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ï¼Œè®©MySQLæœåŠ¡å™¨é€‰æ‹©å³å¯ã€‚ ç›´æ¥ä½¿ç”¨ç£ç›˜ä¸´æ—¶è¡¨çš„åœºæ™¯ 1)è¡¨åŒ…å«TEXTæˆ–è€…BLOBåˆ—ï¼› 2)GROUP BYæˆ–è€… DISTINCTå­å¥ä¸­åŒ…å«é•¿åº¦å¤§äº512å­—èŠ‚çš„åˆ—ï¼› 3)ä½¿ç”¨UNIONæˆ–è€…UNION ALLæ—¶ï¼ŒSELECTå­å¥ä¸­åŒ…å«å¤§äº512å­—èŠ‚çš„åˆ—ï¼› JVMä¸€ã€å››ç§å¼•ç”¨å¼•ç”¨è¯¦è§£ å¼ºå¼•ç”¨ï¼šå¦‚æœä¸€ä¸ªå¯¹è±¡å…·æœ‰å¼ºå¼•ç”¨ï¼Œ==å®ƒå°±ä¸ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶==ã€‚å³ä½¿å½“å‰å†…å­˜ç©ºé—´ä¸è¶³ï¼ŒJVMä¹Ÿä¸ä¼šå›æ”¶å®ƒï¼Œè€Œæ˜¯==æŠ›å‡º OutOfMemoryError é”™è¯¯==ï¼Œä½¿ç¨‹åºå¼‚å¸¸ç»ˆæ­¢ã€‚å¦‚æœæƒ³ä¸­æ–­å¼ºå¼•ç”¨å’ŒæŸä¸ªå¯¹è±¡ä¹‹é—´çš„å…³è”ï¼Œå¯ä»¥==æ˜¾å¼åœ°å°†å¼•ç”¨èµ‹å€¼ä¸ºnul==lï¼Œè¿™æ ·ä¸€æ¥çš„è¯ï¼ŒJVMåœ¨åˆé€‚çš„æ—¶é—´å°±ä¼šå›æ”¶è¯¥å¯¹è±¡ 1Person person=new Person(); è½¯å¼•ç”¨ï¼šåœ¨ä½¿ç”¨è½¯å¼•ç”¨æ—¶ï¼Œå¦‚æœå†…å­˜çš„ç©ºé—´è¶³å¤Ÿï¼Œè½¯å¼•ç”¨å°±èƒ½ç»§ç»­è¢«ä½¿ç”¨ï¼Œè€Œä¸ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ï¼Œ==åªæœ‰åœ¨å†…å­˜ä¸è¶³æ—¶ï¼Œè½¯å¼•ç”¨æ‰ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶==ã€‚ 12Person person=new Person(); SoftReference sr=new SoftReference(person); å¼±å¼•ç”¨ï¼šå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡æ‹¥æœ‰çš„ç”Ÿå‘½å‘¨æœŸæ›´çŸ­æš‚ã€‚å› ä¸ºå½“ JVM è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œä¸€æ—¦å‘ç°å¼±å¼•ç”¨å¯¹è±¡ï¼Œ==æ— è®ºå½“å‰å†…å­˜ç©ºé—´æ˜¯å¦å……è¶³ï¼Œéƒ½ä¼šå°†å¼±å¼•ç”¨å›æ”¶==ã€‚ä¸è¿‡ç”±äºåƒåœ¾å›æ”¶å™¨æ˜¯ä¸€ä¸ªä¼˜å…ˆçº§è¾ƒä½çš„çº¿ç¨‹ï¼Œæ‰€ä»¥å¹¶ä¸ä¸€å®šèƒ½è¿…é€Ÿå‘ç°å¼±å¼•ç”¨å¯¹è±¡ 12Person person=new Person(); WeakReference wr=new WeakReference(person); è™šå¼•ç”¨ï¼šé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å½¢åŒè™šè®¾ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡ä»…æŒæœ‰è™šå¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒç›¸å½“äºæ²¡æœ‰å¼•ç”¨ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚ è®¾ç½®è™šå¼•ç”¨çš„ç›®çš„æ˜¯ä¸ºäº†==è¢«è™šå¼•ç”¨å…³è”çš„å¯¹è±¡åœ¨è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶æ—¶ï¼Œèƒ½å¤Ÿæ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥== 1234ReferenceQueue queue=new ReferenceQueue();PhantomReference pr=new PhantomReference(object.queue);//GCåœ¨å›æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°è¯¥å¯¹è±¡å…·æœ‰è™šå¼•ç”¨ï¼Œé‚£ä¹ˆåœ¨å›æ”¶ä¹‹å‰ä¼šé¦–å…ˆè¯¥å¯¹è±¡çš„è™šå¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚ç¨‹åºå¯ä»¥é€šè¿‡åˆ¤æ–­å¼•ç”¨é˜Ÿåˆ—ä¸­æ˜¯å¦å·²ç»åŠ å…¥è™šå¼•ç”¨æ¥äº†è§£è¢«å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦è¢«GCå›æ”¶ã€‚ å¼•ç”¨é¡ºåº å•æ¡å¼•ç”¨é“¾çš„å¯è¾¾æ€§ä»¥æœ€å¼±çš„ä¸€ä¸ªå¼•ç”¨ç±»å‹æ¥å†³å®šï¼›å¤šæ¡å¼•ç”¨é“¾çš„å¯è¾¾æ€§ä»¥æœ€å¼ºçš„ä¸€ä¸ªå¼•ç”¨ç±»å‹æ¥å†³å®šï¼› åº”ç”¨åœºæ™¯ åˆ©ç”¨è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨è§£å†³OOMé—®é¢˜ï¼š ä¾‹ï¼šç”¨ä¸€ä¸ªHashMapæ¥ä¿å­˜å›¾ç‰‡çš„è·¯å¾„å’Œç›¸åº”å›¾ç‰‡å¯¹è±¡å…³è”çš„è½¯å¼•ç”¨ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œåœ¨å†…å­˜ä¸è¶³æ—¶ï¼ŒJVMä¼šè‡ªåŠ¨å›æ”¶è¿™äº›ç¼“å­˜å›¾ç‰‡å¯¹è±¡æ‰€å ç”¨çš„ç©ºé—´ï¼Œä»è€Œæœ‰æ•ˆåœ°é¿å…äº†OOMçš„é—®é¢˜. é€šè¿‡è½¯å¼•ç”¨å®ç°Javaå¯¹è±¡çš„é«˜é€Ÿç¼“å­˜: ä¾‹ï¼šæ¯”å¦‚æˆ‘ä»¬åˆ›å»ºäº†ä¸€Personçš„ç±»ï¼Œå¦‚æœæ¯æ¬¡éœ€è¦æŸ¥è¯¢ä¸€ä¸ªäººçš„ä¿¡æ¯,å“ªæ€•æ˜¯å‡ ç§’ä¸­ä¹‹å‰åˆšåˆšæŸ¥è¯¢è¿‡çš„ï¼Œéƒ½è¦é‡æ–°æ„å»ºä¸€ä¸ªå®ä¾‹ï¼Œè¿™å°†å¼•èµ·å¤§é‡Personå¯¹è±¡çš„æ¶ˆè€—,å¹¶ä¸”ç”±äºè¿™äº›å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸç›¸å¯¹è¾ƒçŸ­,ä¼šå¼•èµ·å¤šæ¬¡GCå½±å“æ€§èƒ½ã€‚æ­¤æ—¶,é€šè¿‡è½¯å¼•ç”¨å’Œ HashMap çš„ç»“åˆå¯ä»¥æ„å»ºé«˜é€Ÿç¼“å­˜,æä¾›æ€§èƒ½. äºŒã€ReferenceQueueå’ŒReferenceReferenceQueue å…¶ä½œç”¨åœ¨äºReferenceå¯¹è±¡æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«GCå›æ”¶æ—¶ï¼Œè¯¥Referenceå¯¹è±¡å°†ä¼šè¢«åŠ å…¥å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼ˆReferenceQueueï¼‰çš„é˜Ÿåˆ—æœ«å°¾,è¿™ç›¸å½“äºæ˜¯ä¸€ç§é€šçŸ¥æœºåˆ¶.å½“å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­æœ‰æ•°æ®çš„æ—¶å€™ï¼Œæ„å‘³ç€å¼•ç”¨æŒ‡å‘çš„å †å†…å­˜ä¸­çš„å¯¹è±¡è¢«å›æ”¶ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒJVMå…è®¸æˆ‘ä»¬åœ¨å¯¹è±¡è¢«é”€æ¯åï¼Œåšä¸€äº›æˆ‘ä»¬è‡ªå·±æƒ³åšçš„äº‹æƒ… 123ReferenceQueue&lt; Person&gt; rq=new ReferenceQueue&lt;Person&gt;();Person person=new Person();SoftReference sr=new SoftReference(person,rq); Reference Referenceæ˜¯SoftReferenceï¼ŒWeakReference,PhantomReferenceç±»çš„çˆ¶ç±»ï¼Œå…¶å†…éƒ¨é€šè¿‡ä¸€ä¸ªnextå­—æ®µæ¥æ„å»ºäº†ä¸€ä¸ªReferenceç±»å‹çš„å•å‘åˆ—è¡¨ï¼Œè€Œqueueå­—æ®µå­˜æ”¾äº†å¼•ç”¨å¯¹è±¡å¯¹åº”çš„å¼•ç”¨é˜Ÿåˆ—ï¼Œè‹¥åœ¨Referenceçš„å­ç±»æ„é€ å‡½æ•°ä¸­æ²¡æœ‰æŒ‡å®šï¼Œåˆ™é»˜è®¤å…³è”ä¸€ä¸ªReferenceQueue.NULLé˜Ÿåˆ—ã€‚ ä¸‰ã€åƒåœ¾å›æ”¶ç®—æ³• GCä¸»è¦å®Œæˆä¸‰é¡¹ä»»åŠ¡ï¼šåˆ†é…å†…å­˜ï¼Œç¡®ä¿è¢«å¼•ç”¨çš„å¯¹è±¡çš„å†…å­˜ä¸è¢«é”™è¯¯çš„å›æ”¶ä»¥åŠå›æ”¶ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡çš„å†…å­˜ç©ºé—´ æ ‡è®°-æ¸…é™¤ æ ‡è®°-å¤åˆ¶ æ ‡è®°-æ•´ç† åˆ†ä»£å›æ”¶ å¢é‡æ”¶é›† ä¸ç”¨stop the world åˆ¤æ–­å¯¹è±¡å­˜æ´»ï¼š1.å¼•ç”¨è®¡æ•°æ³•;2:å¯¹è±¡å¯è¾¾æ€§åˆ†æ ç®€å•çš„è§£é‡Šä¸€ä¸‹åƒåœ¾å›æ”¶ Java åƒåœ¾å›æ”¶æœºåˆ¶æœ€åŸºæœ¬çš„åšæ³•æ˜¯åˆ†ä»£å›æ”¶ã€‚ å†…å­˜ä¸­çš„åŒºåŸŸè¢«åˆ’åˆ†æˆä¸åŒçš„ä¸–ä»£ï¼Œå¯¹è±¡æ ¹æ®å…¶å­˜æ´»çš„æ—¶é—´è¢«ä¿å­˜åœ¨å¯¹åº”ä¸–ä»£çš„åŒºåŸŸä¸­ã€‚ä¸€èˆ¬çš„å®ç°æ˜¯åˆ’åˆ†æˆ3ä¸ªä¸–ä»£ï¼šå¹´è½»ã€å¹´è€å’Œæ°¸ä¹…ã€‚å†…å­˜çš„åˆ†é…æ˜¯å‘ç”Ÿåœ¨å¹´è½»ä¸–ä»£ä¸­çš„ã€‚å½“ä¸€ä¸ªå¯¹è±¡å­˜æ´»æ—¶é—´è¶³å¤Ÿé•¿çš„æ—¶å€™ï¼Œå®ƒå°±ä¼šè¢«å¤åˆ¶åˆ°å¹´è€ä¸–ä»£ä¸­ã€‚å¯¹äºä¸åŒçš„ä¸–ä»£å¯ä»¥ä½¿ç”¨ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³•ã€‚ è¿›è¡Œä¸–ä»£åˆ’åˆ†çš„å‡ºå‘ç‚¹æ˜¯å¯¹åº”ç”¨ä¸­å¯¹è±¡å­˜æ´»æ—¶é—´è¿›è¡Œç ”ç©¶ä¹‹åå¾—å‡ºçš„ç»Ÿè®¡è§„å¾‹ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªåº”ç”¨ä¸­çš„å¤§éƒ¨åˆ†å¯¹è±¡çš„å­˜æ´»æ—¶é—´éƒ½å¾ˆçŸ­ã€‚æ¯”å¦‚å±€éƒ¨å˜é‡çš„å­˜æ´»æ—¶é—´å°±åªåœ¨æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ã€‚åŸºäºè¿™ä¸€ç‚¹ï¼Œå¯¹äºå¹´è½»ä¸–ä»£çš„åƒåœ¾å›æ”¶ç®—æ³•å°±å¯ä»¥å¾ˆæœ‰é’ˆå¯¹æ€§. å››ã€System.gc()ï¼šé€šçŸ¥GCå¼€å§‹å·¥ä½œ,ä½†æ˜¯GCçœŸæ­£å¼€å§‹çš„æ—¶é—´ä¸ç¡®å®š. äº”ã€JVMçš„å¹³å°äº”æ— å…³æ€§ Javaè¯­è¨€çš„ä¸€ä¸ªéå¸¸é‡è¦çš„ç‰¹ç‚¹å°±æ˜¯ä¸å¹³å°çš„æ— å…³æ€§ã€‚è€Œä½¿ç”¨Javaè™šæ‹Ÿæœºæ˜¯å®ç°è¿™ä¸€ç‰¹ç‚¹çš„å…³é”®ã€‚ä¸€èˆ¬çš„é«˜çº§è¯­è¨€å¦‚æœè¦åœ¨ä¸åŒçš„å¹³å°ä¸Šè¿è¡Œï¼Œè‡³å°‘éœ€è¦ç¼–è¯‘æˆä¸åŒçš„ç›®æ ‡ä»£ç ã€‚è€Œå¼•å…¥Javaè¯­è¨€è™šæ‹Ÿæœºåï¼ŒJavaè¯­è¨€åœ¨ä¸åŒå¹³å°ä¸Šè¿è¡Œæ—¶ä¸éœ€è¦é‡æ–°ç¼–è¯‘ã€‚Javaè¯­è¨€ä½¿ç”¨æ¨¡å¼Javaè™šæ‹Ÿæœºå±è”½äº†ä¸å…·ä½“å¹³å°ç›¸å…³çš„ä¿¡æ¯ï¼Œä½¿å¾—Javaè¯­è¨€ç¼–è¯‘ç¨‹åºåªéœ€ç”Ÿæˆåœ¨Javaè™šæ‹Ÿæœºä¸Šè¿è¡Œçš„ç›®æ ‡ä»£ç ï¼ˆå­—èŠ‚ç ï¼‰ï¼Œå°±å¯ä»¥åœ¨å¤šç§å¹³å°ä¸Šä¸åŠ ä¿®æ”¹åœ°è¿è¡Œã€‚Javaè™šæ‹Ÿæœºåœ¨æ‰§è¡Œå­—èŠ‚ç æ—¶ï¼ŒæŠŠå­—èŠ‚ç è§£é‡Šæˆå…·ä½“å¹³å°ä¸Šçš„æœºå™¨æŒ‡ä»¤æ‰§è¡Œã€‚ å…­ã€ç±»åŠ è½½æœºåˆ¶ æ·±å…¥ç†è§£JVMåŠ è½½å™¨ã€‚ åˆå§‹åŒ–é˜¶æ®µ ä»¥ä¸‹æƒ…å†µæ‰ä¼šå¯¹ç±»ç«‹å³åˆå§‹åŒ–ï¼š ä½¿ç”¨newå…³é”®å­—å®ä¾‹åŒ–å¯¹è±¡ã€è®¿é—®æˆ–è€…è®¾ç½®ä¸€ä¸ªç±»çš„é™æ€å­—æ®µï¼ˆ==è¢«finalä¿®é¥°ã€ç¼–è¯‘å™¨ä¼˜åŒ–æ—¶å·²ç»æ”¾å…¥å¸¸é‡æ± çš„ä¾‹å¤–==ï¼‰ã€è°ƒç”¨ç±»æ–¹æ³•ï¼Œéƒ½ä¼šåˆå§‹åŒ–è¯¥é™æ€å­—æ®µæˆ–è€…é™æ€æ–¹æ³•æ‰€åœ¨çš„ç±»ã€‚ åˆå§‹åŒ–ç±»çš„æ—¶å€™ï¼Œå¦‚æœå…¶çˆ¶ç±»æ²¡æœ‰è¢«åˆå§‹åŒ–è¿‡ï¼Œåˆ™è¦å…ˆè§¦å‘å…¶çˆ¶ç±»åˆå§‹åŒ–ã€‚ ä½¿ç”¨java.lang.reflectåŒ…çš„æ–¹æ³•è¿›è¡Œåå°„è°ƒç”¨çš„æ—¶å€™ï¼Œå¦‚æœç±»æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œåˆ™è¦å…ˆåˆå§‹åŒ–ã€‚Â· è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·ä¼šå…ˆåˆå§‹åŒ–è¦æ‰§è¡Œçš„ä¸»ç±»ï¼ˆå«æœ‰mainï¼‰ jdk 1.7åï¼Œå¦‚æœjava.lang.invoke.MethodHandleçš„å®ä¾‹æœ€åå¯¹åº”çš„è§£æç»“æœæ˜¯ REF_getStaticã€REF_putStaticã€REF_invokeStaticæ–¹æ³•å¥æŸ„ï¼Œå¹¶ä¸”è¿™ä¸ªæ–¹æ³•æ‰€åœ¨ç±»æ²¡æœ‰åˆå§‹åŒ–ï¼Œåˆ™å…ˆåˆå§‹åŒ–ã€‚ å…¶ä»–ä¸€ã€XMLè§£æçš„å‡ ç§æ–¹å¼å’Œç‰¹ç‚¹ DOM,SAX,PULLä¸‰ç§è§£ææ–¹å¼: DOM:æ¶ˆè€—å†…å­˜ï¼šå…ˆæŠŠxmlæ–‡æ¡£éƒ½è¯»åˆ°å†…å­˜ä¸­ï¼Œç„¶åå†ç”¨DOM APIæ¥è®¿é—®æ ‘å½¢ç»“æ„ï¼Œå¹¶è·å–æ•°æ®ã€‚è¿™ä¸ªå†™èµ·æ¥å¾ˆç®€å•ï¼Œä½†æ˜¯å¾ˆæ¶ˆè€—å†…å­˜ã€‚è¦æ˜¯æ•°æ®è¿‡å¤§ï¼Œæ‰‹æœºä¸å¤Ÿç‰›é€¼ï¼Œå¯èƒ½æ‰‹æœºç›´æ¥æ­»æœº SAX:è§£ææ•ˆç‡é«˜ï¼Œå ç”¨å†…å­˜å°‘ï¼ŒåŸºäºäº‹ä»¶é©±åŠ¨çš„ï¼šæ›´åŠ ç®€å•åœ°è¯´å°±æ˜¯å¯¹æ–‡æ¡£è¿›è¡Œé¡ºåºæ‰«æï¼Œå½“æ‰«æåˆ°æ–‡æ¡£(document)å¼€å§‹ä¸ç»“æŸã€å…ƒç´ (element)å¼€å§‹ä¸ç»“æŸã€æ–‡æ¡£(document)ç»“æŸç­‰åœ°æ–¹æ—¶é€šçŸ¥äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œç”±äº‹ä»¶å¤„ç†å‡½æ•°åšç›¸åº”åŠ¨ä½œï¼Œç„¶åç»§ç»­åŒæ ·çš„æ‰«æï¼Œç›´è‡³æ–‡æ¡£ç»“æŸã€‚ PULL:ä¸ SAX ç±»ä¼¼ï¼Œä¹Ÿæ˜¯åŸºäºäº‹ä»¶é©±åŠ¨ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨å®ƒçš„nextï¼ˆï¼‰æ–¹æ³•ï¼Œæ¥è·å–ä¸‹ä¸€ä¸ªè§£æäº‹ä»¶ï¼ˆå°±æ˜¯å¼€å§‹æ–‡æ¡£ï¼Œç»“æŸæ–‡æ¡£ï¼Œå¼€å§‹æ ‡ç­¾ï¼Œç»“æŸæ ‡ç­¾ï¼‰ï¼Œå½“å¤„äºæŸä¸ªå…ƒç´ æ—¶å¯ä»¥è°ƒç”¨XmlPullParserçš„getAttributte()æ–¹æ³•æ¥è·å–å±æ€§çš„å€¼ï¼Œä¹Ÿå¯è°ƒç”¨å®ƒçš„nextText()è·å–æœ¬èŠ‚ç‚¹çš„å€¼ã€‚ äºŒã€ç‰ˆæœ¬ç‰¹æ€§ JDK 1.7ç‰¹æ€§ JDK 1.7 ä¸åƒ JDK 5 å’Œ 8 ä¸€æ ·çš„å¤§ç‰ˆæœ¬ï¼Œä½†æ˜¯ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šæ–°çš„ç‰¹æ€§ï¼Œå¦‚ try-with-resourceè¯­å¥ï¼Œè¿™æ ·ä½ åœ¨ä½¿ç”¨æµæˆ–è€…èµ„æºçš„æ—¶å€™ï¼Œå°±ä¸éœ€è¦æ‰‹åŠ¨å…³é—­ï¼ŒJava ä¼šè‡ªåŠ¨å…³é—­ã€‚ Fork-Join æ± æŸç§ç¨‹åº¦ä¸Šå®ç° Java ç‰ˆçš„ Map-reduceã€‚ å…è®¸ Switch ä¸­æœ‰ String å˜é‡å’Œæ–‡æœ¬ã€‚ è±å½¢æ“ä½œç¬¦(&lt;&gt;)ç”¨äºç±»å‹æ¨æ–­ï¼Œä¸å†éœ€è¦åœ¨å˜é‡å£°æ˜çš„å³è¾¹ç”³æ˜æ³›å‹ï¼Œå› æ­¤å¯ä»¥å†™å‡ºå¯è¯»å†™æ›´å¼ºã€æ›´ç®€æ´çš„ä»£ç  JDK 1.8ç‰¹æ€§ java 8 åœ¨ Java å†å²ä¸Šæ˜¯ä¸€ä¸ªå¼€åˆ›æ–°çš„ç‰ˆæœ¬ï¼Œä¸‹é¢ JDK 8 ä¸­ 5 ä¸ªä¸»è¦çš„ç‰¹æ€§ï¼š Lambda è¡¨è¾¾å¼ï¼Œå…è®¸åƒå¯¹è±¡ä¸€æ ·ä¼ é€’åŒ¿åå‡½æ•° Stream APIï¼Œå……åˆ†åˆ©ç”¨ç°ä»£å¤šæ ¸ CPUï¼Œå¯ä»¥å†™å‡ºå¾ˆç®€æ´çš„ä»£ç  Date ä¸ Time APIï¼Œæœ€ç»ˆï¼Œæœ‰ä¸€ä¸ªç¨³å®šã€ç®€å•çš„æ—¥æœŸå’Œæ—¶é—´åº“å¯ä¾›ä½ ä½¿ç”¨ æ‰©å±•æ–¹æ³•ï¼Œç°åœ¨ï¼Œæ¥å£ä¸­å¯ä»¥æœ‰é™æ€ã€é»˜è®¤æ–¹æ³•ã€‚ é‡å¤æ³¨è§£ï¼Œç°åœ¨ä½ å¯ä»¥å°†ç›¸åŒçš„æ³¨è§£åœ¨åŒä¸€ç±»å‹ä¸Šä½¿ç”¨å¤šæ¬¡ã€‚ SpringåŠ¨æ€ä»£ç† ä»£ç†ç±»åœ¨ç¨‹åºè¿è¡Œæ—¶åˆ›å»ºçš„ä»£ç†æ–¹å¼è¢«ç§°ä¸ºåŠ¨æ€ä»£ç†ã€‚ä»£ç†ç±»å¹¶ä¸æ˜¯åœ¨Javaä»£ç ä¸­å®šä¹‰çš„ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶æ ¹æ®æˆ‘ä»¬åœ¨Javaä»£ç ä¸­çš„â€œæŒ‡ç¤ºâ€åŠ¨æ€ç”Ÿæˆçš„ã€‚æ–¹æ³•å®ç°å‰ååŠ å…¥å¯¹åº”çš„å…¬å…±åŠŸèƒ½ åŸºäºæ¥å£Â· jdkçš„åŠ¨æ€ä»£ç†æ—¶åŸºäºJavaçš„åå°„æœºåˆ¶æ¥å®ç°çš„ï¼Œæ˜¯JavaåŸç”Ÿçš„ä¸€ç§ä»£ç†æ–¹å¼ã€‚ä»–çš„å®ç°åŸç†å°±æ˜¯è®©ä»£ç†ç±»å’Œè¢«ä»£ç†ç±»å®ç°åŒä¸€æ¥å£ï¼Œä»£ç†ç±»æŒæœ‰ç›®æ ‡å¯¹è±¡æ¥è¾¾åˆ°æ–¹æ³•æ‹¦æˆªçš„ä½œç”¨ã€‚ é€šè¿‡æ¥å£çš„æ–¹å¼æœ‰ä¸¤ä¸ªå¼Šç«¯: ä¸€ä¸ªå°±æ˜¯å¿…é¡»ä¿è¯è¢«ä»£ç†ç±»æœ‰æ¥å£ å¦ä¸€ä¸ªå°±æ˜¯å¦‚æœç›¸å¯¹è¢«ä»£ç†ç±»çš„æ–¹æ³•è¿›è¡Œä»£ç†æ‹¦æˆªï¼Œé‚£ä¹ˆå°±è¦ä¿è¯è¿™äº›æ–¹æ³•éƒ½è¦åœ¨æ¥å£ä¸­å£°æ˜ã€‚æ¥å£ç»§æ‰¿çš„æ˜¯java.lang.reflect.InvocationHandler; åŸºäºç»§æ‰¿ cglibåŠ¨æ€ä»£ç†ä½¿ç”¨çš„ASMè¿™ä¸ªéå¸¸å¼ºå¤§çš„Javaå­—èŠ‚ç ç”Ÿæˆæ¡†æ¶æ¥ç”Ÿæˆclassï¼Œæ¯”jdkåŠ¨æ€ä»£ç†ideæ•ˆç‡é«˜ã€‚åŸºäºç»§æ‰¿çš„å®ç°åŠ¨æ€ä»£ç†ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡superå…³é”®å­—æ¥è°ƒç”¨è¢«ä»£ç†ç±»çš„æ–¹æ³•. å­ç±»å¯ä»¥è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³• AOP é¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚ï¼ˆAspect-Oriented Programmingï¼‰ ã€‚AOPå¯ä»¥è¯´æ˜¯å¯¹OOPçš„è¡¥å……å’Œå®Œå–„ã€‚ é¢å‘å¯¹è±¡ç¼–ç¨‹å°†ç¨‹åºåˆ†è§£æˆå„ä¸ªå±‚æ¬¡çš„å¯¹è±¡ï¼Œé¢å‘åˆ‡é¢ç¼–ç¨‹å°†ç¨‹åºè¿è¡Œè¿‡ç¨‹åˆ†è§£æˆå„ä¸ªåˆ‡é¢ã€‚ AOPä»ç¨‹åºè¿è¡Œè§’åº¦è€ƒè™‘ç¨‹åºçš„ç»“æ„ï¼Œæå–ä¸šåŠ¡å¤„ç†è¿‡ç¨‹çš„åˆ‡é¢ï¼Œoopæ˜¯é™æ€çš„æŠ½è±¡ï¼Œaopæ˜¯åŠ¨æ€çš„æŠ½è±¡ï¼Œ æ˜¯å¯¹åº”ç”¨æ‰§è¡Œè¿‡ç¨‹ä¸­çš„æ­¥éª¤è¿›è¡ŒæŠ½è±¡ï¼Œä»è€Œè·å¾—æ­¥éª¤ä¹‹é—´çš„é€»è¾‘åˆ’åˆ†ã€‚ OOPå¼•å…¥å°è£…ã€ ç»§æ‰¿å’Œå¤šæ€æ€§ç­‰æ¦‚å¿µæ¥å»ºç«‹ä¸€ç§å¯¹è±¡å±‚æ¬¡ç»“æ„ï¼Œç”¨ä»¥æ¨¡æ‹Ÿå…¬å…±è¡Œä¸ºçš„ä¸€ä¸ªé›†åˆã€‚ å®ç°AOPçš„æŠ€æœ¯ï¼Œä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ï¼š ä¸€æ˜¯é‡‡ç”¨åŠ¨æ€ä»£ç†æŠ€æœ¯ï¼Œåˆ©ç”¨æˆªå–æ¶ˆæ¯çš„æ–¹å¼ï¼Œå¯¹è¯¥æ¶ˆæ¯è¿›è¡Œè£…é¥°ï¼Œä»¥å–ä»£åŸæœ‰å¯¹è±¡è¡Œä¸ºçš„æ‰§è¡Œï¼› äºŒæ˜¯é‡‡ç”¨é™æ€ç»‡å…¥ çš„æ–¹å¼ï¼Œå¼•å…¥ç‰¹å®šçš„è¯­æ³•åˆ›å»ºâ€œæ–¹é¢â€ï¼Œä»è€Œä½¿å¾—ç¼–è¯‘å™¨å¯ä»¥åœ¨ç¼–è¯‘æœŸé—´ç»‡å…¥æœ‰å…³â€œæ–¹é¢â€çš„ä»£ç ï¼Œå±äºé™æ€ä»£ç†ã€‚ é¢å‘åˆ‡é¢ç¼–ç¨‹æä¾›å£°æ˜å¼äº‹åŠ¡ç®¡ç† springæ”¯æŒç”¨æˆ·è‡ªå®šä¹‰çš„åˆ‡é¢ï¼Œ AOPæ¡†æ¶å…·æœ‰çš„ä¸¤ä¸ªç‰¹å¾ï¼š å„ä¸ªæ­¥éª¤ä¹‹é—´çš„è‰¯å¥½éš”ç¦»æ€§ æºä»£ç æ— å…³æ€§ springAOPçš„å…·ä½“åŠ è½½æ­¥éª¤ï¼š 1ã€å½“ spring å®¹å™¨å¯åŠ¨çš„æ—¶å€™ï¼ŒåŠ è½½äº† spring çš„é…ç½®æ–‡ä»¶ 2ã€ä¸ºé…ç½®æ–‡ä»¶ä¸­çš„æ‰€æœ‰ beanåˆ›å»ºå¯¹è±¡ 3ã€spring å®¹å™¨ä¼šè§£æ aop:configçš„é…ç½® è§£æåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œç”¨åˆ‡å…¥ç‚¹è¡¨è¾¾å¼å’Œçº³å…¥ springå®¹å™¨ä¸­çš„ beanåšåŒ¹é… å¦‚æœåŒ¹é…æˆåŠŸï¼Œåˆ™ä¼šä¸ºè¯¥ beanåˆ›å»ºä»£ç†å¯¹è±¡ï¼Œä»£ç†å¯¹è±¡çš„æ–¹æ³•=ç›®æ ‡æ–¹æ³•+é€šçŸ¥ å¦‚æœåŒ¹é…ä¸æˆåŠŸï¼Œä¸ä¼šåˆ›å»ºä»£ç†å¯¹è±¡ 4ã€åœ¨å®¢æˆ·ç«¯åˆ©ç”¨context.getBean()è·å–å¯¹è±¡æ—¶ï¼Œå¦‚æœè¯¥å¯¹è±¡æœ‰ä»£ç†å¯¹è±¡ï¼Œåˆ™è¿”å›ä»£ç†å¯¹è±¡ï¼›å¦‚æœæ²¡æœ‰ï¼Œåˆ™è¿”å›ç›®æ ‡å¯¹è±¡è¯´æ˜ï¼šå¦‚æœç›®æ ‡ç±»æ²¡æœ‰å®ç°æ¥å£ï¼Œåˆ™ spring å®¹å™¨ä¼šé‡‡ç”¨ cglib çš„æ–¹å¼äº§ç”Ÿä»£ç†å¯¹è±¡ï¼Œå¦‚æœå®ç°äº†æ¥å£ï¼Œåˆ™ä¼šé‡‡ç”¨ jdk çš„æ–¹å¼ IOCæ§åˆ¶åè½¬ä¹Ÿå«ä¾èµ–æ³¨å…¥ã€‚IOCåˆ©ç”¨javaåå°„æœºåˆ¶ï¼ŒAOPåˆ©ç”¨ä»£ç†æ¨¡å¼ã€‚ å½“æŸä¸ªè§’è‰²éœ€è¦å¦å¤–ä¸€ä¸ªè§’è‰²ååŠ©çš„æ—¶å€™ï¼Œåœ¨ä¼ ç»Ÿçš„ç¨‹åºè®¾è®¡è¿‡ç¨‹ä¸­ï¼Œé€šå¸¸ç”±è°ƒç”¨è€…æ¥åˆ›å»ºè¢«è°ƒç”¨è€…çš„å®ä¾‹ã€‚ä½†åœ¨springä¸­åˆ›å»ºè¢«è°ƒç”¨è€…çš„å·¥ä½œä¸å†ç”±è°ƒç”¨è€…æ¥å®Œæˆï¼Œå› æ­¤ç§°ä¸ºæ§åˆ¶åè½¬ã€‚åˆ›å»ºè¢«è°ƒç”¨è€…çš„å·¥ä½œç”±springæ¥å®Œæˆï¼Œç„¶åæ³¨å…¥è°ƒç”¨è€…å› æ­¤ä¹Ÿç§°ä¸ºä¾èµ–æ³¨å…¥ã€‚springä»¥åŠ¨æ€çµæ´»çš„æ–¹å¼æ¥ç®¡ç†å¯¹è±¡ ï¼Œ æ³¨å…¥çš„ä¸¤ç§æ–¹å¼ï¼Œè®¾ç½®æ³¨å…¥å’Œæ„é€ æ³¨å…¥ã€‚ è®¾ç½®æ³¨å…¥çš„ä¼˜ç‚¹ï¼šç›´è§‚ï¼Œè‡ªç„¶æ„é€ æ³¨å…¥çš„ä¼˜ç‚¹ï¼šå¯ä»¥åœ¨æ„é€ å™¨ä¸­å†³å®šä¾èµ–å…³ç³»çš„é¡ºåºã€‚ IOCæ¦‚å¿µçœ‹ä¼¼å¾ˆæŠ½è±¡ï¼Œä½†æ˜¯å¾ˆå®¹æ˜“ç†è§£ã€‚ è¯´ç®€å•ç‚¹å°±æ˜¯å°†å¯¹è±¡äº¤ç»™å®¹å™¨ç®¡ç†ï¼Œä½ åªéœ€è¦åœ¨springé…ç½®æ–‡ä»¶ä¸­é…ç½®å¯¹åº”çš„beanä»¥åŠè®¾ç½®ç›¸å…³çš„å±æ€§ï¼Œè®©springå®¹å™¨æ¥ç”Ÿæˆç±»çš„å®ä¾‹å¯¹è±¡ä»¥åŠç®¡ç†å¯¹è±¡ã€‚åœ¨springå®¹å™¨å¯åŠ¨çš„æ—¶å€™ï¼Œspringä¼šæŠŠä½ åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„beanéƒ½åˆå§‹åŒ–å¥½ï¼Œç„¶ååœ¨ä½ éœ€è¦è°ƒç”¨çš„æ—¶å€™ï¼Œå°±æŠŠå®ƒå·²ç»åˆå§‹åŒ–å¥½çš„é‚£äº›beanåˆ†é…ç»™ä½ éœ€è¦è°ƒç”¨è¿™äº›beançš„ç±» XMLâ€“â€”è¯»å–â€“â€“-&gt; resoureâ€”-è§£æâ€”â€”-&gt;BeanDefinitionâ€“â€“â€”æ³¨å…¥â€“â€“â€“â€“-&gt;BeanFactory Spring IOC å®¹å™¨æºç åˆ†æ Beançš„ç”Ÿå‘½å‘¨æœŸå¯ä»¥ç®€è¿°ä¸ºä»¥ä¸‹ä¹æ­¥ å®ä¾‹åŒ–beanå¯¹è±¡(é€šè¿‡æ„é€ æ–¹æ³•æˆ–è€…å·¥å‚æ–¹æ³•) è®¾ç½®å¯¹è±¡å±æ€§(setterç­‰)ï¼ˆä¾èµ–æ³¨å…¥ï¼‰ å¦‚æœBeanå®ç°äº†BeanNameAwareæ¥å£ï¼Œå·¥å‚è°ƒç”¨Beançš„setBeanName()æ–¹æ³•ä¼ é€’Beançš„IDã€‚ï¼ˆå’Œä¸‹é¢çš„ä¸€æ¡å‡å±äºæ£€æŸ¥Awareæ¥å£ï¼‰ å¦‚æœBeanå®ç°äº†BeanFactoryAwareæ¥å£ï¼Œå·¥å‚è°ƒç”¨setBeanFactory()æ–¹æ³•ä¼ å…¥å·¥å‚è‡ªèº« å°†Beanå®ä¾‹ä¼ é€’ç»™Beançš„å‰ç½®å¤„ç†å™¨çš„postProcessBeforeInitialization(Object bean, String beanname)æ–¹æ³• è°ƒç”¨Beançš„åˆå§‹åŒ–æ–¹æ³• å°†Beanå®ä¾‹ä¼ é€’ç»™Beançš„åç½®å¤„ç†å™¨çš„postProcessAfterInitialization(Object bean, String beanname)æ–¹æ³• ä½¿ç”¨Beanå®¹å™¨å…³é—­ä¹‹å‰ï¼Œè°ƒç”¨Beançš„é”€æ¯æ–¹æ³• Beançš„å•ä¾‹å’Œå¤šä¾‹æ¨¡å¼çš„ä½¿ç”¨æ¡ä»¶springç”Ÿæˆçš„å¯¹è±¡é»˜è®¤éƒ½æ˜¯å•ä¾‹(singleton)çš„.å¯ä»¥é€šè¿‡scopeæ”¹æˆå¤šä¾‹. å¯¹è±¡åœ¨æ•´ä¸ªç³»ç»Ÿä¸­åªæœ‰ä¸€ä»½ï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½ç”¨ä¸€ä¸ªå¯¹è±¡æ¥å¤„ç†ï¼Œå¦‚serviceå’Œdaoå±‚çš„å¯¹è±¡ä¸€èˆ¬æ˜¯å•ä¾‹çš„ã€‚ ä¸ºä»€ä¹ˆä½¿ç”¨å•ä¾‹ï¼šå› ä¸ºæ²¡æœ‰å¿…è¦æ¯ä¸ªè¯·æ±‚éƒ½æ–°å»ºä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œå› ä¸ºè¿™æ ·ä¼šæµªè´¹CPUå’Œå†…å­˜ã€‚ prototypeå¤šä¾‹æ¨¡å¼ï¼šå¯¹è±¡åœ¨æ•´ä¸ªç³»ç»Ÿä¸­å¯ä»¥æœ‰å¤šä¸ªå®ä¾‹ï¼Œæ¯ä¸ªè¯·æ±‚ç”¨ä¸€ä¸ªæ–°çš„å¯¹è±¡æ¥å¤„ç†ï¼Œå¦‚actionã€‚ ä¸ºä»€ä¹ˆä½¿ç”¨å¤šä¾‹ï¼šé˜²æ­¢å¹¶å‘é—®é¢˜ï¼›å³ä¸€ä¸ªè¯·æ±‚æ”¹å˜äº†å¯¹è±¡çš„çŠ¶æ€ï¼Œæ­¤æ—¶å¯¹è±¡åˆå¤„ç†å¦ä¸€ä¸ªè¯·æ±‚ï¼Œè€Œä¹‹å‰è¯·æ±‚å¯¹å¯¹è±¡çš„çŠ¶æ€æ”¹å˜å¯¼è‡´äº†å¯¹è±¡å¯¹å¦ä¸€ä¸ªè¯·æ±‚åšäº†é”™è¯¯çš„å¤„ç†ï¼› Spring MVC çš„å¤„ç†è¿‡ç¨‹ï¼ˆ1ï¼‰å®¢æˆ·ç«¯é€šè¿‡urlå‘é€è¯·æ±‚ï¼ˆ2-3ï¼‰æ ¸å¿ƒæ§åˆ¶å™¨Dispatcher Servletæ¥æ”¶åˆ°è¯·æ±‚ï¼Œé€šè¿‡ç³»ç»Ÿæˆ–è‡ªå®šä¹‰çš„æ˜ å°„å™¨é…ç½®æ‰¾åˆ°å¯¹åº”çš„handlerï¼Œå¹¶å°†urlæ˜ å°„çš„æ§åˆ¶å™¨controllerè¿”å›ç»™æ ¸å¿ƒæ§åˆ¶å™¨ã€‚ï¼ˆ4ï¼‰é€šè¿‡æ ¸å¿ƒæ§åˆ¶å™¨æ‰¾åˆ°ç³»ç»Ÿæˆ–é»˜è®¤çš„é€‚é…å™¨ï¼ˆ5-7ï¼‰ç”±æ‰¾åˆ°çš„é€‚é…å™¨ï¼Œè°ƒç”¨å®ç°å¯¹åº”æ¥å£çš„å¤„ç†å™¨ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™é€‚é…å™¨ï¼Œç»“æœä¸­åŒ…å«æ•°æ®æ¨¡å‹å’Œè§†å›¾å¯¹è±¡ï¼Œå†ç”±é€‚é…å™¨è¿”å›ç»™æ ¸å¿ƒæ§åˆ¶å™¨ï¼ˆ8-9ï¼‰æ ¸å¿ƒæ§åˆ¶å™¨å°†è·å–çš„æ•°æ®å’Œè§†å›¾ç»“åˆçš„å¯¹è±¡ä¼ é€’ç»™è§†å›¾è§£æå™¨ï¼Œè·å–è§£æå¾—åˆ°çš„ç»“æœï¼Œå¹¶ç”±è§†å›¾è§£æå™¨å“åº”ç»™æ ¸å¿ƒæ§åˆ¶å™¨ï¼ˆ10ï¼‰æ ¸å¿ƒæ§åˆ¶å™¨å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ springé¢è¯•çœŸé¢˜ 5.1SSMå„å±‚å…³ç³»5.2 ä¸ºä»€ä¹ˆæ³¨å…¥çš„æ˜¯æ¥å£(æ¥å£å¤šç»§æ‰¿)5.3 Springçš„ä¼˜ç‚¹1.é™ä½äº†ç»„ä»¶ä¹‹é—´çš„è€¦åˆæ€§ ï¼Œå®ç°äº†è½¯ä»¶å„å±‚ä¹‹é—´çš„è§£è€¦2.å¯ä»¥ä½¿ç”¨å®¹æ˜“æä¾›çš„ä¼—å¤šæœåŠ¡ï¼Œå¦‚äº‹åŠ¡ç®¡ç†ï¼Œæ¶ˆæ¯æœåŠ¡ç­‰3.å®¹å™¨æä¾›å•ä¾‹æ¨¡å¼æ”¯æŒ4.å®¹å™¨æä¾›äº†AOPæŠ€æœ¯ï¼Œåˆ©ç”¨å®ƒå¾ˆå®¹æ˜“å®ç°å¦‚æƒé™æ‹¦æˆªï¼Œè¿è¡ŒæœŸç›‘æ§ç­‰åŠŸèƒ½5.å®¹å™¨æä¾›äº†ä¼—å¤šçš„è¾…åŠ©ç±»ï¼Œèƒ½åŠ å¿«åº”ç”¨çš„å¼€å‘6.springå¯¹äºä¸»æµçš„åº”ç”¨æ¡†æ¶æä¾›äº†é›†æˆæ”¯æŒï¼Œå¦‚hibernateï¼ŒJPAï¼ŒStrutsç­‰7.springå±äºä½ä¾µå…¥å¼è®¾è®¡ï¼Œä»£ç çš„æ±¡æŸ“æä½8.ç‹¬ç«‹äºå„ç§åº”ç”¨æœåŠ¡å™¨9.springçš„DIæœºåˆ¶é™ä½äº†ä¸šåŠ¡å¯¹è±¡æ›¿æ¢çš„å¤æ‚æ€§10.Springçš„é«˜åº¦å¼€æ”¾æ€§ï¼Œå¹¶ä¸å¼ºåˆ¶åº”ç”¨å®Œå…¨ä¾èµ–äºSpringï¼Œå¼€å‘è€…å¯ä»¥è‡ªç”±é€‰æ‹©springçš„éƒ¨åˆ†æˆ–å…¨éƒ¨ redisrediçŸ¥è¯†é›†åˆ Redis ä¸­åªåŒ…å«â€œé”®â€å’Œâ€œå€¼â€ä¸¤éƒ¨åˆ†ï¼Œåªèƒ½é€šè¿‡â€œé”®â€æ¥æŸ¥è¯¢â€œå€¼â€ã€‚æ­£æ˜¯å› ä¸ºè¿™æ ·ç®€å•çš„å­˜å‚¨ç»“æ„ï¼Œä¹Ÿè®© Redis çš„è¯»å†™æ•ˆç‡éå¸¸é«˜ æ•°æ®æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ã€‚å°½ç®¡å®ƒç»å¸¸è¢«ç”¨ä½œå†…å­˜æ•°æ®åº“ï¼Œä½†æ˜¯ï¼Œå®ƒä¹Ÿæ”¯æŒå°†æ•°æ®å­˜å‚¨åœ¨ç¡¬ç›˜ä¸­ è§£å†³é«˜å¹¶å‘å’Œé«˜æ€§èƒ½çš„é—®é¢˜ é«˜æ€§èƒ½ï¼šç›´æ¥å¤„ç†ç¼“å­˜ä¹Ÿå°±æ˜¯å¤„ç†å†…å­˜å¾ˆå¿« é«˜å¹¶å‘ï¼šç›´æ¥æ“ä½œç¼“å­˜èƒ½å¤Ÿæ‰¿å—çš„è¯·æ±‚æ˜¯è¿œè¿œå¤§äºç›´æ¥è®¿é—®æ•°æ®åº“çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è€ƒè™‘æŠŠæ•°æ®åº“ä¸­çš„éƒ¨åˆ†æ•°æ®è½¬ç§»åˆ°ç¼“å­˜ä¸­ å»ï¼Œè¿™æ ·ç”¨æˆ·çš„ä¸€éƒ¨åˆ†è¯·æ±‚ä¼šç›´æ¥åˆ°ç¼“å­˜è¿™é‡Œè€Œä¸ç”¨ç»è¿‡æ•°æ®åº“ æ•°æ®ç»“æ„å»ºè®®çœ‹æ•°æ®ç»“æ„éƒ¨åˆ†ï¼šredisè®¾è®¡ä¸å®ç° Stringå¸¸ç”¨å‘½ä»¤: set,get,decr,incr,mgetç­‰ã€‚ Stringæ•°æ®ç»“æ„æ˜¯ç®€å•çš„key-valueç±»å‹ï¼Œvalueå…¶å®ä¸ä»…å¯ä»¥æ˜¯Stringï¼Œä¹Ÿå¯ä»¥æ˜¯æ•°å­—ã€‚ å¸¸è§„key-valueç¼“å­˜åº”ç”¨ï¼› å¸¸è§„è®¡æ•°ï¼šå¾®åšæ•°ï¼Œç²‰ä¸æ•°ç­‰ã€‚ Hashå¸¸ç”¨å‘½ä»¤ï¼š hget,hset,hgetallç­‰ã€‚Hashæ˜¯ä¸€ä¸ª stringç±»å‹çš„ ï¬eldå’Œ valueçš„æ˜ å°„è¡¨ï¼Œhashç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ï¼Œåç»­æ“ä½œçš„æ—¶å€™ï¼Œä½ å¯ä»¥ç›´æ¥ä»… ä»…ä¿®æ”¹è¿™ä¸ªå¯¹è±¡ä¸­çš„æŸä¸ªå­—æ®µçš„å€¼ã€‚ æ¯”å¦‚æˆ‘ä»¬å¯ä»¥Hashæ•°æ®ç»“æ„æ¥å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼Œå•†å“ä¿¡æ¯ç­‰ç­‰ã€‚æ¯”å¦‚ä¸‹é¢æˆ‘å°±ç”¨ hashç±»å‹å­˜æ”¾äº†æˆ‘æœ¬äººçš„ä¸€äº›ä¿¡æ¯ï¼š 1key=JavaUser293847 value=&#123; â€œidâ€: 1, â€œnameâ€: â€œSnailClimbâ€, â€œageâ€: 22, â€œlocationâ€: â€œWuhan, Hubeiâ€ &#125; Listå¸¸ç”¨å‘½ä»¤: lpush,rpush,lpop,rpop,lrangeç­‰list å°±æ˜¯é“¾è¡¨ï¼ŒRedis list çš„åº”ç”¨åœºæ™¯éå¸¸å¤šï¼Œä¹Ÿæ˜¯Redisé‡è¦çš„æ•°æ®ç»“æ„ä¹‹ä¸€ï¼Œæ¯”å¦‚å¾®åšçš„å…³æ³¨åˆ—è¡¨ï¼Œç²‰ä¸åˆ—è¡¨ï¼Œ æ¶ˆæ¯åˆ—è¡¨ç­‰åŠŸèƒ½éƒ½å¯ä»¥ç”¨Redisçš„ listç»“æ„æ¥å®ç°ã€‚Redis listçš„å®ç°ä¸ºä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå³å¯ä»¥æ”¯æŒåå‘æŸ¥æ‰¾å’Œéå†ï¼Œæ›´æ–¹ä¾¿æ“ä½œï¼Œä¸è¿‡å¸¦æ¥äº†éƒ¨åˆ†é¢å¤–çš„å†…å­˜å¼€é”€ã€‚å¦å¤–å¯ä»¥é€šè¿‡ lrangeå‘½ä»¤ï¼Œå°±æ˜¯ä»æŸä¸ªå…ƒç´ å¼€å§‹è¯»å–å¤šå°‘ä¸ªå…ƒç´ ï¼Œå¯ä»¥åŸºäº listå®ç°åˆ†é¡µæŸ¥è¯¢ï¼Œè¿™ä¸ªå¾ˆæ£’çš„ä¸€ä¸ªåŠŸ èƒ½ï¼ŒåŸºäº redis å®ç°ç®€å•çš„é«˜æ€§èƒ½åˆ†é¡µï¼Œå¯ä»¥åšç±»ä¼¼å¾®åšé‚£ç§ä¸‹æ‹‰ä¸æ–­åˆ†é¡µçš„ä¸œè¥¿ï¼ˆä¸€é¡µä¸€é¡µçš„å¾€ä¸‹èµ°ï¼‰ï¼Œæ€§èƒ½é«˜ã€‚ Setå¸¸ç”¨å‘½ä»¤ï¼š sadd,spop,smembers,sunionç­‰ set å¯¹å¤–æä¾›çš„åŠŸèƒ½ä¸listç±»ä¼¼æ˜¯ä¸€ä¸ªåˆ—è¡¨çš„åŠŸèƒ½ï¼Œç‰¹æ®Šä¹‹å¤„åœ¨äº set æ˜¯å¯ä»¥è‡ªåŠ¨æ’é‡çš„ã€‚å½“ä½ éœ€è¦å­˜å‚¨ä¸€ä¸ªåˆ—è¡¨æ•°æ®ï¼Œåˆä¸å¸Œæœ›å‡ºç°é‡å¤æ•°æ®æ—¶ï¼Œsetæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œå¹¶ä¸”setæä¾›äº†åˆ¤æ–­æŸä¸ªæˆå‘˜æ˜¯å¦åœ¨ ä¸€ä¸ªseté›†åˆå†…çš„é‡è¦æ¥å£ï¼Œè¿™ä¸ªä¹Ÿæ˜¯listæ‰€ä¸èƒ½æä¾›çš„ã€‚å¯ä»¥åŸºäº set è½»æ˜“å®ç°äº¤é›†ã€å¹¶é›†ã€å·®é›†çš„æ“ä½œã€‚ æ¯”å¦‚ï¼šåœ¨å¾®åšåº”ç”¨ä¸­ï¼Œå¯ä»¥å°†ä¸€ä¸ªç”¨æˆ·æ‰€æœ‰çš„å…³æ³¨äººå­˜åœ¨ä¸€ä¸ªé›†åˆä¸­ï¼Œå°†å…¶æ‰€æœ‰ç²‰ä¸å­˜åœ¨ä¸€ä¸ªé›†åˆã€‚Rediså¯ä»¥éå¸¸ æ–¹ä¾¿çš„å®ç°å¦‚å…±åŒå…³æ³¨ã€å…±åŒç²‰ä¸ã€å…±åŒå–œå¥½ç­‰åŠŸèƒ½ã€‚è¿™ä¸ªè¿‡ç¨‹ä¹Ÿå°±æ˜¯æ±‚äº¤é›†çš„è¿‡ç¨‹ï¼Œå…·ä½“å‘½ä»¤å¦‚ä¸‹ï¼š 1sinterstore key1 key2 key3 å°†äº¤é›†å­˜åœ¨key1å†… Sorted Setå¸¸ç”¨å‘½ä»¤ï¼š zadd,zrange,zrem,zcardç­‰ å’Œsetç›¸æ¯”ï¼Œsorted setå¢åŠ äº†ä¸€ä¸ªæƒé‡å‚æ•°scoreï¼Œä½¿å¾—é›†åˆä¸­çš„å…ƒç´ èƒ½å¤ŸæŒ‰scoreè¿›è¡Œæœ‰åºæ’åˆ—ã€‚ä¸¾ä¾‹ï¼š åœ¨ç›´æ’­ç³»ç»Ÿä¸­ï¼Œå®æ—¶æ’è¡Œä¿¡æ¯åŒ…å«ç›´æ’­é—´åœ¨çº¿ç”¨æˆ·åˆ—è¡¨ï¼Œå„ç§ç¤¼ç‰©æ’è¡Œæ¦œï¼Œå¼¹å¹•æ¶ˆæ¯ï¼ˆå¯ä»¥ç†è§£ä¸ºæŒ‰æ¶ˆæ¯ç»´ åº¦çš„æ¶ˆæ¯æ’è¡Œæ¦œï¼‰ç­‰ä¿¡æ¯ï¼Œé€‚åˆä½¿ç”¨ Redis ä¸­çš„ SortedSet ç»“æ„è¿›è¡Œå­˜å‚¨ã€‚ åº•å±‚ç»“æ„stringåœ¨Rediså†…éƒ¨ï¼ŒStringç±»å‹é€šè¿‡intã€SDSä½œä¸ºç»“æ„å­˜å‚¨,intç”¨æ¥å­˜æ”¾æ•´å‹æ•°æ®ï¼Œsdså­˜æ”¾å­— èŠ‚/å­—ç¬¦ä¸²å’Œæµ®ç‚¹å‹æ•°æ®ã€‚ listå‹ç¼©åˆ—è¡¨å’ŒåŒå‘å¾ªç¯é“¾è¡¨ Redis3.2ä¹‹åï¼Œé‡‡ç”¨çš„ä¸€ç§å«quicklistçš„æ•°æ®ç»“æ„æ¥å­˜å‚¨listï¼Œåˆ—è¡¨çš„åº•å±‚éƒ½ç”±quicklistå®ç°ã€‚ å½“åˆ—è¡¨ä¸­å­˜å‚¨çš„æ•°æ®é‡æ¯”è¾ƒå°çš„æ—¶å€™ï¼Œåˆ—è¡¨å°±å¯ä»¥é‡‡ç”¨å‹ç¼©åˆ—è¡¨çš„æ–¹å¼å®ç°ã€‚å…·ä½“éœ€è¦åŒæ—¶æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶ï¼š åˆ—è¡¨ä¸­ä¿å­˜çš„å•ä¸ªæ•°æ®ï¼ˆæœ‰å¯èƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹çš„ï¼‰å°äº 64 å­—èŠ‚ï¼› åˆ—è¡¨ä¸­æ•°æ®ä¸ªæ•°å°‘äº 512 ä¸ªã€‚ Redis å®ç°äº†è‡ªå·±çš„åŒç«¯é“¾è¡¨ç»“æ„ã€‚ åŒç«¯é“¾è¡¨ä¸»è¦æœ‰ä¸¤ä¸ªä½œç”¨ï¼š ä½œä¸º Redis åˆ—è¡¨ç±»å‹çš„åº•å±‚å®ç°ä¹‹ä¸€ï¼› ä½œä¸ºé€šç”¨æ•°æ®ç»“æ„ï¼Œè¢«å…¶ä»–åŠŸèƒ½æ¨¡å—æ‰€ä½¿ç”¨ï¼›ï¼ˆäº‹åŠ¡æ¨¡å—ä¿å­˜å‘½ä»¤ã€æœåŠ¡å™¨æ¨¡å—ã€è®¢é˜…å‘é€æ¨¡å—ä¿å­˜å®¢æˆ·ç«¯ã€äº‹ä»¶æ¨¡å—ï¼‰ åŒç«¯é“¾è¡¨åŠå…¶èŠ‚ç‚¹çš„æ€§èƒ½ç‰¹æ€§å¦‚ä¸‹ï¼š èŠ‚ç‚¹å¸¦æœ‰å‰é©±å’Œåç»§æŒ‡é’ˆï¼Œè®¿é—®å‰é©±èŠ‚ç‚¹å’Œåç»§èŠ‚ç‚¹çš„å¤æ‚åº¦ä¸º O(1) ï¼Œå¹¶ä¸”å¯¹é“¾è¡¨çš„è¿­ä»£å¯ä»¥åœ¨ä»è¡¨å¤´åˆ°è¡¨å°¾å’Œä»è¡¨å°¾åˆ°è¡¨å¤´ä¸¤ä¸ªæ–¹å‘è¿›è¡Œï¼› é“¾è¡¨å¸¦æœ‰æŒ‡å‘è¡¨å¤´å’Œè¡¨å°¾çš„æŒ‡é’ˆï¼Œå› æ­¤å¯¹è¡¨å¤´å’Œè¡¨å°¾è¿›è¡Œå¤„ç†çš„å¤æ‚åº¦ä¸º O(1)O(1) ï¼› é“¾è¡¨å¸¦æœ‰è®°å½•èŠ‚ç‚¹æ•°é‡çš„å±æ€§ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ O(1)O(1) å¤æ‚åº¦å†…è¿”å›é“¾è¡¨çš„èŠ‚ç‚¹æ•°é‡ï¼ˆé•¿åº¦ï¼‰ï¼› quicklistä»ç„¶æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œåªæ˜¯åˆ—è¡¨çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªziplistï¼Œå…¶å®å°±æ˜¯linkedlistå’Œziplistçš„ç»“åˆï¼Œquicklist ä¸­æ¯ä¸ªèŠ‚ç‚¹ziplistéƒ½èƒ½å¤Ÿå­˜å‚¨å¤šä¸ªæ•°æ®å…ƒç´  hashå‹ç¼©åˆ—è¡¨å’Œå­—å…¸ï¼ˆæ•£åˆ—è¡¨ï¼‰ï¼ˆæ¸è¿›å¼æ‰©å®¹ç¼©å®¹ç­–ç•¥ã€é“¾åœ°å€æ³•ï¼‰ åŒæ ·ï¼Œåªæœ‰å½“å­˜å‚¨çš„æ•°æ®é‡æ¯”è¾ƒå°çš„æƒ…å†µä¸‹ï¼ŒRedis æ‰ä½¿ç”¨å‹ç¼©åˆ—è¡¨æ¥å®ç°å­—å…¸ç±»å‹ã€‚å…·ä½“éœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š å­—å…¸ä¸­ä¿å­˜çš„é”®å’Œå€¼çš„å¤§å°éƒ½è¦å°äº 64 å­—èŠ‚ï¼› å­—å…¸ä¸­é”®å€¼å¯¹çš„ä¸ªæ•°è¦å°äº 512 ä¸ªã€‚ æ³¨æ„ dict ç±»å‹ä½¿ç”¨äº†ä¸¤ä¸ªæŒ‡é’ˆï¼Œåˆ†åˆ«æŒ‡å‘ä¸¤ä¸ªå“ˆå¸Œè¡¨ã€‚ å…¶ä¸­ï¼Œ 0 å·å“ˆå¸Œè¡¨ï¼ˆht[0]ï¼‰æ˜¯å­—å…¸ä¸»è¦ä½¿ç”¨çš„å“ˆå¸Œè¡¨ï¼Œ è€Œ 1 å·å“ˆå¸Œè¡¨ï¼ˆht[1]ï¼‰åˆ™åªæœ‰åœ¨ç¨‹åºå¯¹ 0 å·å“ˆå¸Œè¡¨è¿›è¡Œ rehash æ—¶æ‰ä½¿ç”¨ã€‚ ä¸ºäº†åœ¨å­—å…¸çš„é”®å€¼å¯¹ä¸æ–­å¢å¤šçš„æƒ…å†µä¸‹ä¿æŒè‰¯å¥½çš„æ€§èƒ½ï¼Œ å­—å…¸éœ€è¦å¯¹æ‰€ä½¿ç”¨çš„å“ˆå¸Œè¡¨ï¼ˆht[0]ï¼‰è¿›è¡Œ rehash æ“ä½œï¼š åœ¨ä¸ä¿®æ”¹ä»»ä½•é”®å€¼å¯¹çš„æƒ…å†µä¸‹ï¼Œå¯¹å“ˆå¸Œè¡¨è¿›è¡Œæ‰©å®¹ï¼Œ å°½é‡å°†æ¯”ç‡ç»´æŒåœ¨ 1:1 å·¦å³ã€‚ dictAdd åœ¨æ¯æ¬¡å‘å­—å…¸æ·»åŠ æ–°é”®å€¼å¯¹ä¹‹å‰ï¼Œ éƒ½ä¼šå¯¹å“ˆå¸Œè¡¨ ht[0] è¿›è¡Œæ£€æŸ¥ï¼Œ å¯¹äº ht[0] çš„ size å’Œ used å±æ€§ï¼Œ å¦‚æœå®ƒä»¬ä¹‹é—´çš„æ¯”ç‡ ratio = used / size æ»¡è¶³ä»¥ä¸‹ä»»ä½•ä¸€ä¸ªæ¡ä»¶çš„è¯ï¼Œrehash è¿‡ç¨‹å°±ä¼šè¢«æ¿€æ´»ï¼š è‡ªç„¶ rehash ï¼š ratio &gt;= 1 ï¼Œä¸”å˜é‡ dict_can_resize ä¸ºçœŸã€‚ï¼ˆåå°æŒä¹…åŒ–æ—¶ä¸ºfalseï¼‰ å¼ºåˆ¶ rehash ï¼š ratio å¤§äºå˜é‡ dict_force_resize_ratio ï¼ˆç›®å‰ç‰ˆæœ¬ä¸­ï¼Œ dict_force_resize_ratio çš„å€¼ä¸º 5 ï¼‰ã€‚ rehashæ‰§è¡Œè¿‡ç¨‹ï¼ˆrehashåçš„å¤§å°è‡³å°‘ä¸ºåŸæ¥çš„ä¸¤å€ï¼‰ åˆ›å»ºä¸€ä¸ªæ¯” ht[0]-&gt;table æ›´å¤§çš„ ht[1]-&gt;table ï¼› å°† ht[0]-&gt;table ä¸­çš„æ‰€æœ‰é”®å€¼å¯¹è¿ç§»åˆ° ht[1]-&gt;table ï¼› å°†åŸæœ‰ ht[0] çš„æ•°æ®æ¸…ç©ºï¼Œå¹¶å°† ht[1] æ›¿æ¢ä¸ºæ–°çš„ ht[0] ï¼› å­—å…¸çš„ç¼©å®¹ åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œ REDIS_HT_MINFILL çš„å€¼ä¸º 10 ï¼Œ ä¹Ÿå³æ˜¯è¯´ï¼Œ å½“å­—å…¸çš„å¡«å……ç‡ä½äº 10% æ—¶ï¼Œ ç¨‹åºå°±å¯ä»¥å¯¹è¿™ä¸ªå­—å…¸è¿›è¡Œæ”¶ç¼©æ“ä½œäº†ã€‚ å­—å…¸æ”¶ç¼©å’Œå­—å…¸æ‰©å±•çš„ä¸€ä¸ªåŒºåˆ«æ˜¯ï¼š å­—å…¸çš„æ‰©å±•æ“ä½œæ˜¯è‡ªåŠ¨è§¦å‘çš„ï¼ˆä¸ç®¡æ˜¯è‡ªåŠ¨æ‰©å±•è¿˜æ˜¯å¼ºåˆ¶æ‰©å±•ï¼‰ï¼› è€Œå­—å…¸çš„æ”¶ç¼©æ“ä½œåˆ™æ˜¯ç”±ç¨‹åºæ‰‹åŠ¨æ‰§è¡Œã€‚ setä¸€ç§æ˜¯åŸºäºæœ‰åºæ•°ç»„(æ•´æ•°é›†åˆ)å’Œæ•£åˆ—è¡¨ã€‚ å½“è¦å­˜å‚¨çš„æ•°æ®ï¼ŒåŒæ—¶æ»¡è¶³ä¸‹é¢è¿™æ ·ä¸¤ä¸ªæ¡ä»¶çš„æ—¶å€™ï¼ŒRedis å°±é‡‡ç”¨æœ‰åºæ•°ç»„ï¼Œæ¥å®ç°é›†åˆè¿™ç§æ•°æ®ç±»å‹ã€‚ å­˜å‚¨çš„æ•°æ®éƒ½æ˜¯æ•´æ•°ï¼› å­˜å‚¨çš„æ•°æ®å…ƒç´ ä¸ªæ•°ä¸è¶…è¿‡ 512 ä¸ªã€‚ æ·»åŠ æ–°å…ƒç´ æ—¶ï¼Œå¦‚æœ intsetAdd å‘ç°æ–°å…ƒç´ ï¼Œä¸èƒ½ç”¨ç°æœ‰çš„ç¼–ç æ–¹å¼æ¥ä¿å­˜ï¼Œä¾¿ä¼šå°†å‡çº§é›†åˆå’Œæ·»åŠ æ–°å…ƒç´ çš„ä»»åŠ¡è½¬äº¤ç»™ intsetUpgradeAndAdd æ¥å®Œæˆï¼š intsetUpgradeAndAdd éœ€è¦å®Œæˆä»¥ä¸‹å‡ ä¸ªä»»åŠ¡ï¼š å¯¹æ–°å…ƒç´ è¿›è¡Œæ£€æµ‹ï¼Œçœ‹ä¿å­˜è¿™ä¸ªæ–°å…ƒç´ éœ€è¦ä»€ä¹ˆç±»å‹çš„ç¼–ç ï¼› å°†é›†åˆ encoding å±æ€§çš„å€¼è®¾ç½®ä¸ºæ–°ç¼–ç ç±»å‹ï¼Œå¹¶æ ¹æ®æ–°ç¼–ç ç±»å‹ï¼Œå¯¹æ•´ä¸ª contents æ•°ç»„è¿›è¡Œå†…å­˜é‡åˆ†é…ã€‚ è°ƒæ•´ contents æ•°ç»„å†…åŸæœ‰å…ƒç´ åœ¨å†…å­˜ä¸­çš„æ’åˆ—æ–¹å¼ï¼Œä»æ—§ç¼–ç è°ƒæ•´ä¸ºæ–°ç¼–ç ã€‚ å°†æ–°å…ƒç´ æ·»åŠ åˆ°é›†åˆä¸­ã€‚ å‡çº§ ç¬¬ä¸€ï¼Œä»è¾ƒçŸ­æ•´æ•°åˆ°è¾ƒé•¿æ•´æ•°çš„è½¬æ¢ï¼Œå¹¶ä¸ä¼šæ›´æ”¹å…ƒç´ é‡Œé¢çš„å€¼ã€‚ ç¬¬äºŒï¼Œé›†åˆç¼–ç å…ƒç´ çš„æ–¹å¼ï¼Œç”±å…ƒç´ ä¸­é•¿åº¦æœ€å¤§çš„é‚£ä¸ªå€¼æ¥å†³å®š inset(æœ‰åºæ•°ç»„)ï¼Œsetæœ¬èº«æ˜¯æ— åºçš„ Intset ç”¨äºæœ‰åºã€æ— é‡å¤åœ°ä¿å­˜å¤šä¸ªæ•´æ•°å€¼ï¼Œä¼šæ ¹æ®å…ƒç´ çš„å€¼ï¼Œè‡ªåŠ¨é€‰æ‹©è¯¥ç”¨ä»€ä¹ˆé•¿åº¦çš„æ•´æ•°ç±»å‹æ¥ä¿å­˜å…ƒç´ ã€‚ å½“ä¸€ä¸ªä½é•¿åº¦æ›´é•¿çš„æ•´æ•°å€¼æ·»åŠ åˆ° intset æ—¶ï¼Œéœ€è¦å¯¹ intset è¿›è¡Œå‡çº§ï¼Œæ–° intset ä¸­æ¯ä¸ªå…ƒç´ çš„ä½é•¿åº¦ï¼Œä¼šç­‰äºæ–°æ·»åŠ å€¼çš„ä½é•¿åº¦ï¼Œä½†åŸæœ‰å…ƒç´ çš„å€¼ä¸å˜ã€‚ å‡çº§ä¼šå¼•èµ·æ•´ä¸ª intset è¿›è¡Œå†…å­˜é‡åˆ†é…ï¼Œå¹¶ç§»åŠ¨é›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œè¿™ä¸ªæ“ä½œçš„å¤æ‚åº¦ä¸º O(Nï¼‰ ã€‚ Intset åªæ”¯æŒå‡çº§ï¼Œä¸æ”¯æŒé™çº§ã€‚ Intset æ˜¯æœ‰åºçš„ï¼Œç¨‹åºä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ç®—æ³•æ¥å®ç°æŸ¥æ‰¾æ“ä½œï¼Œå¤æ‚åº¦ä¸º O(lgN)O(lgâ¡N) ã€‚ zsetè·³è¡¨å’Œå‹ç¼©åˆ—è¡¨ å½“æ•°æ®é‡æ¯”è¾ƒå°çš„æ—¶å€™ï¼ŒRedis ä¼šç”¨å‹ç¼©åˆ—è¡¨æ¥å®ç°æœ‰åºé›†åˆã€‚ æ‰€æœ‰æ•°æ®çš„å¤§å°éƒ½è¦å°äº 64å­—èŠ‚ï¼› å…ƒç´ ä¸ªæ•°è¦å°äº 128ä¸ªã€‚ è·³è·ƒè¡¨æ˜¯ä¸€ç§éšæœºåŒ–æ•°æ®ç»“æ„ï¼ŒæŸ¥æ‰¾ã€æ·»åŠ ã€åˆ é™¤æ“ä½œéƒ½å¯ä»¥åœ¨å¯¹æ•°æœŸæœ›æ—¶é—´ä¸‹å®Œæˆã€‚ è·³è·ƒè¡¨ç›®å‰åœ¨ Redis çš„å”¯ä¸€ä½œç”¨ï¼Œå°±æ˜¯ä½œä¸ºæœ‰åºé›†ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼ˆä¹‹ä¸€ï¼Œå¦ä¸€ä¸ªæ„æˆæœ‰åºé›†çš„ç»“æ„æ˜¯å­—å…¸ï¼‰ã€‚ ä¸ºäº†æ»¡è¶³è‡ªèº«çš„éœ€æ±‚ï¼ŒRedis åŸºäº William Pugh è®ºæ–‡ä¸­æè¿°çš„è·³è·ƒè¡¨è¿›è¡Œäº†ä¿®æ”¹ï¼ŒåŒ…æ‹¬ï¼š score å€¼å¯é‡å¤ã€‚ å¯¹æ¯”ä¸€ä¸ªå…ƒç´ éœ€è¦åŒæ—¶æ£€æŸ¥å®ƒçš„ score å’Œ memeber ã€‚åœ¨Redisçš„skiplistå®ç°ä¸­ï¼Œæ•°æ®æœ¬èº«çš„å†…å®¹å”¯ä¸€æ ‡è¯†è¿™ä»½æ•°æ®ï¼Œè€Œä¸æ˜¯ç”±keyæ¥å”¯ä¸€æ ‡è¯†ã€‚å¦å¤–ï¼Œå½“å¤šä¸ªå…ƒç´ åˆ†æ•°ç›¸åŒçš„æ—¶å€™ï¼Œè¿˜éœ€è¦æ ¹æ®æ•°æ®å†…å®¹æ¥è¿›å­—å…¸æ’åºã€‚ æ¯ä¸ªèŠ‚ç‚¹å¸¦æœ‰é«˜åº¦ä¸º 1 å±‚çš„åé€€æŒ‡é’ˆï¼Œç”¨äºä»è¡¨å°¾æ–¹å‘å‘è¡¨å¤´æ–¹å‘è¿­ä»£ã€‚Â· å‹ç¼©åˆ—è¡¨ åŸŸ é•¿åº¦/ç±»å‹ åŸŸçš„å€¼ zlbytes uint32_t æ•´ä¸ª ziplist å ç”¨çš„å†…å­˜å­—èŠ‚æ•°ï¼Œå¯¹ ziplist è¿›è¡Œå†…å­˜é‡åˆ†é…ï¼Œæˆ–è€…è®¡ç®—æœ«ç«¯æ—¶ä½¿ç”¨ã€‚ zltail uint32_t åˆ°è¾¾ ziplist è¡¨å°¾èŠ‚ç‚¹çš„åç§»é‡ã€‚ é€šè¿‡è¿™ä¸ªåç§»é‡ï¼Œå¯ä»¥åœ¨ä¸éå†æ•´ä¸ª ziplist çš„å‰æä¸‹ï¼Œå¼¹å‡ºè¡¨å°¾èŠ‚ç‚¹ã€‚ zllen uint16_t ziplist ä¸­èŠ‚ç‚¹çš„æ•°é‡ã€‚ å½“è¿™ä¸ªå€¼å°äº UINT16_MAX ï¼ˆ65535ï¼‰æ—¶ï¼Œè¿™ä¸ªå€¼å°±æ˜¯ ziplist ä¸­èŠ‚ç‚¹çš„æ•°é‡ï¼› å½“è¿™ä¸ªå€¼ç­‰äº UINT16_MAX æ—¶ï¼ŒèŠ‚ç‚¹çš„æ•°é‡éœ€è¦éå†æ•´ä¸ª ziplist æ‰èƒ½è®¡ç®—å¾—å‡ºã€‚ entryX ? ziplist æ‰€ä¿å­˜çš„èŠ‚ç‚¹ï¼Œå„ä¸ªèŠ‚ç‚¹çš„é•¿åº¦æ ¹æ®å†…å®¹è€Œå®šã€‚ zlend uint8_t 255 çš„äºŒè¿›åˆ¶å€¼ 1111 1111 ï¼ˆUINT8_MAXï¼‰ ï¼Œç”¨äºæ ‡è®° ziplist çš„æœ«ç«¯ã€‚ èŠ‚ç‚¹entryç»“æ„ 12345area |&lt;------------------- entry --------------------&gt;| +------------------+----------+--------+---------+component | pre_entry_length | encoding | length | content | +------------------+----------+--------+---------+ pre_entry_length pre_entry_length è®°å½•äº†å‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦ï¼Œé€šè¿‡è¿™ä¸ªå€¼ï¼Œå¯ä»¥è¿›è¡ŒæŒ‡é’ˆè®¡ç®—ï¼Œä»è€Œè·³è½¬åˆ°ä¸Šä¸€ä¸ªèŠ‚ç‚¹ã€‚ æ ¹æ®ç¼–ç æ–¹å¼çš„ä¸åŒï¼Œ pre_entry_length åŸŸå¯èƒ½å ç”¨ 1 å­—èŠ‚æˆ–è€… 5 å­—èŠ‚ï¼š 1 å­—èŠ‚ï¼šå¦‚æœå‰ä¸€èŠ‚ç‚¹çš„é•¿åº¦å°äº 254 å­—èŠ‚ï¼Œä¾¿ä½¿ç”¨ä¸€ä¸ªå­—èŠ‚ä¿å­˜å®ƒçš„å€¼ã€‚ 5 å­—èŠ‚ï¼šå¦‚æœå‰ä¸€èŠ‚ç‚¹çš„é•¿åº¦å¤§äºç­‰äº 254 å­—èŠ‚ï¼Œé‚£ä¹ˆå°†ç¬¬ 1 ä¸ªå­—èŠ‚çš„å€¼è®¾ä¸º 254 ï¼Œç„¶åç”¨æ¥ä¸‹æ¥çš„ 4 ä¸ªå­—èŠ‚ä¿å­˜å®é™…é•¿åº¦ã€‚ encoding å’Œ length encoding å’Œ length ä¸¤éƒ¨åˆ†ä¸€èµ·å†³å®šäº† content éƒ¨åˆ†æ‰€ä¿å­˜çš„æ•°æ®çš„ç±»å‹ï¼ˆä»¥åŠé•¿åº¦ï¼‰ã€‚ å…¶ä¸­ï¼Œ encoding åŸŸçš„é•¿åº¦ä¸ºä¸¤ä¸ª bit ï¼Œ å®ƒçš„å€¼å¯ä»¥æ˜¯ 00 ã€ 01 ã€ 10 å’Œ 11 ï¼š 00 ã€ 01 å’Œ 10 è¡¨ç¤º content éƒ¨åˆ†ä¿å­˜ç€å­—ç¬¦æ•°ç»„ã€‚ 11 è¡¨ç¤º content éƒ¨åˆ†ä¿å­˜ç€æ•´æ•°ã€‚ content content éƒ¨åˆ†ä¿å­˜ç€èŠ‚ç‚¹çš„å†…å®¹ï¼Œç±»å‹å’Œé•¿åº¦ç”± encoding å’Œ length å†³å®šã€‚ æ·»åŠ å’Œåˆ é™¤ ziplist èŠ‚ç‚¹æœ‰å¯èƒ½ä¼šå¼•èµ·è¿é”æ›´æ–°ï¼Œå› æ­¤ï¼Œæ·»åŠ å’Œåˆ é™¤æ“ä½œçš„æœ€åå¤æ‚åº¦ä¸º O(N2) ï¼Œä¸è¿‡ï¼Œå› ä¸ºè¿é”æ›´æ–°çš„å‡ºç°æ¦‚ç‡å¹¶ä¸é«˜ï¼Œæ‰€ä»¥ä¸€èˆ¬å¯ä»¥å°†æ·»åŠ å’Œåˆ é™¤æ“ä½œçš„å¤æ‚åº¦è§†ä¸º O(N)) ã€‚ æ“ä½œåŸç† åœ¨æœ€åæ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹ åœ¨èŠ‚ç‚¹é—´æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹ ç‰¹æ®Šæ•°æ®ç»“æ„HyperLogLogç”¨æ¥åšåŸºæ•°ç»Ÿè®¡çš„ç®—æ³•ï¼ŒHyperLogLog çš„ä¼˜ç‚¹æ˜¯ï¼Œåœ¨è¾“å…¥å…ƒç´ çš„æ•°é‡æˆ–è€…ä½“ç§¯éå¸¸éå¸¸å¤§æ—¶ï¼Œè®¡ç®—åŸºæ•°æ‰€éœ€çš„ç©ºé—´æ€»æ˜¯å›ºå®š çš„ã€å¹¶ä¸”æ˜¯å¾ˆå°çš„ã€‚ Geoè¿™ä¸ªåŠŸèƒ½å¯ä»¥å°†ç”¨æˆ·ç»™å®šçš„åœ°ç†ä½ç½®ä¿¡æ¯å‚¨å­˜èµ·æ¥ï¼Œ å¹¶å¯¹è¿™äº›ä¿¡æ¯è¿›è¡Œæ“ä½œ Pub/Sub ä¸€ä¸ªRedis clientå‘å¸ƒæ¶ˆæ¯,å…¶ä»–å¤šä¸ªredis clientè®¢é˜…æ¶ˆæ¯,å‘å¸ƒçš„æ¶ˆæ¯â€œå³å‘å³å¤±â€, redisä¸ä¼šæŒä¹…ä¿å­˜å‘å¸ƒçš„æ¶ˆæ¯; æ¶ˆæ¯è®¢é˜…è€…ä¹Ÿå°†åªèƒ½å¾—åˆ°è®¢é˜…ä¹‹åçš„æ¶ˆæ¯,é€šé“ä¸­æ­¤å‰çš„æ¶ˆæ¯å°†æ— ä»è·å¾—ã€‚ ä¾‹å¦‚ï¼šå“¨å…µæœºåˆ¶æ¨é€æ´»è·ƒæ¶ˆæ¯ æ³¨æ„ï¼šåœ¨æ¶ˆè´¹è€…ä¸‹çº¿çš„æƒ…å†µä¸‹ï¼Œç”Ÿäº§çš„æ¶ˆæ¯ä¼šä¸¢å¤± redisè¿‡æœŸæ—¶é—´ æœ‰äº›æ•°æ®æ˜¯æœ‰æ—¶é—´é™åˆ¶çš„ä¾‹å¦‚ä¸€äº›ç™»é™†ä¿¡æ¯ï¼Œå°¤å…¶æ˜¯çŸ­ä¿¡éªŒè¯ç éƒ½æ˜¯æœ‰æ—¶é—´é™åˆ¶çš„ã€‚å®šæœŸåˆ é™¤+æƒ°æ€§åˆ é™¤å®šæœŸåˆ é™¤è¦ç‚¹ï¼šé»˜è®¤æ¯éš”1000mså°±==éšæœºæŠ½å–==ä¸€äº›è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyã€‚æƒ°æ€§åˆ é™¤ï¼šå®šæœŸåˆ é™¤ä¼šå¯¼è‡´å¾ˆå¤šè¿‡æœŸçš„keyåˆ°äº†æ—¶é—´å¹¶æ²¡æœ‰è¢«åˆ é™¤æ‰ã€‚å‡å¦‚è¿‡æœŸçš„keyé å®šæœŸåˆ é™¤æ²¡æœ‰åˆ é™¤æ‰ï¼Œè¿˜åœç•™åœ¨å†…å­˜ä¸­ï¼Œé™¤éä½ çš„ç³»ç»Ÿå»æŸ¥ä¸€ä¸‹é‚£ä¸ªkeyï¼Œæ‰ä¼šè¢«redisåˆ é™¤ redisçš„æŒä¹…åŒ–æœºåˆ¶1.RDB BGSAVEã€SAVEã€ save 60 10000 ã€SHUTDOWN ã€SYNC å¿«ç…§æ—¶é—´ï¼š1.é…ç½®ã€2.ç”¨æˆ·è°ƒç”¨save/BGSAVEã€3.flushALLã€4.ä¸»ä»å¤åˆ¶åˆå§‹åŒ–æ—¶ BGSAVEåŸç†ï¼šfork and cow ä¹Ÿå°±æ˜¯å¿«ç…§æŒä¹…åŒ–,é€šè¿‡åˆ›å»ºå¿«ç…§æ¥è·å¾—å­˜å‚¨åœ¨å†…å­˜é‡Œé¢çš„æ•°æ®åœ¨æŸä¸ªæ—¶é—´èŠ‚ç‚¹ä¸Šçš„å‰¯æœ¬ï¼ˆç”Ÿæˆdump.rdbæ–‡ä»¶ï¼‰ã€‚redisåˆ›å»ºå¿«ç…§åå¯ä»¥å¯¹å¿«ç…§è¿›è¡Œå¤‡ä»½ï¼Œå¯ä»¥å°†å¿«ç…§å¤åˆ¶åˆ°å…¶ä»–æœåŠ¡å™¨ä»è€Œåˆ›å»ºå‡ºå…·æœ‰ç›¸åŒæ•°æ®çš„æœåŠ¡å™¨å‰¯æœ¬ï¼ˆredisä¸»ä»ç»“æ„ï¼Œä¸»è¦ç”¨æ¥æé«˜redisçš„æ€§èƒ½ï¼‰ï¼Œè¿˜å¯ä»¥å°†å¿«ç…§ç•™åœ¨åŸåœ°ä»¥ä¾¿é‡å¯æœåŠ¡å™¨çš„æ—¶å€™ä½¿ç”¨ã€‚æ³¨æ„ï¼šå¦‚æœç³»ç»Ÿå‘ç”Ÿå´©æºƒï¼Œä¼šä¸¢å¤±æœ€è¿‘å¿«ç…§ä¹‹åçš„æ‰€æœ‰æ•°æ® åœºæ™¯ æ—¥å¿—èšåˆè®¡ç®— å¤§æ•°æ® ç¼ºç‚¹ï¼š1 æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ä¸é«˜ï¼Œå› ä¸ºRDBå¯èƒ½åœ¨æœ€åä¸€æ¬¡å¤‡ä»½æ—¶å®•æœºäº†ã€‚2 å¤‡ä»½æ—¶å ç”¨å†…å­˜ï¼Œå› ä¸ºRedis åœ¨å¤‡ä»½æ—¶ä¼šç‹¬ç«‹åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå°†æ•°æ®å†™å…¥åˆ°ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼ˆæ­¤æ—¶å†…å­˜ä¸­çš„æ•°æ®æ˜¯åŸæ¥çš„ä¸¤å€å“¦ï¼‰ï¼Œæœ€åå†å°†ä¸´æ—¶æ–‡ä»¶æ›¿æ¢ä¹‹å‰çš„å¤‡ä»½æ–‡ä»¶ã€‚ 2.AOFåªè¿½åŠ æ–‡ä»¶ appendonly yes appendfsync everysec #æ¯ç§’é’ŸåŒæ­¥ä¸€æ¬¡ï¼Œæ˜¾ç¤ºåœ°å°†å¤šä¸ªå†™å‘½ä»¤åŒæ­¥åˆ°ç¡¬ç›˜ appendfsync always #æ¯æ¬¡æœ‰æ•°æ®ä¿®æ”¹å‘ç”Ÿæ—¶éƒ½ä¼šå†™å…¥AOFæ–‡ä»¶,è¿™æ ·ä¼šä¸¥é‡é™ä½Redisçš„é€Ÿ appendfsync no #è®©æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶è¿›è¡ŒåŒæ­¥ ä¸å¿«ç…§ç›¸æ¯”AOFçš„å®æ—¶æ€§æ›´å¥½ï¼Œå¼€å¯AOFæŒä¹…åŒ–åæ¯æ‰§è¡Œä¸€æ¡ä¼šæ›´æ”¹Redisä¸­çš„æ•°æ®çš„å‘½ä»¤ï¼ŒRediså°±ä¼šå°†è¯¥å‘½ä»¤å†™å…¥ç¡¬ç›˜ä¸­çš„AOFæ–‡ä»¶ AOFæ–‡ä»¶çš„ä¿å­˜ä½ç½®å’ŒRDBæ–‡ä»¶çš„ä½ç½®ç›¸åŒï¼Œéƒ½æ˜¯é€šè¿‡dirå‚æ•°è®¾ç½®çš„ï¼Œé»˜è®¤çš„æ–‡ä»¶åæ˜¯appendonly.aofã€‚ ä¼˜åŒ– åœ¨æ‰§è¡Œ BGREWRITEAOFå‘½ä»¤æ—¶ï¼ŒRedis æœåŠ¡å™¨ä¼šç»´æŠ¤ä¸€ä¸ª AOF é‡å†™ç¼“å†²åŒºï¼Œè¯¥ç¼“å†²åŒºä¼šåœ¨å­è¿›ç¨‹åˆ›å»ºæ–°AOFæ–‡ä»¶æœŸé—´ï¼Œè®°å½•æœåŠ¡å™¨æ‰§è¡Œçš„æ‰€æœ‰å†™å‘½ä»¤ã€‚å½“å­è¿›ç¨‹å®Œæˆåˆ›å»ºæ–°AOFæ–‡ä»¶çš„å·¥ä½œä¹‹åï¼ŒæœåŠ¡å™¨ä¼šå°†é‡å†™ç¼“å†²åŒºä¸­çš„æ‰€æœ‰å†…å®¹è¿½åŠ åˆ°æ–°AOFæ–‡ä»¶çš„æœ«å°¾ï¼Œä½¿å¾—æ–°æ—§ä¸¤ä¸ªAOFæ–‡ä»¶æ‰€ä¿å­˜çš„æ•°æ®åº“çŠ¶æ€ä¸€è‡´ã€‚æœ€åï¼ŒæœåŠ¡å™¨ç”¨æ–°çš„AOFæ–‡ä»¶æ›¿æ¢æ—§çš„AOFæ–‡ä»¶ï¼Œä»¥æ­¤æ¥å®ŒæˆAOFæ–‡ä»¶é‡å†™æ“ä½œ è®¾ç½® auto-aof-rewrite-percentage å’Œauto-aof-rewrite-min-size æ¢å¤æ—¶redis-check-aof â€“fix appendonly.aof æ ¡éªŒæ–‡ä»¶å®Œæ•´æ€§,ä¿®å¤ç ´ç¢æ–‡ä»¶ ç¼“å­˜é›ªå´©å’Œç¼“å­˜ç©¿é€ç¼“å­˜ç©¿é€ï¼šä¸€èˆ¬æ˜¯é»‘å®¢æ•…æ„å»è¯·æ±‚ç¼“å­˜ä¸­ä¸å­˜åœ¨çš„æ•°æ®ï¼Œå¯¼è‡´æ‰€æœ‰çš„è¯·æ±‚éƒ½è½åˆ°æ•°æ®åº“ä¸Šï¼Œé€ æˆæ•°æ®åº“çŸ­æ—¶é—´å†…æ‰¿å—å¤§é‡è¯·æ±‚è€Œå´©æ‰ã€‚ è§£å†³åŠæ³•ï¼š æœ‰å¾ˆå¤šç§æ–¹æ³•å¯ä»¥æœ‰æ•ˆåœ°è§£å†³ç¼“å­˜ç©¿é€é—®é¢˜ï¼Œå¸¸è§çš„åˆ™æ˜¯é‡‡ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå°†æ‰€æœ‰å¯èƒ½å­˜åœ¨çš„æ•°æ®å“ˆå¸Œåˆ°ä¸€ä¸ªè¶³å¤Ÿå¤§çš„bitmapä¸­ï¼Œä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ä¼šè¢«è¿™ä¸ªbitmapæ‹¦æˆªæ‰ï¼Œä»è€Œé¿å…äº†å¯¹åº•å±‚å­˜å‚¨ç³»ç»Ÿçš„æŸ¥è¯¢å‹åŠ›ã€‚ å¦å¤–ä¹Ÿæœ‰ä¸€ä¸ªæ›´ä¸ºç®€å•ç²—æš´çš„æ–¹æ³•ï¼ˆæˆ‘ä»¬é‡‡ç”¨çš„å°±æ˜¯è¿™ç§ï¼‰ï¼Œå¦‚æœä¸€ä¸ªæŸ¥è¯¢è¿”å›çš„æ•°æ®ä¸ºç©ºï¼ˆä¸ç®¡æ˜¯æ•° æ®ä¸å­˜ åœ¨ï¼Œè¿˜æ˜¯ç³»ç»Ÿæ•…éšœï¼‰ï¼Œæˆ‘ä»¬ä»ç„¶æŠŠè¿™ä¸ªç©ºç»“æœè¿›è¡Œç¼“å­˜ï¼ˆç¼“å­˜è¿‡ç¨‹ä¸Šé”ï¼‰ï¼Œä½†å®ƒçš„è¿‡æœŸæ—¶é—´ä¼šå¾ˆçŸ­ï¼Œé•¿ä¸è¶…è¿‡äº”åˆ†é’Ÿã€‚ ç¼“å­˜é›ªå´©ï¼šç¼“å­˜åŒä¸€æ—¶é—´å¤§é¢ç§¯çš„å¤±æ•ˆï¼Œæ‰€ä»¥ï¼Œåé¢çš„è¯·æ±‚éƒ½ä¼šè½åˆ°æ•°æ®åº“ä¸Šï¼Œé€ æˆæ•°æ®åº“çŸ­æ—¶é—´å†…æ‰¿å—å¤§é‡è¯·æ±‚è€Œå´©æ‰ã€‚ æœ‰å“ªäº›è§£å†³åŠæ³•ï¼Ÿ äº‹å‰ï¼šå°½é‡ä¿è¯æ•´ä¸ª redis é›†ç¾¤çš„é«˜å¯ç”¨æ€§ï¼Œå‘ç°æœºå™¨å®•æœºå°½å¿«è¡¥ä¸Šã€‚é€‰æ‹©åˆé€‚çš„å†…å­˜æ·˜æ±°ç­–ç•¥ã€‚ äº‹ä¸­ï¼šæœ¬åœ°ehcacheç¼“å­˜ + hystrixé™æµ&amp;é™çº§ï¼Œé¿å…MySQLå´©æ‰ äº‹åï¼šåˆ©ç”¨ redis æŒä¹…åŒ–æœºåˆ¶ä¿å­˜çš„æ•°æ®å°½å¿«æ¢å¤ç¼“å­˜ å…¶ä»–æ–¹æ³• 1ï¼Œåœ¨è®¾ç½®Redisé”®çš„è¿‡æœŸæ—¶é—´æ—¶ï¼ŒåŠ ä¸Šä¸€ä¸ªéšæœºæ•°ï¼Œè¿™æ ·å¯ä»¥é¿å…ã€‚2ï¼Œéƒ¨ç½²åˆ†å¸ƒå¼çš„RedisæœåŠ¡ï¼Œå½“ä¸€ä¸ªRedisæœåŠ¡å™¨æŒ‚æ‰äº†ä¹‹åï¼Œè¿›è¡Œæ•…éšœè½¬ç§»ã€‚ ç¼“å­˜å‡»ç©¿â€œ: â€œå°±æ˜¯è¯´æŸä¸ªkeyéå¸¸çƒ­ç‚¹ï¼Œè®¿é—®éå¸¸é¢‘ç¹ï¼Œå¤„äºé›†ä¸­å¼é«˜å¹¶å‘è®¿é—®çš„æƒ…å†µï¼Œå½“è¿™ä¸ª key åœ¨å¤±æ•ˆçš„ç¬é—´ï¼Œå¤§é‡çš„è¯·æ±‚å°±å‡»ç©¿äº†ç¼“å­˜ï¼Œç›´æ¥è¯·æ±‚æ•°æ®åº“ è§£å†³æ–¹æ³• å¯ä»¥å°†çƒ­ç‚¹æ•°æ®è®¾ç½®ä¸ºæ°¸è¿œä¸è¿‡æœŸï¼› åŸºäº redis or zookeeper å®ç°äº’æ–¥é”ï¼Œç­‰å¾…ç¬¬ä¸€ä¸ªè¯·æ±‚æ„å»ºå®Œç¼“å­˜ä¹‹åï¼Œå†é‡Šæ”¾é”ï¼Œè¿›è€Œå…¶å®ƒè¯·æ±‚æ‰èƒ½é€šè¿‡è¯¥ key è®¿é—®æ•°æ® çƒ­ç‚¹keyç¼“å­˜ä¸­çš„æŸäº›Key(å¯èƒ½å¯¹åº”ç”¨ä¸æŸä¸ªä¿ƒé”€å•†å“)å¯¹åº”çš„valueå­˜å‚¨åœ¨é›†ç¾¤ä¸­ä¸€å°æœºå™¨ï¼Œä½¿å¾—æ‰€æœ‰æµé‡æ¶Œå‘åŒä¸€æœºå™¨ï¼Œæˆä¸ºç³»ç»Ÿçš„ç“¶é¢ˆï¼Œè¯¥é—®é¢˜çš„æŒ‘æˆ˜åœ¨äºå®ƒæ— æ³•é€šè¿‡å¢åŠ æœºå™¨å®¹é‡æ¥è§£å†³ã€‚ å®¢æˆ·ç«¯çƒ­ç‚¹keyç¼“å­˜ï¼šå°†çƒ­ç‚¹keyå¯¹åº”valueå¹¶ç¼“å­˜åœ¨å®¢æˆ·ç«¯æœ¬åœ°ï¼Œå¹¶ä¸”è®¾ç½®ä¸€ä¸ªå¤±æ•ˆæ—¶é—´ã€‚ å°†çƒ­ç‚¹keyåˆ†æ•£ä¸ºå¤šä¸ªå­keyï¼Œç„¶åå­˜å‚¨åˆ°ç¼“å­˜é›†ç¾¤çš„ä¸åŒæœºå™¨ä¸Šï¼Œè¿™äº›å­keyå¯¹åº”çš„valueéƒ½å’Œçƒ­ç‚¹keyæ˜¯ä¸€æ ·çš„ã€‚ æ•°æ®åº“ä¸ç¼“å­˜æ•°æ®ä¸€è‡´æ€§æ•°æ®å’Œç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ å†™å®Œæ•°æ®åº“åæ˜¯å¦éœ€è¦é©¬ä¸Šæ›´æ–°ç¼“å­˜è¿˜æ˜¯ç›´æ¥åˆ é™¤ç¼“å­˜ï¼Ÿ ï¼ˆ1ï¼‰ã€å¦‚æœå†™æ•°æ®åº“çš„å€¼ä¸æ›´æ–°åˆ°ç¼“å­˜å€¼æ˜¯ä¸€æ ·çš„ï¼Œä¸éœ€è¦ç»è¿‡ä»»ä½•çš„è®¡ç®—ï¼Œå¯ä»¥é©¬ä¸Šæ›´æ–°ç¼“å­˜ï¼Œä½†æ˜¯å¦‚æœå¯¹äºé‚£ç§å†™æ•°æ®é¢‘ç¹è€Œè¯»æ•°æ®å°‘çš„åœºæ™¯å¹¶ä¸åˆé€‚è¿™ç§è§£å†³æ–¹æ¡ˆï¼Œå› ä¸ºä¹Ÿè®¸è¿˜æ²¡æœ‰æŸ¥è¯¢å°±è¢«åˆ é™¤æˆ–ä¿®æ”¹äº†ï¼Œè¿™æ ·ä¼šæµªè´¹æ—¶é—´å’Œèµ„æº ï¼ˆ2ï¼‰ã€å¦‚æœå†™æ•°æ®åº“çš„å€¼ä¸æ›´æ–°ç¼“å­˜çš„å€¼ä¸ä¸€è‡´ï¼Œå†™å…¥ç¼“å­˜ä¸­çš„æ•°æ®éœ€è¦ç»è¿‡å‡ ä¸ªè¡¨çš„å…³è”è®¡ç®—åå¾—åˆ°çš„ç»“æœæ’å…¥ç¼“å­˜ä¸­ï¼Œé‚£å°±æ²¡æœ‰å¿…è¦é©¬ä¸Šæ›´æ–°ç¼“å­˜ï¼Œåªæœ‰åˆ é™¤ç¼“å­˜å³å¯ï¼Œç­‰åˆ°æŸ¥è¯¢çš„æ—¶å€™åœ¨å»æŠŠè®¡ç®—åå¾—åˆ°çš„ç»“æœæ’å…¥åˆ°ç¼“å­˜ä¸­å³å¯ã€‚ æ‰€ä»¥ä¸€èˆ¬çš„ç­–ç•¥æ˜¯å½“æ›´æ–°æ•°æ®æ—¶ï¼Œå…ˆåˆ é™¤ç¼“å­˜æ•°æ®ï¼Œç„¶åæ›´æ–°æ•°æ®åº“ï¼Œè€Œä¸æ˜¯æ›´æ–°ç¼“å­˜ï¼Œç­‰è¦æŸ¥è¯¢çš„æ—¶å€™æ‰æŠŠæœ€æ–°çš„æ•°æ®æ›´æ–°åˆ°ç¼“å­˜ çº¿ç¨‹æ¨¡å‹Redisçº¿ç¨‹æ¨¡å‹ redis å†…éƒ¨ä½¿ç”¨æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ file event handlerï¼Œè¿™ä¸ªæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨æ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥ redis æ‰å«åšå•çº¿ç¨‹çš„æ¨¡å‹ã€‚å®ƒé‡‡ç”¨ IO å¤šè·¯å¤ç”¨æœºåˆ¶åŒæ—¶ç›‘å¬å¤šä¸ª socketï¼Œæ ¹æ® socket ä¸Šçš„äº‹ä»¶æ¥é€‰æ‹©å¯¹åº”çš„äº‹ä»¶å¤„ç†å™¨è¿›è¡Œå¤„ç†ã€‚ æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨çš„ç»“æ„åŒ…å« 4 ä¸ªéƒ¨åˆ†ï¼š å¤šä¸ª socket IO å¤šè·¯å¤ç”¨ç¨‹åº æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨ äº‹ä»¶å¤„ç†å™¨ï¼ˆè¿æ¥åº”ç­”å¤„ç†å™¨ã€å‘½ä»¤è¯·æ±‚å¤„ç†å™¨ã€å‘½ä»¤å›å¤å¤„ç†å™¨ï¼‰ I/O å¤šè·¯å¤ç”¨ç¨‹åº I/O å¤šè·¯å¤ç”¨ç¨‹åºå¯ä»¥ç›‘å¬å¤šä¸ªå¥—æ¥å­—çš„ ae.h/AE_READABLE äº‹ä»¶å’Œ ae.h/AE_WRITABLE äº‹ä»¶ï¼Œ è¿™ä¸¤ç±»äº‹ä»¶å’Œå¥—æ¥å­—æ“ä½œä¹‹é—´çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š å½“å¥—æ¥å­—å˜å¾—å¯è¯»æ—¶ï¼ˆå®¢æˆ·ç«¯å¯¹å¥—æ¥å­—æ‰§è¡Œ write æ“ä½œï¼Œæˆ–è€…æ‰§è¡Œ close æ“ä½œï¼‰ï¼Œ æˆ–è€…æœ‰æ–°çš„å¯åº”ç­”ï¼ˆacceptableï¼‰å¥—æ¥å­—å‡ºç°æ—¶ï¼ˆå®¢æˆ·ç«¯å¯¹æœåŠ¡å™¨çš„ç›‘å¬å¥—æ¥å­—æ‰§è¡Œ connect æ“ä½œï¼‰ï¼Œ å¥—æ¥å­—äº§ç”Ÿ AE_READABLE äº‹ä»¶ã€‚ å½“å¥—æ¥å­—å˜å¾—å¯å†™æ—¶ï¼ˆå®¢æˆ·ç«¯å¯¹å¥—æ¥å­—æ‰§è¡Œ read æ“ä½œï¼‰ï¼Œ å¥—æ¥å­—äº§ç”Ÿ AE_WRITABLE äº‹ä»¶ã€‚ I/O å¤šè·¯å¤ç”¨ç¨‹åºå…è®¸æœåŠ¡å™¨åŒæ—¶ç›‘å¬å¥—æ¥å­—çš„ AE_READABLE äº‹ä»¶å’Œ AE_WRITABLE äº‹ä»¶ï¼Œ å¦‚æœä¸€ä¸ªå¥—æ¥å­—åŒæ—¶äº§ç”Ÿäº†è¿™ä¸¤ç§äº‹ä»¶ï¼Œ é‚£ä¹ˆæ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨ä¼šä¼˜å…ˆå¤„ç† AE_READABLE äº‹ä»¶ï¼Œ ç­‰åˆ° AE_READABLE äº‹ä»¶å¤„ç†å®Œä¹‹åï¼Œ æ‰å¤„ç† AE_WRITABLE äº‹ä»¶ã€‚ è¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œ å¦‚æœä¸€ä¸ªå¥—æ¥å­—åˆå¯è¯»åˆå¯å†™çš„è¯ï¼Œ é‚£ä¹ˆæœåŠ¡å™¨å°†å…ˆè¯»å¥—æ¥å­—ï¼Œ åå†™å¥—æ¥å­—ã€‚ Redisæ˜¯å•çº¿ç¨‹æ¨¡å‹ä¸ºä»€ä¹ˆæ•ˆç‡è¿˜è¿™ä¹ˆé«˜ï¼Ÿ çº¯å†…å­˜è®¿é—®ï¼šæ•°æ®å­˜æ”¾åœ¨å†…å­˜ä¸­ï¼Œå†…å­˜çš„å“åº”æ—¶é—´å¤§çº¦æ˜¯100çº³ç§’ï¼Œè¿™æ˜¯Redisæ¯ç§’ä¸‡äº¿çº§åˆ«è®¿é—®çš„é‡è¦åŸºç¡€ã€‚ éé˜»å¡I/Oï¼šRedisé‡‡ç”¨epollåšä¸ºI/Oå¤šè·¯å¤ç”¨æŠ€æœ¯çš„å®ç°ï¼Œå†åŠ ä¸ŠRedisè‡ªèº«çš„äº‹ä»¶å¤„ç†æ¨¡å‹å°†epollä¸­çš„è¿æ¥ï¼Œè¯»å†™ï¼Œå…³é—­éƒ½è½¬æ¢ä¸ºäº†æ—¶é—´ï¼Œä¸åœ¨I/Oä¸Šæµªè´¹è¿‡å¤šçš„æ—¶é—´ã€‚ å•çº¿ç¨‹é¿å…äº†çº¿ç¨‹åˆ‡æ¢å’Œç«æ€äº§ç”Ÿçš„æ¶ˆè€—ã€‚ Redisé‡‡ç”¨å•çº¿ç¨‹æ¨¡å‹ï¼Œæ¯æ¡å‘½ä»¤æ‰§è¡Œå¦‚æœå ç”¨å¤§é‡æ—¶é—´ï¼Œä¼šé€ æˆå…¶ä»–çº¿ç¨‹é˜»å¡ï¼Œå¯¹äºRedisè¿™ç§é«˜æ€§èƒ½æœåŠ¡æ˜¯è‡´å‘½çš„ï¼Œæ‰€ä»¥Redisæ˜¯é¢å‘é«˜é€Ÿæ‰§è¡Œçš„æ•°æ®åº“ redisäº‹åŠ¡Redisäº‹åŠ¡æœ‰å¦‚ä¸‹ä¸€äº›ç‰¹ç‚¹: äº‹åŠ¡ä¸­çš„å‘½ä»¤åºåˆ—æ‰§è¡Œçš„æ—¶å€™æ˜¯åŸå­æ€§çš„,ä¹Ÿå°±æ˜¯è¯´,å…¶ä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯çš„å‘½ä»¤ä¸­æ–­. è¿™å’Œä¼ ç»Ÿçš„æ•°æ®åº“çš„äº‹åŠ¡çš„å±æ€§æ˜¯ç±»ä¼¼çš„. å°½ç®¡Redisäº‹åŠ¡ä¸­çš„å‘½ä»¤åºåˆ—æ˜¯åŸå­æ‰§è¡Œçš„, ä½†æ˜¯äº‹åŠ¡ä¸­çš„å‘½ä»¤åºåˆ—æ‰§è¡Œå¯ä»¥éƒ¨åˆ†æˆåŠŸ,è¿™ç§æƒ…å†µä¸‹,Redisäº‹åŠ¡ä¸ä¼šæ‰§è¡Œå›æ»šæ“ä½œ. è¿™å’Œä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“çš„äº‹åŠ¡æ˜¯æœ‰åŒºåˆ«çš„. redisåŒä¸€ä¸ªäº‹åŠ¡ä¸­å¦‚æœæœ‰ä¸€æ¡å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œå…¶åçš„å‘½ä»¤ä»ç„¶ä¼šè¢«æ‰§è¡Œï¼Œæ²¡æœ‰å›æ»š å°½ç®¡Redisæœ‰RDBå’ŒAOFä¸¤ç§æ•°æ®æŒä¹…åŒ–æœºåˆ¶, ä½†æ˜¯å…¶è®¾è®¡ç›®æ ‡æ˜¯é«˜æ•ˆç‡çš„cacheç³»ç»Ÿ. Redisäº‹åŠ¡åªä¿è¯å°†å…¶å‘½ä»¤åºåˆ—ä¸­çš„æ“ä½œç»“æœæäº¤åˆ°å†…å­˜ä¸­,ä¸ä¿è¯æŒä¹…åŒ–åˆ°ç£ç›˜æ–‡ä»¶. æ›´è¿›ä¸€æ­¥çš„, Redisäº‹åŠ¡å’ŒRDBæŒä¹…åŒ–æœºåˆ¶æ²¡æœ‰ä»»ä½•å…³ç³», å› ä¸ºRDBæœºåˆ¶æ˜¯å¯¹å†…å­˜æ•°æ®ç»“æ„çš„å…¨é‡çš„å¿«ç…§.ç”±äºAOFæœºåˆ¶æ˜¯ä¸€ç§å¢é‡æŒä¹…åŒ–,æ‰€ä»¥äº‹åŠ¡ä¸­çš„å‘½ä»¤åºåˆ—ä¼šæäº¤åˆ°AOFçš„ç¼“å­˜ä¸­.ä½†æ˜¯AOFæœºåˆ¶å°†å…¶ç¼“å­˜å†™å…¥ç£ç›˜æ–‡ä»¶æ˜¯ç”±å…¶é…ç½®çš„å®ç°ç­–ç•¥å†³å®šçš„,å’ŒRedisäº‹åŠ¡æ²¡æœ‰å…³ç³». Redisäº‹åŠ¡æ¶‰åŠåˆ°MULTI, EXEC, DISCARD, WATCHå’ŒUNWATCHè¿™äº”ä¸ªå‘½ä»¤:Â· äº‹åŠ¡å¼€å§‹çš„å‘½ä»¤æ˜¯MULTI, è¯¥å‘½ä»¤è¿”å›OKæç¤ºä¿¡æ¯. Redisä¸æ”¯æŒäº‹åŠ¡åµŒå¥—,æ‰§è¡Œå¤šæ¬¡MULTIå‘½ä»¤å’Œæ‰§è¡Œä¸€æ¬¡æ˜¯ç›¸åŒçš„æ•ˆæœ.åµŒå¥—æ‰§è¡ŒMULTIå‘½ä»¤æ—¶,Redisåªæ˜¯è¿”å›é”™è¯¯æç¤ºä¿¡æ¯. EXECæ˜¯äº‹åŠ¡çš„æäº¤å‘½ä»¤,äº‹åŠ¡ä¸­çš„å‘½ä»¤åºåˆ—å°†è¢«æ‰§è¡Œ(æˆ–è€…ä¸è¢«æ‰§è¡Œ,æ¯”å¦‚ä¹è§‚é”å¤±è´¥ç­‰).è¯¥å‘½ä»¤å°†è¿”å›å“åº”æ•°ç»„,å…¶å†…å®¹å¯¹åº”äº‹åŠ¡ä¸­çš„å‘½ä»¤æ‰§è¡Œç»“æœ. WATCHå‘½ä»¤æ˜¯å¼€å§‹æ‰§è¡Œä¹è§‚é”,è¯¥å‘½ä»¤çš„å‚æ•°æ˜¯key(å¯ä»¥æœ‰å¤šä¸ª), Rediså°†æ‰§è¡ŒWATCHå‘½ä»¤çš„å®¢æˆ·ç«¯å¯¹è±¡å’Œkeyè¿›è¡Œå…³è”,å¦‚æœå…¶ä»–å®¢æˆ·ç«¯ä¿®æ”¹äº†è¿™äº›key,åˆ™æ‰§è¡ŒWATCHå‘½ä»¤çš„å®¢æˆ·ç«¯å°†è¢«è®¾ç½®ä¹è§‚é”å¤±è´¥çš„æ ‡å¿—.è¯¥å‘½ä»¤å¿…é¡»åœ¨äº‹åŠ¡å¼€å§‹å‰æ‰§è¡Œ,å³åœ¨æ‰§è¡ŒMULTIå‘½ä»¤å‰æ‰§è¡ŒWATCHå‘½ä»¤,å¦åˆ™æ‰§è¡Œæ— æ•ˆ,å¹¶è¿”å›é”™è¯¯æç¤ºä¿¡æ¯. UNWATCHå‘½ä»¤å°†å–æ¶ˆå½“å‰å®¢æˆ·ç«¯å¯¹è±¡çš„ä¹è§‚é”key,è¯¥å®¢æˆ·ç«¯å¯¹è±¡çš„äº‹åŠ¡æäº¤å°†å˜æˆæ— æ¡ä»¶æ‰§è¡Œ. DISCARDå‘½ä»¤å°†ç»“æŸäº‹åŠ¡,å¹¶ä¸”ä¼šä¸¢å¼ƒå…¨éƒ¨çš„å‘½ä»¤åºåˆ—. éœ€è¦æ³¨æ„çš„æ˜¯,EXECå‘½ä»¤å’ŒDISCARDå‘½ä»¤ç»“æŸäº‹åŠ¡æ—¶,ä¼šè°ƒç”¨UNWATCHå‘½ä»¤,å–æ¶ˆè¯¥å®¢æˆ·ç«¯å¯¹è±¡ä¸Šæ‰€æœ‰çš„ä¹è§‚é”key. äº‹åŠ¡çš„é”™è¯¯å¤„ç† äº‹åŠ¡æäº¤å‘½ä»¤EXECæœ‰å¯èƒ½ä¼šå¤±è´¥, æœ‰ä¸‰ç§ç±»å‹çš„å¤±è´¥åœºæ™¯: åœ¨äº‹åŠ¡æäº¤ä¹‹å‰,å®¢æˆ·ç«¯æ‰§è¡Œçš„å‘½ä»¤ç¼“å­˜å¤±è´¥.æ¯”å¦‚å‘½ä»¤çš„è¯­æ³•é”™è¯¯(å‘½ä»¤å‚æ•°ä¸ªæ•°é”™è¯¯, ä¸æ”¯æŒçš„å‘½ä»¤ç­‰ç­‰).å¦‚æœå‘ç”Ÿè¿™ç§ç±»å‹çš„é”™è¯¯,Rediså°†å‘å®¢æˆ·ç«¯è¿”å›åŒ…å«é”™è¯¯æç¤ºä¿¡æ¯çš„å“åº”. äº‹åŠ¡æäº¤æ—¶,ä¹‹å‰ç¼“å­˜çš„å‘½ä»¤æœ‰å¯èƒ½æ‰§è¡Œå¤±è´¥.ï¼ˆ==ä½†Redisä¸ä¼šå¯¹äº‹åŠ¡åšä»»ä½•å›æ»šè¡¥æ•‘æ“ä½œ==ï¼‰ ç”±äºä¹è§‚é”å¤±è´¥,äº‹åŠ¡æäº¤æ—¶,å°†ä¸¢å¼ƒä¹‹å‰ç¼“å­˜çš„æ‰€æœ‰å‘½ä»¤åºåˆ—. å®é™…ä¸Šï¼Œè¿™å°±æ„å‘³ç€åªæœ‰ç¨‹åºé”™è¯¯æ‰ä¼šå¯¼è‡´Rediså‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œè¿™ç§é”™è¯¯å¾ˆæœ‰å¯èƒ½åœ¨ç¨‹åºå¼€å‘æœŸé—´å‘ç°ï¼Œä¸€èˆ¬å¾ˆå°‘åœ¨ç”Ÿäº§ç¯å¢ƒå‘ç°ã€‚Rediså·²ç»åœ¨ç³»ç»Ÿå†…éƒ¨è¿›è¡ŒåŠŸèƒ½ç®€åŒ–ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿æ›´å¿«çš„è¿è¡Œé€Ÿåº¦ï¼Œå› ä¸ºRedisä¸éœ€è¦äº‹åŠ¡å›æ»šçš„èƒ½åŠ›ã€‚ ä¹è§‚é”æœºåˆ¶Â· å…³äºä¹è§‚é”,éœ€è¦æ³¨æ„çš„æ˜¯: WATCHå‘½ä»¤å¿…é¡»åœ¨MULTIå‘½ä»¤ä¹‹å‰æ‰§è¡Œ. WATCHå‘½ä»¤å¯ä»¥æ‰§è¡Œå¤šæ¬¡. WATCHå‘½ä»¤å¯ä»¥æŒ‡å®šä¹è§‚é”çš„å¤šä¸ªkey,å¦‚æœåœ¨äº‹åŠ¡è¿‡ç¨‹ä¸­,ä»»ä½•ä¸€ä¸ªkeyè¢«å…¶ä»–å®¢æˆ·ç«¯æ”¹å˜,åˆ™å½“å‰å®¢æˆ·ç«¯çš„ä¹è§‚é”å¤±è´¥,äº‹åŠ¡æäº¤æ—¶,å°†ä¸¢å¼ƒæ‰€æœ‰å‘½ä»¤åºåˆ—. å¤šä¸ªå®¢æˆ·ç«¯çš„WATCHå‘½ä»¤å¯ä»¥æŒ‡å®šç›¸åŒçš„key. WATCHå‘½ä»¤æŒ‡å®šä¹è§‚é”å,å¯ä»¥æ¥ç€æ‰§è¡ŒMULTIå‘½ä»¤è¿›å…¥äº‹åŠ¡ä¸Šä¸‹æ–‡,ä¹Ÿå¯ä»¥åœ¨WATCHå‘½ä»¤å’ŒMULTIå‘½ä»¤ä¹‹é—´æ‰§è¡Œå…¶ä»–å‘½ä»¤. å…·ä½“ä½¿ç”¨æ–¹å¼å–å†³äºåœºæ™¯éœ€æ±‚,ä¸åœ¨äº‹åŠ¡ä¸­çš„å‘½ä»¤å°†ç«‹å³è¢«æ‰§è¡Œ. å¦‚æœWATCHå‘½ä»¤æŒ‡å®šçš„ä¹è§‚é”çš„key,è¢«å½“å‰å®¢æˆ·ç«¯æ”¹å˜,åœ¨äº‹åŠ¡æäº¤æ—¶,ä¹è§‚é”ä¸ä¼šå¤±è´¥. å¦‚æœWATCHå‘½ä»¤æŒ‡å®šçš„ä¹è§‚é”çš„keyå…·æœ‰è¶…æ—¶å±æ€§,å¹¶ä¸”è¯¥keyåœ¨WATCHå‘½ä»¤æ‰§è¡Œå, åœ¨äº‹åŠ¡æäº¤å‘½ä»¤EXECæ‰§è¡Œå‰è¶…æ—¶, åˆ™ä¹è§‚é”ä¸ä¼šå¤±è´¥.å¦‚æœè¯¥keyè¢«å…¶ä»–å®¢æˆ·ç«¯å¯¹è±¡ä¿®æ”¹,åˆ™ä¹è§‚é”å¤±è´¥. Redisäº‹åŠ¡å…¶æœ¬è´¨å°±æ˜¯,ä»¥ä¸å¯ä¸­æ–­çš„æ–¹å¼ä¾æ¬¡æ‰§è¡Œç¼“å­˜çš„å‘½ä»¤åºåˆ—,å°†ç»“æœä¿å­˜åˆ°å†…å­˜cacheä¸­ redisäº‹åŠ¡ æ— é”åŒ–ç¼–ç¨‹ä¸€ç§å®ç°æ€æƒ³ å‡å¦‚æœ‰ä¸€ä¸ªä¸Šè¿°çš„postè¯·æ±‚çš„URIéƒ¨åˆ†æ˜¯ä¸ªè¦†ç›–å†™æ“ä½œï¼Œreqid=abc123789defï¼ŒæœåŠ¡éƒ¨ç½²åœ¨å¤šå°æœºå™¨ï¼Œåœ¨å¤§å‰ç«¯å°†æµé‡è½¬å‘åˆ°Nginxä¹‹åæ ¹æ®reqidè¿›è¡Œå“ˆå¸Œ, ç»è¿‡ Nginxè´Ÿè½½å‡è¡¡ ç›¸åŒreqidçš„è¯·æ±‚å°†è¢«è½¬å‘åˆ°ä¸€å°æœºå™¨ä¸Šï¼Œå½“ç„¶ä½ å¯èƒ½ä¼šè¯´å¦‚æœé›†ç¾¤çš„æœºå™¨åŠ¨æ€è°ƒæ•´å‘¢ï¼Ÿæˆ‘åªèƒ½è¯´ä¸è¦è€ƒè™‘é‚£ä¹ˆå¤šé‚£ä¹ˆå……åˆ†ï¼Œ å·¥ç¨‹åŒ–å»è®¾è®¡ å³å¯ã€‚ ç„¶è€Œè½¬å‘åˆ°ä¸€å°æœºå™¨ä»ç„¶æ— æ³•ä¿è¯ä¸²è¡Œå¤„ç†ï¼Œå› ä¸ºå•æœºä»ç„¶æ˜¯å¤šçº¿ç¨‹çš„ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦å°†æ‰€æœ‰çš„reqidæ•°æ®æ”¾åˆ°åŒä¸€ä¸ªçº¿ç¨‹å¤„ç†ï¼Œæœ€ç»ˆä¿è¯çº¿ç¨‹å†…ä¸²è¡Œï¼Œè¿™ä¸ªå°±éœ€è¦å€ŸåŠ©äºçº¿ç¨‹æ± çš„ç®¡ç†è€…DisperæŒ‰ç…§ reqidå“ˆå¸Œå–æ¨¡ æ¥è¿›è¡Œå¤šçº¿ç¨‹çš„è´Ÿè½½å‡è¡¡ã€‚ ç»è¿‡Nginxå’Œçº¿ç¨‹å†…è´Ÿè½½å‡è¡¡ï¼Œæœ€ç»ˆç›¸åŒçš„reqidéƒ½å°†åœ¨çº¿ç¨‹å†…ä¸²è¡Œå¤„ç†ï¼Œæœ‰æ•ˆé¿å…äº†é”çš„ä½¿ç”¨ï¼Œå½“ç„¶è¿™ç§è®¾è®¡å¯èƒ½åœ¨reqidä¸å‡è¡¡æ—¶é€ æˆ çº¿ç¨‹é¥¥é¥¿ ï¼Œä¸è¿‡é«˜å¹¶å‘å¤§é‡è¯·æ±‚çš„æƒ…å†µä¸‹è¿˜æ˜¯å¯ä»¥çš„ã€‚ åˆ†å¸ƒå¼é” åœ¨ åˆ†å¸ƒå¼éƒ¨ç½²é«˜å¹¶å‘åœºæ™¯ ä¸‹ï¼Œç»å¸¸ä¼šé‡åˆ°èµ„æºçš„äº’æ–¥è®¿é—®çš„é—®é¢˜ï¼Œæœ€æœ‰æ•ˆæœ€æ™®éçš„æ–¹æ³•æ˜¯ç»™å…±äº«èµ„æºæˆ–è€…å¯¹å…±äº«èµ„æºçš„æ“ä½œåŠ ä¸€æŠŠé” åˆ†å¸ƒå¼é”æ˜¯ æ§åˆ¶åˆ†å¸ƒå¼ç³»ç»Ÿä¹‹é—´åŒæ­¥è®¿é—®å…±äº«èµ„æºçš„ä¸€ç§æ–¹å¼ ï¼Œç”¨äºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­åè°ƒä»–ä»¬ä¹‹é—´çš„åŠ¨ä½œã€‚ åˆ†å¸ƒå¼é”ä¸€èˆ¬æœ‰ä¸‰ç§å®ç°æ–¹å¼ï¼š åŸºäºæ•°æ®åº“åœ¨æ•°æ®åº“ä¸­åˆ›å»ºä¸€å¼ è¡¨ï¼Œè¡¨é‡ŒåŒ…å«æ–¹æ³•åç­‰å­—æ®µï¼Œå¹¶ä¸”åœ¨æ–¹æ³•åå­—æ®µä¸Šé¢åˆ›å»ºå”¯ä¸€ç´¢å¼•ï¼Œæ‰§è¡ŒæŸä¸ªæ–¹æ³•éœ€è¦ä½¿ç”¨æ­¤æ–¹æ³•åå‘è¡¨ä¸­æ’å…¥æ•°æ®ï¼ŒæˆåŠŸæ’å…¥åˆ™è·å–é”ï¼Œæ‰§è¡Œç»“æŸåˆ™åˆ é™¤å¯¹åº”çš„è¡Œæ•°æ®é‡Šæ”¾é” åŸºäºç¼“å­˜æ•°æ®åº“Redis Redisæ€§èƒ½å¥½å¹¶ä¸”å®ç°æ–¹ä¾¿ï¼Œä½†æ˜¯å•èŠ‚ç‚¹çš„åˆ†å¸ƒå¼é”åœ¨æ•…éšœè¿ç§»æ—¶äº§ç”Ÿå®‰å…¨é—®é¢˜ (åœ¨redisä¸»ä»æ¶æ„éƒ¨ç½²æ—¶ï¼Œåœ¨redis-masterå®ä¾‹å®•æœºçš„æ—¶å€™ï¼Œå¯èƒ½å¯¼è‡´å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶å®ŒæˆåŠ é”ã€‚æç«¯æƒ…å†µä¸‹ä¸èƒ½å¾—åˆ°ä¿è¯ã€‚ä½œè€…éƒ½æ˜¯è¿™å—è¯´çš„) Redlockæ˜¯Redisçš„ä½œè€… Antirez æå‡ºçš„é›†ç¾¤æ¨¡å¼åˆ†å¸ƒå¼é”ï¼ŒåŸºäºNä¸ªå®Œå…¨ç‹¬ç«‹çš„RedisèŠ‚ç‚¹å®ç°åˆ†å¸ƒå¼é”çš„é«˜å¯ç”¨ åŸºäºZooKeeper ZooKeeperæ˜¯ä»¥ Paxos ç®—æ³•ä¸ºåŸºç¡€çš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºåè°ƒæœåŠ¡ï¼Œä¸ºåˆ†å¸ƒå¼åº”ç”¨æä¾›ä¸€è‡´æ€§æœåŠ¡çš„å¼€æºç»„ä»¶ åŸºäºRedisçš„åˆ†å¸ƒå¼é”å’ŒRedlockç®—æ³•Â· åˆ†å¸ƒå¼é”æ­£ç¡®å®ç° redisessionå®ç° ç®€å•åº”ç”¨ å…ˆæ‹¿setnxæ¥äº‰æŠ¢é”ï¼ŒæŠ¢åˆ°ä¹‹åï¼Œå†ç”¨expireç»™é”åŠ ä¸€ä¸ªè¿‡æœŸæ—¶é—´é˜²æ­¢é”å¿˜è®°äº†é‡Šæ”¾ ä¸»ä»+å“¨å…µ ä¸»ä»æ¨¡å¼å¾ˆå¥½çš„è§£å†³äº†æ•°æ®å¤‡ä»½é—®é¢˜ï¼Œå¹¶ä¸”ç”±äºä¸»ä»æœåŠ¡æ•°æ®å‡ ä¹æ˜¯ä¸€è‡´çš„ï¼Œå› è€Œå¯ä»¥å°†å†™å…¥æ•°æ®çš„å‘½ä»¤å‘é€ç»™ä¸»æœºæ‰§è¡Œï¼Œè€Œè¯»å–æ•°æ®çš„å‘½ä»¤å‘é€ç»™ä¸åŒçš„ä»æœºæ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°è¯»å†™åˆ†ç¦»çš„ç›®çš„ Rediså¯ä»¥ä½¿ç”¨ä¸»ä»åŒæ­¥ï¼Œä»ä»åŒæ­¥ã€‚ç¬¬ä¸€æ¬¡åŒæ­¥æ—¶ï¼Œä¸»èŠ‚ç‚¹åšä¸€æ¬¡bgsaveï¼Œå¹¶åŒæ—¶å°†åç»­ä¿®æ”¹æ“ä½œè®°å½•åˆ°å†…å­˜bufferï¼Œå¾…å®Œæˆåå°†rdbæ–‡ä»¶å…¨é‡åŒæ­¥åˆ°å¤åˆ¶èŠ‚ç‚¹ï¼Œå¤åˆ¶èŠ‚ç‚¹æ¥å—å®Œæˆåå°†rdbé•œåƒåŠ è½½åˆ°å†…å­˜ã€‚åŠ è½½å®Œæˆåï¼Œå†é€šçŸ¥ä¸»èŠ‚ç‚¹å°†æœŸé—´ä¿®æ”¹çš„æ“ä½œè®°å½•åŒæ­¥åˆ°å¤åˆ¶èŠ‚ç‚¹è¿›è¡Œé‡æ”¾å°±å®Œæˆäº†åŒæ­¥è¿‡ç¨‹ã€‚ é—®é¢˜ åŒæ­¥æ•…éšœ å¤åˆ¶æ•°æ®å»¶è¿Ÿ(ä¸ä¸€è‡´) â€”-info replication æŸ¥çœ‹å»¶è¿Ÿåç§»é‡â€”zookeeperç›‘å¬å›è°ƒæœºåˆ¶å®ç°å®¢æˆ·ç«¯é€šçŸ¥ è¯»å–è¿‡æœŸæ•°æ®(Slave ä¸èƒ½åˆ é™¤æ•°æ®) â€”â€“æƒ°æ€§åˆ é™¤å’Œå®šæœŸåˆ é™¤â€”Redis3.2ç‰ˆæœ¬ä¸­å·²ç»è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œåœ¨æ­¤ç‰ˆæœ¬ä¸­slaveèŠ‚ç‚¹è¯»å–æ•°æ®ä¹‹å‰ä¼šæ£€æŸ¥é”®è¿‡æœŸæ—¶é—´æ¥å†³å®šæ˜¯å¦è¿”å›æ•°æ®çš„ã€‚ ä»èŠ‚ç‚¹æ•…éšœ â€“å“¨å…µæœºåˆ¶ ä¸»èŠ‚ç‚¹æ•…éšœ é…ç½®ä¸ä¸€è‡´ maxmemoryä¸ä¸€è‡´:ä¸¢å¤±æ•°æ® ä¼˜åŒ–å‚æ•°ä¸ä¸€è‡´:å†…å­˜ä¸ä¸€è‡´. é¿å…å…¨é‡å¤åˆ¶ é€‰æ‹©å°ä¸»èŠ‚ç‚¹(åˆ†ç‰‡)ã€ä½å³°æœŸé—´æ“ä½œ.ï¼ˆé˜²æ­¢ç¬¬ä¸€æ¬¡å…¨é‡å¤åˆ¶å‹åŠ›è¿‡å¤§ï¼‰ å¦‚æœèŠ‚ç‚¹è¿è¡Œ id ä¸åŒ¹é…(å¦‚ä¸»èŠ‚ç‚¹é‡å¯ã€è¿è¡Œ id å‘é€å˜åŒ–)ï¼Œæ­¤æ—¶è¦æ‰§è¡Œå…¨é‡å¤åˆ¶ï¼Œåº”è¯¥é…åˆå“¨å…µå’Œé›†ç¾¤è§£å†³. ä¸»ä»å¤åˆ¶æŒ¤å‹ç¼“å†²åŒºä¸è¶³äº§ç”Ÿçš„é—®é¢˜(ç½‘ç»œä¸­æ–­ï¼Œéƒ¨åˆ†å¤åˆ¶æ— æ³•æ»¡è¶³)ï¼Œå¯å¢å¤§å¤åˆ¶ç¼“å†²åŒº( rel_backlog_sizeå‚æ•°).Â· å¤åˆ¶é£æš´ å¤åˆ¶é£æš´æ˜¯æŒ‡å¤§é‡ä»èŠ‚ç‚¹å¯¹åŒä¸€ä¸»èŠ‚ç‚¹æˆ–è€…åŒä¸€å°æœºå™¨çš„å¤šä¸ªä¸»èŠ‚ç‚¹ï¼Œåœ¨çŸ­æ—¶é—´å†…å‘èµ·å…¨é‡å¤åˆ¶çš„è¿‡ç¨‹ã€‚æ­¤æ—¶å°†å¯¼è‡´è¢«å‘èµ·çš„ä¸»èŠ‚ç‚¹æˆ–æœºå™¨äº§ç”Ÿå¤§é‡å¼€é”€ï¼Œå¦‚ ï¼šCPUã€å†…å­˜ã€ç¡¬ç›˜ã€å¸¦å®½ç­‰ å•èŠ‚ç‚¹å¤åˆ¶é£æš´ â€”é¦–å…ˆå‡å°‘ä¸»èŠ‚ç‚¹æŒ‚åœ¨ä»èŠ‚ç‚¹çš„æ•°é‡ï¼Œæˆ–è€…é‡‡ç”¨æ ‘æ¡©å¤åˆ¶ç»“æ„ã€‚ å•æœºå¤åˆ¶é£æš´ â€”é›†ç¾¤å’Œå¤šèŠ‚ç‚¹éƒ¨ç½²â€”æ³¨æ„æ•…éšœæ¢å¤æœºåˆ¶ï¼Œé˜²æ­¢æ¢å¤æ—¶å‡ºç°å¯†é›†å…¨é‡å¤åˆ¶ ä¸»ä»æ•…éšœå¦‚ä½•æ•…éšœè½¬ç§»Â· a)ä¸»èŠ‚ç‚¹(master)æ•…éšœï¼Œä»èŠ‚ç‚¹slave-1ç«¯æ‰§è¡Œslaveof no oneåå˜æˆæ–°ä¸»èŠ‚ç‚¹ï¼›b)å…¶å®ƒçš„èŠ‚ç‚¹æˆä¸ºæ–°ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ï¼Œå¹¶ä»æ–°èŠ‚ç‚¹å¤åˆ¶æ•°æ®ï¼›c)éœ€è¦äººå·¥å¹²é¢„ï¼Œæ— æ³•å®ç°é«˜å¯ç”¨ã€‚ é…ç½® 12345678#é…ç½®ä¸»ä»èŠ‚ç‚¹127.0.0.1:6380&gt; slaveof 127.0.0.1 6379#é…ç½®å“¨å…µï¼ˆé…ç½®sentinel.confï¼‰#â‘ æ¯ä¸ªsentinelçš„myidå‚æ•°ä¹Ÿè¦è¿›è¡Œä¿®æ”¹ï¼Œå› ä¸ºsentinelä¹‹é—´æ˜¯é€šè¿‡è¯¥å±æ€§æ¥å”¯ä¸€åŒºåˆ†å…¶ä»–sentinelèŠ‚ç‚¹çš„ï¼›#â‘¡å‚æ•°ä¸­sentinel monitor mymaster 127.0.0.1 6379 2è¿™é‡Œçš„ç«¯å£å·6379æ˜¯ä¸ç”¨æ›´æ”¹çš„ï¼Œå› ä¸ºsentinelæ˜¯é€šè¿‡æ£€æµ‹ä¸»èŠ‚ç‚¹çš„çŠ¶æ€æ¥å¾—çŸ¥å½“å‰ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹æœ‰å“ªäº›çš„ï¼Œå› è€Œè®¾ç½®ä¸ºä¸»èŠ‚ç‚¹çš„ç«¯å£å·å³å¯./src/redis-sentinel sentinel-26379.conf#æŸ¥çœ‹çŠ¶æ€info replication å“¨å…µç›‘æ§æœºåˆ¶ ä»»åŠ¡1ï¼šæ¯ä¸ªå“¨å…µèŠ‚ç‚¹æ¯10ç§’ä¼šå‘ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹å‘é€infoå‘½ä»¤è·å–æ‹“æ‰‘ç»“æ„å›¾ ä»»åŠ¡2ï¼šæ¯ä¸ªå“¨å…µèŠ‚ç‚¹æ¯éš”2ç§’ä¼šå‘redisæ•°æ®èŠ‚ç‚¹çš„æŒ‡å®šé¢‘é“ä¸Šå‘é€è¯¥å“¨å…µèŠ‚ç‚¹å¯¹äºä¸»èŠ‚ç‚¹çš„åˆ¤æ–­ä»¥åŠå½“å‰å“¨å…µèŠ‚ç‚¹çš„ä¿¡æ¯ï¼ŒåŒæ—¶æ¯ä¸ªå“¨å…µèŠ‚ç‚¹ä¹Ÿä¼šè®¢é˜…è¯¥é¢‘é“ï¼Œæ¥äº†è§£å…¶å®ƒå“¨å…µèŠ‚ç‚¹çš„ä¿¡æ¯åŠå¯¹ä¸»èŠ‚ç‚¹çš„åˆ¤æ–­ï¼Œå…¶å®å°±æ˜¯é€šè¿‡æ¶ˆæ¯publishå’Œsubscribeæ¥å®Œæˆçš„Â· ä»»åŠ¡3ï¼šæ¯éš”1ç§’æ¯ä¸ªå“¨å…µä¼šå‘ä¸»èŠ‚ç‚¹ã€ä»èŠ‚ç‚¹åŠå…¶ä½™å“¨å…µèŠ‚ç‚¹å‘é€ä¸€æ¬¡pingå‘½ä»¤åšä¸€æ¬¡å¿ƒè·³æ£€æµ‹ï¼Œè¿™ä¸ªä¹Ÿæ˜¯å“¨å…µç”¨æ¥åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦æ­£å¸¸çš„é‡è¦ä¾æ® é¢†å¯¼è€…å“¨å…µé€‰ä¸¾æµç¨‹ a)æ¯ä¸ªåœ¨çº¿çš„å“¨å…µèŠ‚ç‚¹éƒ½å¯ä»¥æˆä¸ºé¢†å¯¼è€…ï¼Œå½“å®ƒç¡®è®¤ï¼ˆæ¯”å¦‚å“¨å…µ3ï¼‰ä¸»èŠ‚ç‚¹ä¸‹çº¿æ—¶ï¼ˆä¸»è§‚ä¸‹çº¿ï¼‰ï¼Œä¼šå‘å…¶å®ƒå“¨å…µå‘is-master-down-by-addrå‘½ä»¤ï¼Œå¾æ±‚åˆ¤æ–­å¹¶è¦æ±‚å°†è‡ªå·±Â·è®¾ç½®ä¸ºé¢†å¯¼è€…ï¼Œç”±é¢†å¯¼è€…å¤„ç†æ•…éšœè½¬ç§»ï¼›b)å½“å…¶å®ƒå“¨å…µæ”¶åˆ°æ­¤å‘½ä»¤æ—¶ï¼Œå¯ä»¥åŒæ„æˆ–è€…æ‹’ç»å®ƒæˆä¸ºé¢†å¯¼è€…ï¼›c)å¦‚æœå“¨å…µ3å‘ç°è‡ªå·±åœ¨é€‰ä¸¾çš„ç¥¨æ•°å¤§äºç­‰äºnum(sentinels)/2+1æ—¶ï¼Œå°†æˆä¸ºé¢†å¯¼è€…ï¼Œå¦‚æœæ²¡æœ‰è¶…è¿‡ï¼Œç»§ç»­é€‰ä¸¾â€¦â€¦â€¦â€¦(å®¢è§‚ä¸‹çº¿)\ æ•…éšœè½¬ç§»Â· é€‰æ‹© slave-priority æœ€é«˜çš„èŠ‚ç‚¹ã€‚ é€‰æ‹©å¤åˆ¶åç§»é‡æœ€å¤§çš„èŠ‚ç‚¹(åŒæ­¥æ•°æ®æœ€å¤š)ã€‚ é€‰æ‹© runIdæœ€å°çš„èŠ‚ç‚¹ã€‚ éƒ¨ç½²å»ºè®® aï¼ŒsentinelèŠ‚ç‚¹åº”éƒ¨ç½²åœ¨å¤šå°ç‰©ç†æœºï¼ˆçº¿ä¸Šç¯å¢ƒï¼‰ bï¼Œè‡³å°‘ä¸‰ä¸ªä¸”å¥‡æ•°ä¸ªsentinelèŠ‚ç‚¹ cï¼Œé€šè¿‡ä»¥ä¸Šæˆ‘ä»¬çŸ¥é“ï¼Œ3ä¸ªsentinelå¯åŒæ—¶ç›‘æ§ä¸€ä¸ªä¸»èŠ‚ç‚¹æˆ–å¤šä¸ªä¸»èŠ‚ç‚¹ ç›‘å¬Nä¸ªä¸»èŠ‚ç‚¹è¾ƒå¤šæ—¶ï¼Œå¦‚æœsentinelå‡ºç°å¼‚å¸¸ï¼Œä¼šå¯¹å¤šä¸ªä¸»èŠ‚ç‚¹æœ‰å½±å“ï¼ŒåŒæ—¶è¿˜ä¼šé€ æˆsentinelèŠ‚ç‚¹äº§ç”Ÿè¿‡å¤šçš„ç½‘ç»œè¿æ¥ï¼Œ ä¸€èˆ¬çº¿ä¸Šå»ºè®®è¿˜æ˜¯ï¼Œ 3ä¸ªsentinelç›‘å¬ä¸€ä¸ªä¸»èŠ‚ç‚¹ æ•°æ®åŒæ­¥ redis 2.8ç‰ˆæœ¬ä»¥ä¸Šä½¿ç”¨Â·å‘½ä»¤å®ŒæˆåŒæ­¥ï¼Œè¿‡ç¨‹åˆ†â€œå…¨é‡â€ä¸â€œéƒ¨åˆ†â€å¤åˆ¶ å…¨é‡å¤åˆ¶ï¼šä¸€èˆ¬ç”¨äºåˆæ¬¡å¤åˆ¶åœºæ™¯ï¼ˆç¬¬ä¸€æ¬¡å»ºç«‹SLAVEåå…¨é‡ï¼‰ éƒ¨åˆ†å¤åˆ¶ï¼šç½‘ç»œå‡ºç°é—®é¢˜ï¼Œä»èŠ‚ç‚¹å†æ¬¡è¿æ¥ä¸»èŠ‚ç‚¹æ—¶ï¼Œä¸»èŠ‚ç‚¹è¡¥å‘ç¼ºå°‘çš„æ•°æ®ï¼Œæ¯æ¬¡æ•°æ®å¢é‡åŒæ­¥ å¿ƒè·³ï¼šä¸»ä»æœ‰é•¿è¿æ¥å¿ƒè·³ï¼Œä¸»èŠ‚ç‚¹é»˜è®¤æ¯10Så‘ä»èŠ‚ç‚¹å‘pingå‘½ä»¤ï¼Œrepl-ping-slave-periodæ§åˆ¶å‘é€é¢‘ç‡Â· é›†ç¾¤ å½“é‡åˆ°å•æœºå†…å­˜ï¼Œå¹¶å‘å’Œæµé‡ç“¶é¢ˆç­‰é—®é¢˜æ—¶ï¼Œå¯é‡‡ç”¨Clusteræ–¹æ¡ˆè¾¾åˆ°è´Ÿè½½å‡è¡¡çš„ç›®çš„ã€‚å¹¶ä¸”ä»å¦ä¸€æ–¹é¢è®²ï¼Œredisä¸­sentinelæœ‰æ•ˆçš„è§£å†³äº†æ•…éšœè½¬ç§»çš„é—®é¢˜ï¼Œä¹Ÿè§£å†³äº†ä¸»èŠ‚ç‚¹ä¸‹çº¿å®¢æˆ·ç«¯æ— æ³•è¯†åˆ«æ–°çš„å¯ç”¨èŠ‚ç‚¹çš„é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæ˜¯ä»èŠ‚ç‚¹ä¸‹çº¿äº†ï¼Œsentinelæ˜¯ä¸ä¼šå¯¹å…¶è¿›è¡Œæ•…éšœè½¬ç§»çš„ï¼Œå¹¶ä¸”è¿æ¥ä»èŠ‚ç‚¹çš„å®¢æˆ·ç«¯ä¹Ÿæ— æ³•è·å–åˆ°æ–°çš„å¯ç”¨ä»èŠ‚ç‚¹ redisé›†ç¾¤ä¸­æ•°æ®æ˜¯å’Œæ§½ï¼ˆslotï¼‰æŒ‚é’©çš„ï¼Œå…¶æ€»å…±å®šä¹‰äº†16384ä¸ªæ§½ï¼Œæ‰€æœ‰çš„æ•°æ®æ ¹æ®ä¸€è‡´å“ˆå¸Œç®—æ³•ä¼šè¢«æ˜ å°„åˆ°è¿™16384ä¸ªæ§½ä¸­çš„æŸä¸ªæ§½ä¸­ã€‚ slot=CRC16ï¼ˆkeyï¼‰/16384 æ•°æ®çš„å­˜å‚¨åªå’Œæ§½æœ‰å…³ï¼Œå¹¶ä¸”æ§½çš„æ•°é‡æ˜¯ä¸€å®šçš„ï¼Œç”±äºä¸€è‡´hashç®—æ³•Â·æ˜¯ä¸€å®šçš„ï¼Œå› è€Œå°†è¿™16384ä¸ªæ§½åˆ†é…ç»™æ— è®ºå¤šå°‘ä¸ªrediså®ä¾‹ï¼Œå¯¹äºç¡®è®¤çš„æ•°æ®å…¶éƒ½å°†è¢«åˆ†é…åˆ°ç¡®å®šçš„æ§½ä½ä¸Šã€‚redisé›†ç¾¤é€šè¿‡è¿™ç§æ–¹å¼æ¥è¾¾åˆ°redisçš„é«˜æ•ˆå’Œé«˜å¯ç”¨æ€§ç›®çš„ã€‚ ä¸€è‡´æ€§å“ˆå¸Œå’Œå“ˆå¸Œæ§½çš„åŒºåˆ«Â·ä¸€è‡´æ€§å“ˆå¸Œæ˜¯åˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹æ¥å®ç°èŠ‚ç‚¹å®•æœºåçš„æ•°æ®è½¬ç§»å¹¶ä¿è¯æ•°æ®çš„å®‰å…¨æ€§å’Œé›†ç¾¤çš„å¯ç”¨æ€§çš„ã€‚ redis clusteræ˜¯é‡‡ç”¨masterèŠ‚ç‚¹æœ‰å¤šä¸ªslaveèŠ‚ç‚¹æœºåˆ¶æ¥ä¿è¯æ•°æ®çš„å®Œæ•´æ€§çš„,masterèŠ‚ç‚¹å†™å…¥æ•°æ®ï¼ŒslaveèŠ‚ç‚¹åŒæ­¥æ•°æ®ã€‚å½“masterèŠ‚ç‚¹æŒ‚æœºåï¼ŒslaveèŠ‚ç‚¹ä¼šé€šè¿‡é€‰ä¸¾æœºåˆ¶é€‰ä¸¾å‡ºä¸€ä¸ªèŠ‚ç‚¹å˜æˆmasterèŠ‚ç‚¹ï¼Œå®ç°é«˜å¯ç”¨ã€‚ä½†æ˜¯è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦è€ƒè™‘ï¼Œå¦‚æœmasterèŠ‚ç‚¹å­˜åœ¨çƒ­ç‚¹ç¼“å­˜ï¼ŒæŸä¸€ä¸ªæ—¶åˆ»æŸä¸ªkeyçš„è®¿é—®æ€¥å‰§å¢é«˜ï¼Œè¿™æ—¶è¯¥materèŠ‚ç‚¹å¯èƒ½æ“åŠ³è¿‡åº¦è€Œæ­»ï¼Œéšåä»èŠ‚ç‚¹é€‰ä¸¾ä¸ºä¸»èŠ‚ç‚¹åï¼ŒåŒæ ·å®•æœºï¼Œä¸€æ¬¡ç±»æ¨ï¼Œé€ æˆç¼“å­˜é›ªå´© é…ç½® 123456789#redis.confé…ç½®æ–‡ä»¶è®¾ç½®port 6379cluster-enabled yescluster-node-timeout 15000cluster-config-file "nodes-6379.conf"pidfile /var/run/redis_6379.pidlogfile "cluster-6379.log"dbfilename dump-cluster-6379.rdbappendfilename "appendonly-cluster-6379.aof" 123#å¯åŠ¨é…ç½®æ–‡ä»¶./src/redis-server cluster-6379.conf... 123456#è®¾ç½®æ§½ä½#å…ˆè¿æ¥./src/redis-cli -p 6379#è®¾ç½®å¤šä¸ªæ§½ä½127.0.0.1:6379&gt;cluster meet 127.0.0.1 6380... 12345678#æŸ¥çœ‹çŠ¶æ€127.0.0.1:6379&gt; cluster nodes4fa7eac4080f0b667ffeab9b87841da49b84a6e4 127.0.0.1:6384 master - 0 1468073975551 5 connectedcfb28ef1deee4e0fa78da86abe5d24566744411e 127.0.0.1:6379 myself,master - 0 0 0 connectedbe9485a6a729fc98c5151374bc30277e89a461d8 127.0.0.1:6383 master - 0 1468073978579 4 connected40622f9e7adc8ebd77fca0de9edfe691cb8a74fb 127.0.0.1:6382 master - 0 1468073980598 3 connected8e41673d59c9568aa9d29fb174ce733345b3e8f1 127.0.0.1:6380 master - 0 1468073974541 1 connected40b8d09d44294d2e23c7c768efc8fcd153446746 127.0.0.1:6381 master - 0 1468073979589 2 connected 123#æ·»åŠ è™šæ‹Ÿæ§½(ç±»ä¼¼äºä¸€è‡´æ€§hashæä¾›ç»™è™šæ‹ŸèŠ‚ç‚¹)127.0.0.1:6379&gt;cluster addslots &#123;0...5461&#125;#...ä¹‹åæˆ‘ä»¬è¿˜å¯ä»¥åˆ†é…ä¸»ä»èŠ‚ç‚¹ï¼Œè¿›ä¸€æ­¥æé«˜å¯é æ€§ å…¶ä»–é›†ç¾¤æ¡ˆä¾‹ Redis Shardingé›†ç¾¤ é‡‡ç”¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•(consistent hashing)ï¼Œå°†keyå’ŒèŠ‚ç‚¹nameåŒæ—¶hashingï¼Œç„¶åè¿›è¡Œæ˜ å°„åŒ¹é…ï¼Œé‡‡ç”¨çš„ç®—æ³•æ˜¯MURMUR_HASHã€‚é‡‡ç”¨ä¸€è‡´æ€§å“ˆå¸Œè€Œä¸æ˜¯é‡‡ç”¨ç®€å•ç±»ä¼¼å“ˆå¸Œæ±‚æ¨¡æ˜ å°„çš„ä¸»è¦åŸå› æ˜¯å½“å¢åŠ æˆ–å‡å°‘èŠ‚ç‚¹æ—¶ï¼Œä¸ä¼šäº§ç”Ÿç”±äºé‡æ–°åŒ¹é…é€ æˆçš„rehashingã€‚ä¸€è‡´æ€§å“ˆå¸Œåªå½±å“ç›¸é‚»èŠ‚ç‚¹keyåˆ†é…ï¼Œå½±å“é‡å°ã€‚ ä¸ºäº†é¿å…ä¸€è‡´æ€§å“ˆå¸Œåªå½±å“ç›¸é‚»èŠ‚ç‚¹é€ æˆèŠ‚ç‚¹åˆ†é…å‹åŠ›ï¼ŒShardedJedisä¼šå¯¹æ¯ä¸ªRedisèŠ‚ç‚¹æ ¹æ®åå­—(æ²¡æœ‰ï¼ŒJedisä¼šèµ‹äºˆç¼ºçœåå­—)ä¼šè™šæ‹ŸåŒ–å‡º160ä¸ªè™šæ‹ŸèŠ‚ç‚¹è¿›è¡Œæ•£åˆ—ã€‚æ ¹æ®æƒé‡weightï¼Œä¹Ÿå¯è™šæ‹ŸåŒ–å‡º160å€æ•°çš„è™šæ‹ŸèŠ‚ç‚¹ã€‚ç”¨è™šæ‹ŸèŠ‚ç‚¹åšæ˜ å°„åŒ¹é…ï¼Œå¯ä»¥åœ¨å¢åŠ æˆ–å‡å°‘RedisèŠ‚ç‚¹æ—¶ï¼Œkeyåœ¨å„RedisèŠ‚ç‚¹ç§»åŠ¨å†åˆ†é…æ›´å‡åŒ€ï¼Œè€Œä¸æ˜¯åªæœ‰ç›¸é‚»èŠ‚ç‚¹å—å½±å“ã€‚ ShardedJedisæ”¯æŒkeyTagPatternæ¨¡å¼ï¼Œå³æŠ½å–keyçš„ä¸€éƒ¨åˆ†keyTagåšshardingï¼Œè¿™æ ·é€šè¿‡åˆç†å‘½åkeyï¼Œå¯ä»¥å°†ä¸€ç»„ç›¸å…³è”çš„keyæ”¾å…¥åŒä¸€ä¸ªRedisèŠ‚ç‚¹ï¼Œè¿™åœ¨é¿å…è·¨èŠ‚ç‚¹è®¿é—®ç›¸å…³æ•°æ®æ—¶å¾ˆé‡è¦ã€‚ ç‰¹ç‚¹ï¼šreshardingÂ·ï¼Œå³é¢„å…ˆæ ¹æ®ç³»ç»Ÿè§„æ¨¡å°½é‡éƒ¨ç½²å¥½å¤šä¸ªRediså®ä¾‹ï¼Œè¿™äº›å®ä¾‹å ç”¨ç³»ç»Ÿèµ„æºå¾ˆå°ï¼Œä¸€å°ç‰©ç†æœºå¯éƒ¨ç½²å¤šä¸ªï¼Œè®©ä»–ä»¬éƒ½å‚ä¸shardingï¼Œå½“éœ€è¦æ‰©å®¹æ—¶ï¼Œé€‰ä¸­ä¸€ä¸ªå®ä¾‹ä½œä¸ºä¸»èŠ‚ç‚¹ï¼Œæ–°åŠ å…¥çš„RedisèŠ‚ç‚¹ä½œä¸ºä»èŠ‚ç‚¹è¿›è¡Œæ•°æ®å¤åˆ¶ã€‚ preshardingæ˜¯é¢„å…ˆåˆ†é…å¥½è¶³å¤Ÿçš„åˆ†ç‰‡ï¼Œæ‰©å®¹æ—¶åªæ˜¯å°†å±äºæŸä¸€åˆ†ç‰‡çš„åŸRediså®ä¾‹æ›¿æ¢æˆæ–°çš„å®¹é‡æ›´å¤§çš„Rediså®ä¾‹ã€‚å‚ä¸shardingçš„åˆ†ç‰‡æ²¡æœ‰æ”¹å˜ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸å­˜åœ¨keyå€¼ä»ä¸€ä¸ªåŒºè½¬ç§»åˆ°å¦ä¸€ä¸ªåˆ†ç‰‡åŒºçš„ç°è±¡ï¼Œåªæ˜¯å°†å±äºåŒåˆ†ç‰‡åŒºçš„é”®å€¼ä»åŸRediså®ä¾‹åŒæ­¥åˆ°æ–°Rediså®ä¾‹ã€‚ ä½¿ç”¨åœºæ™¯ çƒ­ç‚¹æ•°æ®ç¼“å­˜ ä¼šè¯ç»´æŒsession åˆ†å¸ƒå¼é”SETNX è¡¨ç¼“å­˜ æ¶ˆæ¯é˜Ÿåˆ— list()æä¾›é˜»å¡æ–¹æ³• è®¡æ•°å™¨ string æ³¨æ„ç‚¹å…³æ³¨æœ€åçš„å¼€å‘å»ºè®®ï¼šä¸è¦ç”¨keys å¤§å®¶çŸ¥é“ Redis æ˜¯å•çº¿ç¨‹ç¨‹åºï¼Œæ˜¯æŒ‰ç…§é¡ºåºæ‰§è¡ŒæŒ‡ä»¤çš„ï¼Œå¦‚æœè¯´æˆ‘ä»¬ç°åœ¨æ­£åœ¨æ‰§è¡Œ keys å‘½ä»¤ï¼Œé‚£ä¹ˆå…¶å®ƒæŒ‡ä»¤å¿…é¡»ç­‰åˆ°å½“å‰çš„ keys æŒ‡ä»¤æ‰§è¡Œå®Œäº†æ‰å¯ä»¥ç»§ç»­ï¼Œå†åŠ ä¸Š keys æ“ä½œæ˜¯éå†ç®—æ³•ï¼Œå¤æ‚åº¦æ˜¯ O (n)ï¼Œä¹ä¸€æƒ³å°±çŸ¥é“é—®é¢˜æ‰€åœ¨äº†ï¼Œå½“å®ä¾‹ä¸­æ•°æ®é‡è¿‡å¤§çš„æ—¶å€™ï¼ŒRedis æœåŠ¡å¯èƒ½ä¼šå¡é¡¿ï¼Œå…¶ä½™æŒ‡ä»¤å¯èƒ½ä¼šå»¶æ—¶ç”šè‡³è¶…æ—¶æŠ¥é”™â€¦. ä½¿ç”¨ï¼šscan - cursor [MATCH pattern] [COUNT count]Â· å¤æ‚åº¦è™½ç„¶ä¹Ÿæ˜¯ O (n)ï¼Œä½†æ˜¯å®ƒæ˜¯é€šè¿‡æ¸¸æ ‡åˆ†æ­¥è¿›è¡Œçš„ï¼Œä¸ä¼šé˜»å¡çº¿ç¨‹ï¼› scanæŒ‡ä»¤å¯ä»¥æ— é˜»å¡çš„æå–å‡ºæŒ‡å®šæ¨¡å¼çš„keyåˆ—è¡¨ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€å®šçš„é‡å¤æ¦‚ç‡ï¼Œåœ¨å®¢æˆ·ç«¯åšä¸€æ¬¡å»é‡å°±å¯ä»¥äº†ï¼Œä½†æ˜¯æ•´ä½“æ‰€èŠ±è´¹çš„æ—¶é—´ä¼šæ¯”ç›´æ¥ç”¨keysæŒ‡ä»¤é•¿ã€‚ scanç”¨æ³• IONIOæµ…æ åˆ†ç±»javaæä¾›çš„API IOæ¨¡å‹:IO NIO AIO Javaä¸­æä¾›çš„IOæœ‰å…³çš„APIï¼Œåœ¨æ–‡ä»¶å¤„ç†çš„æ—¶å€™ï¼Œå…¶å®ä¾èµ–æ“ä½œç³»ç»Ÿå±‚é¢çš„IOæ“ä½œå®ç°çš„ã€‚æ¯”å¦‚åœ¨Linux 2.6ä»¥åï¼ŒJavaä¸­NIOå’ŒAIOéƒ½æ˜¯é€šè¿‡epollæ¥å®ç°çš„ï¼Œè€Œåœ¨Windowsä¸Šï¼ŒAIOæ˜¯é€šè¿‡IOCPæ¥å®ç°çš„ã€‚ å¯ä»¥æŠŠJavaä¸­çš„BIOã€NIOå’ŒAIOç†è§£ä¸ºæ˜¯Javaè¯­è¨€å¯¹æ“ä½œç³»ç»Ÿçš„å„ç§IOæ¨¡å‹çš„å°è£…ã€‚ç¨‹åºå‘˜åœ¨ä½¿ç”¨è¿™äº›APIçš„æ—¶å€™ï¼Œä¸éœ€è¦å…³å¿ƒæ“ä½œç³»ç»Ÿå±‚é¢çš„çŸ¥è¯†ï¼Œä¹Ÿä¸éœ€è¦æ ¹æ®ä¸åŒæ“ä½œç³»ç»Ÿç¼–å†™ä¸åŒçš„ä»£ç ã€‚åªéœ€è¦ä½¿ç”¨Javaçš„APIå°±å¯ä»¥äº†ã€‚ æ“ä½œç³»ç»Ÿå±‚é¢çš„IOæ¨¡å‹: é˜»å¡IOæ¨¡å‹ã€éé˜»å¡IOæ¨¡å‹ã€IOå¤ç”¨æ¨¡å‹ã€ä¿¡å·é©±åŠ¨IOæ¨¡å‹ä»¥åŠå¼‚æ­¥IOæ¨¡å‹ã€‚ é˜»å¡å¼IO åº”ç”¨è¿›ç¨‹é€šè¿‡ç³»ç»Ÿè°ƒç”¨ recvfrom æ¥æ”¶æ•°æ®ï¼Œä½†ç”±äºå†…æ ¸è¿˜æœªå‡†å¤‡å¥½æ•°æ®æŠ¥ï¼Œåº”ç”¨è¿›ç¨‹å°±ä¼šé˜»å¡ä½ï¼Œç›´åˆ°å†…æ ¸å‡†å¤‡å¥½æ•°æ®æŠ¥ï¼Œrecvfrom å®Œæˆæ•°æ®æŠ¥å¤åˆ¶å·¥ä½œï¼Œåº”ç”¨è¿›ç¨‹æ‰èƒ½ç»“æŸé˜»å¡çŠ¶æ€ã€‚ éé˜»å¡å¼IO åº”ç”¨è¿›ç¨‹é€šè¿‡ recvfrom è°ƒç”¨ä¸åœçš„å»å’Œå†…æ ¸äº¤äº’ï¼Œç›´åˆ°å†…æ ¸å‡†å¤‡å¥½æ•°æ®ã€‚å¦‚æœæ²¡æœ‰å‡†å¤‡å¥½ï¼Œå†…æ ¸ä¼šè¿”å›errorï¼Œåº”ç”¨è¿›ç¨‹åœ¨å¾—åˆ°erroråï¼Œè¿‡ä¸€æ®µæ—¶é—´å†å‘é€recvfromè¯·æ±‚ã€‚åœ¨ä¸¤æ¬¡å‘é€è¯·æ±‚çš„æ—¶é—´æ®µï¼Œè¿›ç¨‹å¯ä»¥å…ˆåšåˆ«çš„äº‹æƒ…ã€‚ ä¿¡å·é©±åŠ¨IOæ¨¡å‹ åº”ç”¨è¿›ç¨‹é¢„å…ˆå‘å†…æ ¸æ³¨å†Œä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ï¼Œç„¶åç”¨æˆ·è¿›ç¨‹è¿”å›ï¼Œå¹¶ä¸”ä¸é˜»å¡ï¼Œå½“å†…æ ¸æ•°æ®å‡†å¤‡å°±ç»ªæ—¶ä¼šå‘é€ä¸€ä¸ªä¿¡å·ç»™è¿›ç¨‹ï¼Œç”¨æˆ·è¿›ç¨‹ä¾¿åœ¨ä¿¡å·å¤„ç†å‡½æ•°ä¸­å¼€å§‹æŠŠæ•°æ®æ‹·è´çš„ç”¨æˆ·ç©ºé—´ä¸­ã€‚ IOå¤ç”¨æ¨¡å‹ IOå¤šè·¯è½¬æ¥æ˜¯å¤šäº†ä¸€ä¸ªselectå‡½æ•°ï¼Œå¤šä¸ªè¿›ç¨‹çš„IOå¯ä»¥æ³¨å†Œåˆ°åŒä¸€ä¸ªselectä¸Šï¼Œå½“ç”¨æˆ·è¿›ç¨‹è°ƒç”¨è¯¥selectï¼Œselectä¼šç›‘å¬æ‰€æœ‰æ³¨å†Œå¥½çš„IOï¼Œå¦‚æœæ‰€æœ‰è¢«ç›‘å¬çš„IOéœ€è¦çš„æ•°æ®éƒ½æ²¡æœ‰å‡†å¤‡å¥½æ—¶ï¼Œselectè°ƒç”¨è¿›ç¨‹ä¼šé˜»å¡ã€‚å½“ä»»æ„ä¸€ä¸ªIOæ‰€éœ€çš„æ•°æ®å‡†å¤‡å¥½ä¹‹åï¼Œselectè°ƒç”¨å°±ä¼šè¿”å›ï¼Œç„¶åè¿›ç¨‹åœ¨é€šè¿‡recvfromæ¥è¿›è¡Œæ•°æ®æ‹·è´ã€‚ è¿™é‡Œçš„IOå¤ç”¨æ¨¡å‹ï¼Œå¹¶æ²¡æœ‰å‘å†…æ ¸æ³¨å†Œä¿¡å·å¤„ç†å‡½æ•°ï¼Œæ‰€ä»¥ï¼Œä»–å¹¶ä¸æ˜¯éé˜»å¡çš„ã€‚è¿›ç¨‹åœ¨å‘å‡ºselectåï¼Œè¦ç­‰åˆ°selectç›‘å¬çš„æ‰€æœ‰IOæ“ä½œä¸­è‡³å°‘æœ‰ä¸€ä¸ªéœ€è¦çš„æ•°æ®å‡†å¤‡å¥½ï¼Œæ‰ä¼šæœ‰è¿”å›ï¼Œå¹¶ä¸”ä¹Ÿéœ€è¦å†æ¬¡å‘é€è¯·æ±‚å»è¿›è¡Œæ–‡ä»¶çš„æ‹·è´ã€‚ å¼‚æ­¥IOæ¨¡å‹ ä¸Šè¿°IOæ¨¡å‹çš„æ•°æ®æ‹·è´è¿‡ç¨‹ï¼Œéƒ½æ˜¯åŒæ­¥è¿›è¡Œçš„ã€‚(ä¿¡å·é©±åŠ¨IOæ¨¡å‹æ•°æ®å‡†å¤‡é˜¶æ®µå¼å¼‚æ­¥çš„ä½†æ˜¯æ‹·è´ä¾ç„¶æ˜¯åŒæ­¥çš„) ç”¨æˆ·è¿›ç¨‹å‘èµ·aio_readæ“ä½œä¹‹åï¼Œç»™å†…æ ¸ä¼ é€’æè¿°ç¬¦ã€ç¼“å†²åŒºæŒ‡é’ˆã€ç¼“å†²åŒºå¤§å°ç­‰ï¼Œå‘Šè¯‰å†…æ ¸å½“æ•´ä¸ªæ“ä½œå®Œæˆæ—¶ï¼Œå¦‚ä½•é€šçŸ¥è¿›ç¨‹ï¼Œç„¶åå°±ç«‹åˆ»å»åšå…¶ä»–äº‹æƒ…äº†ã€‚å½“å†…æ ¸æ”¶åˆ°aio_readåï¼Œä¼šç«‹åˆ»è¿”å›ï¼Œç„¶åå†…æ ¸å¼€å§‹ç­‰å¾…æ•°æ®å‡†å¤‡ï¼Œæ•°æ®å‡†å¤‡å¥½ä»¥åï¼Œç›´æ¥æŠŠæ•°æ®æ‹·è´åˆ°ç”¨æˆ·æ§ä»¶ï¼Œç„¶åå†é€šçŸ¥è¿›ç¨‹æœ¬æ¬¡IOå·²ç»å®Œæˆã€‚ IOã€NIOã€AIOåŒºåˆ«BIO: ç”¨ BIO é€šä¿¡æ¨¡å‹ çš„æœåŠ¡ç«¯ï¼Œé€šå¸¸ç”±ä¸€ä¸ªç‹¬ç«‹çš„ Acceptor çº¿ç¨‹è´Ÿè´£ç›‘å¬å®¢æˆ·ç«¯çš„è¿æ¥ã€‚æˆ‘ä»¬ä¸€èˆ¬é€šè¿‡åœ¨while(true) å¾ªç¯ä¸­æœåŠ¡ç«¯ä¼šè°ƒç”¨ accept() æ–¹æ³•ç­‰å¾…æ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥çš„æ–¹å¼ç›‘å¬è¯·æ±‚ï¼Œè¯·æ±‚ä¸€æ—¦æ¥æ”¶åˆ°ä¸€ä¸ªè¿æ¥è¯·æ±‚ï¼Œå°±å¯ä»¥å»ºç«‹é€šä¿¡å¥—æ¥å­—åœ¨è¿™ä¸ªé€šä¿¡å¥—æ¥å­—ä¸Šè¿›è¡Œè¯»å†™æ“ä½œï¼Œæ­¤æ—¶ä¸èƒ½å†æ¥æ”¶å…¶ä»–å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚ï¼Œåªèƒ½ç­‰å¾…åŒå½“å‰è¿æ¥çš„å®¢æˆ·ç«¯çš„æ“ä½œæ‰§è¡Œå®Œæˆï¼Œ ä¸è¿‡å¯ä»¥é€šè¿‡å¤šçº¿ç¨‹æ¥æ”¯æŒå¤šä¸ªå®¢æˆ·ç«¯çš„è¿æ¥ BIOç¼ºç‚¹ çº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯æˆæœ¬å¾ˆé«˜ï¼Œåœ¨Linuxè¿™æ ·çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œçº¿ç¨‹æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ã€‚åˆ›å»ºå’Œé”€æ¯éƒ½æ˜¯é‡é‡çº§çš„ç³»ç»Ÿå‡½æ•°ã€‚ çº¿ç¨‹æœ¬èº«å ç”¨è¾ƒå¤§å†…å­˜ï¼ŒåƒJavaçš„çº¿ç¨‹æ ˆï¼Œä¸€èˆ¬è‡³å°‘åˆ†é…512Kï½1Mçš„ç©ºé—´ï¼Œå¦‚æœç³»ç»Ÿä¸­çš„çº¿ç¨‹æ•°è¿‡åƒï¼Œææ€•æ•´ä¸ªJVMçš„å†…å­˜éƒ½ä¼šè¢«åƒæ‰ä¸€åŠã€‚ çº¿ç¨‹çš„åˆ‡æ¢æˆæœ¬æ˜¯å¾ˆé«˜çš„ã€‚æ“ä½œç³»ç»Ÿå‘ç”Ÿçº¿ç¨‹åˆ‡æ¢çš„æ—¶å€™ï¼Œéœ€è¦ä¿ç•™çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ï¼Œç„¶åæ‰§è¡Œç³»ç»Ÿè°ƒç”¨ã€‚å¦‚æœçº¿ç¨‹æ•°è¿‡é«˜ï¼Œå¯èƒ½æ‰§è¡Œçº¿ç¨‹åˆ‡æ¢çš„æ—¶é—´ç”šè‡³ä¼šå¤§äºçº¿ç¨‹æ‰§è¡Œçš„æ—¶é—´ï¼Œè¿™æ—¶å€™å¸¦æ¥çš„è¡¨ç°å¾€å¾€æ˜¯ç³»ç»Ÿloadåé«˜ã€CPU syä½¿ç”¨ç‡ç‰¹åˆ«é«˜ï¼ˆè¶…è¿‡20%ä»¥ä¸Š)ï¼Œå¯¼è‡´ç³»ç»Ÿå‡ ä¹é™·å…¥ä¸å¯ç”¨çš„çŠ¶æ€ã€‚ å®¹æ˜“é€ æˆé”¯é½¿çŠ¶çš„ç³»ç»Ÿè´Ÿè½½ã€‚å› ä¸ºç³»ç»Ÿè´Ÿè½½æ˜¯ç”¨æ´»åŠ¨çº¿ç¨‹æ•°æˆ–CPUæ ¸å¿ƒæ•°ï¼Œä¸€æ—¦çº¿ç¨‹æ•°é‡é«˜ä½†å¤–éƒ¨ç½‘ç»œç¯å¢ƒä¸æ˜¯å¾ˆç¨³å®šï¼Œå°±å¾ˆå®¹æ˜“é€ æˆå¤§é‡è¯·æ±‚çš„ç»“æœåŒæ—¶è¿”å›ï¼Œæ¿€æ´»å¤§é‡é˜»å¡çº¿ç¨‹ä»è€Œä½¿ç³»ç»Ÿè´Ÿè½½å‹åŠ›è¿‡å¤§ã€‚ NIO : NIOæ˜¯ä¸€ç§åŒæ­¥éé˜»å¡çš„I/Oæ¨¡å‹ï¼Œåœ¨Java 1.4 ä¸­å¼•å…¥äº† NIO æ¡†æ¶ï¼Œå¯¹åº” java.nio åŒ…ï¼Œæä¾›äº† Channel , Selectorï¼ŒBufferç­‰æŠ½è±¡ã€‚ NIOä¸­çš„Nå¯ä»¥ç†è§£ä¸ºNon-blockingï¼Œä¸å•çº¯æ˜¯Newã€‚å®ƒæ”¯æŒé¢å‘ç¼“å†²çš„ï¼ŒåŸºäºé€šé“çš„I/Oæ“ä½œæ–¹æ³•ã€‚ NIOæä¾›äº†ä¸ä¼ ç»ŸBIOæ¨¡å‹ä¸­çš„ Socket å’Œ ServerSocket ç›¸å¯¹åº”çš„ SocketChannel å’Œ ServerSocketChannel ä¸¤ç§ä¸åŒçš„å¥—æ¥å­—é€šé“å®ç°,ä¸¤ç§é€šé“éƒ½æ”¯æŒé˜»å¡å’Œéé˜»å¡ä¸¤ç§æ¨¡å¼ã€‚é˜»å¡æ¨¡å¼ä½¿ç”¨å°±åƒä¼ ç»Ÿä¸­çš„æ”¯æŒä¸€æ ·ï¼Œæ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯æ€§èƒ½å’Œå¯é æ€§éƒ½ä¸å¥½ï¼›éé˜»å¡æ¨¡å¼æ­£å¥½ä¸ä¹‹ç›¸åã€‚å¯¹äºä½è´Ÿè½½ã€ä½å¹¶å‘çš„åº”ç”¨ç¨‹åºï¼Œå¯ä»¥ä½¿ç”¨åŒæ­¥é˜»å¡I/Oæ¥æå‡å¼€å‘é€Ÿç‡å’Œæ›´å¥½çš„ç»´æŠ¤æ€§ï¼›å¯¹äºé«˜è´Ÿè½½ã€é«˜å¹¶å‘çš„ï¼ˆç½‘ç»œï¼‰åº”ç”¨ï¼Œåº”ä½¿ç”¨ NIO çš„éé˜»å¡æ¨¡å¼æ¥å¼€å‘ã€‚ NIOç‰¹ç‚¹ äº‹ä»¶é©±åŠ¨æ¨¡å‹ é¿å…å¤šçº¿ç¨‹ å•çº¿ç¨‹å¤„ç†å¤šä»»åŠ¡ éé˜»å¡I/Oï¼ŒI/Oè¯»å†™ä¸å†é˜»å¡ï¼Œè€Œæ˜¯è¿”å›0ï¼ˆæŒ‡channelæ“ä½œçš„æ—¶å€™å¯ä»¥é€‰æ‹©æ³¨å†Œæˆéé˜»å¡ï¼‰ åŸºäºblockçš„ä¼ è¾“ï¼Œé€šå¸¸æ¯”åŸºäºæµçš„ä¼ è¾“æ›´é«˜æ•ˆ æ›´é«˜çº§çš„IOå‡½æ•°ï¼Œzero-copy IOå¤šè·¯å¤ç”¨å¤§å¤§æé«˜äº†Javaç½‘ç»œåº”ç”¨çš„å¯ä¼¸ç¼©æ€§å’Œå®ç”¨æ€§ NIOç”±åŸæ¥çš„é˜»å¡è¯»å†™ï¼ˆå ç”¨çº¿ç¨‹ï¼‰å˜æˆäº†å•çº¿ç¨‹è½®è¯¢äº‹ä»¶ï¼Œæ‰¾åˆ°å¯ä»¥è¿›è¡Œè¯»å†™çš„ç½‘ç»œæè¿°ç¬¦è¿›è¡Œè¯»å†™ã€‚é™¤äº†äº‹ä»¶çš„è½®è¯¢æ˜¯é˜»å¡çš„ï¼ˆæ²¡æœ‰å¯å¹²çš„äº‹æƒ…å¿…é¡»è¦é˜»å¡ï¼‰ï¼Œå‰©ä½™çš„I/Oæ“ä½œéƒ½æ˜¯çº¯CPUæ“ä½œï¼Œæ²¡æœ‰å¿…è¦å¼€å¯å¤šçº¿ç¨‹ã€‚ AIO: ä¹Ÿå°±æ˜¯ NIO 2ã€‚åœ¨ Java 7 ä¸­å¼•å…¥äº† NIO çš„æ”¹è¿›ç‰ˆ NIO 2,å®ƒæ˜¯å¼‚æ­¥éé˜»å¡çš„IOæ¨¡å‹ã€‚å¼‚æ­¥ IO æ˜¯åŸºäºäº‹ä»¶å’Œå›è°ƒæœºåˆ¶å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯åº”ç”¨æ“ä½œä¹‹åä¼šç›´æ¥è¿”å›ï¼Œä¸ä¼šå µå¡åœ¨é‚£é‡Œï¼Œå½“åå°å¤„ç†å®Œæˆï¼Œæ“ä½œç³»ç»Ÿä¼šé€šçŸ¥ç›¸åº”çš„çº¿ç¨‹è¿›è¡Œåç»­çš„æ“ä½œã€‚ AIO æ˜¯å¼‚æ­¥IOçš„ç¼©å†™ï¼Œè™½ç„¶ NIO åœ¨ç½‘ç»œæ“ä½œä¸­ï¼Œæä¾›äº†éé˜»å¡çš„æ–¹æ³•ï¼Œä½†æ˜¯ NIO çš„ IO è¡Œä¸ºè¿˜æ˜¯åŒæ­¥çš„ã€‚ åœ¨ Windows ä¸­ JDK ç›´æ¥é‡‡ç”¨äº† IOCP çš„æ”¯æŒ linuxä¸­ä½¿ç”¨çš„epoll NIOçš„ä¸‰ä¸ªä¸»è¦ç»„æˆéƒ¨åˆ† Channelï¼ˆé€šé“ï¼‰ã€Bufferï¼ˆç¼“å†²åŒºï¼‰ã€Selectorï¼ˆé€‰æ‹©å™¨ï¼‰ ChannelChannelï¼ˆé€šé“ï¼‰ï¼šChannelæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡å®ƒè¯»å–å’Œå†™å…¥æ•°æ®ã€‚å¯ä»¥æŠŠå®ƒçœ‹åšæ˜¯IOä¸­çš„æµï¼Œä¸åŒçš„æ˜¯ï¼š Channelæ˜¯åŒå‘çš„ï¼Œæ—¢å¯ä»¥è¯»åˆå¯ä»¥å†™ï¼Œè€Œæµæ˜¯å•å‘çš„ Channelå¯ä»¥è¿›è¡Œå¼‚æ­¥çš„è¯»å†™ å¯¹Channelçš„è¯»å†™å¿…é¡»é€šè¿‡bufferå¯¹è±¡ åœ¨Java NIOä¸­çš„Channelä¸»è¦æœ‰å¦‚ä¸‹å‡ ç§ç±»å‹ï¼š FileChannelï¼šä»æ–‡ä»¶è¯»å–æ•°æ®çš„ï¼ˆæ²¡æœ‰å¼‚æ­¥æ¨¡å¼ï¼‰ DatagramChannelï¼šè¯»å†™UDPç½‘ç»œåè®®æ•°æ® SocketChannelï¼šè¯»å†™TCPç½‘ç»œåè®®æ•°æ® ServerSocketChannelï¼šå¯ä»¥ç›‘å¬TCPè¿æ¥ FileChannelè¯»å–æ–‡ä»¶å†…å®¹ï¼š 123ByteBuffer buffer = ByteBuffer.allocate(1024);int num = fileChannel.read(buffer); å‰é¢æˆ‘ä»¬ä¹Ÿè¯´äº†ï¼Œæ‰€æœ‰çš„ Channel éƒ½æ˜¯å’Œ Buffer æ‰“äº¤é“çš„ã€‚ å†™å…¥æ–‡ä»¶å†…å®¹ï¼š 12345678ByteBuffer buffer = ByteBuffer.allocate(1024);buffer.put("éšæœºå†™å…¥ä¸€äº›å†…å®¹åˆ° Buffer ä¸­".getBytes());// Buffer åˆ‡æ¢ä¸ºè¯»æ¨¡å¼buffer.flip();while(buffer.hasRemaining()) &#123; // å°† Buffer ä¸­çš„å†…å®¹å†™å…¥æ–‡ä»¶ fileChannel.write(buffer);&#125; SocketChannelæ‰“å¼€ä¸€ä¸ª TCP è¿æ¥ï¼š 1SocketChannel socketChannel = SocketChannel.open(new InetSocketAddress("https://www.javadoop.com", 80)); å½“ç„¶äº†ï¼Œä¸Šé¢çš„è¿™è¡Œä»£ç ç­‰ä»·äºä¸‹é¢çš„ä¸¤è¡Œï¼š 1234// æ‰“å¼€ä¸€ä¸ªé€šé“SocketChannel socketChannel = SocketChannel.open();// å‘èµ·è¿æ¥socketChannel.connect(new InetSocketAddress("https://www.javadoop.com", 80)); SocketChannel çš„è¯»å†™å’Œ FileChannel æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œå°±æ˜¯æ“ä½œç¼“å†²åŒºã€‚ 1234567// è¯»å–æ•°æ®socketChannel.read(buffer);// å†™å…¥æ•°æ®åˆ°ç½‘ç»œè¿æ¥ä¸­while(buffer.hasRemaining()) &#123; socketChannel.write(buffer); &#125; ServerSocketChannelä¹‹å‰è¯´ SocketChannel æ˜¯ TCP å®¢æˆ·ç«¯ï¼Œè¿™é‡Œè¯´çš„ ServerSocketChannel å°±æ˜¯å¯¹åº”çš„æœåŠ¡ç«¯ã€‚ ServerSocketChannel ç”¨äºç›‘å¬æœºå™¨ç«¯å£ï¼Œç®¡ç†ä»è¿™ä¸ªç«¯å£è¿›æ¥çš„ TCP è¿æ¥ã€‚ 123456789// å®ä¾‹åŒ–ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();// ç›‘å¬ 8080 ç«¯å£serverSocketChannel.socket().bind(new InetSocketAddress(8080));while (true) &#123; // ä¸€æ—¦æœ‰ä¸€ä¸ª TCP è¿æ¥è¿›æ¥ï¼Œå°±å¯¹åº”åˆ›å»ºä¸€ä¸ª SocketChannel è¿›è¡Œå¤„ç† SocketChannel socketChannel = serverSocketChannel.accept();&#125; ServerSocketChannel ä¸å’Œ Buffer æ‰“äº¤é“äº†ï¼Œå› ä¸ºå®ƒå¹¶ä¸å®é™…å¤„ç†æ•°æ®ï¼Œå®ƒä¸€æ—¦æ¥æ”¶åˆ°è¯·æ±‚åï¼Œå®ä¾‹åŒ– SocketChannelï¼Œä¹‹ååœ¨è¿™ä¸ªè¿æ¥é€šé“ä¸Šçš„æ•°æ®ä¼ é€’å®ƒå°±ä¸ç®¡äº†ï¼Œå› ä¸ºå®ƒéœ€è¦ç»§ç»­ç›‘å¬ç«¯å£ï¼Œç­‰å¾…ä¸‹ä¸€ä¸ªè¿æ¥ã€‚ DatagramChannelUDP å’Œ TCP ä¸ä¸€æ ·ï¼ŒDatagramChannel ä¸€ä¸ªç±»å¤„ç†äº†æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ã€‚ ç›‘å¬ç«¯å£ï¼š 12345DatagramChannel channel = DatagramChannel.open();channel.socket().bind(new InetSocketAddress(9090));ByteBuffer buf = ByteBuffer.allocate(48);channel.receive(buf); å‘é€æ•°æ®ï¼š 12345678String newData = "New String to write to file..." + System.currentTimeMillis();ByteBuffer buf = ByteBuffer.allocate(48);buf.put(newData.getBytes());buf.flip();int bytesSent = channel.send(buf, new InetSocketAddress("jenkov.com", 80)); BufferBufferæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒåŒ…å«ä¸€äº›è¦å†™å…¥æˆ–è€…è¯»åˆ°Streamå¯¹è±¡çš„ã€‚åº”ç”¨ç¨‹åºä¸èƒ½ç›´æ¥å¯¹ Channel è¿›è¡Œè¯»å†™æ“ä½œï¼Œè€Œå¿…é¡»é€šè¿‡ Buffer æ¥è¿›è¡Œï¼Œå³ Channel æ˜¯é€šè¿‡ Buffer æ¥è¯»å†™æ•°æ®çš„ã€‚ åœ¨NIOä¸­ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯ç”¨Bufferå¤„ç†çš„ï¼Œå®ƒæ˜¯NIOè¯»å†™æ•°æ®çš„ä¸­è½¬æ± ã€‚Bufferå®è´¨ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªå­—èŠ‚æ•°æ®ï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯å…¶ä»–ç±»å‹çš„æ•°ç»„ã€‚ä½†ä¸€ä¸ªç¼“å†²åŒºä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‡è¦çš„æ˜¯å®ƒæä¾›äº†å¯¹æ•°æ®çš„ç»“æ„åŒ–è®¿é—®ï¼Œè€Œä¸”è¿˜å¯ä»¥è·Ÿè¸ªç³»ç»Ÿçš„è¯»å†™è¿›ç¨‹ã€‚ ä½¿ç”¨ Bufferè¯»å†™æ•°æ®ä¸€zesèˆ¬éµå¾ªä»¥ä¸‹å››ä¸ªæ­¥éª¤ï¼š 1.å†™å…¥æ•°æ®åˆ° Bufferï¼› 2.è°ƒç”¨ flip()æ–¹æ³•ï¼› 3.ä» Bufferä¸­è¯»å–æ•°æ®ï¼› 4.è°ƒç”¨ clear()æ–¹æ³•æˆ–è€…compact() æ–¹æ³•ã€‚ å½“å‘ Buffer å†™å…¥æ•°æ®æ—¶ï¼ŒBuffer ä¼šè®°å½•ä¸‹å†™äº†å¤šå°‘æ•°æ®ã€‚ä¸€æ—¦è¦è¯»å–æ•°æ®ï¼Œéœ€è¦é€šè¿‡ flip()æ–¹æ³•å°† Buffer ä»å†™æ¨¡å¼åˆ‡æ¢åˆ°è¯»æ¨¡å¼ã€‚åœ¨è¯»æ¨¡å¼ä¸‹ï¼Œå¯ä»¥è¯»å–ä¹‹å‰å†™å…¥åˆ° Buffer çš„æ‰€æœ‰æ•°æ®ã€‚ ä¸€æ—¦è¯»å®Œäº†æ‰€æœ‰çš„æ•°æ®ï¼Œå°±éœ€è¦æ¸…ç©ºç¼“å†²åŒºï¼Œè®©å®ƒå¯ä»¥å†æ¬¡è¢«å†™å…¥ã€‚æœ‰ä¸¤ç§æ–¹å¼èƒ½æ¸…ç©ºç¼“å†²åŒºï¼šè°ƒç”¨ clear() æˆ– compact() æ–¹æ³•ã€‚ clear() æ–¹æ³•ä¼šæ¸…ç©ºæ•´ä¸ªç¼“å†²åŒºã€‚ compact() æ–¹æ³•åªä¼šæ¸…é™¤å·²ç»è¯»è¿‡çš„æ•°æ®ã€‚ä»»ä½•æœªè¯»çš„æ•°æ®éƒ½è¢«ç§»åˆ°ç¼“å†²åŒºçš„èµ·å§‹å¤„ï¼Œæ–°å†™å…¥çš„æ•°æ®å°†æ”¾åˆ°ç¼“å†²åŒºæœªè¯»æ•°æ®çš„åé¢ã€‚ Bufferä¸»è¦æœ‰å¦‚ä¸‹å‡ ç§ ByteBuffer CharBuffer DoubleBuffer FloatBuffer IntBuffer LongBuffer ShortBuffer é‡è¦å±æ€§ capacityï¼Œå®ƒä»£è¡¨è¿™ä¸ªç¼“å†²åŒºçš„å®¹é‡ï¼Œä¸€æ—¦è®¾å®šå°±ä¸å¯ä»¥æ›´æ”¹ã€‚ position çš„åˆå§‹å€¼æ˜¯ 0ï¼Œæ¯å¾€ Buffer ä¸­å†™å…¥ä¸€ä¸ªå€¼ï¼Œposition å°±è‡ªåŠ¨åŠ  1ï¼Œä»£è¡¨ä¸‹ä¸€æ¬¡çš„å†™å…¥ä½ç½®ã€‚è¯»æ“ä½œçš„æ—¶å€™ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œæ¯è¯»ä¸€ä¸ªå€¼ï¼Œposition å°±è‡ªåŠ¨åŠ  1ã€‚ ä»å†™æ“ä½œæ¨¡å¼åˆ°è¯»æ“ä½œæ¨¡å¼åˆ‡æ¢çš„æ—¶å€™ï¼ˆflipï¼‰ï¼Œposition éƒ½ä¼šå½’é›¶ï¼Œè¿™æ ·å°±å¯ä»¥ä»å¤´å¼€å§‹è¯»å†™äº†ã€‚ Limitï¼šå†™æ“ä½œæ¨¡å¼ä¸‹ï¼Œlimit ä»£è¡¨çš„æ˜¯æœ€å¤§èƒ½å†™å…¥çš„æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™ limit ç­‰äº capacityã€‚å†™ç»“æŸåï¼Œåˆ‡æ¢åˆ°è¯»æ¨¡å¼ï¼Œæ­¤æ—¶çš„ limit ç­‰äº Buffer ä¸­å®é™…çš„æ•°æ®å¤§å°ï¼Œå› ä¸º Buffer ä¸ä¸€å®šè¢«å†™æ»¡äº†ã€‚ 123456public final Buffer flip() &#123; limit = position; // å°† limit è®¾ç½®ä¸ºå®é™…å†™å…¥çš„æ•°æ®æ•°é‡ position = 0; // é‡ç½® position ä¸º 0 mark = -1; // mark ä¹‹åå†è¯´ return this;&#125; mark() &amp; reset() é™¤äº† positionã€limitã€capacity è¿™ä¸‰ä¸ªåŸºæœ¬çš„å±æ€§å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå¸¸ç”¨çš„å±æ€§å°±æ˜¯ markã€‚ mark ç”¨äºä¸´æ—¶ä¿å­˜ position çš„å€¼ï¼Œæ¯æ¬¡è°ƒç”¨ mark() æ–¹æ³•éƒ½ä¼šå°† mark è®¾å€¼ä¸ºå½“å‰çš„ positionï¼Œä¾¿äºåç»­éœ€è¦çš„æ—¶å€™ä½¿ç”¨ã€‚resetç”¨äºè¿”å›ä¿å­˜å€¼ rewind() &amp; clear() &amp; compact() rewind()ï¼šä¼šé‡ç½® position ä¸º 0ï¼Œé€šå¸¸ç”¨äºé‡æ–°ä»å¤´è¯»å†™ Bufferã€‚ clear()ï¼šæœ‰ç‚¹é‡ç½® Buffer çš„æ„æ€ï¼Œç›¸å½“äºé‡æ–°å®ä¾‹åŒ–äº†ä¸€æ · compact()ï¼šå’Œ clear() ä¸€æ ·çš„æ˜¯ï¼Œå®ƒä»¬éƒ½æ˜¯åœ¨å‡†å¤‡å¾€ Buffer å¡«å……æ–°çš„æ•°æ®ä¹‹å‰è°ƒç”¨ã€‚ä½†æ˜¯ä¸åŒåœ¨äºï¼Œè°ƒç”¨è¿™ä¸ªæ–¹æ³•ä»¥åï¼Œä¼šå…ˆå¤„ç†è¿˜æ²¡æœ‰è¯»å–çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ position åˆ° limit ä¹‹é—´çš„æ•°æ®ï¼ˆè¿˜æ²¡æœ‰è¯»è¿‡çš„æ•°æ®ï¼‰ï¼Œå…ˆå°†è¿™äº›æ•°æ®ç§»åˆ°å·¦è¾¹ï¼Œç„¶ååœ¨è¿™ä¸ªåŸºç¡€ä¸Šå†å¼€å§‹å†™å…¥ã€‚å¾ˆæ˜æ˜¾ï¼Œæ­¤æ—¶ limit è¿˜æ˜¯ç­‰äº capacityï¼Œposition æŒ‡å‘åŸæ¥æ•°æ®çš„å³è¾¹ã€‚ Selectorï¼ˆé€‰æ‹©å™¨å¯¹è±¡ï¼‰é¦–å…ˆéœ€è¦äº†è§£ä¸€ä»¶äº‹æƒ…å°±æ˜¯çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ä¼šåœ¨é«˜å¹¶å‘æ—¶å˜å¾—å¾ˆæ˜æ˜¾ï¼Œè¿™æ˜¯åŒæ­¥é˜»å¡æ–¹å¼çš„ä½æ‰©å±•æ€§åŠ£åŠ¿Â· Selectoræ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒå¯ä»¥æ³¨å†Œåˆ°å¾ˆå¤šä¸ªChannelä¸Šï¼Œç›‘å¬å„ä¸ªChannelä¸Šå‘ç”Ÿçš„äº‹ä»¶ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ ¹æ®äº‹ä»¶æƒ…å†µå†³å®šChannelè¯»å†™ã€‚è¿™æ ·ï¼Œé€šè¿‡ä¸€ä¸ªçº¿ç¨‹ç®¡ç†å¤šä¸ªChannelï¼Œå°±å¯ä»¥å¤„ç†å¤§é‡ç½‘ç»œè¿æ¥äº†ã€‚ æœ‰äº†Selectorï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†æ‰€æœ‰çš„channelsã€‚çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢å¯¹æ“ä½œç³»ç»Ÿæ¥è¯´ä»£ä»·æ˜¯å¾ˆé«˜çš„ï¼Œå¹¶ä¸”æ¯ä¸ªçº¿ç¨‹ä¹Ÿä¼šå ç”¨ä¸€å®šçš„ç³»ç»Ÿèµ„æºã€‚æ‰€ä»¥ï¼Œå¯¹ç³»ç»Ÿæ¥è¯´ä½¿ç”¨çš„çº¿ç¨‹è¶Šå°‘è¶Šå¥½ã€‚ 1.å¦‚ä½•åˆ›å»ºä¸€ä¸ªSelector Selector å°±æ˜¯æ‚¨æ³¨å†Œå¯¹å„ç§ I/O äº‹ä»¶å…´è¶£çš„åœ°æ–¹ï¼Œè€Œä¸”å½“é‚£äº›äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå°±æ˜¯è¿™ä¸ªå¯¹è±¡å‘Šè¯‰æ‚¨æ‰€å‘ç”Ÿçš„äº‹ä»¶ã€‚ 1Selector selector = Selector.open(); 2.æ³¨å†ŒChannelåˆ°Selector ä¸ºäº†èƒ½è®©Channelå’ŒSelectoré…åˆä½¿ç”¨ï¼Œæˆ‘ä»¬éœ€è¦æŠŠChannelæ³¨å†Œåˆ°Selectorä¸Šã€‚é€šè¿‡è°ƒç”¨ channel.registerï¼ˆï¼‰æ–¹æ³•æ¥å®ç°æ³¨å†Œï¼š 12channel.configureBlocking(false);SelectionKey key =channel.register(selector,SelectionKey.OP_READ); æ³¨æ„ï¼Œæ³¨å†Œçš„Channel å¿…é¡»è®¾ç½®æˆéé˜»å¡æ¨¡å¼ æ‰å¯ä»¥,å¦åˆ™å¼‚æ­¥IOå°±æ— æ³•å·¥ä½œï¼Œè¿™å°±æ„å‘³ç€æˆ‘ä»¬ä¸èƒ½æŠŠä¸€ä¸ªFileChannelæ³¨å†Œåˆ°Selectorï¼Œå› ä¸ºFileChannelæ²¡æœ‰éé˜»å¡æ¨¡å¼ï¼Œä½†æ˜¯ç½‘ç»œç¼–ç¨‹ä¸­çš„SocketChannelæ˜¯å¯ä»¥çš„ã€‚ 3.è°ƒç”¨ select()æ–¹æ³•è·å–é€šé“ä¿¡æ¯ã€‚ç”¨äºåˆ¤æ–­æ˜¯å¦æœ‰æˆ‘ä»¬æ„Ÿå…´è¶£çš„äº‹ä»¶å·²ç»å‘ç”Ÿäº†ã€‚ äº‹ä»¶ SelectionKey.OP_READ å¯¹åº” 00000001ï¼Œé€šé“ä¸­æœ‰æ•°æ®å¯ä»¥è¿›è¡Œè¯»å– SelectionKey.OP_WRITE å¯¹åº” 00000100ï¼Œå¯ä»¥å¾€é€šé“ä¸­å†™å…¥æ•°æ® SelectionKey.OP_CONNECT å¯¹åº” 00001000ï¼ŒæˆåŠŸå»ºç«‹ TCP è¿æ¥ SelectionKey.OP_ACCEPT å¯¹åº” 00010000ï¼Œæ¥å— TCP è¿æ¥ æˆ‘ä»¬å¯ä»¥åŒæ—¶ç›‘å¬ä¸€ä¸ª Channel ä¸­çš„å‘ç”Ÿçš„å¤šä¸ªäº‹ä»¶ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦ç›‘å¬ ACCEPT å’Œ READ äº‹ä»¶ï¼Œé‚£ä¹ˆæŒ‡å®šå‚æ•°ä¸ºäºŒè¿›åˆ¶çš„ 00010001 å³åè¿›åˆ¶æ•°å€¼ 17 å³å¯ã€‚ æ³¨å†Œæ–¹æ³•è¿”å›å€¼æ˜¯ SelectionKey å®ä¾‹ï¼Œå®ƒåŒ…å«äº† Channel å’Œ Selector ä¿¡æ¯ï¼Œä¹ŸåŒ…æ‹¬äº†ä¸€ä¸ªå«åš Interest Set çš„ä¿¡æ¯ï¼Œå³æˆ‘ä»¬è®¾ç½®çš„æˆ‘ä»¬æ„Ÿå…´è¶£çš„æ­£åœ¨ç›‘å¬çš„äº‹ä»¶é›†åˆã€‚ SelectionKey è¯·æ³¨æ„å¯¹register()çš„è°ƒç”¨çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªSelectionKeyã€‚ SelectionKeyä»£è¡¨è¿™ä¸ªé€šé“åœ¨æ­¤ Selectorä¸Šæ³¨å†Œã€‚å½“æŸä¸ª Selectoré€šçŸ¥æ‚¨æŸä¸ªä¼ å…¥äº‹ä»¶æ—¶ï¼Œå®ƒæ˜¯é€šè¿‡æä¾›å¯¹åº”äºè¯¥äº‹ä»¶çš„ SelectionKeyæ¥è¿›è¡Œçš„ã€‚SelectionKeyè¿˜å¯ä»¥ç”¨äºå–æ¶ˆé€šé“çš„æ³¨å†Œã€‚ SelectionKeyä¸­åŒ…å«å¦‚ä¸‹å±æ€§ï¼š The interest set The ready set The Channel The Selector An attached object (optional) æ–°æŠ€æœ¯NIOçš„ç‰¹æ€§ IOæ˜¯é¢å‘æµçš„ï¼ŒNIOæ˜¯é¢å‘ç¼“å†²çš„ï¼› IOæ˜¯é˜»å¡çš„ï¼ŒNIOæ˜¯éé˜»å¡çš„ï¼› IOæ˜¯å•çº¿ç¨‹çš„ï¼ŒNIO æ˜¯é€šè¿‡é€‰æ‹©å™¨æ¥æ¨¡æ‹Ÿå¤šçº¿ç¨‹çš„ï¼› å†…å­˜æ˜ å°„å†…å­˜æ˜ å°„æ–‡ä»¶(memory-mappedfile)èƒ½è®©ä½ åˆ›å»ºå’Œä¿®æ”¹é‚£äº›å¤§åˆ°æ— æ³•è¯»å…¥å†…å­˜çš„æ–‡ä»¶ã€‚æœ‰äº†å†…å­˜æ˜ å°„æ–‡ä»¶ï¼Œä½ å°±å¯ä»¥è®¤ä¸ºæ–‡ä»¶å·²ç»å…¨éƒ¨è¯»è¿›äº†å†…å­˜ï¼Œç„¶åæŠŠå®ƒå½“æˆä¸€ä¸ªéå¸¸å¤§çš„æ•°ç»„æ¥è®¿é—®äº†ã€‚å°†æ–‡ä»¶çš„ä¸€æ®µåŒºåŸŸæ˜ å°„åˆ°å†…å­˜ä¸­ï¼Œæ¯”ä¼ ç»Ÿçš„æ–‡ä»¶å¤„ç†é€Ÿåº¦è¦å¿«å¾ˆå¤šã€‚å†…å­˜æ˜ å°„æ–‡ä»¶å®ƒè™½ç„¶æœ€ç»ˆä¹Ÿæ˜¯è¦ä»ç£ç›˜è¯»å–æ•°æ®ï¼Œä½†æ˜¯å®ƒå¹¶ä¸éœ€è¦å°†æ•°æ®è¯»å–åˆ°OSå†…æ ¸ç¼“å†²åŒºï¼Œè€Œæ˜¯ç›´æ¥å°†è¿›ç¨‹çš„ç”¨æˆ·ç§æœ‰åœ°å€ç©ºé—´ä¸­çš„ä¸€éƒ¨åˆ†åŒºåŸŸä¸æ–‡ä»¶å¯¹è±¡å»ºç«‹èµ·æ˜ å°„å…³ç³»ï¼Œå°±å¥½åƒç›´æ¥ä»å†…å­˜ä¸­è¯»ã€å†™æ–‡ä»¶ä¸€æ ·ï¼Œé€Ÿåº¦å½“ç„¶å¿«äº†ã€‚ NIOä¸­å†…å­˜æ˜ å°„ä¸»è¦ç”¨åˆ°ä»¥ä¸‹ä¸¤ä¸ªç±»ï¼š java.nio.MappedByteBuffer java.nio.channels.FileChannel æ”¯æŒä¸‰ç§æ¨¡å¼:åªè¯»,åªå†™,ç§æœ‰ å†…å­˜æ˜ å°„æ–‡ä»¶çš„ä¼˜ç‚¹ï¼š ç”¨æˆ·è¿›ç¨‹å°†æ–‡ä»¶æ•°æ®è§†ä¸ºå†…å­˜ï¼Œå› æ­¤ä¸éœ€è¦å‘å‡ºread()æˆ–write()ç³»ç»Ÿè°ƒç”¨ã€‚ å½“ç”¨æˆ·è¿›ç¨‹è§¦æ‘¸æ˜ å°„çš„å†…å­˜ç©ºé—´æ—¶ï¼Œå°†è‡ªåŠ¨ç”Ÿæˆé¡µé¢é”™è¯¯ï¼Œä»¥ä»ç£ç›˜å¼•å…¥æ–‡ä»¶æ•°æ®ã€‚ å¦‚æœç”¨ä¿®æ”¹æ˜ å°„çš„å†…å­˜ç©ºé—´ï¼Œå—å½±å“çš„é¡µé¢å°†è‡ªåŠ¨æ ‡è®°ä¸ºè„ï¼Œå¹¶éšååˆ·æ–°åˆ°ç£ç›˜ä»¥æ›´æ–°æ–‡ä»¶ã€‚ æ“ä½œç³»ç»Ÿçš„è™šæ‹Ÿå†…å­˜å­ç³»ç»Ÿå°†æ‰§è¡Œé¡µé¢çš„æ™ºèƒ½ç¼“å­˜ï¼Œæ ¹æ®ç³»ç»Ÿè´Ÿè½½è‡ªåŠ¨ç®¡ç†å†…å­˜ã€‚ æ•°æ®å§‹ç»ˆæ˜¯é¡µé¢å¯¹é½çš„ï¼Œä¸éœ€è¦ç¼“å†²åŒºå¤åˆ¶ã€‚ å¯ä»¥æ˜ å°„éå¸¸å¤§çš„æ–‡ä»¶ï¼Œè€Œä¸æ¶ˆè€—å¤§é‡å†…å­˜æ¥å¤åˆ¶æ•°æ®ã€‚ å­—ç¬¦å’Œç¼–ç å¤§éƒ¨åˆ†çš„æ“ä½œç³»ç»Ÿåœ¨I/Oä¸æ–‡ä»¶å­˜å‚¨æ–¹é¢ä»æ˜¯ä»¥å­—èŠ‚ä¸ºå¯¼å‘çš„ï¼Œæ‰€ä»¥æ— è®ºä½¿ç”¨ä½•ç§ç¼–ç ï¼ŒUnicodeæˆ–å…¶ä»–ç¼–ç ï¼Œåœ¨å­—èŠ‚åºåˆ—å’Œå­—ç¬¦é›†ç¼–ç ä¹‹é—´ä»éœ€è¦è¿›è¡Œè½¬åŒ–ã€‚ åœ¨NIOä¸­æä¾›äº†ä¸¤ä¸ªç±»CharsetEncoderå’ŒCharsetDecoderæ¥å®ç°ç¼–ç è½¬æ¢æ–¹æ¡ˆ CharsetEncoderç±»æ˜¯ä¸€ä¸ªçŠ¶æ€ç¼–ç å¼•æ“ã€‚å®é™…ä¸Šï¼Œç¼–ç å™¨æœ‰çŠ¶æ€æ„å‘³ç€å®ƒä»¬ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ 12345678910111213141516171819202122//nioå­—ç¬¦é›†ç¼–ç public class testCharacter &#123; public static void main(String[] a)&#123; //è®¾ç½®ç¼–ç å™¨ Charset charset = Charset.forName("GBK"); //è·å–ç¼“å†²å™¨ CharBuffer charBuffer = CharBuffer.allocate(1024); charBuffer.put("skdfnså²å¯æ³•ä½ 00"); //ç¼–ç  charBuffer.flip(); ByteBuffer byteBuffer = charset.encode(charBuffer); for(int i = 0;i &lt; byteBuffer.limit();i ++)&#123; System.out.println(byteBuffer.get()); &#125; //è§£ç  byteBuffer.flip(); CharBuffer charBuffer1 = charset.decode(byteBuffer); for(int i = 0;i &lt; charBuffer1.limit();i ++)&#123; System.out.println(charBuffer1.get()); &#125; &#125;&#125; éé˜»å¡IONIO çš„éé˜»å¡ I/O æœºåˆ¶æ˜¯å›´ç»• é€‰æ‹©å™¨å’Œ é€šé“æ„å»ºçš„ã€‚ Channel ç±»è¡¨ç¤ºæœåŠ¡å™¨å’Œå®¢æˆ·æœºä¹‹é—´çš„ä¸€ç§é€šä¿¡æœºåˆ¶ã€‚Selector ç±»æ˜¯ Channel çš„å¤šè·¯å¤ç”¨å™¨ã€‚ Selector ç±»å°†ä¼ å…¥å®¢æˆ·æœºè¯·æ±‚å¤šè·¯åˆ†ç”¨å¹¶å°†å®ƒä»¬åˆ†æ´¾åˆ°å„è‡ªçš„è¯·æ±‚å¤„ç†ç¨‹åºã€‚NIO è®¾è®¡èƒŒåçš„åŸºçŸ³æ˜¯ååº”å™¨(Reactor)è®¾è®¡æ¨¡å¼ã€‚ Reactorè´Ÿè´£IOäº‹ä»¶çš„å“åº”ï¼Œä¸€æ—¦æœ‰äº‹ä»¶å‘ç”Ÿï¼Œä¾¿å¹¿æ’­å‘é€ç»™ç›¸åº”çš„handlerå»å¤„ç† åœ¨Reactoræ¨¡å¼ä¸­ï¼ŒåŒ…å«å¦‚ä¸‹è§’è‰²ï¼š Reactor å°†I/Oäº‹ä»¶å‘æ´¾ç»™å¯¹åº”çš„Handler Acceptor å¤„ç†å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚ Handlers æ‰§è¡Œéé˜»å¡è¯»/å†™ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374public class NIOServer &#123; private static final Logger LOGGER = LoggerFactory.getLogger(NIOServer.class); public static void main(String[] args) throws IOException &#123; Selector selector = Selector.open(); ServerSocketChannel serverSocketChannel = ServerSocketChannel.open(); serverSocketChannel.configureBlocking(false); serverSocketChannel.bind(new InetSocketAddress(1234)); serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT); while (true) &#123; if(selector.selectNow() &lt; 0) &#123; continue; &#125; //è·å–æ³¨å†Œçš„channel Set&lt;SelectionKey&gt; keys = selector.selectedKeys(); //éå†æ‰€æœ‰çš„key Iterator&lt;SelectionKey&gt; iterator = keys.iterator(); while(iterator.hasNext()) &#123; SelectionKey key = iterator.next(); iterator.remove(); //å¦‚æœé€šé“ä¸Šæœ‰äº‹ä»¶å‘ç”Ÿ if (key.isAcceptable()) &#123; //è·å–è¯¥é€šé“ ServerSocketChannel acceptServerSocketChannel = (ServerSocketChannel) key.channel(); SocketChannel socketChannel = acceptServerSocketChannel.accept(); socketChannel.configureBlocking(false); LOGGER.info("Accept request from &#123;&#125;", socketChannel.getRemoteAddress()); //åŒæ—¶å°†SelectionKeyæ ‡è®°ä¸ºå¯è¯»ï¼Œä»¥ä¾¿è¯»å–ã€‚ SelectionKey readKey = socketChannel.register(selector, SelectionKey.OP_READ); //åˆ©ç”¨SelectionKeyçš„attacheåŠŸèƒ½ç»‘å®šAcceptor å¦‚æœæœ‰äº‹æƒ…ï¼Œè§¦å‘Acceptor //Processorå¯¹è±¡ä¸ºè‡ªå®šä¹‰å¤„ç†è¯·æ±‚çš„ç±» readKey.attach(new Processor()); &#125; else if (key.isReadable()) &#123; Processor processor = (Processor) key.attachment(); processor.process(key); &#125; &#125; &#125; &#125;&#125;/** * Processorç±»ä¸­è®¾ç½®ä¸€ä¸ªçº¿ç¨‹æ± æ¥å¤„ç†è¯·æ±‚ï¼Œ * è¿™æ ·å°±å¯ä»¥å……åˆ†åˆ©ç”¨å¤šçº¿ç¨‹çš„ä¼˜åŠ¿ */class Processor &#123; private static final Logger LOGGER = LoggerFactory.getLogger(Processor.class); private static final ExecutorService service = Executors.newFixedThreadPool(16); public void process(final SelectionKey selectionKey) &#123; service.submit(new Runnable() &#123; @Override public void run() &#123; ByteBuffer buffer = null; SocketChannel socketChannel = null; try &#123; buffer = ByteBuffer.allocate(1024); socketChannel = (SocketChannel) selectionKey.channel(); int count = socketChannel.read(buffer); if (count &lt; 0) &#123; socketChannel.close(); selectionKey.cancel(); LOGGER.info("&#123;&#125;\t Read ended", socketChannel); &#125; else if(count == 0) &#123; &#125; &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; LOGGER.info("&#123;&#125;\t Read message &#123;&#125;", socketChannel, new String(buffer.array())); &#125; &#125;); &#125;&#125; å¤šè·¯å¤ç”¨IOä¸ºä½•æ¯”éé˜»å¡IOæ¨¡å‹çš„æ•ˆç‡é«˜æ˜¯å› ä¸ºåœ¨éé˜»å¡IOä¸­ï¼Œä¸æ–­åœ°è¯¢é—®socketçŠ¶æ€æ—¶é€šè¿‡ç”¨æˆ·çº¿ç¨‹å»è¿›è¡Œçš„ï¼Œè€Œåœ¨å¤šè·¯å¤ç”¨IOä¸­ï¼Œè½®è¯¢æ¯ä¸ªsocketçŠ¶æ€æ˜¯å†…æ ¸åœ¨è¿›è¡Œçš„ï¼Œè¿™ä¸ªæ•ˆç‡è¦æ¯”ç”¨æˆ·çº¿ç¨‹è¦é«˜çš„å¤šã€‚ æ–‡ä»¶é”å®š12345678910// å¦‚æœè¯·æ±‚çš„é”å®šèŒƒå›´æ˜¯æœ‰æ•ˆçš„ï¼Œé˜»å¡ç›´è‡³è·å–é” public final FileLock lock() // å°è¯•è·å–é”éé˜»å¡ï¼Œç«‹åˆ»è¿”å›ç»“æœ public final FileLock tryLock() // ç¬¬ä¸€ä¸ªå‚æ•°ï¼šè¦é”å®šåŒºåŸŸçš„èµ·å§‹ä½ç½® // ç¬¬äºŒä¸ªå‚æ•°ï¼šè¦é”å®šåŒºåŸŸçš„å°ºå¯¸, // ç¬¬ä¸‰ä¸ªå‚æ•°ï¼štrueä¸ºå…±äº«é”ï¼Œfalseä¸ºç‹¬å é” public abstract FileLock lock (long position, long size, boolean shared) public abstract FileLock tryLock (long position, long size, boolean shared) NIO AsynchronousFileChannelå¼‚æ­¥æ–‡ä»¶é€šé“AIOJava å¼‚æ­¥ IO æä¾›äº†ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯è¿”å› Future å®ä¾‹å’Œä½¿ç”¨å›è°ƒå‡½æ•°ã€‚ è¿”å›Futureå®ä¾‹ future.isDone(); åˆ¤æ–­æ“ä½œæ˜¯å¦å·²ç»å®Œæˆï¼ŒåŒ…æ‹¬äº†æ­£å¸¸å®Œæˆã€å¼‚å¸¸æŠ›å‡ºã€å–æ¶ˆ future.cancel(true); å–æ¶ˆæ“ä½œï¼Œæ–¹å¼æ˜¯ä¸­æ–­ã€‚å‚æ•° true è¯´çš„æ˜¯ï¼Œå³ä½¿è¿™ä¸ªä»»åŠ¡æ­£åœ¨æ‰§è¡Œï¼Œä¹Ÿä¼šè¿›è¡Œä¸­æ–­ã€‚ future.isCancelled(); æ˜¯å¦è¢«å–æ¶ˆï¼Œåªæœ‰åœ¨ä»»åŠ¡æ­£å¸¸ç»“æŸä¹‹å‰è¢«å–æ¶ˆï¼Œè¿™ä¸ªæ–¹æ³•æ‰ä¼šè¿”å› true future.get(); è¿™æ˜¯æˆ‘ä»¬çš„è€æœ‹å‹ï¼Œè·å–æ‰§è¡Œç»“æœï¼Œé˜»å¡ã€‚ future.get(10, TimeUnit.SECONDS); å¦‚æœä¸Šé¢çš„ get() æ–¹æ³•çš„é˜»å¡ä½ ä¸æ»¡æ„ï¼Œé‚£å°±è®¾ç½®ä¸ªè¶…æ—¶æ—¶é—´ã€‚ æä¾› CompletionHandler å›è°ƒå‡½æ•° ç”¨æ³• æ³¨æ„ï¼Œå‚æ•°ä¸Šæœ‰ä¸ª attachmentï¼Œè™½ç„¶ä¸å¸¸ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å„ä¸ªæ”¯æŒçš„æ–¹æ³•ä¸­ä¼ é€’è¿™ä¸ªå‚æ•°å€¼ 123456789101112AsynchronousServerSocketChannel listener = AsynchronousServerSocketChannel.open().bind(null);// accept æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥ä¼ é€’ attachmentlistener.accept(attachment, new CompletionHandler&lt;AsynchronousSocketChannel, Object&gt;() &#123; public void completed( AsynchronousSocketChannel client, Object attachment) &#123; // &#125; public void failed(Throwable exc, Object attachment) &#123; // &#125;&#125;); ChannelAsynchronousFileChannelAIO çš„è¯»å†™ä¸»è¦ä¹Ÿè¿˜æ˜¯ä¸ Buffer æ‰“äº¤é“ï¼Œè¿™ä¸ªä¸ NIO æ˜¯ä¸€è„‰ç›¸æ‰¿çš„ã€‚ å¦å¤–ï¼Œè¿˜æä¾›äº†ç”¨äºå°†å†…å­˜ä¸­çš„æ•°æ®åˆ·å…¥åˆ°ç£ç›˜çš„æ–¹æ³•ï¼š 1public abstract void force(boolean metaData) throws IOException; å› ä¸ºæˆ‘ä»¬å¯¹æ–‡ä»¶çš„å†™æ“ä½œï¼Œæ“ä½œç³»ç»Ÿå¹¶ä¸ä¼šç›´æ¥é’ˆå¯¹æ–‡ä»¶æ“ä½œï¼Œç³»ç»Ÿä¼šç¼“å­˜ï¼Œç„¶åå‘¨æœŸæ€§åœ°åˆ·å…¥åˆ°ç£ç›˜ã€‚å¦‚æœå¸Œæœ›å°†æ•°æ®åŠæ—¶å†™å…¥åˆ°ç£ç›˜ä¸­ï¼Œä»¥å…æ–­ç”µå¼•å‘éƒ¨åˆ†æ•°æ®ä¸¢å¤±ï¼Œå¯ä»¥è°ƒç”¨æ­¤æ–¹æ³•ã€‚å‚æ•°å¦‚æœè®¾ç½®ä¸º trueï¼Œæ„å‘³ç€åŒæ—¶ä¹Ÿå°†æ–‡ä»¶å±æ€§ä¿¡æ¯æ›´æ–°åˆ°ç£ç›˜ã€‚ è¿˜æœ‰ï¼Œè¿˜æä¾›äº†å¯¹æ–‡ä»¶çš„é”å®šåŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥é”å®šæ–‡ä»¶çš„éƒ¨åˆ†æ•°æ®ï¼Œè¿™æ ·å¯ä»¥è¿›è¡Œæ’ä»–æ€§çš„æ“ä½œã€‚ 1public abstract Future&lt;FileLock&gt; lock(long position, long size, boolean shared); position æ˜¯è¦é”å®šå†…å®¹çš„å¼€å§‹ä½ç½®ï¼Œsize æŒ‡ç¤ºäº†è¦é”å®šçš„åŒºåŸŸå¤§å°ï¼Œshared æŒ‡ç¤ºéœ€è¦çš„æ˜¯å…±äº«é”è¿˜æ˜¯æ’ä»–é” æ³¨æ„: AsynchronousFileChannels ä¸å±äº groupã€‚ä½†æ˜¯å®ƒä»¬ä¹Ÿæ˜¯å…³è”åˆ°ä¸€ä¸ªçº¿ç¨‹æ± çš„ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œä¼šä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„çº¿ç¨‹æ± ï¼Œå¦‚æœæƒ³è¦ä½¿ç”¨æŒ‡å®šçš„çº¿ç¨‹æ± ï¼Œå¯ä»¥åœ¨å®ä¾‹åŒ–çš„æ—¶å€™ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š 123456public static AsynchronousFileChannel open(Path file, Set&lt;? extends OpenOption&gt; options, ExecutorService executor, FileAttribute&lt;?&gt;... attrs) &#123; ...&#125; AsynchronousServerSocketChannelAsynchronousSocketChannelAsynchronous Channel Groups å¼‚æ­¥ IO ä¸€å®šå­˜åœ¨ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œè¿™ä¸ªçº¿ç¨‹æ± è´Ÿè´£æ¥æ”¶ä»»åŠ¡ã€å¤„ç† IO äº‹ä»¶ã€å›è°ƒç­‰ã€‚è¿™ä¸ªçº¿ç¨‹æ± å°±åœ¨ group å†…éƒ¨ï¼Œgroup ä¸€æ—¦å…³é—­ï¼Œé‚£ä¹ˆç›¸åº”çš„çº¿ç¨‹æ± å°±ä¼šå…³é—­ã€‚ AsynchronousServerSocketChannels å’Œ AsynchronousSocketChannels æ˜¯å±äº group çš„ï¼Œå½“æˆ‘ä»¬è°ƒç”¨ AsynchronousServerSocketChannel æˆ– AsynchronousSocketChannel çš„ open() æ–¹æ³•çš„æ—¶å€™ï¼Œç›¸åº”çš„ channel å°±å±äºé»˜è®¤çš„ groupï¼Œè¿™ä¸ª group ç”± JVM è‡ªåŠ¨æ„é€ å¹¶ç®¡ç†ã€‚ æƒ³è¦ä½¿ç”¨è‡ªå·±å®šä¹‰çš„ groupï¼Œè¿™æ ·å¯ä»¥å¯¹å…¶ä¸­çš„çº¿ç¨‹è¿›è¡Œæ›´å¤šçš„æ§åˆ¶ï¼Œä½¿ç”¨ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•å³å¯ï¼š AsynchronousChannelGroup.withCachedThreadPool(ExecutorService executor, int initialSize) AsynchronousChannelGroup.withFixedJava éé˜»å¡ IO å’Œå¼‚æ­¥ IOThreadPool(int nThreads, ThreadFactory threadFactory) AsynchronousChannelGroup.withThreadPool(ExecutorService executor) Java éé˜»å¡ IO å’Œå¼‚æ­¥ IO äº‹ä»¶é©±åŠ¨æ¨¡å‹å’Œæ¶ˆæ¯é©±åŠ¨æ¨¡å‹äº‹ä»¶é©±é©±åŠ¨æ¶æ„ç”±ä¸‰ä¸ªåŸºæœ¬ç»„ä»¶æ„æˆï¼Œäº‹ä»¶ã€äº‹ä»¶å¤„ç†å™¨ã€äº‹ä»¶å¾ªç¯ã€‚äº‹ä»¶äº§ç”Ÿåå‘é€ç»™äº‹ä»¶å¾ªç¯ï¼Œäº‹ä»¶å¾ªç¯å°†æ¯ä¸ªäº‹ä»¶åˆ†æ´¾ç»™ä¸ªå„ä¸ªäº‹ä»¶å¤„ç†å™¨ã€‚äº‹ä»¶Aç”±å¤„ç†å™¨Aå¤„ç†ï¼Œäº‹ä»¶Bå°†è¢«å¤„ç†å™¨Bå¤„ç†ã€‚ select poll epoll ServletWebå®¹å™¨servletå·¥ä½œåŸç†ä¹‹tomcatç¯‡ Webå®¹å™¨æ˜¯ä¸€ç§æœåŠ¡ç¨‹åºï¼Œç»™å¤„äºå…¶ä¸­çš„åº”ç”¨ç¨‹åºç»„ä»¶æä¾›ç¯å¢ƒï¼Œä½¿å…¶ç›´æ¥è·Ÿå®¹å™¨ä¸­çš„ç¯å¢ƒå˜é‡äº¤äº’ï¼Œä¸å¿…å…³æ³¨å…¶å®ƒç³»ç»Ÿé—®é¢˜ã€‚ä¸»è¦ç”±åº”ç”¨æœåŠ¡å™¨æ¥å®ç°ï¼Œå¦‚Tomcatã€JBossã€Weblogicã€WebSphereç­‰ã€‚ Servletå®¹å™¨çš„ä¸»è¦ä»»åŠ¡æ˜¯ç®¡ç†Servletçš„ç”Ÿå‘½å‘¨æœŸï¼Œè€ŒWebå®¹å™¨ä¸»è¦ä»»åŠ¡æ˜¯ç®¡ç†Webåº”ç”¨ç¨‹åºã€‚ ä¸€ä¸ªwebåº”ç”¨å¯¹åº”ä¸€ä¸ªcontextå®¹å™¨ï¼Œæ·»åŠ ä¸€ä¸ªåº”ç”¨æ—¶å°†ä¼šåˆ›å»ºä¸€ä¸ªStandardContextå®¹å™¨ï¼Œå¹¶ä¸”ç»™è¿™ä¸ªcontextå®¹å™¨è®¾ç½®å¿…è¦çš„å‚æ•°ï¼Œurlå’Œpathåˆ†åˆ«ä»£è¡¨è¿™ä¸ªåº”ç”¨åœ¨tomcatä¸­çš„è®¿é—®è·¯å¾„å’Œè¿™ä¸ªåº”ç”¨å®é™…çš„ç‰©ç†è·¯å¾„ã€‚å…¶ä¸­æœ€é‡è¦çš„ä¸€ä¸ªé…ç½®æ˜¯ContextConfigï¼Œè¿™ä¸ªç±»å°†ä¼šè´Ÿè´£æ•´ä¸ªwebåº”ç”¨é…ç½®çš„è§£æå·¥ä½œï¼Œæœ€åå°†è¿™ä¸ªcontextå®¹å™¨åŠ åˆ°çˆ¶å®¹å™¨hostä¸­ã€‚ servlet æŠ½è±¡ç±»HttpServletç»§æ‰¿æŠ½è±¡ç±»GenericServletï¼Œå…¶æœ‰ä¸¤ä¸ªæ¯”è¾ƒå…³é”®çš„æ–¹æ³•ï¼ŒdoGet()å’ŒdoPost() GenericServletå®ç°æ¥å£Servlet,ServletConfig,Serializable MyServlet(ç”¨æˆ·è‡ªå®šä¹‰Servletç±»)ç»§æ‰¿HttpServletï¼Œé‡å†™æŠ½è±¡ç±»HttpServletçš„doGet()å’ŒdoPost()æ–¹æ³• æ³¨ï¼šä»»ä½•ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰Servletï¼Œåªéœ€é‡å†™æŠ½è±¡ç±»HttpServletçš„doPost()å’ŒdoGet()å³å¯ å®¹å™¨ä¸­çš„æ‰§è¡Œè¿‡ç¨‹ Servletåªæœ‰æ”¾åœ¨å®¹å™¨ä¸­ï¼Œæ–¹å¯æ‰§è¡Œï¼Œä¸”Servletå®¹å™¨ç§ç±»è¾ƒå¤šï¼Œå¦‚Tomcat,WebLogicç­‰ã€‚ä¸‹å›¾ä¸ºç®€å•çš„ è¯·æ±‚å“åº” æ¨¡å‹ã€‚ åˆ†æï¼š 1.æµè§ˆå™¨å‘æœåŠ¡å™¨å‘å‡ºGETè¯·æ±‚(è¯·æ±‚æœåŠ¡å™¨ServletA) 2.æœåŠ¡å™¨ä¸Šçš„å®¹å™¨é€»è¾‘æ¥æ”¶åˆ°è¯¥url,æ ¹æ®è¯¥urlåˆ¤æ–­ä¸ºServletè¯·æ±‚ï¼Œæ­¤æ—¶å®¹å™¨é€»è¾‘å°†äº§ç”Ÿä¸¤ä¸ªå¯¹è±¡ï¼šè¯·æ±‚å¯¹è±¡(HttpServletRequest)å’Œå“åº”å¯¹è±¡(HttpServletResponce) 3.å®¹å™¨é€»è¾‘æ ¹æ®urlæ‰¾åˆ°ç›®æ ‡Servlet(æœ¬ç¤ºä¾‹ç›®æ ‡Servletä¸ºServletA),ä¸”åˆ›å»ºä¸€ä¸ªçº¿ç¨‹A 4.å®¹å™¨é€»è¾‘å°†åˆšæ‰åˆ›å»ºçš„è¯·æ±‚å¯¹è±¡å’Œå“åº”å¯¹è±¡ä¼ é€’ç»™çº¿ç¨‹A 5.å®¹å™¨é€»è¾‘è°ƒç”¨Servletçš„service()æ–¹æ³• 6.service()æ–¹æ³•æ ¹æ®è¯·æ±‚ç±»å‹(æœ¬ç¤ºä¾‹ä¸ºGETè¯·æ±‚)è°ƒç”¨doGet()(æœ¬ç¤ºä¾‹è°ƒç”¨doGet())æˆ–doPost()æ–¹æ³• 7.doGet()æ‰§è¡Œå®Œåï¼Œå°†ç»“æœè¿”å›ç»™å®¹å™¨é€»è¾‘ 8.çº¿ç¨‹Aè¢«é”€æ¯æˆ–è¢«æ”¾åœ¨çº¿ç¨‹æ± ä¸­ æ³¨æ„ï¼š 1.åœ¨å®¹å™¨ä¸­çš„æ¯ä¸ªServletåŸåˆ™ä¸Šåªæœ‰ä¸€ä¸ªå®ä¾‹ 2.æ¯ä¸ªè¯·æ±‚å¯¹åº”ä¸€ä¸ªçº¿ç¨‹ 3.å¤šä¸ªçº¿ç¨‹å¯ä½œç”¨äºåŒä¸€ä¸ªServlet(è¿™æ˜¯é€ æˆServletçº¿ç¨‹ä¸å®‰å…¨çš„æ ¹æœ¬åŸå› ) 4.æ¯ä¸ªçº¿ç¨‹ä¸€æ—¦æ‰§è¡Œå®Œä»»åŠ¡ï¼Œå°±è¢«é”€æ¯æˆ–æ”¾åœ¨çº¿ç¨‹æ± ä¸­ç­‰å¾…å›æ”¶ åœ¨JavaWebä¸­æ‰®æ¼”çš„è§’è‰² Servletåœ¨JavaWebä¸­ï¼Œæ‰®æ¼”ä¸¤ä¸ªè§’è‰²ï¼šé¡µé¢è§’è‰²å’Œæ§åˆ¶å™¨è§’è‰²(æ›´å¤š)ã€‚ ç”Ÿå‘½å‘¨æœŸ ç¬¬ä¸€æ­¥ï¼šå®¹å™¨å…ˆåŠ è½½Servletç±» ç¬¬äºŒæ­¥ï¼šå®¹å™¨å®ä¾‹åŒ–Servlet(Servletæ— å‚æ„é€ å‡½æ•°æ‰§è¡Œ) ç¬¬ä¸‰æ­¥ï¼šæ‰§è¡Œinit()æ–¹æ³•ï¼ˆåœ¨Servletç”Ÿå‘½å‘¨æœŸä¸­ï¼Œåªæ‰§è¡Œä¸€æ¬¡ï¼Œä¸”åœ¨service()æ–¹æ³•æ‰§è¡Œå‰æ‰§è¡Œï¼‰ ç¬¬å››æ­¥ï¼šæ‰§è¡Œservice()æ–¹æ³•ï¼Œå¤„ç†å®¢æˆ·è¯·æ±‚ï¼ŒdoPost()æˆ–doGet() ç¬¬äº”æ­¥ï¼šæ‰§è¡Œdestroy()ï¼Œé”€æ¯çº¿ç¨‹ BigDecimal ä¿ç•™ä¸¤ä½å°æ•°çš„æ–¹æ³• BigDecimalçš„setScal()æ–¹æ³• System.out.println(â€œ%2fâ€,a); NumberFormat DecimalFormatçš„formatæ–¹æ³• 1234567891011121314151617181920212223public class Format&#123; double f = 111231.5585; public void m1()&#123; BigDecimal bg = new BigDecimal(f); double f1 = bg.setScale(2,BigDecimal.ROUND_HALF_UP).doubleValue(); &#125; public void m2()&#123; DecimalFormat df = new DecimalFormat("#.00"); Sytem.out.println(df.format(f)); &#125; public void m3()&#123; System.out.printlin(String.format()".%2f",f); &#125; public void m4() &#123; NumberFormat nf = NumberFormat.getNumberInstance(); nf.setMaximumFractionDigits(2); System.out.println(nf.format(f)); &#125;&#125; å½“doubleå¿…é¡»ç”¨ä½œBigDecimalçš„æºæ—¶ï¼Œè¯·ä½¿ç”¨Double.toString(double)è½¬æˆStringï¼Œç„¶å`ä½¿ç”¨Stringæ„é€ æ–¹æ³•ï¼Œæˆ–ä½¿ç”¨BigDecimalçš„é™æ€æ–¹æ³•valueOfï¼Œå¦‚ä¸‹ 123456789public static void main(String[] args) &#123; BigDecimal bDouble1 = BigDecimal.valueOf(2.3); BigDecimal bDouble2 = new BigDecimal(Double.toString(2.3)); System.out.println("bDouble1=" + bDouble1); System.out.println("bDouble2=" + bDouble2); &#125; å››åˆ™è¿ç®—1public BigDecimal divide(BigDecimal divisor, int scale, int roundingMode) 123456789101112131415ROUND_CEILING //å‘æ­£æ— ç©·æ–¹å‘èˆå…¥ROUND_DOWN //å‘é›¶æ–¹å‘èˆå…¥ROUND_FLOOR //å‘è´Ÿæ— ç©·æ–¹å‘èˆå…¥ROUND_HALF_DOWN //å‘ï¼ˆè·ç¦»ï¼‰æœ€è¿‘çš„ä¸€è¾¹èˆå…¥ï¼Œé™¤éä¸¤è¾¹ï¼ˆçš„è·ç¦»ï¼‰æ˜¯ç›¸ç­‰,å¦‚æœæ˜¯è¿™æ ·ï¼Œå‘ä¸‹èˆå…¥, ä¾‹å¦‚1.55 ä¿ç•™ä¸€ä½å°æ•°ç»“æœä¸º1.5ROUND_HALF_EVEN //å‘ï¼ˆè·ç¦»ï¼‰æœ€è¿‘çš„ä¸€è¾¹èˆå…¥ï¼Œé™¤éä¸¤è¾¹ï¼ˆçš„è·ç¦»ï¼‰æ˜¯ç›¸ç­‰,å¦‚æœæ˜¯è¿™æ ·ï¼Œå¦‚æœä¿ç•™ä½æ•°æ˜¯å¥‡æ•°ï¼Œä½¿ç”¨ROUND_HALF_UPï¼Œå¦‚æœæ˜¯å¶æ•°ï¼Œä½¿ç”¨ROUND_HALF_DOWNROUND_HALF_UP //å‘ï¼ˆè·ç¦»ï¼‰æœ€è¿‘çš„ä¸€è¾¹èˆå…¥ï¼Œé™¤éä¸¤è¾¹ï¼ˆçš„è·ç¦»ï¼‰æ˜¯ç›¸ç­‰,å¦‚æœæ˜¯è¿™æ ·ï¼Œå‘ä¸Šèˆå…¥, 1.55ä¿ç•™ä¸€ä½å°æ•°ç»“æœä¸º1.6ROUND_UNNECESSARY //è®¡ç®—ç»“æœæ˜¯ç²¾ç¡®çš„ï¼Œä¸éœ€è¦èˆå…¥æ¨¡å¼ROUND_UP //å‘è¿œç¦»0çš„æ–¹å‘èˆå…¥ (1)å•†ä¸šè®¡ç®—ä½¿ç”¨BigDecimalã€‚ (2)å°½é‡ä½¿ç”¨å‚æ•°ç±»å‹ä¸ºStringçš„æ„é€ å‡½æ•°ã€‚ (3) BigDecimaléƒ½æ˜¯ä¸å¯å˜çš„ï¼ˆimmutableï¼‰çš„ï¼Œåœ¨è¿›è¡Œæ¯ä¸€æ­¥è¿ç®—æ—¶ï¼Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œæ‰€ä»¥åœ¨åšåŠ å‡ä¹˜é™¤è¿ç®—æ—¶åƒä¸‡è¦ä¿å­˜æ“ä½œåçš„å€¼ã€‚ æšä¸¾EnumSetå’ŒEnumMapEnumMapæ˜¯ä¸“é—¨ä¸ºæšä¸¾ç±»å‹é‡èº«å®šåšçš„Mapå®ç°ã€‚è™½ç„¶ä½¿ç”¨å…¶å®ƒçš„Mapå®ç°ï¼ˆå¦‚HashMapï¼‰ä¹Ÿèƒ½å®Œæˆæšä¸¾ç±»å‹å®ä¾‹åˆ°å€¼å¾—æ˜ å°„ï¼Œä½†æ˜¯ä½¿ç”¨EnumMapä¼šæ›´åŠ é«˜æ•ˆï¼šå®ƒåªèƒ½æ¥æ”¶åŒä¸€æšä¸¾ç±»å‹çš„å®ä¾‹ä½œä¸ºé”®å€¼ï¼Œå¹¶ä¸”ç”±äºæšä¸¾ç±»å‹å®ä¾‹çš„æ•°é‡ç›¸å¯¹å›ºå®šå¹¶ä¸”æœ‰é™ï¼Œæ‰€ä»¥EnumMapä½¿ç”¨æ•°ç»„æ¥å­˜æ”¾ä¸æšä¸¾ç±»å‹å¯¹åº”çš„å€¼ã€‚è¿™ä½¿å¾—EnumMapçš„æ•ˆç‡éå¸¸é«˜ã€‚EnumMapåœ¨å†…éƒ¨ä½¿ç”¨æšä¸¾ç±»å‹çš„ordinal()å¾—åˆ°å½“å‰å®ä¾‹çš„å£°æ˜æ¬¡åºï¼Œå¹¶ä½¿ç”¨è¿™ä¸ªæ¬¡åºç»´æŠ¤æšä¸¾ç±»å‹å®ä¾‹å¯¹åº”å€¼åœ¨æ•°ç»„çš„ä½ç½®ã€‚ 1ã€çˆ¶ç±»ä¸ºAbstractMapï¼Œæœªå®ç°Mapæ¥å£ï¼Œåªå®ç°äº†Cloneableå’ŒSerializableæ¥å£ã€‚ 2ã€éçº¿ç¨‹å®‰å…¨ï¼Œæ‰€æœ‰æ–¹æ³•å’Œæ“ä½œéƒ½æœªåŠ é”ã€‚ 3ã€é‡‡ç”¨keyæ•°ç»„å’Œvalsæ•°ç»„å…±åŒå®ç°keyå’Œvalueçš„å…³è”ã€‚ 4ã€ä¸å…è®¸null keyï¼Œä½†å…è®¸null valueã€‚ 5ã€nullå€¼ä¼šè¢«è½¬æ¢ä¸ºObjectçš„NULLå®ä¾‹å ä½æ›¿æ¢ã€‚ 6ã€å…ƒç´ çš„å­˜å‚¨é¡ºåºæŒ‰ç…§æšä¸¾å€¼çš„å£°æ˜æ¬¡åºå­˜å‚¨ã€‚]]></content>
      <categories>
        <category>å­¦ä¹ ç¬”è®°</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ­å»ºä¸€ä¸ªé˜²ç«å¢™natæ‹“æ‰‘]]></title>
    <url>%2F2019%2F10%2F15%2Fnat-topo%2F</url>
    <content type="text"><![CDATA[enspçœŸæ˜¯æœ‰æ¯’ã€‚ã€‚æ˜¨å¤©æ­»æ´»pingä¸é€šçš„è·¯ç”±ä»Šå¤©é‡å¯å°±å¯ä»¥pingé€šäº†ï¼Ÿï¼Ÿäºæˆ‘æ˜¨å¤©æ’æŸ¥äº†ä¸€æ™šä¸Šã€‚ã€‚ è®°å½•ä¸€æ¬¡æ­å»ºå¤§å‹çš„ç½‘ç»œæ‹“æ‰‘ï¼Œå…ˆçœ‹çœ‹æ€»çš„æ‹“æ‰‘ç»“æ„ï¼š è¿™æ˜¯ä¸€ä¸ªå¤§å‹å…¬å¸çš„ç»„ç½‘æ–¹æ¡ˆï¼Œæ€»éƒ¨æ”¾åœ¨å†…ç½‘192.168.0.0ï¼Œ è¿™é‡Œä»¥å››ä¸ªPCä½œä¸ºä»£æ›¿çš„å››ä¸ªåˆ†éƒ¨é—¨ï¼Œå››éƒ¨é—¨ä¹‹é—´å¯ä»¥é…ç½®VLANå®ç°äº’é€šæˆ–è€…é™åˆ¶æŸä¸€éƒ¨é—¨ä¸é€šã€‚ è¿æ¥éƒ¨é—¨çš„æ˜¯ä¸¤å°æ ¸å¿ƒäº¤æ¢æœºï¼Œä½œä¸ºæ±‡èšå±‚ã€‚äº¤æ¢æœºä¸Šå®ç°ä¸»å¤‡å¤‡ä»½å¹¶åœ¨å…³é”®é“¾è·¯å®ç°é“¾è·¯èšåˆã€‚åŒæ—¶ï¼Œæ ¸å¿ƒäº¤æ¢æœºè¿˜æ‰¿æ‹…ç€DHCPæœåŠ¡å™¨çš„ä½œç”¨ï¼Œå‘ä¸‹é¢çš„å››ä¸ªéƒ¨é—¨åˆ†é…IPåœ°å€å¹¶å®ç°ä¸‰å±‚äº¤æ¢ é˜²ç«å¢™æ·»åŠ äº†NATç­–ç•¥å¹¶å®ç°äº†åŒæœºçƒ­å¤‡+å¿ƒè·³æ£€æµ‹ï¼Œç”±äºå¼€å¯äº†webè§†å›¾ï¼Œå› æ­¤é…ç½®èµ·æ¥å˜å¾—æ›´åŠ ç®€å• å¤–ç½‘æ–¹é¢ï¼ŒARä½œä¸ºæ ¸å¿ƒè·¯ç”±å™¨æ±‡èšäº†å¤–ç½‘æœåŠ¡å™¨æœºç¾¤å’Œåˆ†éƒ¨é—¨ å…¶ä¸­ä¸€ä¸ªå­å…¬å¸ä½¿ç”¨PPP åè®®+CHAPé“¾è·¯åŠ å¯†å®ç°å’ŒARçš„é€šä¿¡ï¼›å¦å¤–ä¸€ä¸ªå­å…¬å¸ä½¿ç”¨å¸§ä¸­ç»§äºARé€šä¿¡ï¼›è·¯ç”±åè®®ä½¿ç”¨çš„æ˜¯ospfï¼Œä¸ºäº†é˜²ç¯è®¾ç½®äº†é€‰æ‹©äº†å­å…¬å¸ä¸åŒçš„areaä¸æ ¸å¿ƒè·¯ç”±å™¨area0ç›¸è¿ é˜²ç«å¢™NATç­–ç•¥ è¸©å‘ +]]></content>
      <categories>
        <category>æŠ€æœ¯æ¢ç´¢</category>
      </categories>
      <tags>
        <tag>ICT</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¤šçº¿ç¨‹ã€IOæµä¸åå°„]]></title>
    <url>%2F2019%2F10%2F12%2Fmutithread%2F</url>
    <content type="text"><![CDATA[æ—§ç¬”è®°è¡¥æ¡£ å¤šçº¿ç¨‹/IO CPUæ˜¯ä»¥æ—¶é—´ç‰‡çš„æ–¹å¼ä¸ºè¿›ç¨‹åˆ†é…CPUå¤„ç†æ—¶é—´çš„,ä¸ºäº†æé«˜CPUçš„ä½¿ç”¨ç‡ï¼Œé‡‡ç”¨å¤šçº¿ç¨‹çš„æ–¹å¼å»åŒæ—¶å®Œæˆå‡ ä»¶äº‹æƒ…è€Œäº’ä¸å¹²æ‰°,ä»è€Œæé«˜CPUçš„ä½¿ç”¨æ•ˆç‡ å¤šçº¿ç¨‹çš„ä½¿ç”¨åœºæ™¯ å¤šçº¿ç¨‹åŒæ—¶å®Œæˆå¤šä¸ªä»»åŠ¡ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849//å¤šçº¿ç¨‹æ ¸å¿ƒä»£ç  public void run()&#123; FileInputStream in = null; FileOutputStream out = null; try &#123; in = new FileInputStream(src); out = new FileOutputStream(dest); int buf = 1024; byte[] b = new byte[buf]; int lenth = 0; long len = src.length();// //å·²å¤åˆ¶æ–‡ä»¶çš„å­—èŠ‚æ•° double temp = 0; //æ•°å­—æ ¼å¼åŒ–ï¼Œæ˜¾ç¤ºç™¾åˆ†æ¯” DecimalFormat df = new DecimalFormat("##.00%"); while ((lenth = in.read(b)) != -1) &#123; out.write(b,0,lenth); //è·å–å·²ä¸‹è½½çš„å¤§å°ï¼Œå¹¶ä¸”è½¬æ¢æˆç™¾åˆ†æ¯” temp += lenth; double d = temp/len; System.out.println(src.getName()+"ä»¥å¤åˆ¶è¿›åº¦"+df.format(d)); //çº¿ç¨‹é˜»å¡ï¼Œå®ç°åŒæ­¥// Thread.sleep(1); if (len - temp &lt; buf) &#123; buf = (int) (len - temp); if (buf == 0) &#123; break; &#125; b = new byte[buf]; &#125; &#125; &#125; catch (FileNotFoundException e) &#123; e.printStackTrace(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; finally &#123; try &#123; if(in !=null)&#123; in.close(); &#125; if(out != null)&#123; out.close(); &#125; &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125; å¤šçº¿ç¨‹ååŒå®Œæˆå•ä¸€ä»»åŠ¡ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677//å¤šçº¿ç¨‹æ ¸å¿ƒä»£ç public void run() &#123; //å¯ä»¥ä»ä»»æ„ä½ç½®è¿›è¡Œè¯»å†™æ–‡ä»¶ RandomAccessFile in =null; RandomAccessFile out = null; try &#123; in = new RandomAccessFile(src, "r"); out = new RandomAccessFile(dest, "rw"); in.seek(startPos); out.seek(endPos); int size = endPos-startPos; int lenth=0; double temp =0;// åˆ¤æ–­å‰©ä½™é•¿åº¦æ˜¯å¦å¤§äº1024 int bufLen = (int) (size &lt; 1024 ? src.length() : 1024);// int bufLen = 1024; byte[] b = new byte[bufLen]; //æ•°å­—æ ¼å¼åŒ–ï¼Œæ˜¾ç¤ºç™¾åˆ†æ¯” DecimalFormat df = new DecimalFormat("##.00%"); while ((lenth = in.read(b)) != -1) &#123; out.write(b, 0, lenth); temp += lenth; double d = temp / size; System.out.println("çº¿ç¨‹" + j + "å¤åˆ¶è¿›åº¦" + df.format(d)); if (size - temp &lt; bufLen) &#123; bufLen = (int) (size - temp); if (bufLen == 0) &#123; break; &#125; b = new byte[bufLen]; &#125; &#125; &#125; catch (FileNotFoundException e) &#123; e.printStackTrace(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125;finally &#123; try &#123; in.close(); out.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; System.out.println("è¿è¡Œåˆ°è¿™é‡Œ"); countDownLatch.countDown(); &#125; &#125;//çº¿ç¨‹è°ƒç”¨æ–¹æ³•private static Executor executor = Executors.newCachedThreadPool(); private static void MutiCopy(String src,String dest,int count) &#123; File file = new File(src); long len= file.length(); int oneNum = (int) (len/count); System.out.println(oneNum); int num = 0; // CountDownLatch latch = null; if((num= (int) (len%count))!=0)&#123; System.out.println("å‰©ä½™ï¼š"+(len%count)); latch = new CountDownLatch(count+1); executor.execute(new FileCopy2(src,dest,(int)(len-len%count),(int)len,num,latch)); &#125;else&#123; System.out.println("æ•´é™¤"); latch = new CountDownLatch(count); &#125; for(int i =0;i &lt;count;i++)&#123; executor.execute(new FileCopy2(src,dest,oneNum*i,oneNum*(i+1),i,latch)); System.out.println("çº¿ç¨‹"+i+"å¯åŠ¨"); &#125; try &#123; latch.await(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; sleep()ã€join()ã€CountDownLatchç±»ä¹‹é—´çš„åŒºåˆ« Sleepæ–¹æ³•æ˜¯ä¸ªé™æ€æ–¹æ³•ï¼Œç”±threadç±»æ¥è°ƒç”¨ã€‚å®ƒåªèƒ½æš‚åœå½“å‰çº¿ç¨‹ï¼Œä¸èƒ½æš‚åœå…¶ä»–çº¿ç¨‹ã€‚å®ƒæ¥å—çš„å‚æ•°æŒ‡åè¿™ä¸ªçº¿ç¨‹éœ€è¦ä¼‘çœ å¤šå°‘æ—¶é—´ã€‚ Joinæ–¹æ³•æ˜¯éé™æ€æ–¹æ³•ï¼Œä»–ä½¿å¾—åœ¨ç³»ç»Ÿè°ƒç”¨æ­¤æ–¹æ³•æ—¶åªæœ‰è¿™ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œå ï¼Œæ‰èƒ½æ‰§è¡Œå…¶ä»–çº¿ç¨‹ï¼ŒåŒ…æ‹¬ä¸»çº¿ç¨‹çš„ç»ˆæ­¢ï¼›æˆ–è€…ç»™å®ƒåˆ¶å®šæ—¶é—´ï¼Œå³æœ€å¤šè¿‡äº†è¿™ä¹ˆå¤šæ—¶é—´åï¼Œå¦‚æœè¿˜æ˜¯æ²¡æœ‰æ‰§è¡Œå®Œï¼Œä¸‹é¢çš„çº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œè€Œä¸å¿…å†ç†ä¼šå½“å‰çº¿ç¨‹æ˜¯å¦æ‰§è¡Œå®Œã€‚ CountDownLatchæ˜¯ä¸€ä¸ªåŒæ­¥å·¥å…·ç±»ï¼Œå®ƒå…è®¸ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹çš„æ“ä½œæ‰§è¡Œå®Œåå†æ‰§è¡Œã€‚è°ƒç”¨joinæ–¹æ³•éœ€è¦ç­‰å¾…threadæ‰§è¡Œå®Œæ¯•æ‰èƒ½ç»§ç»­å‘ä¸‹æ‰§è¡Œ,è€ŒCountDownLatchåªéœ€è¦æ£€æŸ¥è®¡æ•°å™¨çš„å€¼ä¸ºé›¶å°±å¯ä»¥ç»§ç»­å‘ä¸‹æ‰§è¡Œ Threadå’ŒRunnableä¹‹é—´çš„å…³ç³» å®ç°Runnableæ›´åŠ é€‚åˆèµ„æºå…±äº« å®ç°Runnableæ¥å£é¿å…å•ç‚¹ç»§æ‰¿çš„å±€é™ï¼Œä¸€ä¸ªç±»å¯ä»¥ç»§æ‰¿å¤šä¸ªæ¥å£ å¤‡æ³¨ï¼š Runnableå§‹ç»ˆä½¿ç”¨ä¸€ä¸ªå¯¹è±¡çš„è®¡æ•°å™¨ï¼ŒThreadåˆ™æ¯æ¬¡åˆ›å»ºä¸€ä¸ªè®¡æ•°å™¨ Threadé€šè¿‡staticå±æ€§åŒæ ·å¯ä»¥å®ç°èµ„æºå…±äº« æ³¨æ„æ·»åŠ åŒæ­¥é” çº¿ç¨‹æ±  æ›´å¥½è°ƒåº¦å’Œç®¡ç†çº¿ç¨‹ ç§ç±» FixedThreadPool SingleThreadExecutor CachedThreadPool SingleThreadSchduledExecutor ScheduledThreadPool ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„æ˜¯å‡å°‘åœ¨åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ä¸Šæ‰€èŠ±çš„æ—¶é—´ä»¥åŠç³»ç»Ÿèµ„æºçš„å¼€é”€ï¼Œè§£å†³ç³»ç»Ÿèµ„æºä¸è¶³çš„é—®é¢˜ã€‚å¦‚æœä¸é€‚ç”¨çº¿ç¨‹æ± ï¼Œæœ‰å¯èƒ½é€ æˆç³»ç»Ÿåˆ›å»ºå¤§é‡åŒç±»çº¿ç¨‹è€Œå¯¼è‡´æ¶ˆè€—å®Œå†…å­˜æˆ–è€…â€è¿‡åº¦åˆ‡æ¢çš„é—®é¢˜â€ã€‚ å•çº¿ç¨‹å’Œå¤šçº¿ç¨‹ è¿›ç¨‹åªæœ‰ä¸€ä¸ªï¼Œæ‰€ä»¥åˆ†é…çš„CPUèµ„æºæ˜¯ä¸€å®šçš„ï¼Œå¤šçº¿ç¨‹åªä¸è¿‡æ˜¯è½®æµæŠ¢å CPUè€Œå·²ï¼Œå¹¶ä¸ä¼šçœŸæ­£æé«˜å¤„ç†é€Ÿåº¦ã€‚è¿™æ„å‘³ç€ï¼Œå¤šçº¿ç¨‹çš„ä½œç”¨ä¸»è¦åœ¨äºæé«˜äº†å¹¶å‘æ•°é‡ï¼Œæ¯”å¦‚httpè¯·æ±‚ï¼Œå¦‚æœæ˜¯å•çº¿ç¨‹ï¼Œä¸€æ¬¡åªèƒ½æ¥æ”¶ä¸€ä¸ªè¯·æ±‚ï¼Œå¤šçº¿ç¨‹åˆ™å¯ä»¥åŒæ—¶æ¥æ”¶å¤šä¸ªè¯·æ±‚ ä½†æ˜¯å¤šçº¿ç¨‹ç”±äºè½®æ¢ä½¿ç”¨CPUï¼Œä¼šé€ æˆå•ä¸ªçº¿ç¨‹çš„æ‰§è¡Œé€Ÿåº¦å˜æ…¢ï¼ˆä»¥å‰CPUä¾›ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œç°åœ¨è¦ä¾›å¤šä¸ªçº¿ç¨‹è½®æµä½¿ç”¨äº†ï¼‰ã€‚ä½†æ˜¯åœ¨å¤šCPUçš„æœåŠ¡å™¨ä¸Šï¼Œå¤šçº¿ç¨‹å°±å¾ˆæœ‰ä¼˜åŠ¿äº†ï¼Œå®ƒä¸ä½†èƒ½æé«˜å¹¶å‘æ•°é‡ï¼Œè€Œä¸”èƒ½æé«˜å¤„ç†é€Ÿåº¦ã€‚å› ä¸ºåœ¨å¤šCPUçš„æœåŠ¡å™¨ä¸Šï¼ŒCPUè°ƒåº¦å¾ˆçµæ´»ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹å ç”¨ç€ä¸€ä¸ªCPUçš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥è¢«åˆ†é…ç»™å…¶ä»–CPUå»å¤„ç†ï¼Œä»è€Œå®ç°äº†â€œçœŸæ­£æ„ä¹‰ä¸Šåœ°å¹¶è¡Œâ€ åå°„åå°„çš„æ¦‚å¿µ è™šæ‹Ÿæœºåœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œå¯ä»¥åŠ¨æ€åŠ è½½ä¸€ä¸ªåªæœ‰åç§°çš„ç±»ï¼ŒåŠ è½½å®Œç±»ä¹‹åï¼Œåœ¨å †å†…å­˜ä¸­ï¼Œå°±äº§ç”Ÿäº†ä¸€ä¸ª Class ç±»å‹çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å°±åŒ…å«äº†å®Œæ•´çš„ç»“æ„ä¿¡æ¯ï¼Œé€šè¿‡è¿™ä¸ªå¯¹è±¡æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç±»çš„ç»“æ„ã€‚ åå°„çš„ç”¨å¤„ åŠ¨æ€åŠ è½½ç±»ï¼Œåœ¨è¿è¡ŒæœŸé—´å¯ä»¥æ‰“å¼€å’Œæ£€æŸ¥.classæ–‡ä»¶ï¼ŒåŠ¨æ€è·å–ç±»ã€æ–¹æ³•ã€å±æ€§ç­‰ å¹¿æ³›åº”ç”¨äºå„ç±»æ¡†æ¶ï¼Œå¦‚spring Classç±» åœ¨Javaä¸­æ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ªClasså¯¹è±¡ï¼Œæ¯å½“æˆ‘ä»¬ç¼–å†™å¹¶ä¸”ç¼–è¯‘ä¸€ä¸ªæ–°åˆ›å»ºçš„ç±»å°±ä¼šäº§ç”Ÿä¸€ä¸ªå¯¹åº”Classå¯¹è±¡å¹¶ä¸”è¿™ä¸ªClasså¯¹è±¡ä¼šè¢«ä¿å­˜åœ¨åŒå.classæ–‡ä»¶é‡Œ(ç¼–è¯‘åçš„å­—èŠ‚ç æ–‡ä»¶ä¿å­˜çš„å°±æ˜¯Classå¯¹è±¡) __å†…å­˜ä¸­classå¯¹è±¡åªæœ‰ä¸€ä¸ªï¼Œåªèƒ½è¢«JVMåˆ›å»ºå¹¶åŠ è½½* ç±»çš„ç”Ÿæˆè¿‡ç¨‹ åŠ è½½ è¿æ¥ åˆå§‹åŒ– è·å– classç±»çš„ä¸‰ç§æ–¹å¼ é€šè¿‡ç±»åè·å– : ç±»å.class é€šè¿‡å¯¹è±¡è·å– : å¯¹è±¡å.getClass() è·å–å­—é¢å¸¸é‡çš„Classå¼•ç”¨æ—¶ï¼Œä¸ä¼šè§¦å‘åˆå§‹åŒ– é€šè¿‡å…¨ç±»åè·å– : Class.ForName(å…¨ç±»å) ç±»åŠ è½½å™¨ è´Ÿè´£å°†.classæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¹¶ä¸ºä¹‹ç”Ÿæˆå¯¹åº”çš„Classå¯¹è±¡ ç»„æˆ Bootstrap ClassLoader æ ¹ç±»åŠ è½½å™¨ è´Ÿè´£Javaæ ¸å¿ƒç±»çš„åŠ è½½ï¼Œæ¯”å¦‚Systemç±»ï¼Œåœ¨JDKä¸­JREçš„libç›®å½•ä¸‹rt.jaræ–‡ä»¶ä¸­çš„ç±» Extension ClassLoader æ‰©å±•ç±»åŠ è½½å™¨ è´Ÿè´£JREçš„æ‰©å±•ç›®å½•ä¸­jaråŒ…çš„åŠ è½½ï¼Œåœ¨JDKä¸­JREçš„libç›®å½•ä¸‹extç›®å½• System ClassLoader ç³»ç»Ÿç±»åŠ è½½å™¨ è´Ÿè´£åœ¨JVMå¯åŠ¨æ—¶åŠ è½½æ¥è‡ªjavaå‘½ä»¤çš„classæ–‡ä»¶ï¼Œä»¥åŠclasspathç¯å¢ƒå˜é‡æ‰€æŒ‡å®šçš„jaråŒ…å’Œç±»è·¯å¾„ 123456public void testClassLoader() throws IOException &#123; InputStream in1 = null; in1 = this.getClass().getClassLoader().getResourceAsStream("reflect/1.txt"); System.out.println(in1.read()); &#125; åŸºæœ¬æ“ä½œç±» è·å–ç±»çš„æ–¹æ³• è·å–ç±»åä»¥åŠå…¶å®ƒä¿¡æ¯ 1234567891011private static void test1() throws ClassNotFoundException &#123; String path = &quot;team.redrock.reflect.Student&quot;; Class cls1 = Class.forName(path);// Class cls2 = Student.class; System.out.println(cls1.getName()); System.out.println(cls1.getSimpleName()); // Student student = new Student(); // Class cls3 = student.getClass(); // System.out.println(cls3.getName()); &#125; å±æ€§ æ— å‚è·å–å…¬æœ‰å±æ€§ æ— å‚è·å–ç§æœ‰å±æ€§ è·å–å…¬æœ‰å±æ€§å€¼ è·å–ç§æœ‰å±æ€§å€¼ 12345678910111213141516171819202122232425private static void test2(Class cls)&#123; //è·å–å…¬æœ‰å±æ€§ Field[] fields = cls.getFields(); for(Field f : fields) &#123;// System.out.println(f.getName()); &#125; //è·å–å…¨éƒ¨å±æ€§ Field[] fieldss = cls.getDeclaredFields(); for(Field f : fieldss)&#123; //å¦‚æœå­—æ®µæ˜¯ç§æœ‰çš„ï¼Œä¸ç®¡æ˜¯è¯»å€¼è¿˜æ˜¯å†™å€¼ï¼Œéƒ½å¿…é¡»å…ˆè°ƒç”¨setAccessibleï¼ˆtrueï¼‰æ–¹æ³• f.setAccessible(true); try &#123; System.out.println(f.get(cls.getDeclaredConstructor().newInstance())); &#125; catch (IllegalAccessException e) &#123; e.printStackTrace(); &#125; catch (InstantiationException e) &#123; e.printStackTrace(); &#125; catch (InvocationTargetException e) &#123; e.printStackTrace(); &#125; catch (NoSuchMethodException e) &#123; e.printStackTrace(); &#125; &#125; &#125; newå’ŒnewInstanceçš„åŒºåˆ« new=åˆå§‹åŒ–+å®ä¾‹åŒ– newInstance=å®ä¾‹åŒ– å¿…é¡»æ ¹æ®å®ä¾‹è·å–å±æ€§å’Œæ–¹æ³• æ–¹æ³• è·å–å…¬æœ‰æ–¹æ³• è·å–ç§æœ‰æ–¹æ³• è·å–æŒ‡å®šæ–¹æ³• è°ƒç”¨æ–¹æ³• è°ƒç”¨çˆ¶ç±»çš„ç§æœ‰æ–¹æ³• 1234567891011121314151617181920212223242526private static void test3(Class cls)&#123;// Method[] methods = cls.getMethods(); //ä¸èƒ½è·å–ç§æœ‰æ–¹æ³•// for(Method method:methods)&#123;// System.out.println(method.getName());// &#125;// Method[] methods1 = cls.getDeclaredMethods(); //ä¸èƒ½è·å–çˆ¶ç±»æ–¹æ³•// for(Method method:methods1)&#123;// System.out.println(method.getName());// &#125; Method method = null; try &#123;// method = cls.getMethod("studySecretly",null); //å’Œæ— å‚è·å–methodä¸€æ · method = cls.getDeclaredMethod("studySecretly"); Object instance = cls.getDeclaredConstructor().newInstance(); method.setAccessible(true); //è°ƒç”¨ä½ç½®æ³¨æ„ä¸€ä¸‹ method.invoke(instance); &#125; catch (NoSuchMethodException e) &#123; e.printStackTrace(); &#125; catch (IllegalAccessException e) &#123; e.printStackTrace(); &#125; catch (InstantiationException e) &#123; e.printStackTrace(); &#125; catch (InvocationTargetException e) &#123; e.printStackTrace(); &#125; æ³¨è§£ åˆ©ç”¨åå°„å®ç°æ³¨è§£åŠŸèƒ½ 123456789101112131415161718192021private static void test4(Class cls)&#123; try &#123; Object object = cls.getDeclaredConstructor().newInstance(); Annotation annotation = (Annotation) cls.getAnnotation(GoodBoy.class); if(annotation !=null)&#123; if(annotation instanceof GoodBoy)&#123; //è¯¥æ³¨è§£æ˜¯å¦æ˜¯å®šä¹‰æ³¨è§£ç±»çš„ä¸€ä¸ªå®ä¾‹ GoodBoy goodBoy = (GoodBoy) annotation; System.out.println(goodBoy.value());//å®ç°æ³¨è§£é€»è¾‘çš„åœ°æ–¹ &#125; &#125; &#125; catch (InstantiationException e) &#123; e.printStackTrace(); &#125; catch (IllegalAccessException e) &#123; e.printStackTrace(); &#125; catch (InvocationTargetException e) &#123; e.printStackTrace(); &#125; catch (NoSuchMethodException e) &#123; e.printStackTrace(); &#125;&#125; å¦‚æœåœ¨ç¨‹åºä¸­è¦è·å–æ³¨è§£ï¼Œç„¶åè·å–æ³¨è§£çš„å€¼è¿›è€Œåˆ¤æ–­æˆ‘ä»¬èµ‹å€¼æ˜¯å¦åˆæ³•ï¼Œé‚£ä¹ˆç±»å¯¹è±¡çš„åˆ›å»ºå’Œæ–¹æ³•çš„åˆ›å»ºå¿…é¡»æ˜¯é€šè¿‡åå°„è€Œæ¥çš„ æ„é€ å™¨ åˆ©ç”¨æ„é€ å™¨åˆ›å»ºå¯¹è±¡ 12345678910111213141516private static void test5(Class cls)&#123; Constructor&lt;Student&gt;[] constructors = cls.getConstructors(); for (Constructor&lt;Student&gt; constructor1 :constructors)&#123; System.out.println(constructor1); try &#123; Student student = constructor1.newInstance(); System.out.println(student.play("dota")); &#125; catch (InstantiationException e) &#123; e.printStackTrace(); &#125; catch (IllegalAccessException e) &#123; e.printStackTrace(); &#125; catch (InvocationTargetException e) &#123; e.printStackTrace(); &#125; &#125; &#125;]]></content>
      <categories>
        <category>å­¦ä¹ ç¬”è®°</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è¸©å‘è®°å½•-SSLéªŒè¯æŠ¥é”™]]></title>
    <url>%2F2019%2F10%2F11%2FSSLSL-Problem%2F</url>
    <content type="text"><![CDATA[ä»Šå¤©ä¸çŸ¥é“æ€ä¹ˆå›äº‹è¯¸äº‹ä¸é¡ºï¼Œå±…ç„¶è¿åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®éƒ½ä¼šæŠ¥é”™ã€‚ã€‚ä»Šå¤©ä¸€å¦‚æ—¢å¾€æ‰“å¼€IDEAï¼Œæ»¡æ€€æ¬£å–œåœ°åˆ›å»ºä¸€ä¸ªspringbootåœ°æ–°é¡¹ç›®ï¼Œæƒ³ç€æ€ä¹ˆå»æ…¢æ…¢å¡«å……ç¾½ç¿¼ï¼Œç»™é¡¹ç›®æ³¨å…¥æ–°çš„ç”Ÿå‘½ã€‚ã€‚çªç„¶ï¼Œä¸€æ’çº¢çº¿æ˜¾ç¤ºåœ¨æˆ‘é¢å‰â€”â€” 1sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target son of bitch ! SSLéªŒè¯å¤±è´¥çš„ä¸€ç§è§£å†³æ–¹æ¡ˆ ç›®å‰è§£å†³æ–¹æ³• mvnç¼–è¯‘æŠ¥é”™mavn sun.security.validator.ValidatorException]]></content>
      <categories>
        <category>æŠ€æœ¯æ¢ç´¢</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æˆ‘çš„ä¹æœˆæ€»ç»“]]></title>
    <url>%2F2019%2F10%2F07%2Fseptember-plan%2F</url>
    <content type="text"><![CDATA[å¤©å‡‰å¥½ä¸ªç§‹~ åº”è¯¥è„šè¸å®åœ°ï¼Œåº”è¯¥è®¤æ¸…ç°å®ï¼Œåº”è¯¥ä¸€å¾€æ— å‰ã€‚ var ap = new APlayer({ element: document.getElementById("aplayer-IxgGolVt"), narrow: false, autoplay: false, showlrc: false, music: { title: "Move Mountains", author: "Alisa", url: "http://music.163.com/song/media/outer/url?id=1381578814.mp3", pic: "http://p1.music.126.net/wR8cPX0w4gj179SCzUHI6A==/109951164258264118.jpg?param=130y130", lrc: "" } }); window.aplayers || (window.aplayers = []); window.aplayers.push(ap); çŸ­æš‚çš„ä¹æœˆï¼Œæ›¾ç»å¯„æ‰˜äº†æˆ‘å¤šå°‘çš„å¹»æƒ³ï¼Œä½œä¸ºå¤§ä¸‰çš„å¼€å±€ä¹‹æœˆï¼Œä¹Ÿæ˜¯ç«‹ä¸‹èª“è¨€åçš„å®è·µæ—¶æœŸï¼Œæƒ³ç€ä¹æœˆå¤šé•¿ï¼Œè‡ªå·±çš„æ”¹å˜å°±ä¼šæœ‰å¤šå¤§ï¼Œä½†æ˜¯æœ€åæ—¶é—´åŒ†åŒ†ï¼Œæç„¶é—´å¸¦èµ°äº†ä¸€å¶çŸ¥ç§‹çš„æ¢¦æƒ³ï¼Œé‡‘é»„çš„å­£èŠ‚å´æ²¡ç”Ÿäº§å‡ºæœŸå¾…çš„æœå®ã€‚ è¿™ä¸ªæœˆï¼Œæ˜¯æ£€éªŒè‡ªå·±è®¡åˆ’æ­£ç¡®æ€§å’Œåˆç†æ€§çš„ä¸€ä¸ªæœˆï¼Œä¹Ÿæ˜¯åœ¨é˜µç—›ä¸­è‰°éš¾è½¬å‹çš„ä¸€ä¸ªæœˆï¼Œè¿™ä¸ªæœˆèµ°è¿‡ï¼Œç¦»è‡ªå·±ç›®æ ‡çš„12æœˆï¼Œåªå‰©ä¸‹æ®‹ç¼ºçš„ä¸‰ä¸ªæœˆæ—¶é—´ï¼Œæ—¶é—´ä¸é¥¶äººï¼Œå°±ç®—è‡ªå·±è¿˜æ²¡æœ‰å®Œå…¨è½¬å˜è¿‡æ¥ï¼Œä¹Ÿåªèƒ½åŒ†åŒ†ä¸Šé©¬ æ”¶è·è¿™ä¸ªæœˆï¼Œæ€»ç®—æœ‰äº†è‡ªå·±çš„è®¡åˆ’ å¯¹è‡ªå·±çš„å°±ä¸šç›®æ ‡ï¼Œæ€»ç®—æœ‰äº†ç›¸å¯¹æ¸…æ¥šçš„è®¤è¯†ï¼Œå°½ç®¡è®¡åˆ’å¤šå˜ï¼Œä½†æˆ‘ç›¸ä¿¡è¿™äº›æ”¹å˜éƒ½åœ¨ä¸€æ­¥æ­¥æ¥è¿‘æˆ‘è‡ªå·±çš„çœŸå®æ°´å¹³ï¼Œéƒ½åœ¨è®©æˆ‘çš„ç›®æ ‡å˜å¾—æ›´åŠ æ¸…æ™°æ˜ç¡® è¿˜æ˜¯è®¡åˆ’åšä¸€ä¸ªwebåç«¯å·¥ç¨‹å¸ˆï¼Œè™½ç„¶æ„Ÿè§‰ç¼–ç¨‹ä¸æ˜¯å¾ˆé€‚åˆæˆ‘ï¼Œä½†æ˜¯å°±ç›®å‰è€Œè¨€ï¼Œå¼€å‘å²—ä½ä¾ç„¶æ˜¯æœ€ä¸ºç†æƒ³çš„ç›®æ ‡ è‡ªå·±çš„æŠ€èƒ½åœ¨äºJAVAåç«¯å¼€å‘å’Œç½‘ç»œæŠ€æœ¯ï¼Œä½†æ˜¯åŸºç¡€æ²¡æœ‰ååˆ†å¤¯å®ï¼Œå¾ˆå¤šçŸ¥è¯†ç‚¹ä¹Ÿè¿˜æ²¡å®Œå…¨ç†è§£ï¼Œå› æ­¤ä»Šå¹´æ˜¯æ‰“åŸºç¡€ï¼Œæå‡ä¸“ä¸šç´ å…»çš„ä¸€å¹´ã€‚ ä½†æ˜¯è®¡åˆ’å®Œæˆå¾—ä¸æ˜¯å¾ˆç†æƒ³ã€‚ ç§¯ç´¯è¿™ä¸ªæœˆï¼Œå‹‰å¼ºå®Œæˆäº†ã€Šé«˜æ€§èƒ½MYSQLã€‹é‡è¦éƒ¨åˆ†çš„é˜…è¯»ï¼Œæœ‰æ”¶è·ï¼Œåœ¨ç´¢å¼•çš„è¿ç”¨å’Œè¡¨çš„ä¼˜åŒ–ä¸Šæœ‰äº†ä¸€ç‚¹åˆæ­¥çš„è®¤è¯†ï¼Œä½†æ˜¯æ›´å¤šçš„æ˜¯å¯¹é«˜çº§ç‰¹æ€§çš„ä¸è§£ï¼Œå¯¹å…·ä½“åº”ç”¨åœºæ™¯çš„ä¸ç¡®å®šã€‚å¾ˆå¤šçŸ¥è¯†ç‚¹è¿˜æ˜¯ä¸èƒ½å¾ˆå¥½åœ°è¿ç”¨åˆ°åç«¯å¼€å‘ä¸­å» è¿™ä¸ªæœˆ å¼€å§‹å­¦ä¹ pythonï¼Œæœ¬æƒ³ç³»ç»Ÿå­¦ä¹ ï¼Œä½†æ˜¯å› ä¸ºè‡ªå·±è®¡åˆ’çš„å˜æ›´æœ€ç»ˆä¸äº†äº†ä¹‹ã€‚ç›®å‰å­¦ä¹ åˆ°äº†åŸºç¡€çŸ¥è¯†ï¼Œå¤§è‡´åœ°è¿‡äº†ä¸€éï¼Œå¯¹è¿™ä¸ªè¯­è¨€çš„åŸºç¡€æœ‰äº†åˆæ­¥çš„ç†è§£ï¼Œæ¥ä¸‹æ¥æŠŠè¿™äº›çŸ¥è¯†ç‚¹å½’çº³ï¼Œæ€»ç»“æˆæ–‡ï¼Œå¹¶åœ¨ä¹‹åï¼ˆå¤§æ¦‚æ˜¯11æœˆæŠŠï¼‰åœ¨ç³»ç»Ÿåœ°å­¦ä¹ ä¸‹å» è¿™ä¸ªæœˆ æœ‰åœ¨ç´§è·Ÿæ—¥å¸¸è¯¾ç¨‹ã€‚ä½œä¸ºé€šä¿¡å·¥ç¨‹çš„å­¦ç”Ÿï¼Œå¹³æ—¶çš„è¯¾ç¨‹ç›¸å½“ç¹é‡ï¼Œä¸Šä¸ªå­¦æœŸå·®ç‚¹æŒ‚ç§‘çš„æˆ‘ä¸æƒ³å†ç»å†ä¸€æ¬¡æœ€åé˜¶æ®µç–¯ç‹‚å¤ä¹ çš„ç—›è‹¦ã€‚åŠ ä¸Šè¿™ä¸ªå­¦æœŸçš„è¯¾ç¨‹ç¡®å®ååˆ†é‡è¦ï¼Œå¯¹åæœŸæ‰¾å·¥ä½œéƒ½æ„ä¹‰éå¸¸ï¼Œå› æ­¤ï¼Œæˆ‘ä¾ç„¶å¾—åœ¨å¹³æ—¶æŠŠå­¦ä¹ è·Ÿä¸Šï¼Œå°½é‡ä¸è¦æ‹‰å¼€å¤ªå¤§è·ç¦»ã€‚ä½†ä»¤äººæ²®ä¸§çš„æ˜¯ï¼Œæ„Ÿè§‰è‡ªå·±å¹³æ—¶èŠ±åœ¨ä¸Šé¢çš„æ—¶é—´å¤ªå¤šäº†ï¼Œå¯¼è‡´è‡ªå·±çš„å°±ä¸šè®¡åˆ’è¿›å±•ç¼“æ…¢ï¼Œç„¶è€Œï¼Œå°±ç®—æ˜¯è‡ªå·±èŠ±æ—¶é—´çš„åŠªåŠ›å®Œå–„ç¬”è®°ï¼Œæœ€åä¾ç„¶å’Œä¸Šè¯¾çš„å­¦ä¹ è¿›åº¦æ‹‰å¼€äº†å·®è·ï¼Œæ„Ÿè§‰æ˜¯æˆ‘è¿‡äºé‡è§†ç¬”è®°çš„é‡è¦æ€§è€Œå¿½è§†äº†å®è·µåº”ç”¨çš„ç¼˜æ•… æ—¥å¸¸è¿™ä¸ªæœˆ ä¸»è¦æ˜¯åœ¨å¿™ICTæ‹›æ–°çš„äº‹æƒ… è¿™ä¸ªæœˆ ä¸»è¦æ˜¯åœ¨å­¦ä¹ ä¸Šè¯¾ è¿™ä¸ªæœˆ è¿˜èŠ±äº†ä¸€ç‚¹æ—¶é—´åœ¨ç­å­¦é•¿ä¸Š ä¸è¶³ICTæ–¹é¢å­¦ä¹ ç§¯ç´¯ä¸è¶³ï¼Œæ²¡æœ‰çœ‹å®ŒNA æ²¡æœ‰å›é¡¾è®¡ç½‘ ä¸€ç›´åœ¨æƒ³ä½†æ²¡æœ‰è¿›è¡Œçš„Leetcodeç®—æ³•å­¦ä¹  æ²¡æœ‰çœ‹å®Œä¹‹å‰åšè¿‡çš„é¡¹ç›® è‡ªå·±çš„javaåŸºç¡€æ²¡æœ‰å¾ˆå¤§çš„æå‡ å…³é”®åœ¨äºï¼Œè‡ªå·±å­¦ä¹ çš„çƒ­æƒ…å’Œå…´è¶£æ²¡æœ‰æƒ³åƒä¸­é«˜æ¶¨ï¼Œä¸“æ³¨åº¦ä¾ç„¶æ²¡æœ‰æå‡ï¼Œè¿˜æ˜¯ä¼šæƒ³ç€åšåˆ«çš„äº‹æƒ… ä¸‹ä¸ªæœˆè®¡åˆ’ é¢„æœŸè¾¾æˆçš„ç›®æ ‡ å€Ÿå°ç¨‹åºï¼Œå¯¹é¡¹ç›®çš„ç»éªŒæ›´åŠ ä¸°å¯Œ JAVAåŸºç¡€æœ‰äº†æå‡ ä¸“æ³¨åº¦å’Œè®¤çœŸç¨‹åº¦æœ‰æå‡]]></content>
      <categories>
        <category>ä¸€å¦‚æ—¢å¾€ï¼Œåªæ˜¯æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>æ€»ç»“</tag>
        <tag>è®¡åˆ’</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å„å±‚å¸¸è§åè®®é¦–éƒ¨æ ¼å¼è§£æ]]></title>
    <url>%2F2019%2F09%2F24%2Fhcna%2F</url>
    <content type="text"><![CDATA[å¤§æ¦‚ä¸€ç¯‡èƒ½è®²å®Œå§â€¦ ä»¥å¤ªç½‘å¸§è¿è¡Œåœ¨ä»¥å¤ªç½‘ä¸Šçš„å¸¸è§å¸§æ ¼å¼åˆ†ä¸ºä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯Ethenet_IIå¸§æ ¼å¼ã€IEEE802.3å¸§æ ¼å¼ï¼ˆSNAPï¼‰ ethenet IIçš„typeå­—æ®µæŒ‡å®šäº†ä¸Šå±‚çš„åè®® IEEE802.3ç›¸åŒä½ç½®æ˜¯é•¿åº¦ï¼ŒåŒæ—¶å¯¹æ•°æ®è¿›è¡Œæ›´åŠ ç»†ç²’åº¦çš„æ§åˆ¶ ETHENET_IIå­—æ®µè¯´æ˜ DMACæ˜¯ç›®çš„MACåœ°å€ã€‚DMACå­—æ®µé•¿åº¦ä¸º6ä¸ªå­—èŠ‚ï¼Œæ ‡è¯†å¸§çš„æ¥æ”¶è€…ã€‚ SMACæ˜¯æºMACåœ°å€ã€‚SMACå­—æ®µé•¿åº¦ä¸º6ä¸ªå­—èŠ‚ï¼Œæ ‡è¯†å¸§çš„å‘é€è€…ã€‚ ç±»å‹å­—æ®µç”¨äºæ ‡è¯†æ•°æ®å­—æ®µä¸­åŒ…å«çš„é«˜å±‚åè®®ï¼Œè¯¥å­—æ®µé•¿åº¦ä¸º2ä¸ªå­—èŠ‚ã€‚ç±»å‹å­—æ®µå–å€¼ä¸º0x0800çš„å¸§ä»£è¡¨IPåè®®å¸§ï¼›ç±»å‹å­—æ®µå–å€¼ä¸º0x0806çš„å¸§ä»£è¡¨ARPåè®®å¸§ã€‚ æ•°æ®å­—æ®µæ˜¯ç½‘ç»œå±‚æ•°æ®ï¼Œæœ€å°é•¿åº¦å¿…é¡»ä¸º46å­—èŠ‚ä»¥ä¿è¯å¸§é•¿è‡³å°‘ä¸º64å­—èŠ‚ï¼Œæ•°æ®å­—æ®µçš„æœ€å¤§é•¿åº¦ä¸º1500å­—èŠ‚ã€‚ å¾ªç¯å†—ä½™æ ¡éªŒå­—æ®µï¼ˆ``FCS`ï¼‰æä¾›äº†ä¸€ç§é”™è¯¯æ£€æµ‹æœºåˆ¶ã€‚è¯¥å­—æ®µé•¿åº¦ä¸º4ä¸ªå­—èŠ‚ã€‚ IEEE802.3 å­—æ®µè¯´æ˜ Length ä»£æ›¿ETHENET_IIå­—æ®µçš„Typeå­—æ®µï¼Œè®°å½•å¸§çš„å­—é•¿ LLCå ç”¨Dataçš„3ä¸ªå­—èŠ‚ D.SAP ç›®çš„è®¿é—®æœåŠ¡ç‚¹ S.SAP æºæœåŠ¡è®¿é—®ç‚¹ Control æ§åˆ¶å­—æ®µ SNAP å ç”¨Dataçš„5ä¸ªå­—èŠ‚ Org Codeæœºæ„ä»£ç ï¼Œä¸€èˆ¬ä¸º0 Typeå­—æ®µå’ŒEthenetç›¸åŒ DSAPå’ŒSSAPä½œç”¨è§£é‡Š å½“DSAPå’ŒSSAPéƒ½å–ç‰¹å®šå€¼``0xffæ—¶ï¼Œ802.3å¸§å°±å˜æˆäº†Netware ETHERNET`å¸§ï¼Œç”¨æ¥æ‰¿è½½NetWareç±»å‹çš„æ•°æ®ã€‚ å½“DSAPå’ŒSSAPéƒ½å–ç‰¹å®šå€¼``0xaaæ—¶ï¼Œ802.3å¸§å°±å˜æˆäº†ETHERNET_SNAPå¸§ã€‚ETHERNET_SNAP`å¸§å¯ä»¥ç”¨äºä¼ è¾“å¤šç§åè®® DSAPå’ŒSSAPå…¶ä»–çš„å–å€¼å‡ä¸ºçº¯``IEEE802.3`å¸§ã€‚ MACåœ°å€ï¼ˆ6å­—èŠ‚48bitï¼‰ å‰24bitæ˜¯OUI ä¾›åº”å•†ä»£ç ï¼Œå24bitæ˜¯åºåˆ—å· å•æ’­ç¬¬1å­—èŠ‚çš„ç¬¬8bitä¸º0ï¼›ç»„æ’­ç¬¬1å­—èŠ‚çš„ç¬¬8bitä¸º1ï¼›å¹¿æ’­ä¸ºå…¨1 IPv4æŠ¥æ–‡ç»“æ„ å­—æ®µè§£é‡Š Version 4å­—èŠ‚ï¼Œç‰ˆæœ¬å· Header Lenngth 4å­—èŠ‚ï¼Œæ˜¾ç¤ºé¦–éƒ¨é•¿åº¦ï¼Œä¸€èˆ¬é¦–éƒ¨é•¿åº¦ä¸º20å­—èŠ‚ DS Field 8å­—èŠ‚ï¼ŒåŒºåˆ†æœåŠ¡,ä¹Ÿå«TOS Total Length 16å­—èŠ‚ï¼ŒæŠ¥æ–‡æ€»é•¿åº¦,ç†è®ºä¸Šå¯åˆ°è¾¾65535å­—èŠ‚ identification 16å­—èŠ‚ï¼Œæ ‡è¯†ï¼Œå’Œåˆ†ç‰‡æœ‰å…³ Flags 3å­—èŠ‚ æ ‡å¿—ï¼Œå’Œåˆ†ç‰‡æœ‰å…³ Fragment Offset 13å­—èŠ‚ï¼Œç‰‡åç§»ï¼Œå’Œåˆ†ç‰‡æœ‰å…³ Time To Live 8å­—èŠ‚ TTL Protocol 8å­—èŠ‚ åè®®ï¼ŒæŒ‡å®šä¼ è¾“å±‚åè®® Header Checksum 16å­—èŠ‚ï¼Œé¦–éƒ¨æ ¡éªŒå’Œï¼Œåªå¯¹é¦–éƒ¨è¿›è¡Œå·®é”™æ£€æµ‹ Source IP Address 32å­—èŠ‚ï¼ŒæºIPåœ°å€ Destination IP Address 32å­—èŠ‚ ç›®çš„IPåœ°å€ IP OPtion å¯é€‰é¡¹ dataæœ‰æ•ˆè½½è· å…³äºåŒºåˆ†æœåŠ¡IPv4çš„DS Fieldå­—æ®µæä¾›Qosã€‚ åŸå…ˆå®šä¹‰ä¸ºTOSï¼ˆRFC791ï¼‰ï¼ŒTOSä¸­çš„IP Precedenceå­—æ®µåªèƒ½å°†æŠ¥æ–‡åˆ†æˆ8ç±»ï¼Œåœ¨å®é™…ç”Ÿæ´»ä¸­å®Œå…¨ä¸å¤Ÿç”¨ï¼Œå¦‚ä¸‹ å­—æ®µè¯´æ˜ IP Precedence ä»£è¡¨äº†æŠ¥æ–‡çš„ä¼˜å…ˆçº§ D/T/R D bitä»£è¡¨å»¶è¿Ÿï¼ˆDelayï¼‰ï¼ŒT bitä»£è¡¨ååé‡ï¼ˆThroughputï¼‰ï¼ŒR bitä»£è¡¨å¯é æ€§ï¼ˆReliabilityï¼‰ã€‚ åæ¥ï¼Œåœ¨RFC2474ä¸­å¯¹IPv4æŠ¥æ–‡å¤´çš„ToSå­—æ®µè¿›è¡Œäº†é‡æ–°å®šä¹‰ï¼Œç§°ä¸ºDSï¼ˆDifferentiated Servicesï¼‰å­—æ®µã€‚ å­—æ®µè¯´æ˜ DSCP DSCPæœ‰ä¸¤ç§è¡¨è¾¾æ–¹å¼ï¼Œä¸€ç§æ˜¯æ•°å€¼ï¼ŒèŒƒå›´æ˜¯0~63ï¼ˆ6ä¸ªå­—èŠ‚ï¼‰ï¼›ä¸€ç§æ˜¯å…³é”®å­—ï¼Œåˆ†ä¸ºCSã€EFã€AFã€BE å…¶ä¸­xyè¡¨ç¤ºä¸åŒç±»åˆ«ï¼Œæ•°å­—è¶Šå°ä¸¢åŒ…æ¦‚ç‡è¶Šå° CS6å’ŒCS7é»˜è®¤ç”¨äºåè®®æŠ¥æ–‡ï¼Œè€Œä¸”æ˜¯å¤§å¤šæ•°å‚å•†è®¾å¤‡çš„ç¡¬ä»¶é˜Ÿåˆ—é‡Œæœ€é«˜ä¼˜å…ˆçº§çš„æŠ¥æ–‡ï¼Œå› ä¸ºå¦‚æœè¿™äº›æŠ¥æ–‡æ— æ³•æ¥æ”¶çš„è¯ä¼šå¼•èµ·åè®®ä¸­æ–­ã€‚ EFå¸¸ç”¨äºæ‰¿è½½è¯­éŸ³çš„æµé‡ï¼Œå› ä¸ºè¯­éŸ³è¦æ±‚ä½å»¶è¿Ÿï¼Œä½æŠ–åŠ¨ï¼Œä½ä¸¢åŒ…ç‡ï¼Œæ˜¯ä»…æ¬¡äºåè®®æŠ¥æ–‡çš„æœ€é‡è¦çš„æŠ¥æ–‡ã€‚ AF4ç”¨æ¥æ‰¿è½½è¯­éŸ³çš„ä¿¡ä»¤æµé‡,æŒ‡ç”µè¯çš„æ§åˆ¶ä¿¡ä»¤ã€‚ AF3å¯ä»¥ç”¨æ¥æ‰¿è½½IPTVçš„ç›´æ’­æµé‡ï¼Œç›´æ’­çš„å®æ—¶æ€§å¾ˆå¼ºï¼Œéœ€è¦è¿ç»­æ€§å’Œå¤§ååé‡çš„ä¿è¯ã€‚ AF2å¯ä»¥ç”¨æ¥æ‰¿è½½VODï¼ˆVideo on Demandï¼šè§†é¢‘ç‚¹æ’­ï¼‰çš„æµé‡ï¼Œç›¸å¯¹äºç›´æ’­æµé‡æ¥è¯´ï¼ŒVODå¯¹å®æ—¶æ€§è¦æ±‚æ²¡é‚£ä¹ˆå¼ºçƒˆï¼Œå…è®¸æœ‰æ—¶å»¶æˆ–è€…ç¼“å†²ã€‚ AF1å¯ä»¥ç”¨æ¥æ‰¿è½½æ™®é€šä¸Šç½‘ä¸šåŠ¡ã€‚ BE æ˜¯æŒ‡ä¼ ç»ŸIPçš„åˆ†ç»„æŠ•é€’æœåŠ¡ï¼Œåªå…³æ³¨å¯è¾¾æ€§ï¼Œå¯¹å…¶ä»–æ–¹é¢ä¸åšè¦æ±‚ï¼Œæ‰€æœ‰è·¯ç”±å™¨å¿…é¡»æ”¯æŒBE å…³äºåˆ†ç‰‡IPæ•°æ®æŠ¥åˆ†ç‰‡ä¸»è¦è€ƒè™‘ä»¥ä¸‹åŸå› ï¼š æ•°æ®é“¾è·¯å±‚æœ‰ä¸åŒçš„æ‰¿è½½åè®®ï¼Œä¸åŒåè®®æ‰¿è½½çš„æœ€å¤§æ•°æ®é•¿åº¦å„ä¸ç›¸åŒ ä½¿ç”¨IPåˆ†ç‰‡å°†æ•°æ®åˆ†ç‰‡ä¼ è¾“ï¼Œä»è€Œä½¿æ•°æ®ä¸ä¼šè¶…è¿‡MTUï¼Œå¯¹æ­¤ï¼ŒIPv4æä¾›äº†ä¸‰ä¸ªå­—æ®µï¼šæ ‡è¯†ã€æ ‡å¿—ã€ç‰‡åç§» Identificationï¼šæ ‡è¯†å·,å½’å±äºåŒä¸€ä¸ªæ ‡è¯†å·çš„æ•°æ®åŒ…åˆ†ç‰‡å…·æœ‰ç›¸åŒçš„==æ ‡è¯†å·==ã€==æºIPåœ°å€==ã€==ç›®çš„åœ°å€== ï¼ŒåŒæ—¶ï¼Œå‘é€ä¸»æœºé€šå¸¸ä¸ºä»–å‘é€çš„æ¯ä¸€ä¸ªæ•°æ®æŠ¥çš„æ ‡è¯†å·åŠ 1ã€‚ flagï¼šç”¨äºåˆ¤æ–­åé¢æ˜¯å¦è¿˜æœ‰ç‰‡ï¼Œflagåˆ†ä¸ºReserve,DFå’ŒMFä¸‰éƒ¨åˆ†ã€‚Reserveæ˜¯ä¿ç•™ä½ï¼›DFè¡¨ç¤ºæ˜¯å¦åˆ†ç‰‡ï¼ˆDF=1è¡¨ç¤ºä¸åˆ†ç‰‡ï¼‰ï¼›MFè¡¨ç¤ºæ˜¯å¦è¿˜æœ‰åç»­åˆ†ç‰‡ã€‚å¯ä»¥çœ‹å‡ºï¼Œä¸‰ä½åŒæ—¶æœ€å¤šåªèƒ½ç”±ä¸€ä¸ªå€¼ä¸º1 Fragment Offset:ç‰‡åç§»ï¼Œç”¨æ¥åˆ†ç‰‡é‡ç»„æ—¶è¿›è¡Œå®šä½ï¼Œåç§»ä»¥8å­—èŠ‚ä¸ºå•ä½ åˆ†ç‰‡çš„ç¼ºç‚¹ åˆ†ç‰‡æœ¬èº«çš„åˆ’åˆ†å’Œé‡ç»„ä¼šå¸¦æ¥èµ„æºæ¶ˆè€—ï¼Œå°¤å…¶æ˜¯æ¥æ”¶æ–¹ï¼Œåœ¨æ¥å—åˆ†ç‰‡æ—¶è¦ä¸ºæ¯ä¸ªåˆ†ç‰‡æä¾›å†…å­˜ç©ºé—´ï¼Œåˆ†ç‰‡è¿‡å¤šä¼šå¯¼è‡´èµ„æºæ¶ˆè€—ä¸¥é‡ ç”±äºIPå±‚æ²¡æœ‰é‡ä¼ çš„ç­–ç•¥ï¼Œæ‰€ä»¥å½“æ•°æ®æ³¢ä¸­çš„ä»»æ„åˆ†ç‰‡ä¸¢å¤±æ—¶ï¼Œæ•´ä¸ªæ•°æ®æŠ¥éƒ½éœ€è¦ä¾èµ–ä¼ è¾“å±‚è¿›è¡Œé‡ä¼ ï¼Œåˆå› ä¸ºIPå±‚çš„åˆ†ç‰‡ç›¸å¯¹äºä¼ è¾“å±‚æ˜¯é€æ˜çš„ï¼Œæ‰€ä»¥å¾€å¾€ä¼ è¾“å±‚ä¼šé‡ä¼ æ•´ä¸ªæ•°æ®åŒ…ï¼Œè¿™æ ·ä¼šæµªè´¹èµ„æºï¼Œå½±å“ç½‘ç»œä¸­çš„ä¼ è¾“è´¨é‡ã€‚ åŒæ—¶ï¼Œåˆ†ç‰‡çš„å­˜åœ¨ä¼šå¯¹ç½‘ç»œå®‰å…¨é€ æˆéšæ‚£ã€‚åˆ©ç”¨æœ€åä¸€ä¸ªåˆ†ç‰‡æ²¡æœ‰è¢«æ¥å—ï¼Œæ‰€æœ‰åˆ†ç‰‡å°±ä¸ä¼šé‡ç»„å¹¶é‡Šæ”¾å†…å­˜ç©ºé—´çš„ç‰¹ç‚¹ï¼Œæ•…æ„ä¸å‘æ¥æ”¶æ–¹å‘é€æœ€åä¸€ä¸ªåˆ†ç‰‡ï¼Œå¦‚æœè¿™æ ·çš„æ”»å‡»è¿…é€Ÿï¼Œå¤§é‡ï¼Œå°±ä¼šå¯¼è‡´æ¥æ”¶æ–¹çš„å†…å­˜ç©ºé—´å æ»¡ï¼Œæ— æ³•å¤„ç†æ­£å¸¸ä¸šåŠ¡ï¼Œè¾¾åˆ°DOSæ•ˆæœã€‚åŒæ—¶ä¹Ÿå¯ä»¥ä½¿åˆ†ç‰‡çš„åç§»é‡å‡ºç°å·®é”™ï¼Œå¯¼è‡´æ¥æ”¶æ–¹æ— æ³•æ­£å¸¸é‡ç»„æ•°æ®æŠ¥ å€¼å¾—æ³¨æ„çš„æ—¶IPåˆ†ç»„åªæœ‰ç¬¬ä¸€ä¸ªåˆ†ç‰‡å¸¦æœ‰å››å±‚ä¿¡æ¯ï¼Œå› æ­¤å…¶ä½™åˆ†ç‰‡æœ‰å¯èƒ½å› æ­¤é€ƒè¿‡é˜²ç«å¢™ç­‰çš„æ£€æµ‹ï¼Œä»è€Œç»™é»‘å®¢å¯ä¹˜ä¹‹æœº åœ¨å®é™…åº”ç”¨ä¸­ï¼Œåº”å°½é‡é¿å…ä½¿ç”¨IPåˆ†ç‰‡ã€‚äº‹å®ä¸Šï¼ŒIPv6åè®®ä¸­å·²ç»å–æ¶ˆåˆ†ç‰‡çš„ç­–ç•¥ã€‚ ç”±äºTCPåè®®ä¸­å­˜åœ¨MSSï¼Œé™åˆ¶äº†æœ€å¤§æ•°æ®å‘é€é‡ï¼Œä»è€Œå¯ä»¥ç¡®ä¿IPæ•°æ®æŠ¥å¤§å°ä¸ä¼šè¶…è¿‡æ•°æ®é“¾è·¯å±‚çš„MTUï¼Œå› æ­¤ï¼Œåœ¨TCPåè®®ä¸­ä¸å­˜åœ¨IPåˆ†ç‰‡ï¼›ä½†æ˜¯åœ¨UDPåè®®ä¸‹ï¼Œä¸å­˜åœ¨è¿™æ ·çš„ä¿éšœæœºåˆ¶ï¼Œå› æ­¤æœ€å¥½è¦åœ¨åº”ç”¨å±‚å°±é™å®šæ¯ä¸ªåŒ…çš„å¤§å° å…³äºæ ¡éªŒIPå±‚åªå¯¹æŠ¥æ–‡å¤´éƒ¨è¿›è¡Œæ ¡éªŒæ£€é”™ï¼Œä¸å¯¹æ•°æ®è¿›è¡Œå·®é”™æ£€æµ‹ï¼Œç½‘ç»œå±‚å®è´¨ä¸Šè¿˜æ˜¯å±äºâ€œå°½æœ€å¤§åŠªåŠ›äº¤ä»˜â€ ä¸ºä»€ä¹ˆé“¾è·¯å±‚ã€IPå±‚å’Œä¼ è¾“å±‚éƒ½éœ€è¦æ ¡éªŒï¼Ÿ ç­”ï¼šé“¾è·¯å±‚çš„å·®é”™æ£€éªŒæ˜¯ä¸ºäº†ä¿è¯æ•°æ®åœ¨é“¾è·¯ä¼ è¾“çš„å®Œæ•´æ€§ï¼Œ IPå±‚åªå¯¹å¤´éƒ¨è¿›è¡Œæ ¡éªŒï¼Œä¸€æ¥æ˜¯å› ä¸ºé“¾è·¯å±‚çš„æ ¡éªŒå·²ç»å°½å¯èƒ½åœ°é™ä½äº†å·®é”™ç‡ï¼ŒäºŒæ¥æ˜¯å› ä¸ºIPå±‚èŒƒå›´åºæ‚ï¼Œå¦‚æœæ¯ç»è¿‡ä¸€ä¸ªè·¯ç”±å™¨éƒ½å¯¹æ•°æ®è¿›è¡Œæ ¡éªŒï¼Œä¼šå¯¹æ€§èƒ½äº§ç”Ÿå½±å“ï¼Œå¯ä»¥ä½†æ²¡å¿…é¡»ã€‚åŒæ—¶æ ¡éªŒå¤´éƒ¨æ˜¯ä¸ºäº†ä¿éšœIPåè®®è‡ªèº«çš„æ­£ç¡®æ€§ï¼ŒåŒæ—¶ä¹Ÿå­˜åœ¨å¯¹äºŒå±‚çš„ä¸ä¿¡ä»»ï¼Œä»¥åŠå››å±‚åè®®æœ‰æ ¡éªŒä¹Ÿæœ‰æ— æ ¡éªŒï¼Œåšä¸€ä¸ªæœ€ä½é™åº¦çš„ä¿éšœã€‚ç”šè‡³è¿˜æœ‰è¯´æ³•æ˜¯å†å²é—ç•™é—®é¢˜ã€‚æ€»ä¹‹ç®—æ˜¯ä¸€ä¸ªcomplicated issueäº†ğŸ¤£ ä¼ è¾“å±‚åè®®ä¾‹å¦‚TCPåè®®å¯¹æ•´ä¸ªæŠ¥æ–‡æ®µè¿›è¡Œæ ¡éªŒï¼Œä¹Ÿæ˜¯å‡ºäºå¯¹ä¸‹å±‚çš„ä¸ä¿¡ä»»çš„åŸå› ã€‚ï¼ˆå¤§æ¦‚å§ï¼‰ å…³äºé€‰é¡¹é€‰é¡¹å…è®¸IPé¦–éƒ¨è¢«æ‰©å±•ï¼Œé€‰é¡¹å­—æ®µç”¨æ¥æ”¯æŒæ’é”™ã€æµ‹é‡ä»¥åŠå®‰å…¨ç­‰æªæ–½ï¼Œä¸€èˆ¬è¾ƒå°‘ä½¿ç”¨ IPv6æŠ¥æ–‡ç»“æ„ä¼ è¾“å±‚æŠ¥æ–‡ç»“æ„UDPTCP]]></content>
      <categories>
        <category>å­¦ä¹ ç¬”è®°</category>
      </categories>
      <tags>
        <tag>ICT</tag>
        <tag>è®¡ç®—æœºç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[pythonå­¦ä¹ ï¼ˆ02ï¼‰]]></title>
    <url>%2F2019%2F09%2F23%2Fpython2%2F</url>
    <content type="text"><![CDATA[â€¦ å‡½æ•°ä¼ é€’å‚æ•° å¿…å¤‡å‚æ•° å…³é”®å­—å‚æ•° é»˜è®¤å‚æ•° ä¸å®šé•¿å‚æ•° å¿…å¤‡å‚æ•°ï¼ˆä½ç½®å‚æ•°ï¼‰ é»˜è®¤å‚æ•° é»˜è®¤å‚æ•°å¿…é¡»æŒ‡å‘ä¸å˜å¯¹è±¡ï¼ 123456def power(x, n=2): s = 1 while n &gt; 0: n = n - 1 s = s * x return s 123456#L[]æ˜¯å¯å˜å¯¹è±¡ï¼Œæ¯æ¬¡è°ƒç”¨ä¼šæ”¹å˜å€¼ï¼Œå› æ­¤ä½¿ç”¨NoneåŠ é”def add_end(L=None): if L is None: L = [] L.append('END') return L ä¸å®šé•¿å‚æ•°ï¼ˆå¯å˜å‚æ•°ï¼‰ 12345def calc(*numbers): sum = 0 for n in numbers: sum = sum + n * n return sum å…³é”®å­—å‚æ•° å¯ä»¥ä¼ å…¥æ•°é‡ä¸å®šçš„dictå‚æ•° 12345678def person(name, age, **kw): if 'city' in kw: # æœ‰cityå‚æ•° pass if 'job' in kw: # æœ‰jobå‚æ•° pass print('name:', name, 'age:', age, 'other:', kw) æŒ‡å®šå…³é”®å­—å‚æ•°ï¼Œå‘½åå…³é”®å­—å‚æ•°éœ€è¦ä¸€ä¸ªç‰¹æ®Šåˆ†éš”ç¬¦*ï¼Œ*åé¢çš„å‚æ•°è¢«è§†ä¸ºå‘½åå…³é”®å­—å‚æ•°ã€‚ 12def person(name, age, *, city, job): print(name, age, city, job) å¦‚æœå·²æœ‰å¯å˜å‚æ•°ï¼Œåé¢çš„å‚æ•°å°±è‡ªåŠ¨è¢«è®¾ä¸ºæŒ‡å®šå…³é”®å­—å‚æ•° 12def person(name, age, *args, city, job): print(name, age, args, city, job) é«˜çº§ç‰¹æ€§åˆ‡ç‰‡ä½¿ç”¨å½¢å¦‚[:]çš„è¯­å¥æ¥æ‰§è¡Œç´¢å¼•èŒƒå›´çš„æ“ä½œ æ”¯æŒå€’æ•°åˆ‡ç‰‡ è¿­ä»£ä½¿ç”¨Iterable åˆ—è¡¨ç”Ÿæˆå™¨ å¯ä»¥ä½¿ç”¨å¤šé‡å¾ªç¯ ç”Ÿæˆå™¨è¿­ä»£å™¨]]></content>
      <categories>
        <category>å­¦ä¹ ç¬”è®°</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[pythonå®ç°ç‰›é¡¿æ³•è¿­ä»£æ³•]]></title>
    <url>%2F2019%2F09%2F22%2Fpynewton%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘çœ‹åˆ°ç‰›é¡¿è¿­ä»£æ³•å’ŒäºŒåˆ†æ³•ï¼Œç°åœ¨ç”¨pythonå®ç°ä¸€ä¸‹ æ‹¿å¼€æ–¹ä¸¾ä¾‹,è½¬è½½è‡ªPythonç¼–ç¨‹å®ç°äºŒåˆ†æ³•å’Œç‰›é¡¿è¿­ä»£æ³•æ±‚å¹³æ–¹æ ¹ä»£ç  ä¸€ã€ä½¿ç”¨äºŒåˆ†æ³•å®ç°å¼€æ–¹å‡è®¾æ±‚æ ¹å·5ï¼ŒäºŒåˆ†æ³•çš„åŸºæœ¬æ€è·¯æ˜¯ 123456a:æŠ˜åŠï¼š 5/2=2.5b:å¹³æ–¹æ ¡éªŒ: 2.5*2.5=6.25&gt;5ï¼Œå¹¶ä¸”å¾—åˆ°å½“å‰ä¸Šé™2.5c:å†æ¬¡å‘ä¸‹æŠ˜åŠ:2.5/2=1.25d:å¹³æ–¹æ ¡éªŒï¼š1.25*1.25=1.5625&lt;5,å¾—åˆ°å½“å‰ä¸‹é™1.25e:å†æ¬¡æŠ˜åŠ:2.5-(2.5-1.25)/2=1.875f:å¹³æ–¹æ ¡éªŒï¼š1.875*1.875=3.515625&lt;5,å¾—åˆ°å½“å‰ä¸‹é™1.875 æ¯æ¬¡å¾—åˆ°å½“å‰å€¼å’Œ5è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶ä¸”è®°ä¸‹ä¸‹ä¸‹é™å’Œä¸Šé™ï¼Œä¾æ¬¡è¿­ä»£ï¼Œé€æ¸é€¼è¿‘å¹³æ–¹æ ¹ï¼š å½“ç»“æœæ ¡éªŒè¶…è¿‡åŸå€¼ï¼Œç»§ç»­è¿­ä»£ å½“ç»“æ„æ ¡éªŒä½äºåŸå€¼ï¼Œè·å¾—å¦ä¸€åŠï¼Œç»§ç»­è¿­ä»£ pythonä»£ç  12345678910111213141516171819import mathfrom math import sqrtdef sqrt_binary(num): x = sqrt(num) y = num/2.0 low = 0.0 up = num*1.0 count = 1 while abs(y-x)&gt;0.000001: print(count,y) count += 1 if y*y&gt;num : up = y y = low+(y-low)/2 else: low = y y = up-(up-y)/2 return y äºŒã€ä½¿ç”¨ç‰›é¡¿è¿­ä»£æ³•å®ç°å¼€æ–¹ä»å‡½æ•°æ„ä¹‰ä¸Šç†è§£ï¼šæˆ‘ä»¬æ˜¯è¦æ±‚å‡½æ•°f(x)=xÂ²ï¼Œä½¿f(x)=numçš„è¿‘ä¼¼è§£ï¼Œå³xÂ²-num=0çš„è¿‘ä¼¼è§£ã€‚ ä»å‡ ä½•æ„ä¹‰ä¸Šç†è§£ï¼šæˆ‘ä»¬æ˜¯è¦æ±‚æŠ›ç‰©çº¿g(x)=xÂ²-numä¸xè½´äº¤ç‚¹ï¼ˆg(x)=0ï¼‰æœ€æ¥è¿‘çš„ç‚¹ã€‚ æˆ‘ä»¬å‡è®¾g(x0)=0ï¼Œå³x0æ˜¯æ­£è§£ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦åšçš„å°±æ˜¯è®©è¿‘ä¼¼è§£xä¸æ–­é€¼è¿‘x0ï¼Œè¿™æ˜¯å‡½æ•°å¯¼æ•°çš„å®šä¹‰ï¼š å¯ä»¥ç”±æ­¤å¾—åˆ° ä»å‡ ä½•å›¾å½¢ä¸Šçœ‹ï¼Œå› ä¸ºå¯¼æ•°æ˜¯åˆ‡çº¿ï¼Œé€šè¿‡ä¸æ–­è¿­ä»£ï¼Œå¯¼æ•°ä¸xè½´çš„äº¤ç‚¹ä¼šä¸æ–­é€¼è¿‘x0ã€‚ å¯¹äºä¸€èˆ¬æƒ…å†µï¼š å°†m=2ä»£å…¥ï¼š 123456789101112def sqrt_newton(num): x=sqrt(num) y=num/2.0 count=1 while abs(y-x)&gt;0.00000001: print count,y count+=1 y=((y*1.0)+(1.0*num)/y)/2.0000 return y print(sqrt_newton(5)) print(sqrt(5)) ä¸‰ã€åˆ©ç”¨ç‰›é¡¿è¿­ä»£æ³•å®ç°ç«‹æ–¹123456789101112def cube_newton(num): x=num/3.0 y=0 count=1 while abs(x-y)&gt;0.00000001: print count,x count+=1 y=x x=(2.0/3.0)*x+(num*1.0)/(x*x*3.0) return x print(cube_newton(27))]]></content>
      <categories>
        <category>æŠ€æœ¯æ¢ç´¢</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[pythonå­¦ä¹ (01)]]></title>
    <url>%2F2019%2F09%2F22%2Fpython1%2F</url>
    <content type="text"><![CDATA[å¼€å§‹ç³»ç»Ÿå­¦ä¹ python æœ¬èŠ‚ä¸»è¦å›é¡¾pythonçš„åŸºæœ¬è¯­æ³• åŸºæœ¬è¯­æ³•æ ‡è¯†ç¬¦æ ‡è¯†ç¬¦ç”±å­—æ¯æ•°å­—ä¸‹åˆ’çº¿ç»„æˆï¼Œå¼€å¤´ä¸èƒ½æ˜¯æ•°å­—ï¼ŒåŒºåˆ†å¤§å°å†™ å•ä¸‹åˆ’çº¿å¼€å¤´ _foo çš„ä»£è¡¨ä¸èƒ½ç›´æ¥è®¿é—®çš„ç±»å±æ€§ï¼Œéœ€é€šè¿‡ç±»æä¾›çš„æ¥å£è¿›è¡Œè®¿é—®ï¼Œä¸èƒ½ç”¨ from xxx import è€Œå¯¼å…¥ã€‚ ä»¥åŒä¸‹åˆ’çº¿å¼€å¤´çš„ __fooä»£è¡¨ç±»çš„ç§æœ‰æˆå‘˜ ä»¥åŒä¸‹åˆ’çº¿å¼€å¤´å’Œç»“å°¾çš„ __foo__ä»£è¡¨ Python é‡Œç‰¹æ®Šæ–¹æ³•ä¸“ç”¨çš„æ ‡è¯†ï¼Œå¦‚ init() ä»£è¡¨ç±»çš„æ„é€ å‡½æ•°ã€‚ ä¹¦å†™è¯­æ³• å¤šè¡Œè¯­å¥ å¤šè¡Œæ³¨é‡Š Python å¯ä»¥åŒä¸€è¡Œæ˜¾ç¤ºå¤šæ¡è¯­å¥ï¼Œæ–¹æ³•æ˜¯ç”¨åˆ†å· ; åˆ†å¼€ print é»˜è®¤è¾“å‡ºæ˜¯æ¢è¡Œçš„ï¼Œå¦‚æœè¦å®ç°ä¸æ¢è¡Œéœ€è¦åœ¨å˜é‡æœ«å°¾åŠ ä¸Šé€—å· ,ã€‚ 12#!/usr/bin/env python3# -*- coding: utf-8 -*- ç¬¬ä¸€è¡Œæ³¨é‡Šæ˜¯ä¸ºäº†å‘Šè¯‰Linux/OS Xç³»ç»Ÿï¼Œè¿™æ˜¯ä¸€ä¸ªPythonå¯æ‰§è¡Œç¨‹åºï¼ŒWindowsç³»ç»Ÿä¼šå¿½ç•¥è¿™ä¸ªæ³¨é‡Šï¼› ç¬¬äºŒè¡Œæ³¨é‡Šæ˜¯ä¸ºäº†å‘Šè¯‰Pythonè§£é‡Šå™¨ï¼ŒæŒ‰ç…§UTF-8ç¼–ç è¯»å–æºä»£ç ï¼Œå¦åˆ™ï¼Œä½ åœ¨æºä»£ç ä¸­å†™çš„ä¸­æ–‡è¾“å‡ºå¯èƒ½ä¼šæœ‰ä¹±ç ã€‚ Numberç±»å‹1234567891011121314int(x [,base ]) å°†xè½¬æ¢ä¸ºä¸€ä¸ªæ•´æ•° long(x [,base ]) å°†xè½¬æ¢ä¸ºä¸€ä¸ªé•¿æ•´æ•° float(x ) å°†xè½¬æ¢åˆ°ä¸€ä¸ªæµ®ç‚¹æ•° complex(real [,imag ]) åˆ›å»ºä¸€ä¸ªå¤æ•° str(x ) å°†å¯¹è±¡ x è½¬æ¢ä¸ºå­—ç¬¦ä¸² repr(x ) å°†å¯¹è±¡ x è½¬æ¢ä¸ºè¡¨è¾¾å¼å­—ç¬¦ä¸² eval(str ) ç”¨æ¥è®¡ç®—åœ¨å­—ç¬¦ä¸²ä¸­çš„æœ‰æ•ˆPythonè¡¨è¾¾å¼,å¹¶è¿”å›ä¸€ä¸ªå¯¹è±¡ tuple(s ) å°†åºåˆ— s è½¬æ¢ä¸ºä¸€ä¸ªå…ƒç»„ list(s ) å°†åºåˆ— s è½¬æ¢ä¸ºä¸€ä¸ªåˆ—è¡¨ chr(x ) å°†ä¸€ä¸ªæ•´æ•°è½¬æ¢ä¸ºä¸€ä¸ªå­—ç¬¦ unichr(x ) å°†ä¸€ä¸ªæ•´æ•°è½¬æ¢ä¸ºUnicodeå­—ç¬¦ ord(x ) å°†ä¸€ä¸ªå­—ç¬¦è½¬æ¢ä¸ºå®ƒçš„æ•´æ•°å€¼ hex(x ) å°†ä¸€ä¸ªæ•´æ•°è½¬æ¢ä¸ºä¸€ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ä¸² oct(x ) å°†ä¸€ä¸ªæ•´æ•°è½¬æ¢ä¸ºä¸€ä¸ªå…«è¿›åˆ¶å­—ç¬¦ä¸² Python math æ¨¡å—æä¾›äº†è®¸å¤šå¯¹æµ®ç‚¹æ•°çš„æ•°å­¦è¿ç®—å‡½æ•°ã€‚ Python cmath æ¨¡å—åŒ…å«äº†ä¸€äº›ç”¨äºå¤æ•°è¿ç®—çš„å‡½æ•°ã€‚ å­—ç¬¦ä¸²å’Œç¼–ç ASCIIç¼–ç æ˜¯1ä¸ªå­—èŠ‚ï¼Œè€ŒUnicodeç¼–ç é€šå¸¸æ˜¯2ä¸ªå­—èŠ‚ã€‚ æŠŠUnicodeç¼–ç è½¬åŒ–ä¸ºâ€œå¯å˜é•¿ç¼–ç â€çš„UTF-8ç¼–ç ã€‚UTF-8ç¼–ç æŠŠä¸€ä¸ªUnicodeå­—ç¬¦æ ¹æ®ä¸åŒçš„æ•°å­—å¤§å°ç¼–ç æˆ1-6ä¸ªå­—èŠ‚ï¼Œå¸¸ç”¨çš„è‹±æ–‡å­—æ¯è¢«ç¼–ç æˆ1ä¸ªå­—èŠ‚ï¼Œæ±‰å­—é€šå¸¸æ˜¯3ä¸ªå­—èŠ‚ï¼Œåªæœ‰å¾ˆç”Ÿåƒ»çš„å­—ç¬¦æ‰ä¼šè¢«ç¼–ç æˆ4-6ä¸ªå­—èŠ‚ã€‚å¦‚æœä½ è¦ä¼ è¾“çš„æ–‡æœ¬åŒ…å«å¤§é‡è‹±æ–‡å­—ç¬¦ï¼Œç”¨UTF-8ç¼–ç å°±èƒ½èŠ‚çœç©ºé—´ åœ¨è®¡ç®—æœºå†…å­˜ä¸­ï¼Œç»Ÿä¸€ä½¿ç”¨Unicodeç¼–ç ï¼Œå½“éœ€è¦ä¿å­˜åˆ°ç¡¬ç›˜æˆ–è€…éœ€è¦ä¼ è¾“çš„æ—¶å€™ï¼Œå°±è½¬æ¢ä¸ºUTF-8ç¼–ç ã€‚ ç”¨è®°äº‹æœ¬ç¼–è¾‘çš„æ—¶å€™ï¼Œä»æ–‡ä»¶è¯»å–çš„UTF-8å­—ç¬¦è¢«è½¬æ¢ä¸ºUnicodeå­—ç¬¦åˆ°å†…å­˜é‡Œï¼Œç¼–è¾‘å®Œæˆåï¼Œä¿å­˜çš„æ—¶å€™å†æŠŠUnicodeè½¬æ¢ä¸ºUTF-8ä¿å­˜åˆ°æ–‡ä»¶ï¼š å¯¹äºå•ä¸ªå­—ç¬¦çš„ç¼–ç ï¼ŒPythonæä¾›äº†ord()å‡½æ•°è·å–å­—ç¬¦çš„æ•´æ•°è¡¨ç¤ºï¼Œchr()å‡½æ•°æŠŠç¼–ç è½¬æ¢ä¸ºå¯¹åº”çš„å­—ç¬¦ï¼š Pythonçš„å­—ç¬¦ä¸²ç±»å‹æ˜¯strï¼Œåœ¨å†…å­˜ä¸­ä»¥Unicodeè¡¨ç¤ºï¼Œä¼ è¾“æ—¶éœ€è¦è½¬æ¢æˆbyteså¯¹bytesç±»å‹çš„æ•°æ®ç”¨å¸¦bå‰ç¼€çš„å•å¼•å·æˆ–åŒå¼•å·è¡¨ç¤º å­—ç¬¦ä¸²å¼€å¤´çš„å«ä¹‰ b r éè½¬ä¹‰åŸç”Ÿå­—ç¬¦ u unicodeç¼–ç å­—ç¬¦ï¼Œpython3é»˜è®¤å­—ç¬¦ä¸²ç¼–ç æ–¹å¼ã€‚ ä½¿ç”¨encodeå’Œdecodeè¿›è¡Œç¼–è§£ç  Listå’Œtuplelist æœ‰åºé›†åˆ tuple åˆå§‹åŒ–åæ— æ³•ä¿®æ”¹çš„æœ‰åºåˆ—è¡¨ åœ¨å®šä¹‰çš„æ—¶å€™ï¼Œtupleçš„å…ƒç´ å°±å¿…é¡»è¢«ç¡®å®šä¸‹æ¥ åªæœ‰1ä¸ªå…ƒç´ çš„tupleå®šä¹‰æ—¶å¿…é¡»åŠ ä¸€ä¸ªé€—å·,ï¼Œæ¥æ¶ˆé™¤æ­§ä¹‰ dictå’Œsetdict åˆç§°mapï¼Œä½¿ç”¨é”®-å€¼ï¼ˆkey-valueï¼‰å­˜å‚¨ï¼Œå…·æœ‰æå¿«çš„æŸ¥æ‰¾é€Ÿåº¦ åˆ¤æ–­keyä¸å­˜åœ¨ é€šè¿‡inåˆ¤æ–­keyæ˜¯å¦å­˜åœ¨ é€šè¿‡dictæä¾›çš„get()æ–¹æ³•ï¼Œå¦‚æœkeyä¸å­˜åœ¨ï¼Œå¯ä»¥è¿”å›Noneï¼Œæˆ–è€…è‡ªå·±æŒ‡å®šçš„value dictæ˜¯ç”¨ç©ºé—´æ¥æ¢å–æ—¶é—´çš„ä¸€ç§æ–¹æ³•ã€‚ hasnç®—æ³•å†³å®škeyä¸å¯å˜ set ä¸é‡å¤çš„keyçš„é›†åˆ æ³¨æ„ä¸å¯å˜å¯¹è±¡ï¼Œä¾‹å¦‚str]]></content>
      <categories>
        <category>å­¦ä¹ ç¬”è®°</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[UIè®¾è®¡å°ºå¯¸é—®é¢˜â€”â€”ç§»åŠ¨ç«¯]]></title>
    <url>%2F2019%2F09%2F18%2Fui%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘æ­£åœ¨åšå‰ç«¯çš„UIï¼Œæœ¬æ¥ä»¥ä¸ºä¼šæ˜¯ä¸€ä»¶å¾ˆç®€å•çš„äº‹æƒ…ï¼Œä½†ä¸€æ¥äºŒå»ä¹Ÿæäº†æ•´æ•´ä¸€å¤©ã€‚å…¶ä¸­æœ€è®©æˆ‘éƒé—·çš„æ˜¯åœ¨äº†PSè®¾ç½®ç”»å¸ƒå°ºå¯¸çš„æ—¶å€™æ²¡æœ‰åšå……åˆ†çš„è°ƒæŸ¥ï¼Œç†è§£é”™äº†åŒå­¦å£ä¸­çš„å°ºå¯¸æ„ä¹‰ï¼Œå¯¼è‡´UIç”»å®Œäº†æ‰å‘ç°å°ºå¯¸æ•´æ•´å°äº†ä¸€åœˆğŸ˜‚æ€ä¹ˆåŠï¼Ÿé‡ç”»å‘—~ è¿™æ¬¡æˆ‘å¸å–æ•™è®­ï¼Œæ•´ç†äº†ç›¸å…³èµ„æ–™ï¼Œè¿™æ¬¡ä¸€å®šè¦ä¸€ä¸¾å‡»ç ´åƒç´ å°ºå¯¸é—®é¢˜ï¼ ç‰©ç†å°ºå¯¸è‹±å¯¸è‹±å¯¸(inch)æ˜¯è¡¡é‡è®¾å¤‡å°ºå¯¸çš„å¸¸ç”¨å•ä½ å®ƒä»£è¡¨çš„æ˜¯å±å¹•å¯¹è§’çº¿çš„é•¿åº¦ ä¸€è‹±å¯¸â‰ˆ2.54cm åˆ†è¾¨ç‡åƒç´ åƒç´ æ˜¯å±å¹•çš„æœ€å°å•ä½ï¼Œæ‰€æœ‰å›¾ç‰‡éƒ½æ˜¯ç”±æ— æ•°ä¸ªåƒç´ ç‚¹æ„æˆã€‚ åƒç´ åº”è¯¥æ˜¯ç”¨æ¥è¡¡é‡å°ºå¯¸çš„ï¼Œåƒç´ ç‚¹å’Œå°ºå¯¸æˆæ­£æ¯” å±å¹•åˆ†è¾¨ç‡ åˆ†è¾¨ç‡å³å‚ç›´å’Œæ°´å¹³æ–¹å‘ä¸Šçš„åƒç´ ç‚¹æ•°,ä¾‹å¦‚1080*1920 æŒ‡å…·ä½“è®¾å¤‡çš„å±å¹•åƒç´ å°ºå¯¸ï¼Œä¸€èˆ¬æˆ‘ä»¬æ‰€è¯´çš„æ‰‹æœºæˆ–è€…ç”µè„‘ç­‰ç‰©ç†è®¾å¤‡çš„åˆ†è¾¨ç‡çš„æ—¶å€™å°±æ˜¯æŒ‡å±å¹•åˆ†è¾¨ç‡ å±å¹•åˆ†è¾¨ç‡è¶Šé«˜ä¸ä»£è¡¨å±å¹•è¶Šæ¸…æ™°ï¼Œè¿™è¿˜è¦å–å†³è®¾å¤‡çš„ç‰©ç†å°ºå¯¸ã€‚æ¢å¥è¯è¯´ï¼Œåˆ†è¾¨ç‡è¦å’Œç‰©ç†å°ºå¯¸æ­é…æ‰èƒ½ä½“ç°æ¸…æ™°åº¦ï¼Œå› ä¸ºå®ƒç›´æ¥èƒ½è¡¨ç°çš„æ˜¯å±å¹•æ‰€èƒ½å®¹çº³çš„æ€»çš„åƒç´ ç‚¹æ•°ï¼Œå¦‚æœè®¾å¤‡ç‰©ç†å°ºå¯¸ä¸åŒï¼Œæ¯”è¾ƒåˆ†è¾¨ç‡åº”è¯¥æ„ä¹‰ä¸å¤§ã€‚å½“ç„¶è¿™é‡Œçš„åƒç´ åº”è¯¥æŒ‡çš„æ˜¯ç‰©ç†åƒç´ ï¼Œè¿™ç‚¹ä¹‹åä¼šæåˆ°ã€‚ è¿™é‡Œè¦è®°ä½çš„æ˜¯å±å¹•åˆ†è¾¨ç‡/è®¾å¤‡ç‹¬ç«‹åƒç´ (é€»è¾‘åƒç´ ) = å€ç‡ï¼ˆè®¾å¤‡åƒç´ æ¯”ï¼‰è¿™ä¸ªç»“æœæ‰èƒ½çœŸæ­£å®šä¹‰æ¸…æ™°åº¦ å›¾åƒåˆ†è¾¨ç‡å³å›¾ç‰‡æ‰€å«çš„åƒç´ ç‚¹æ•°ï¼Œè¡¨ç¤ºä¸€å¼ å›¾ç‰‡åœ¨å‚ç›´å’Œæ°´å¹³æ–¹å‘ä¸Šçš„åƒç´ ç‚¹æ•° å’Œå±å¹•åˆ†è¾¨ç‡çš„å®šä¹‰å·®ä¸å¤šï¼Œåªä¸è¿‡ä¸€ä¸ªæ˜¯å®šä¹‰å±å¹•çš„ä¸€ä¸ªæ˜¯å®šä¹‰å›¾ç‰‡çš„ã€‚åŒä¸€å°ºå¯¸ä¸‹åˆ†è¾©ç‡è¶Šé«˜ï¼Œå›¾ç‰‡è¶Šæ¸…æ™° PPIï¼ˆPixel per Inchï¼‰ æ¯è‹±å°ºåŒ…å«çš„åƒç´ ç‚¹æ•°ï¼Œå¯ä»¥ç”¨æ¥æè¿°å±å¹•çš„æ¸…æ™°ç¨‹åº¦ PPIè¶Šé«˜ï¼Œå›¾ç‰‡è´¨é‡è¶Šæ¸…æ™°ã€‚ è¿™é‡Œæ³¨æ„åœ¨è®¾è®¡çš„æ—¶å€™ä¸€èˆ¬çº¦å®š æ‰‹æœºå±å¹•ä½¿ç”¨72PPIï¼Œæµ·æŠ¥ä½¿ç”¨300PPI æ®è¯´PPIè¾¾åˆ°300ä»¥ä¸Šï¼Œå°±ä¼šç»™äººçœŸå®æ„Ÿï¼Œå› æ­¤æµ·æŠ¥çš„PPIè¦è¾¾åˆ°è¿™ä¸ªæ•°å€¼ï¼Œè€Œæ‰‹æœºå±å¹•å¦‚æœPPIè®¾ç½®è¿‡å¤§ï¼Œä¼šå¯¼è‡´åŠ è½½è¿‡æ…¢ï¼Œå¡é¡¿çš„ç°è±¡ï¼Œä¸€èˆ¬72PPIä¹Ÿå¤Ÿç”¨äº† PPIçš„è®¡ç®—å…¬å¼ DPIï¼ˆDot per Inchï¼‰ æ¯è‹±å¯¸åŒ…æ‹¬çš„ç‚¹æ•°ã€‚å®ƒå¯ä»¥æ˜¯å±å¹•åƒç´ ç‚¹ã€å›¾ç‰‡åƒç´ ç‚¹ä¹Ÿå¯ä»¥æ˜¯æ‰“å°æœºçš„å¢¨ç‚¹ã€‚ åœ¨æè¿°å›¾ç‰‡å’Œå±å¹•çš„æ—¶å€™å¯ä»¥è®¤ä¸ºDPIå’ŒPPIä¸¤è€…ç­‰ä»· åœ¨ä½¿ç”¨æ‰“å°æœºçš„æ—¶å€™ï¼Œç”±äºæ‰“å°æœºæ‰“å°çš„ç‚¹ä¸æ˜¯è§„åˆ™æ’åˆ—çš„ï¼Œæ‰“å°ç‚¹ä¹‹é—´ä¼šå­˜åœ¨ç©ºéš™ï¼Œå› æ­¤DPIä¹Ÿè¢«ç§°ä¹‹ä¸ºæ‰“å°ç‚¹çš„å¯†åº¦ æ‰“å°æœºçš„DPIè¶Šé«˜ï¼Œæ‰“å°å›¾åƒçš„ç²¾ç»†ç¨‹åº¦è¶Šé«˜ï¼ŒåŒæ—¶å¢¨ç‚¹çš„è€—è´¹é‡å’Œæ‰“å°æ—¶é—´ä¹Ÿè¶Šé•¿ é€»è¾‘åƒç´ å’Œç‰©ç†åƒç´ ä»¥ä¸Šæˆ‘ä»¬çœ‹åˆ°çš„åƒç´ éƒ½æ˜¯çœŸå®çš„åƒç´ ï¼Œæ˜¯ç‰©ç†åƒç´  ä½†æ˜¯éšç€æŠ€æœ¯çš„å‘å±•å‡ºç°äº†é€»è¾‘åƒç´ ï¼Œå³ç”±å¤šä¸ªç‰©ç†åƒç´ ç»„æˆä¸€ä¸ªé€»è¾‘åƒç´ ã€‚ è¿™æ˜¯ç”±ä¹”å¸ƒæ–¯åœ¨Iphone4çš„å‘å¸ƒä¼šä¸Šå‘å¸ƒçš„è§†ç½‘è†œå±å¹•ï¼ˆRetina Displayï¼‰é¦–æ¬¡æå‡ºçš„ ä¸€ä¸ªå¾ˆç›´è§‚çš„å¯¹æ¯”å°±æ˜¯ï¼Œç”±é€»è¾‘åƒç´ ï¼ˆå‡è®¾ä¸€ä¸ªé€»è¾‘åƒç´ ç”±3ä¸ªç‰©ç†åƒç´ ç»„æˆï¼‰ç»„æˆçš„åˆ†è¾¨ç‡ä¸º10801920çš„å›¾ç‰‡ï¼Œå’Œä¸€ä¸ªç”±ç‰©ç†åƒç´ ç»„æˆçš„åˆ†è¾¨ç‡ä¸º`10801920`çš„å›¾ç‰‡ï¼Œåœ¨åƒç´ æ€»é‡ä¸€å®šçš„å‰æä¸‹ï¼Œå‰è€…çš„å›¾ç‰‡å°ºå¯¸æ˜¯åè€…çš„3å€ï¼Œè¯•æƒ³æƒ³å¦‚æœæŠŠè¿™ä¸ª3å€çš„å°ºå¯¸å›¾ç‰‡å‹ç¼©åˆ°1å€çš„å›¾ç‰‡ä¸­ï¼Œæ˜¯ä¸æ˜¯æ¸…æ™°åº¦éª¤ç„¶å°±æå‡äº†å‘¢ï¼Ÿ è®¾å¤‡ç‹¬ç«‹åƒç´ è®¾å¤‡ç‹¬ç«‹åƒç´ ï¼ŒæŒ‡è®¾å¤‡çš„åŸå§‹å°ºå¯¸ï¼Œè¿™é‡Œçš„åƒç´ æ˜¯é€»è¾‘åƒç´  æ‰“å¼€chromeçš„å¼€å‘è€…å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥æ¨¡æ‹Ÿå„ä¸ªæ‰‹æœºå‹å·çš„æ˜¾ç¤ºæƒ…å†µï¼Œæ¯ç§å‹å·ä¸Šé¢ä¼šæ˜¾ç¤ºä¸€ä¸ªå°ºå¯¸ï¼Œæ¯”å¦‚iPhone Xæ˜¾ç¤ºçš„å°ºå¯¸æ˜¯375x812ï¼Œå®é™…iPhone Xçš„åˆ†è¾¨ç‡ä¼šæ¯”è¿™é«˜å¾ˆå¤šï¼Œè¿™é‡Œæ˜¾ç¤ºçš„å°±æ˜¯è®¾å¤‡ç‹¬ç«‹åƒç´ ã€‚ è®¾å¤‡åƒç´ æ¯”DPRdevice pixel ratioç®€ç§°DIPæˆ–DP,æŒ‡è®¾å¤‡çš„ç‰©ç†åƒç´ å’Œé€»è¾‘åƒç´ ä¹‹æ¯”ï¼Œä¹Ÿç§°ä¹‹ä¸ºå€æ•° å¼€å‘é—®é¢˜ç§»åŠ¨ç«¯iOSçš„å°ºå¯¸å•ä½ä¸ºptï¼ŒAndroidçš„å°ºå¯¸å•ä½ä¸ºdpï¼ŒReact Nativeä¸­æ²¡æœ‰æŒ‡å®šæ˜ç¡®çš„å•ä½ï¼Œå®ƒä»¬å…¶å®éƒ½æ˜¯è®¾å¤‡ç‹¬ç«‹åƒç´ dp(Device Pixel)ã€‚ WEBç«¯CSSåƒç´ ä½¿ç”¨çš„æ˜¯è®¾å¤‡ç‹¬ç«‹åƒç´ (é€»è¾‘åƒç´ ) UIå‡†å¤‡å›¾çš„æ—¶å€™æ ¹æ®å±å¹•çš„è´¨é‡ï¼ˆ2å€å±æˆ–3å€å±ï¼‰å‡†å¤‡2å€å’Œ3å€çš„åƒç´ å°ºå¯¸è¿›è¡Œç»˜å›¾ åœ¨å†™CSSæ—¶ï¼Œæˆ‘ä»¬ç”¨åˆ°æœ€å¤šçš„å•ä½æ˜¯pxï¼Œå³CSSåƒç´ ï¼Œå½“é¡µé¢ç¼©æ”¾æ¯”ä¾‹ä¸º100%æ—¶ï¼Œä¸€ä¸ªCSSåƒç´ ç­‰äºä¸€ä¸ªè®¾å¤‡ç‹¬ç«‹åƒç´ ã€‚ ä½†æ˜¯CSSåƒç´ æ˜¯å¾ˆå®¹æ˜“è¢«æ”¹å˜çš„ï¼Œå½“ç”¨æˆ·å¯¹æµè§ˆå™¨è¿›è¡Œäº†æ”¾å¤§ï¼ŒCSSåƒç´ ä¼šè¢«æ”¾å¤§ï¼Œè¿™æ—¶ä¸€ä¸ªCSSåƒç´ ä¼šè·¨è¶Šæ›´å¤šçš„ç‰©ç†åƒç´ ã€‚ é¡µé¢çš„ç¼©æ”¾ç³»æ•° = CSSåƒç´  / è®¾å¤‡ç‹¬ç«‹åƒç´  å±å¹•é—®é¢˜æˆ‘ä»¬å¸¸ä½¿ç”¨På’ŒKè¡¡é‡å±å¹•è´¨é‡ Pä»£è¡¨çš„å±å¹•çºµå‘çš„åƒç´ ä¸ªæ•° 1080På³ä»£è¡¨å±å¹•çºµå‘æœ‰1080ä¸ªåƒç´  Kä»£è¡¨çš„å±å¹•æ¨ªå‘çš„åƒç´ ä¸ªæ•° Kä»£è¡¨å±å¹•æ¨ªå‘æœ‰å‡ ä¸ª1024åƒç´ ï¼Œåƒåƒç´ è¶…è¿‡4096ä¸€èˆ¬å°±ç§°ä¹‹ä¸º4Kå± å‚è€ƒæ–‡ç« ï¼šå…³äºç§»åŠ¨ç«¯é€‚é…ï¼Œä½ å¿…é¡»è¦çŸ¥é“çš„]]></content>
      <categories>
        <category>å­¦ä¹ ç¬”è®°</category>
      </categories>
      <tags>
        <tag>è®¾è®¡</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å½“æˆ‘ä»¬é¢å¯¹å‘½è¿çš„æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨æƒ³äº›ä»€ä¹ˆï¼Ÿ]]></title>
    <url>%2F2019%2F09%2F18%2Fdestiney%2F</url>
    <content type="text"><![CDATA[â€œåŒ—æµ·ï¼Œæˆ‘åªèƒ½å‘Šè¯‰ä½ ï¼Œåœ¨é‚£ä¹‹å‰è¦å¤šæƒ³â€ å½“æˆ‘ç‚¹å¼€å®ƒçš„ä¸€ç¬é—´ï¼Œæˆ‘åœ¨æƒ³ä»€ä¹ˆï¼Ÿæ— å¥ˆï¼Ÿææƒ§ï¼Ÿæœ‰å¯¹è¿‡å»çš„å¿æ‚”ï¼Ÿæœ‰åœ¨é»˜é»˜ç¥ˆç¥·ï¼Ÿä¸ç®¡æ€æ ·ï¼Œæˆ‘è‡³å°‘èƒ½ç¡®å®šä¸€ç‚¹ã€‚ é‚£ä¸€åˆ»ï¼Œæˆ‘è¢«å‘½è¿ä¸»å®°äº†ã€‚ æˆ‘ç›¸ä¿¡å‘½è¿å—ï¼Ÿåœ¨æˆ‘ä¿æŒç†æ™ºçš„æ—¶å€™ï¼Œæˆ‘æ˜¯ä¼šå¦è®¤çš„ï¼Œä½†æ¯å½“åœ¨é‚£äº›å…³é”®çš„èŠ‚ç‚¹çš„æ—¶å€™ï¼Œæˆ‘ä¸å¾—ä¸æ‰¿è®¤ï¼Œæˆ‘æ— èƒ½ä¸ºåŠ›ï¼Œå¦‚æœè¯´æˆ‘æ— æ³•æ§åˆ¶æˆ‘æœªæ¥èµ°å‘ï¼Œé‚£ç©¶ç«Ÿæ˜¯è°åœ¨æ§åˆ¶å®ƒï¼Ÿå¤§æ¦‚å°±æ˜¯å‘½è¿å§ã€‚ ä»€ä¹ˆæ˜¯å‘½è¿ï¼Ÿ ~å¾ˆæ˜¾ç„¶ï¼Œæˆ‘ä»¬æš‚æ—¶æ— æ³•å¾—çŸ¥å‘½è¿åœ°å…¨è²Œï¼Œä½†æ˜¯æˆ‘ä»¬èƒ½ç²—ç¥å®ƒçš„çœŸå®¹ã€‚å‘½è¿ä¸ä¼šåè¢’ä»»ä½•ä¸€æ–¹ï¼Œå®ƒæ‰€åšçš„æ‰€æœ‰éƒ½æ˜¯åˆç†çš„ï¼Œå°½ç®¡æœ‰æ—¶å€™ä¼šç”±äºæˆ‘ä»¬è®¤çŸ¥çš„ä¸è¶³è€Œå‡ºç°ä¸€äº›çœ‹ä¼¼å¶ç„¶ï¼Œä½†å®åˆ™å¿…ç„¶çš„äº‹æƒ…ã€‚å®ƒæ˜¯ç»å¯¹å…¬æ­£çš„ã€‚ä½†æ˜¯æˆ‘ä»¬éœ€è¦ç»å¯¹å…¬æ­£å—?æˆ‘ä¸çŸ¥é“ï¼Œè¿™ä¸ªé—®é¢˜ç”¨æˆ‘ç°åœ¨çš„æ€ç»´èƒ½åŠ›æ— æ³•è§£ç­”ã€‚ä½†æ˜¯å¾ˆæœ‰è¶£ï¼Œå¸Œæœ›æœ‰ä¸€å¤©æˆ‘èƒ½çŸ¥é“ æˆ‘çŸ¥é“è¿™æ¬¡æˆ‘åˆæ˜¯æ— èƒ½ä¸ºåŠ›ï¼Œé¢å¯¹å³å°†å‡ºç°çš„æˆç»©æˆ‘æ— å¯å¥ˆä½•ï¼Œæˆ‘ä»»ç”±å‘½è¿ç»™æˆ‘ç­”æ¡ˆã€‚ä½†æ˜¯ä¹Ÿæ­£æ˜¯è¿™ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘å¼€å§‹ç–¯ç‹‚å›å¿†è‡ªå·±çš„æ‰€ä½œæ‰€ä¸ºï¼Œå¼€å§‹å‡æƒ³å„ç§å„æ ·çš„ç»“å±€ï¼Œæ˜æ˜çŸ¥é“è‡ªå·±çš„ç»“å±€å·²ç»æ˜¯ç¡®å®šçš„ï¼Œä½†æ˜¯æ½œæ„è¯†ä¸­ï¼Œä»å¸Œæœ›åšç€çœ‹ä¼¼æ— è°“çš„æŒ£æ‰ã€‚è¿™å°±æ˜¯äººæ€§å§ã€‚ æˆ‘æŠŠå†…å¿ƒçš„æŒ£æ‰å½’ä¸ºæ˜¯è‡ªç”±æ„å¿—çš„ä½“ç°ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆäººç±»èƒ½ä¸æ–­å‰è¿›çš„åŸå› ã€‚å› ä¸ºäººç±»å°±æ˜¯è¿™æ ·ä¸€ç§ä¸ºäº†å¦å®šå‘½è¿è€Œå­˜åœ¨çš„åŠ¨ç‰©ã€‚å› ä¸ºå¯¹è‡ªç”±çš„æ¸´æœ›ï¼Œäººç±»ä¸æ–­åæŠ—ç€ï¼Œå¸Œæœ›æŒæ¡è‡ªå·±çš„å‘½è¿ï¼Œå› æ­¤ä»–ä»¬æˆåŠŸäº†ï¼Œä»–ä»¬è‡ªç”±äº†ï¼Œæ‰€ä»¥äººæˆäº†ä¸‡ç‰©çš„çµé•¿ã€‚æ°¸ä¸åœæ­¢æŠ—äº‰å’Œå¤±å»å¯¹è‡ªç”±çš„è¿½æ±‚ï¼Œè¿™æ˜¯æˆ‘ä»¬çš„å¤©æ€§ã€‚ å‘½è¿ç”±æˆ‘ä¸ç”±å¤©å‘½è¿ç”±æˆ‘ä¸ç”±å¤©ã€‚å°½ç®¡æœ‰çš„æ—¶å€™æˆ‘ä»¬æ— æ³•ä¸»å®°å‘½è¿ï¼Œä½†æ˜¯ä¸èƒ½è®©å‘½è¿å†³å®šæˆ‘ä»¬çš„æœªæ¥ã€‚é“è·¯æ˜¯æ›²æŠ˜çš„ï¼Œä½†æ˜¯å‰é€”æ˜¯å…‰æ˜çš„ï¼Œåœ¨æˆ‘ä»¬çš„è‡ªç”±æ„å¿—ä¸‹ï¼Œç›®æ ‡çš„å®ç°æ˜¯å¿…ç„¶çš„ã€‚ åªæ˜¯ï¼Œç°åœ¨çš„æˆ‘ï¼Œå¼€å§‹å¼€å§‹æ‰¿è®¤å‘½è¿çš„ä¸»å®°åœ°ä½äº†ã€‚å½“é¢å¯¹å‘½è¿çš„æ—¶å€™ï¼Œå·¨å¤§çš„æ— åŠ›æ„Ÿè®©æˆ‘æ— å¯å¥ˆä½•ã€‚æŸæ‰‹æ— ç­–çš„æˆ‘å¤±å»äº†è‡ªå·±çš„è‡ªç”±ã€‚å°½ç®¡æ€è€ƒå†å¤šï¼Œæˆ‘ä¹Ÿæ‰“ä¸å€’å‘½è¿ã€‚ â€œåŒ—æµ·ï¼Œæˆ‘åªèƒ½å‘Šè¯‰ä½ ï¼Œåœ¨é‚£ä¹‹å‰è¦å¤šæƒ³â€ æ˜¯å•Šï¼Œå¦‚æœäººéƒ½åªæ˜¯åœ¨å¤§éš¾ä¸´å¤´çš„æ—¶å€™æ‰æ€è€ƒï¼Œé‚£ä»–ç¦»æ¯ç­ä¹Ÿä¸è¿œäº†ã€‚æ¯”è¿™æ›´å¯æ€•çš„æ˜¯è¢«å‡»å€’åå°±ä¹ æƒ¯äº†ä¸‹è·ªï¼Œå†ç—›çš„ä¼¤æ„ˆåˆåä¹Ÿè¢«å¿˜å¾—ä¸€å¹²äºŒå‡€ã€‚æƒ³ï¼Œè¦å¤šæƒ³ï¼Œè¦æ— æ—¶ä¸åˆ»åœ°æƒ³ã€‚æ—¢ç„¶è®°å¿†æ€»ä¼šè¶‹å‘é€å»ï¼Œé‚£å°±å°±ä¸æ–­åœ°åˆ·æ–°å¼ºåŒ–ï¼Œç”¨æ¯…åŠ›å»åšæŒï¼è¿™æ‰æ˜¯æˆ‘ä»¬çš„è‡ªç”±æ„å¿—ï¼]]></content>
      <categories>
        <category>è¡Œè·¯åŒ†åŒ†ï¼Œéšç¬”æ‚ æ‚ </category>
      </categories>
      <tags>
        <tag>æ„Ÿæ‚Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è¿·å¤±çš„äººè¿·å¤±äº†ï¼Œç›¸é€¢çš„äººè¿˜ä¼šå†ç›¸é€¢]]></title>
    <url>%2F2019%2F09%2F18%2Fspirit-away%2F</url>
    <content type="text"><![CDATA[var ap = new APlayer({ element: document.getElementById("aplayer-wZwItmdp"), narrow: false, autoplay: false, showlrc: false, music: { title: "ã„ã¤ã‚‚ä½•åº¦ã§ã‚‚", author: "ä¼Šè—¤ã‚µãƒã‚³", url: "http://music.163.com/song/media/outer/url?id=584155.mp3", pic: "http://p1.music.126.net/GYWkXtrnAawOWO2nfLg3PA==/109951163028865726.jpg?param=130y130", lrc: "" } }); window.aplayers || (window.aplayers = []); window.aplayers.push(ap); å‰è¨€æˆ‘æ²¡æœ‰ä¿®æ”¹æ–‡å­—çš„ä¹ æƒ¯ã€‚æˆ‘ä»¥ä¸ºä½†å‡¡æ˜¯å†™ä¸‹çš„éƒ½æ˜¯å†…å¿ƒçš„çœŸå®æƒ³æ³•ï¼Œéƒ½æ˜¯è½¬ç¬å³é€çš„çè´µè®°å¿†ï¼Œå°½ç®¡æœ‰æ—¶å€™å†™å‡ºæ¥çš„ä¸œè¥¿æ··ä¹±ä¸å ªï¼Œä½†æ˜¯æˆ‘ä¾ç„¶èƒ½ä»è¿™äº›æ–‡å­—æ€»ä½“ä¼šåˆ°å½“æ—¶æˆ‘çš„æ€ç»ªï¼Œæ‰€ä»¥è¯´æ–‡å­—æ˜¯ä¸€æŠŠæ‰“å¼€è®°å¿†ä¹‹é—¨çš„é’¥åŒ™ï¼ŒåŒæ—¶ä¹Ÿæ˜¯æˆ‘ä¸æ–­åçœçš„å·¥å…·ã€‚å› æ­¤æ‰€æœ‰çš„æ–‡å­—æˆ‘éƒ½åŸæ ·ä¿ç•™ï¼Œç‰¹æ­¤è¯´æ˜ï¼Œå¼•ä»¥ä¸ºè­¦ã€‚ æœ¬ä»¥ä¸ºåˆå°†æ˜¯ä¸€æ¬¡ç—›è‹¦çš„æŠ˜ç£¨ï¼Œä½†æ˜¯å®¤å‹ä»¬çš„æ•å¼€å¿ƒæ‰‰ï¼Œè®©æˆ‘çœŸçš„å‘ç°äº†ä¸€ä¸çš„å…‰äº®ã€‚æˆ‘è‡ªè¯©å­¤ç‹¬ï¼Œåªæ˜¯æˆ‘ä¸€ç›´åœ¨æŠ—æ‹’ï¼Œæˆ–è€…è¯´ä¸€ç›´åœ¨é€ƒé¿ã€‚ä½†æ˜¯æˆ‘çœŸçš„ä¸æ˜¯ä¸€ä¸ªäººï¼Œä»–ä»¬å°±æ˜¯æˆ‘çš„æœ‹å‹ã€‚æˆ‘æ— éœ€åœ¨ä»Šæ™šæ”¹å˜ä»€ä¹ˆï¼Œä½†æ˜¯æˆ‘åªç¡®å®šä¸€ç‚¹ï¼Œä»¥åå¿…é¡»åšå®šä¸ç§»åœ°åšæŒè¿™ä¸€ç‚¹è®¤è¯†ï¼š æˆ‘ä¸æ˜¯ä¸€ä¸ªäººï¼Œæˆ‘æœ‰çœŸæ­£çš„æœ‹å‹ï¼Œå¯¹æœ‹å‹è¯·æ•å¼€å¿ƒæ‰‰ã€‚ 2019.7.2 æ— é¢ç”· ä»–åƒæˆ‘ä½†ä¸æ˜¯æˆ‘ã€‚æˆ‘ä»¬éƒ½æ˜¯å­¤ç‹¬ä¸­æ‰¾ä¸åˆ°è‡ªæˆ‘çš„äººï¼Œæˆ‘ä»¬éƒ½æ˜¯è¢«æ¬²æœ›å¡«å……å°±å¤±å»è‡ªæˆ‘çš„äººã€‚ä»–ç»ˆç©¶æ˜¯å•çº¯çš„ï¼Œæœ€åä¹Ÿèƒ½æ‰¾åˆ°è‡ªå·±çš„å½’å®¿ã€‚è€Œæˆ‘ä¸€ç›´éƒ½æ˜¯æ®‹ç¼ºçš„ï¼Œå¯¹ä¸–ç•Œçš„è”ç³»æ˜¯è„†å¼±çš„ï¼Œæ•…äº‹æ€»æ˜¯ç¾å¥½çš„ï¼Œå³ä½¿æœ‰æ— å¥ˆçš„ç»“å±€ä½†è‡³å°‘è¿˜èƒ½åº†å¹¸æ˜¯è™šå‡çš„ï¼Œæˆ‘æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œæ‰€æœ‰å…³äºæˆ‘çš„ä¸€åˆ‡éƒ½æ˜¯çœŸå®åœ°æ®‹é…·ï¼Œè¿™æ˜¯ä¸€æ¡æ— æ³•å›å¤´çš„è·¯ï¼Œæ²¡æœ‰ä¸€ä¸çš„æ€œæ‚¯ï¼Œæ²¡æœ‰ä¸€ä¸çš„ä¾¥å¹¸ï¼Œèµ°ç€èµ°ç€åªèƒ½åƒæ˜¯ä¸€æ»´æµŠæ³ªå å…¥æ±ªæ´‹ï¼Œåˆ†è§£åœ°æ‚„æ— å£°æ¯åˆæ¶ˆå¤±åœ°æ— å¯å¥ˆä½•ï¼Œä¸–ç•Œä¸ä¼šå› æ­¤æœ‰ä»»ä½•æ”¹å˜ï¼Œå­˜åœ¨ä¹Ÿä¸ä¼šæœ‰ä»»ä½•æ„ä¹‰ï¼Œ äººä¸ºä»€ä¹ˆè¦ç™½ç™½èµ°è¿™ä¸€é­å•Šï¼ 2019.7.3 æˆ‘çŠ¯äº†ä¸€ä¸ªå¾ˆå¤§çš„é”™ã€‚æˆ‘ç›´åˆ°ç°åœ¨éƒ½æ²¡æœ‰çœŸæ­£åœ°å»æ¥çº³è¿™ä¸ªä¸–ç•Œã€‚æˆ‘æ˜¯å­¤ç‹¬çš„ï¼Œå› ä¸ºæˆ‘æ€»æ˜¯æŠŠçœ¼å…‰å±€é™åœ¨äº†è‡ªå·±æ‰€èƒ½è§¦åŠçš„èŒƒå›´å†…ï¼Œè¢«è‡ªå·±çš„è‡†æƒ³æ‰€æŸç¼šï¼Œæ‰€æƒ³å³æ‰€å¾—ï¼ŒçŠ¯äº†å”¯å¿ƒä¸»ä¹‰çš„å¤§å¿Œã€‚å…¶æ¬¡ï¼Œæˆ‘ä¸€ç›´éƒ½æ˜¯çŸ¥é“è·¯çš„ï¼Œä½†æ˜¯æˆ‘ä¸€ç›´åœ¨è·¯æ—ä¼«ç«‹ã€‚åœ¨é™æ­¢çš„æ—¶é—´ä½ ç¡®å®å¯ä»¥å¥½å¥½åçœï¼Œä½†æ˜¯æ²¡æœ‰äº†æµåŠ¨ï¼Œä½ å°±æ— æ³•æ‰“ç ´è‡ªå·±è®¾ä¸‹çš„ç¯ï¼Œæƒ³å¾—å¤ªå¤šï¼Œæ‰€å¾—çš„ç»“æœå´æ€»æ˜¯åŸåœ°æ‰“è½¬ï¼Œåªæœ‰è´Ÿèƒ½é‡åœ¨ä¸æ–­æ”¾å¤§ï¼Œæœ€ç»ˆæ¯’å®³äº†è‡ªå·±ã€‚ æ‰€ä»¥ï¼Œä¸è¦åœä¸‹æ¥å•Šï¼ é‡åˆ°è‡ªå·±è§£å†³ä¸äº†çš„äº‹æƒ…å°±å¤§èƒ†è¯´å‡ºæ¥ï¼Œæ‰€æœ‰çš„çƒ¦æ¼å’Œå›°æƒ‘è¯·åŠæ—¶æŠ›å¼ƒï¼Œåªæœ‰å¤§èƒ†åœ°è¿ˆå‡ºè¿™ä¸€æ­¥ï¼Œä½ æ‰èƒ½èµ°å‡ºæ€ªåœˆã€‚é€ ç‰©ä¸»æ˜¯ç¼ºä¹æƒ³è±¡åŠ›çš„ï¼Œäººä»¬å¤–è²Œç‰¹å¾æ€»æ˜¯ä¼šå’Œåˆ«äººæœ‰éƒ¨åˆ†åœ°ç›¸ä¼¼ï¼Œæ‰€æœ‰ç»å†éƒ½åƒæ˜¯åˆ«äººç»å†çš„ä¸œæ‹¼å››å‡‘ï¼Œå› æ­¤æ²¡æœ‰äººæ˜¯ç‰¹æ®Šçš„ï¼Œæ‰€æœ‰äººéƒ½æ˜¯å¹³å‡¡çš„ã€‚ä½†å¹³å‡¡çš„äººä»¬å´æ˜¯å¯Œæœ‰æƒ³è±¡åŠ›çš„ï¼Œäººä»¬å¯¹äºåŒæ ·çš„äº‹æƒ…ï¼Œä¼šæœ‰ç€ä¸åŒçš„çœ‹æ³•ï¼Œä¼šæœ‰ç€åƒå¥‡ç™¾æ€ªçš„è§£å†³åŠæ³•ï¼Œæ­£å› ä¸ºå¤§å®¶éƒ½æœ‰ä¸€æ®µç»å†çš„ç›¸ä¼¼æ€§ï¼Œå› æ­¤æ‰€æœ‰çš„è§£å†³æ–¹æ³•æ‰æœ‰äº†å€Ÿé‰´çš„å¯èƒ½ï¼Œäººå› æ­¤èƒ½æ€»ç»“å‰äººç•™ä¸‹ çš„ç»éªŒï¼Œä¸ºè‡ªå·±çš„ç»å†å¢æ·»æ–°çš„æ€è·¯çœ‹æ³•ã€‚æˆ‘ä»¬çš„ç›®æ ‡ä»æ¥ä¸æ˜¯è§£å†³å®Œä¸–ç•Œçš„æ‰€æœ‰é—®é¢˜ï¼Œæˆ‘ä»¬ä¹Ÿä¸æœŸæœ›é—®é¢˜éƒ½æœ‰ä¸€ä¸ªæœ€ä½³çš„ç­”æ¡ˆï¼Œå› ä¸ºæˆ‘ä»¬åœ¨æ€è€ƒé—®é¢˜çš„è¿‡ç¨‹ä¸­æ‰€è¿¸å‘çš„æ— ç©·çš„æ™ºæ…§æ‰æ˜¯æˆ‘ä»¬æƒ³è¦ä¼ æ‰¿å’Œå‘æ‰¬çš„å®è—ã€‚ å› æ­¤äººç”Ÿæ˜¯å€¼å¾—çš„ã€‚ å†ä¸€æ¬¡çœ‹çœ‹ã€Šåƒä¸åƒå¯»ã€‹ï¼Œè™½è¯´æ˜¯æƒ³æ‰¾å¯»ä¸€ä¸‹å†…å¿ƒçš„å¹³é™ï¼Œä½†æ˜¯å…¶å®ä¹Ÿæœ‰å¾ˆå¤§ç¨‹åº¦æ˜¯å› ä¸ºè‡ªè¯©ç”µå½±çˆ±å¥½è€…æ€»æƒ³ç»™è‡ªå·±èµ‹äºˆä¸€äº›ä¸“ä¸šåº¦ã€‚å¸Œæœ›èƒ½é€šè¿‡å†æ¬¡å›é¡¾ç”µå½±å»æ¢ç´¢ç”µå½±èƒŒåçš„å¯“æ„ï¼Œæ¥æ»¡è¶³è‡ªå·±çš„è™šè£å¿ƒã€‚äº‹å®è¯æ˜ï¼Œå°½ç®¡ç¬¬äºŒæ¬¡é‡æ¸©ç”µå½±ï¼Œæˆ‘ä¾ç„¶æ²¡æœ‰èƒ½æŠ“ä½ç”µå½±çš„æ·±å±‚å«ä¹‰ï¼Œå¼€åœºç¬¬ä¸€å¹•éŸ³ä¹ä¸€å“èµ·ï¼Œæˆ‘å°±åƒæµ¸æ³¡åœ¨äº†æµ´ç¼¸é‡Œä¸€æ ·ï¼Œèˆ’æœå¾—ä¸æƒ³å†å»åŠ¨è„‘å­ï¼Œåªæƒ³å¥½å¥½æ²‰æµ¸åœ¨ç”µå½±å¸¦æ¥çš„è§‚æ„Ÿä¸­ã€‚å†åŠ ä¸ŠååŠæ®µçš„å‰§æƒ…è‡ªå·±ä¹Ÿå·²è®°å¿†æ¨¡ç³Šï¼Œæ‰€ä»¥åªæ™“å¾—è·Ÿç€å‰§æƒ…èµ°äº†ï¼Œåˆ«çš„å†ä¸æƒ³ï¼ˆæœç„¶è¿˜æ˜¯ä¸æ‡‚è„‘å­æ¯”è¾ƒå¥½~ï¼‰ï¼Œæ€»çš„æ¥è¯´ï¼Œè¿˜æ˜¯å€¼å¾—çš„ ã€‚ å°½ç®¡å¦‚æ­¤ï¼Œç¬¬äºŒæ¬¡è§‚å½±è¿˜æ˜¯ç»™æˆ‘å¸¦æ¥äº†ä¸€äº›ä¸ä¸€æ ·çš„æ„Ÿè§¦ã€‚æ¯”å¦‚ç¬¬ä¸€æ¬¡è®©æˆ‘å¼€å§‹æœ‰æ‰€åçœçš„å°±æ˜¯æ— è„¸ç”·çš„ç™»åœºã€‚æ— è„¸ç”·å–œæ¬¢å°åƒï¼Œå´ä¸æ‡‚ä»€ä¹ˆæ˜¯çˆ± ï¼Œæˆ‘åæ­£è§‰å¾—è¿™å°±æ˜¯æˆ‘çš„å½±å­ã€‚æˆ‘æ¸´æœ›æˆåŠŸå’Œè£èª‰ï¼ˆæˆ–è€…çˆ±æƒ…ä¹Ÿä¸æ˜¯ä¸å¯ä»¥â€“ï¼‰ä½†æ˜¯å´æ‰¾ä¸åˆ°æ–¹æ³•ï¼Œæˆ–è€…è¯´å¾ˆè¿·èŒ«ã€‚æ— è„¸ç”·ä¸ºäº†è®¨å°åƒæ¬¢å¿ƒï¼Œä¸æ–­åœ°æ€è€ƒä»€ä¹ˆæ˜¯äººæ‰€æƒ³è¦çš„ï¼Œæœ€åä»–å‘ç°äº†é‡‘å­ã€‚é‡‘å­çè´µåˆå……æ»¡çš„é­”åŠ›ï¼Œå•çº¯çš„ä»–å¾ˆå¿«å°±è¿·å¤±åœ¨äº†å…¶ä¸­ï¼Œé‡‘å­æ»¡è¶³äº†ä»–çš„æ¬²æœ›ï¼Œæ¬²æœ›ä¸æ–­åœ°è†¨èƒ€ï¼Œæœ€åå¯ä»¥æ‰­æ›²ä¸€ä¸ªäººçš„æ€§æ ¼ã€‚è¢«æ¬²æœ›å¡«å……çš„æ— è„¸ç”·å˜å¾—ä¸‘é™‹ï¼Œæ²¹è…»ï¼Œç‹‚å¦„è‡ªå¤§ï¼Œæ·±é™·å…¶ä¸­ä¸èƒ½è‡ªæ‹”ã€‚è¿›å…¥å¤§å­¦çš„æˆ‘ä¹Ÿæ˜¯ä¸€æ ·çš„è¿·èŒ«ï¼Œå››å¤„ç¢°å£ï¼Œæˆ–æ²‰è¿·äºæ¬²æœ›ä¸­ï¼Œå¤§å­¦çš„è‡ªç”±è®©æˆ‘ä¸å¾—ä¸é¢å¯¹å‘¨å›´è®¸è®¸å¤šå¤šçš„è¯±æƒ‘ï¼Œç„¶è€Œæˆ‘æ²¡æœ‰æˆåŠŸåœ°å…‹åˆ¶ä½è‡ªå·±ï¼Œä»»ç”±æ¬²æœ›ä¸æ–­è†¨èƒ€ï¼Œæˆ‘å¼€å§‹å¤±å»ç›®æ ‡ï¼Œå¼€å§‹å˜å¾—æ— å¥ˆå’Œé¢“åºŸï¼Œæ˜çŸ¥é“è‡ªå·±çš„ç¥¸æ ¹åœ¨å“ªï¼Œå¯å°±æ˜¯æ— æ³•èˆå¼ƒã€‚æˆ‘å†ä¹Ÿå›ä¸åˆ°åŸæ¥çš„çŠ¶æ€äº†ï¼Œé‚£ä¸ªæ°¸ä¸æ”¾å¼ƒï¼Œå•çº¯ï¼Œå‹‡æ•¢çš„å°‘å¹´ï¼Œæ­£æå‰å˜å¾—æ²¹è…»ï¼Œå¤±å»æ–—å¿—ã€‚æ€ä¹ˆåŠï¼Ÿç”µå½±ä¸­è§£å†³æ–¹æ³•å¾ˆæœ‰è¶£ï¼Œæ— è„¸ç”·åƒå¤šäº†æ¬²æœ›ï¼Œå¤šè¿åŠ¨å°±å¥½ã€‚éšç€è¿åŠ¨ä¸æ–­æ’æ³„å‡ºæ— ç”¨çš„æ¬²æœ›ï¼Œç›´åˆ°è‡ªå·±å†ä¸€æ¬¡å­‘ç„¶ä¸€èº«ï¼Œèº«ä½“ä¹Ÿé‡æ–°å˜å¾—ç©ºçµèµ·æ¥ã€‚æ‰€ä»¥ç®€å•å°±æ˜¯ä¸€ç§æ€åº¦ã€‚æˆ‘é‚£ä¸¤ä¸ªåœ¨è¡¡ä¸­çš„å®¤å‹æƒ³å¿µåŸæ¥çš„ç”Ÿæ´»æ–¹å¼ä¹Ÿä¸æ˜¯æ²¡æœ‰é“ç†ï¼Œç°åœ¨çš„æˆ‘å‡ ä¹ä¹Ÿè¦è¢«ä»–ä»¬è¯´æœäº†ã€‚ å¤§å­¦çš„æˆ‘ä»¬æœ‰å¤ªå¤šçš„é€‰æ‹©ï¼Œå¯å¾ˆå¤šæ—¶å€™æˆ‘ä»¬åˆä¸ä¼šé€‰æ‹© è¿™æ ·çš„è¯ï¼Œä¸å¦‚æˆ‘ä»¬å°±ä»å¤´æ¥è¿‡ï¼Œå›åˆ°é«˜ä¸­ç®€ç®€å•å•çš„æ¨¡å¼ï¼Œç»™è‡ªå·±å‡è´Ÿã€‚è¿™å°±æ˜¯èˆå¾—ã€‚ å…¨ç‰‡æœ€è®©æˆ‘æ„ŸåŠ¨çš„å°±æ˜¯åƒå¯»å’Œæ— è„¸ç”·åä¸Šæœ‰è½¨åˆ—è½¦ï¼Œåˆ—è½¦åœ¨æ°´ä¸Šç¼“ç¼“é©¶è¿‡ï¼Œè½¦å¤–é£æ™¯å˜æ¢æ— å¸¸ï¼Œè½¦ä¸Šæ—…å®¢è¡Œè·¯åŒ†åŒ†ï¼Œæˆ‘å’Œä½ è‚©å¹¶è‚©åç€ï¼Œä¸è¯´è¯ï¼Œå°±å¾ˆç¾å¥½ã€‚ è®°ä½è‡ªå·±çš„åå­—ï¼Œå¿˜è®°äº†å°±æ‰¾ä¸å›è‡ªæˆ‘ã€‚ç®€å•å°±æ˜¯ä¸€å¥è¯ï¼Œä¸å¿˜åˆå¿ƒï¼Œæ–¹å¾—å§‹ç»ˆã€‚ ç”µå½±æ’­å®Œï¼Œå­—å¹•å‡ºåœºï¼Œä¼´éšç€ã€Šã„ã¤ã‚‚ä½•åº¦ã§ã‚‚ã€‹çš„EDå“èµ·ï¼Œåˆæ˜¯æ³›èµ·ä¸€é˜µä¸èˆï¼Œåƒè¨€ä¸‡è¯­åŒ–ä½œä¸€å¥è¯ï¼šâ€œè¿™å°±æ˜¯äººç”Ÿå•Šâ€ã€‚ ç«‹ä¸‹ä¸€ä¸ªä¸ç®—æ˜¯Flagçš„Flagï¼šä»¥åè¿˜æ˜¯ä¼šå†è§çš„ï¼Œã€Šåƒã¨åƒå°‹ã®ç¥éš ã—ã€‹]]></content>
      <categories>
        <category>è¡Œè·¯åŒ†åŒ†ï¼Œéšç¬”æ‚ æ‚ </category>
      </categories>
      <tags>
        <tag>å½±è¯„</tag>
        <tag>æ„Ÿæ‚Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mysqlæ•°æ®åº“äº‹åŠ¡åˆè¯†]]></title>
    <url>%2F2019%2F09%2F18%2Ftransaction%2F</url>
    <content type="text"><![CDATA[å‰è¨€ï¼š æœ¬ç¯‡å…±2895å­—ï¼Œé˜…è¯»å¤§çº¦éœ€è¦6åˆ†é’Ÿ æœ¬æ¬¡å°†å‘å¤§å®¶ç§‘æ™®ä¸€äº›æ•°æ®åº“äº‹åŠ¡ç›¸å…³çŸ¥è¯†ã€‚ä¸ºä»€ä¹ˆé€‰æ‹©æ•°æ®åº“ä½œä¸ºæœ¬æ¬¡ä»‹ç»çš„ä¸»è§’ï¼Ÿ æ•°æ®åº“æ˜¯ç°ä»£ç½‘ç»œçš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚åœ¨ä¿¡æ¯çˆ†ç‚¸çš„å¤§æ•°æ®æ—¶ä»£ï¼Œå„è¡Œå„ä¸šéƒ½å› ä¸ºå¤§å¹…çˆ†å‘çš„æ•°æ®è€Œæ­£å˜å¾—è’¸è’¸æ—¥ä¸Šï¼›æµ·é‡ï¼Œå¤šæ ·ä¸”åœ¨é«˜é€Ÿäº§ç”Ÿçš„æ•°æ®æ­£è¿¸å‘ç€å‰æ‰€æœªæœ‰çš„ä»·å€¼ã€‚å¯ä»¥è¯´ï¼Œæ•°æ®æ”¹å˜äº†æˆ‘ä»¬çš„ç”Ÿæ´»ï¼Œä¹Ÿåœ¨åˆ›é€ æˆ‘ä»¬çš„æœªæ¥ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è¶Šæ¥è¶Šéœ€è¦æ›´åŠ çµæ´»ï¼ŒåŠŸèƒ½å¼ºå¤§çš„æ•°æ®åº“æ¥å¸®åŠ©æˆ‘ä»¬å­˜å‚¨æ•°æ®ï¼Œå¤„ç†æ•°æ®ã€‚éšç€æ—¶ä»£çš„å‘å±•ï¼ŒæŒæ¡æ•°æ®åº“æ“ä½œç›¸å…³æŠ€æœ¯å·²ç»æ˜¯ä»äº‹ICTè¡Œä¸šçš„ç›¸å…³äººå‘˜çš„å¿…å¤‡é€‰æ‹©ã€‚ åŸºç¡€æ¦‚å¿µåœ¨æ­£å¼ä»‹ç»äº‹åŠ¡ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆå……å……ç”µï¼Œå¤§è‡´äº†è§£ä¸€äº›åŸºæœ¬æ¦‚å¿µï¼Œè¿™äº›åœ¨ä¹‹åçš„å­¦ä¹ å°†ä¼šç”¨åˆ°ã€‚ ä»€ä¹ˆæ˜¯æ•°æ®åº“ â€œæ•°æ®åº“â€æ˜¯ä»¥ä¸€å®šæ–¹å¼å‚¨å­˜åœ¨ä¸€èµ·ã€èƒ½äºˆå¤šä¸ªç”¨æˆ·å…±äº«ã€å…·æœ‰å°½å¯èƒ½å°çš„å†—ä½™åº¦ã€ä¸åº”ç”¨ç¨‹åºå½¼æ­¤ç‹¬ç«‹çš„æ•°æ®é›†åˆ ä»€ä¹ˆæ˜¯æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆData Base Management Systemï¼Œç®€ç§°DBMSï¼‰æ˜¯ä½äºç”¨æˆ·åº”ç”¨ç¨‹åºä¸æ“ä½œç³»ç»Ÿä¹‹é—´çš„ä¸€å±‚æ•°æ®ç®¡ç†è½¯ä»¶ï¼Œæ˜¯æ•°æ®åº“ç³»ç»Ÿçš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ã€‚ä¸ºç”¨æˆ·æˆ–åº”ç”¨ç¨‹åºæä¾›è®¿é—®æ•°æ®åº“çš„æ–¹æ³•ï¼šåŒ…æ‹¬æ•°æ®åº“çš„å»ºç«‹ã€æŸ¥è¯¢ã€æ›´æ–°ä»¥åŠå„ç§æ•°æ®æ§åˆ¶ã€‚ æ•°æ®åº“ç®¡ç†ç³»ç»Ÿä¸ä»…å…è®¸å•ä¸ªç”¨æˆ·æŸ¥è¯¢å’Œä¿®æ”¹æ•°æ®ï¼Œä¹Ÿå¯ä»¥æ”¯æŒå¤šäººæ“ä½œã€‚å¤šäººæ“ä½œå°±ä¼šå‡ºç°å¯¼è‡´æ“ä½œå¹¶å‘ï¼Œå‡ºç°æ‹¥å¡ã€‚ ä»€ä¹ˆæ˜¯é” é”æ˜¯æ•°æ®åº“æœåŠ¡å™¨ç”¨æ¥æ§åˆ¶æ•°æ®èµ„æºè¢«å¹¶è¡Œä½¿ç”¨çš„ä¸€ç§æœºåˆ¶ã€‚è¢«é”çš„å¯¹è±¡åªå…è®¸æŒæœ‰ç”¨æˆ·æ“ä½œï¼Œåªæœ‰ç­‰é”é‡Šæ”¾åï¼Œå…¶ä»–ç”¨æˆ·æ‰èƒ½æœ‰æ‹¥æœ‰é”çš„æœºä¼šã€‚ å¤§éƒ¨åˆ†æ•°æ®åº“ä½¿ç”¨ä¸‹é¢ä¸¤ç§é”ç­–ç•¥ï¼š å†™æ“ä½œéœ€è¦ç”³è¯·å†™é”ï¼Œè¯»æ“ä½œç”³è¯·è¯»é”ï¼Œä¸€ä¸ªè¡¨ä¸€æ¬¡åªèƒ½åˆ†é…ä¸€ä¸ªå†™é”ï¼Œå¹¶ä¸”æ‹’ç»è¯»è¯·æ±‚ç›´åˆ°å†™é”é‡Šæ”¾ å†™æ“ä½œéœ€è¦å†™é”ï¼Œè¯»æ“ä½œä¸éœ€è¦é” å…¶ä¸­å¸¸è§çš„æ•°æ®åº“å¦‚mysqlå¯ä»¥æ ¹æ®ä¸åŒçš„å­˜å‚¨å¼•æ“é€‰æ‹©ä¸åŒçš„é”ç­–ç•¥ é”çš„ç²’åº¦ å³é”çš„èŒƒå›´ï¼Œåœ¨æ•°æ®åº“ä¸­ï¼ŒæœåŠ¡å™¨å¯ä»¥åœ¨3ä¸ªä¸åŒçº§åˆ«åº”ç”¨é” è¡¨é” é˜»æ­¢å¤šç”¨æˆ·åŒæ—¶ä¿®æ”¹åŒä¸€å¼ è¡¨çš„æ•°æ® é¡µé” é˜»æ­¢å¤šç”¨æˆ·åŒæ—¶ä¿®æ”¹æŸè¡¨ä¸­çš„ä¸€é¡µ è¡Œé” é˜»æ­¢å¤šç”¨æˆ·åŒæ—¶ä¿®æ”¹æŸè¡¨ä¸­çš„æŸä¸€è¡Œ ä»€ä¹ˆæ˜¯å­˜å‚¨å¼•æ“ æ•°æ®åº“å­˜å‚¨å¼•æ“æ˜¯æ•°æ®åº“åº•å±‚è½¯ä»¶ç»„ç»‡,æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ(DBMS)ä½¿ç”¨æ•°æ®å¼•æ“è¿›è¡Œåˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°å’Œåˆ é™¤æ•°æ®ï¼Œä¸åŒçš„å­˜å‚¨å¼•æ“æä¾›ä¸åŒçš„å­˜å‚¨æœºåˆ¶ã€é”å®šæ°´å¹³ç­‰åŠŸèƒ½ã€‚ é”çš„è¡Œä¸ºæ˜¯ç”±å­˜å‚¨å¼•æ“å†³å®šçš„ï¼Œå­˜å‚¨å¼•æ“ä½¿ç”¨ä¸å½“ä¼šå¼•å‘æ­»é”ç°è±¡ ä¾‹å¦‚mysqlæœ‰ä¸‰ç§å­˜å‚¨å¼•æ“ï¼šInnoDB MyISAM MEMORY ä»€ä¹ˆæ˜¯äº‹åŠ¡æˆ‘ä»¬ä»ä¸€ä¸ªåœºæ™¯å¼€å§‹è¯´èµ·ã€‚å‡è®¾ä¸€ä¸ªäººåœ¨é“¶è¡ŒåŠç†è½¬è´¦ä¸šåŠ¡ï¼Œç°åœ¨ä»–è¦å°†1ä¸‡å…ƒè½¬è´¦åˆ°å¦ä¸€ä¸ªäººï¼ŒæŒ‰ä¸€èˆ¬æƒ…å†µï¼Œè½¬è´¦çš„è¿‡ç¨‹å‡ ä¹æ˜¯ç§’çº§å®Œæˆï¼Œä½†æ˜¯ï¼Œå½“æˆ‘ä»¬å°†è¿‡ç¨‹æ‹†è§£ï¼Œè½¬è´¦æ­¥éª¤å¯åˆ†ä¸º3æ­¥ï¼š1.æŸ¥è¯¢è´¦æˆ·ä½™é¢æ˜¯å¦å¤§äº1ä¸‡å…ƒï¼Œ2.ä»åŸè´¦æˆ·ä¸Šå‡å»1ä¸‡å…ƒï¼Œ3.åœ¨å¯¹æ–¹è´¦æˆ·ä¸Šå¢åŠ 1ä¸‡å…ƒã€‚æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå…¶å®åªè¦å…¶ä¸­ä»»æ„ä¸€ä¸ªç¯èŠ‚å‡ºç°åå·®ï¼Œéƒ½æœ‰å¯èƒ½é€ æˆæ— æ³•æŒ½å›çš„é‡å¤§æŸå¤±ã€‚å› æ­¤ï¼Œä¸ºäº†ç¡®ä¿é“¶è¡Œé‡Œé‡‘é¢ä¸ä¼šæŸå¤±ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåšï¼šå°†è¿™ä¸€ä¸‡å…ƒæš‚æ—¶ç¼“å­˜ä¸‹æ¥ï¼Œåªæœ‰ç¡®è®¤å¯¹æ–¹è´¦æˆ·å·²å®Œæˆæ‰£é™¤æ¬¾é¡¹çš„æ“ä½œï¼Œæ‰å°†è¿™ä¸€ä¸‡å…ƒå¢åŠ åˆ°å¯¹æ–¹è´¦æˆ·ï¼›å¦åˆ™ï¼Œæ‰€æœ‰æ“ä½œéƒ½å¤±æ•ˆï¼ŒåŸè´¦æˆ·å–æ¶ˆæ‰£é™¤æ¬¾é¡¹ï¼Œå¯¹æ–¹è´¦æˆ·ä¹Ÿä¸ä¼šæ— æ•…å¢åŠ æ•°é‡ï¼Œæˆ‘ä»¬æŠŠè¿™ç§æ“ä½œç§°ä¹‹ä¸ºäº‹åŠ¡å›æ»šï¼Œè½¬è´¦çš„æ“ä½œå°±æ˜¯ä¸€ä¸ªäº‹åŠ¡ã€‚ äº‹åŠ¡çš„ç‰¹æ€§ä¸–ç•Œä¸Šæ€»æ˜¯å……æ»¡å„ç§å„æ ·çš„æ„å¤–ï¼Œå¾ˆå¤šéƒ½æ˜¯æˆ‘ä»¬æ— æ³•å·¦å³çš„ï¼Œä¾‹å¦‚æœåŠ¡å™¨çš„æŸåï¼Œçªç„¶çš„æ–­ç”µï¼Œç³»ç»Ÿçš„å´©æºƒç­‰ç­‰ï¼Œå¦‚æœæ²¡æœ‰äº‹åŠ¡çš„å­˜åœ¨ï¼Œæ•°æ®åº“çš„æ“ä½œå¯é æ€§å°†æ— æ³•å¾—åˆ°ä¿è¯ã€‚ä½†è¿™äº›çš„å‰ææ˜¯äº‹åŠ¡æœ¬èº«åº”å½“æœ‰å®Œå¤‡çš„æ ‡å‡†æ¥ç¡®ä¿äº‹åŠ¡æœ¬èº«çš„å¯é æ€§ã€‚å› æ­¤ï¼Œé‚£äº›å‰è¾ˆä»¬ç»™äº‹åŠ¡æŒ‡å®šäº†ACIDå››å¤§ç‰¹æ€§ï¼Œåªæœ‰ä¸¥æ ¼é€šè¿‡äº†ACIDæµ‹è¯•ï¼Œäº‹åŠ¡æ‰èƒ½å‘æŒ¥å…¶ä½œç”¨ã€‚ åŸå­æ€§ ä¸€ä¸ªäº‹åŠ¡å¿…é¡»è¢«è§†ä¸ºä¸å¯åˆ†å‰²çš„æœ€å°å·¥ä½œå•å…ƒï¼Œæ•´ä¸ªäº‹åŠ¡ç§çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨æäº¤æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥å›æ»šï¼Œå¯¹äºä¸€ä¸ª äº‹åŠ¡æ¥è¯´ï¼Œä¸å¯èƒ½ æ‰§è¡Œå…¶ä¸­ä¸€éƒ¨åˆ†æ“ä½œã€‚ ä¸€è‡´æ€§ æ•°æ®åº“æ€»æ˜¯ä»ä¸€ä¸ªä¸€è‡´æ€§çš„çŠ¶æ€è½¬ç§»åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çš„çŠ¶æ€ï¼Œäº‹åŠ¡ä¸èƒ½ç ´åæ•°æ®åº“çš„å®Œæ•´æ€§ä»¥åŠä¸šåŠ¡é€»è¾‘çš„ä¸€è‡´æ€§ã€‚æ¯”å¦‚æ— è®ºè½¬è´¦æˆåŠŸæˆ–å¤±è´¥ï¼Œéƒ½ä¸å¯èƒ½ä¼šå¤šå‡ºæˆ–å‡å°‘1ä¸‡å…ƒï¼Œé‡‘é¢æ€»æ•°æ˜¯ä¸å˜çš„ã€‚&gt; éš”ç¦»æ€§ ä¸€ä¸ªäº‹åŠ¡åœ¨æäº¤å‰çš„ä¿®æ”¹å¯¹å…¶ä»–äº‹åŠ¡é€šå¸¸æ˜¯ä¸å¯è§çš„ã€‚ä¸€ä¸ªäº‹åŠ¡ä¸åº”å½±å“å…¶ä»–äº‹åŠ¡çš„è¿è¡Œæ•ˆæœã€‚ æŒä¹…æ€§ ä¸€æ—¦äº‹åŠ¡æäº¤ï¼Œå…¶ä¿®æ”¹æ˜¯ä¸å¯é€†çš„ã€‚ äº‹åŠ¡çš„ACIDç‰¹æ€§ä¿è¯äº†æ•°æ®åº“æ“ä½œçš„å®‰å…¨æ€§å’Œå¯é æ€§ï¼Œä½†å®é™…æ“ä½œæ€»æ²¡æœ‰æƒ³è±¡ä¸­é‚£ä¹ˆç®€å•ã€‚åŒæ—¶ï¼Œæ·»åŠ äº‹åŠ¡ä¹Ÿéœ€è¦æ•°æ®åº“ç³»ç»Ÿè¿›è¡Œæ›´å¤šé¢å¤–çš„å·¥ä½œï¼Œè¿™å¯¹æ•°æ®åº“ç³»ç»Ÿçš„æ€§èƒ½æå‡ºäº†ä¸€å®šçš„è¦æ±‚ã€‚ éš”ç¦»çº§åˆ«å®é™…ä¸Šï¼Œè¦è®©äº‹åŠ¡ä¿è¯å®Œå…¨éš”ç¦»ä¾ç„¶æ˜¯ä¸€ä»¶ååˆ†å›°éš¾çš„äº‹æƒ… ï¼Œå®Œå…¨çš„éš”ç¦»è¦æ±‚æ•°æ®åº“åŒä¸€æ—¶é—´åªèƒ½æ‰§è¡Œä¸€ä¸ªäº‹åŠ¡ï¼Œè¿™æ ·ä¼šä¸¥é‡å½±å“æ€§èƒ½ã€‚ç°å®ä¸­ï¼Œå¾€å¾€æ˜¯å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œã€‚ ä¸€æ—¦éš”ç¦»æ€§æ— æ³•å¾—åˆ°ä¿è¯ï¼Œæ•°æ®åº“çš„è¯»å†™å°±ä¼šé¢ä¸´å¦‚ä¸‹æƒ…å†µ è„è¯»ï¼šäº‹åŠ¡è¯»å–äº†æœªæäº¤çš„æ•°æ®ã€‚ä¾‹å¦‚äº‹åŠ¡Aè¯»å–äº†äº‹åŠ¡Bçš„æ›´æ–°çš„æ•°æ®ï¼Œä½†æ˜¯äº‹åŠ¡Bå›æ»šäº†ï¼Œå¯¼è‡´Aè¯»å–çš„ä¸ºè„æ•°æ® ä¸å¯é‡å¤è¯»ï¼šäº‹åŠ¡Aè¯»å–åŒä¸€æ•°æ®ä¸¤æ¬¡ï¼Œä½†æ˜¯åœ¨ä¸¤æ¬¡ä¹‹é—´äº‹åŠ¡Bå¯¹è¯¥æ•°æ®è¿›è¡Œäº†ä¿®æ”¹å¹¶æäº¤ï¼Œå¯¼è‡´äº‹åŠ¡Aè¯»å–ä¸¤æ¬¡è¯»å–ä¸ä¸€è‡´ å¹»è¯»ï¼šäº‹åŠ¡Aä¿®æ”¹å…¨è¡¨çš„æ•°æ®ï¼Œåœ¨æœªæäº¤æ—¶ï¼Œäº‹åŠ¡Bå‘è¡¨ä¸­æ’å…¥æˆ–åˆ é™¤æ•°æ®ï¼Œå¯¼è‡´äº‹åŠ¡Aè¯»å–çš„æ•°æ®ä¸éœ€è¦ä¿®æ”¹çš„æ•°æ®ä¸ä¸€è‡´ å¯¹æ­¤ï¼Œsqlæ ‡å‡†ä¸­æŒ‡å®šäº†å››ç§éš”ç¦»çº§åˆ«ï¼š æœªæäº¤è¯»ï¼ˆREAD UNCOMMITTEDï¼‰ äº‹åŠ¡å¯ä»¥è¯»å–ä¸ºæäº¤çš„æ•°æ®ï¼Œä¸åšéš”ç¦»æ§åˆ¶ æäº¤è¯»ï¼ˆREAD COMMITTEDï¼‰ ä¸å…è®¸æœªæäº¤è¯»,ä¸€ä¸ªäº‹åŠ¡å¼€å§‹å‰ï¼Œåªèƒ½â€œçœ‹è§â€å·²æäº¤çš„äº‹åŠ¡ä¿®æ”¹ï¼Œæ˜¯å¤§éƒ¨åˆ†æ•°æ®åº“çš„é»˜è®¤éš”ç¦»çº§åˆ«ï¼ˆmysqlé™¤å¤–ï¼‰ å¯é‡å¤è¯»ï¼ˆREPEATED READï¼‰ ä¿è¯åŒä¸€äº‹åŠ¡ä¸­å¤šæ¬¡è¯»å–åŒä¸€è®°å½•çš„ç»“æœæ˜¯ä¸€è‡´çš„ï¼Œä¸€èˆ¬æ–¹æ³•æ˜¯äº‹åŠ¡ä¸­å¯¹ç¬¦åˆæ¡ä»¶çš„è®°å½•ä¸Šæ’ä»–é”ï¼Œè¿™æ ·å…¶ä»–äº‹åŠ¡ä¸èƒ½å¯¹è¯¥äº‹åŠ¡æ“ä½œçš„æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œæ˜¯mysqlçš„é»˜è®¤éš”ç¦»çº§åˆ« å¯ä¸²è¡ŒåŒ–(SERIALIZABLE) æ˜¯æœ€é«˜éš”ç¦»çº§åˆ«ï¼Œé€šè¿‡å¼ºåˆ¶äº‹åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œåœ¨è¯»å–çš„æ¯ä¸€è¡Œæ•°æ®ä¸ŠåŠ é”ï¼Œå¯¼è‡´å…¶ä»–äº‹åŠ¡ä¸èƒ½å¯¹æ•°æ®è¿›è¡Œæ“ä½œï¼ˆåŒ…æ‹¬å¢åŠ ã€åˆ é™¤å’Œä¿®æ”¹ï¼‰ï¼Œä½†æ˜¯æ­¤çº§åˆ«ä¹Ÿè¦æ³¨æ„å¤§é‡é”çš„è¶…æ—¶ä¼šæå¤§åœ°å½±å“æ€§èƒ½ã€‚ éš”ç¦»çº§åˆ« è„è¯» ä¸å¯é‡å¤è¯» å¹»è¯» æœªæäº¤è¯»ï¼ˆREAD UNCOMMITTEDï¼‰ æ˜¯ æ˜¯ æ˜¯ æäº¤è¯»ï¼ˆREAD COMMITTEDï¼‰ å¦ æ˜¯ æ˜¯ å¯é‡å¤è¯»ï¼ˆREPEATED READï¼‰ å¦ å¦ æ˜¯ å¯ä¸²è¡ŒåŒ–(SERIALIZABLE) å¦ å¦ å¦ é˜»å¡å’Œæ­»é”è°ˆåˆ°å¹¶å‘å°±å¤§è‡´è°ˆä¸€ä¸‹é˜»å¡çš„æ¦‚å¿µ å½“å¤šä¸ªäº‹åŠ¡å¯¹æŸä¸€èµ„æºè¿›è¡Œé”å®šæ—¶ï¼Œå…¶ä»–æ²¡æœ‰åˆ†é…åˆ°é”çš„äº‹åŠ¡åŠ¿å¿…ç­‰å¾…é”çš„é‡Šæ”¾ï¼Œè¿™å°±é€ æˆäº†é˜»å¡ã€‚ å½“é˜»å¡æ—¶é—´è¾¾åˆ°æ°¸ä¹…ï¼Œå°±å½¢æˆäº†æ­»é”ã€‚ åœ¨äº‹åŠ¡ä¸­ï¼Œä¸€æ—¦ä¸¤ä¸ªåŠä»¥ä¸Šçš„äº‹åŠ¡åœ¨åŒä¸€èµ„æºä¸Šç›¸äº’å ç”¨ï¼Œå¹¶è¯·æ±‚é”å®šå¯¹æ–¹å ç”¨çš„èµ„æºï¼Œå°±ä¼šå¼•å‘æ­»é”ç°è±¡ã€‚ è§£å†³æ€è·¯ æŸ¥è¯¢æ—¶é—´è¾¾åˆ°é”çš„è¶…æ—¶æ—¶é—´åæ”¾å¼ƒè¯·æ±‚ ä½¿ç”¨è¾ƒä½çš„éš”ç¦»çº§åˆ«ï¼Œè®©æŒæœ‰é”çš„æ—¶é—´å‡çŸ­ï¼Œå‡å°‘é”ç«äº‰ é¿å…äº‹åŠ¡ä¸­ç”¨æˆ·äº¤äº’ï¼ŒåŒæ—¶å°½é‡é¡ºåºè®¿é—®å¯¹è±¡ â€¦â€¦. ä¸åŒçš„å­˜å‚¨å¼•æ“å¯¹æ­»é”å®ç°äº†ä¸åŒçš„æ­»é”æ£€æµ‹å’Œæ­»é”è¶…æ—¶æœºåˆ¶ï¼Œå› æ­¤å¤§å®¶åœ¨è€ƒè™‘æ­»é”çš„è§£å†³æ–¹æ¡ˆçš„æ—¶å€™ä¸€å®šè¦ç»“åˆæ•°æ®åº“å­˜å‚¨å¼•æ“çš„å®ç°æ–¹æ¡ˆï¼Œå¹¶ä¸”åšå¥½äº‹åŠ¡æ—¥å¿—ï¼Œä»¥ä¾¿åœ¨é—®é¢˜å‘ç”Ÿæ—¶è¿›è¡Œæœ‰æ•ˆæ’æŸ¥å’Œé«˜æ•ˆè§£å†³ã€‚ äº‹åŠ¡çš„é˜»å¡å’Œæ­»é”çš„å‡ºç°å®é™…ä¸Šæ˜¯å¤šä¸ªè¿›ç¨‹å¹¶å‘çš„å¿…ç„¶ç»“æœï¼Œå¤§å®¶å¦‚æœæƒ³äº†è§£æ›´å¤šå…³äºæœ‰å…³å¹¶å‘å’Œé”ï¼Œå¯ä»¥è‡ªè¡Œäº†è§£ç›¸å…³çŸ¥è¯†ã€‚ æ€»ç»“æœ¬ç¯‡ç¬”è€…å¸¦å¤§å®¶åˆè¯†æ•°æ®åº“äº‹åŠ¡ï¼Œåˆæ­¥äº†è§£äº†ï¼š ä»€ä¹ˆæ˜¯æ•°æ®åº“ã€ä»€ä¹ˆæ˜¯é”å’Œäº‹åŠ¡; äº‹åŠ¡çš„å››ä¸ªç‰¹æ€§ï¼šåŸå­æ€§ã€éš”ç¦»æ€§ã€ä¸€è‡´æ€§ã€æŒä¹…æ€§; æ•°æ®åº“è¯»å†™å‡ºç°çš„æƒ…å†µï¼šè„è¯»ã€å¹»è¯»å’Œä¸å¯é‡å¤è¯»; äº‹åŠ¡çš„éš”ç¦»çº§åˆ«; æ­»é”çš„å‡ºç°å’Œè§£å†³æ€è·¯ å› ä¸ºç¯‡å¹…æœ‰é™ï¼Œè¿™é‡Œåªèƒ½æµ…å°è¾„æ­¢ã€‚æ•°æ®åº“æ˜¯ä¸€é—¨åºå¤§å¤æ‚åˆæå…¶é‡è¦çš„å­¦ç§‘ï¼Œå¦‚æœå¤§å®¶æœ‰å…´è¶£ï¼Œé¼“åŠ±å¤§å®¶è‡ªå·±å‡¿æ¸ å¼•æ°´ï¼Œå› ç¬”è€…çŸ¥è¯†æœ‰é™ï¼Œæ–‡ç« å†…å®¹æ‰€è¿°éš¾å…å­˜åœ¨è°¬è¯¯ï¼Œæ³è¯·å¹¿å¤§è¯»è€…æ–§æ­£ã€‚ çŸ¥è¯†é“¾æ¥æ•°æ®åº“å­¦ä¹ ã€ŠSQLå­¦ä¹ æŒ‡å—ã€‹ï¼Œã€Šé«˜æ€§èƒ½MYSQLã€‹]]></content>
      <categories>
        <category>å­¦ä¹ ç¬”è®°</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[VRRPå…¥é—¨]]></title>
    <url>%2F2019%2F09%2F18%2Fvrrp%2F</url>
    <content type="text"><![CDATA[èƒŒæ™¯éšç€ç§»åŠ¨åŠå…¬ã€ç½‘ä¸Šè´­ç‰©ã€å³æ—¶é€šè®¯ã€äº’è”ç½‘é‡‘èã€äº’è”ç½‘æ•™è‚²ç­‰ä¸šåŠ¡è“¬å‹ƒå‘å±•ï¼Œç½‘ç»œæ‰¿è½½çš„ä¸šåŠ¡è¶Šæ¥è¶Šå¤šï¼Œè¶Šæ¥è¶Šé‡è¦ã€‚æ‰€ä»¥å¦‚ä½•ä¿è¯ç½‘ç»œçš„ä¸é—´æ–­ä¼ è¾“æˆä¸ºç½‘ç»œå‘å±•è¿‡ç¨‹ä¸­æ€¥éœ€è§£å†³çš„ä¸€ä¸ªé—®é¢˜ã€‚ å¯¹æ­¤ï¼Œå…¶ä¸­ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œä½¿ç”¨ä¸€å¥—ä½¿ç”¨ä¸€å¥—å†—ä½™å¤‡ä»½æœºåˆ¶ï¼Œé¿å…ä¼ ç»Ÿç»„ç½‘å¼•å‘çš„å•ç‚¹æ•…éšœï¼Œä»¥ä¾¿åœ¨è·¯ç”±å™¨å‡ºç°æ•…éšœçš„æ—¶å€™åŠæ—¶è¿›è¡Œé“¾è·¯åˆ‡æ¢ï¼Œä¿è¯ä¸šåŠ¡å¹³æ»‘è¿›è¡Œã€‚ ä¼ ç»Ÿè§£å†³æ–¹æ¡ˆ é…å¤‡å¤šå°è·¯ç”±å™¨è§£å†³å•ç‚¹æ•…éšœ ä½¿ç”¨åŠ¨æ€è·¯ç”±åè®®è§£å†³å¤šç½‘å…³å†²çªï¼Œå®ç°é“¾è·¯å›åˆ‡ ä½†æ˜¯ä¼ ç»Ÿæ–¹æ¡ˆä¾ç„¶å­˜åœ¨å‡ ä¸ªé—®é¢˜ ä¸€äº›åŠ¨æ€è·¯ç”±åè®®ä½¿ç”¨å¹¿æ’­æŠ¥æ–‡è¿›è¡Œé“¾è·¯åˆ‡æ¢é€Ÿåº¦ä¸Šæ¯”è¾ƒç¼“æ…¢ åœ¨è®¸å¤šæƒ…æ™¯ä¸‹å¯èƒ½ä¼šä¸æ”¯æŒä½¿ç”¨åŠ¨æ€è·¯ç”± äºæ˜¯ï¼ŒVRRPåº”è¿è€Œç”Ÿã€‚ VRRPçš„åŸºæœ¬æ¦‚å¿µVRRP è™šæ‹Ÿè·¯ç”±å†—ä½™åè®®(Virtual Router Redundancy Protocolï¼Œç®€ç§°VRRP)æ˜¯ç”±IETFæå‡ºçš„è§£å†³å±€åŸŸç½‘ä¸­é…ç½®é™æ€ç½‘å…³å‡ºç°å•ç‚¹å¤±æ•ˆç°è±¡çš„è·¯ç”±åè®®ã€‚ VRRPèƒ½å¤Ÿåœ¨ä¸æ”¹å˜ç»„ç½‘çš„æƒ…å†µä¸‹ï¼Œå°†å¤šå°è·¯ç”±å™¨è™šæ‹Ÿæˆä¸€ä¸ªè™šæ‹Ÿè·¯ç”±å™¨ï¼Œé€šè¿‡é…ç½®è™šæ‹Ÿè·¯ç”±å™¨çš„IPåœ°å€ä¸ºé»˜è®¤ç½‘å…³ï¼Œå®ç°ç½‘å…³çš„å¤‡ä»½ ä¼˜åŠ¿é‡‡ç”¨VRRPçš„é“¾è·¯ä¿æŠ¤æœºåˆ¶æ¯”ä¾èµ–åŠ¨æ€è·¯ç”±åè®®çš„å¹¿æ’­æŠ¥æ–‡æ¥è¿›è¡Œé“¾è·¯åˆ‡æ¢çš„æ—¶é—´æ›´çŸ­ï¼ŒåŒæ—¶å¼¥è¡¥äº†ä¸èƒ½ä½¿ç”¨åŠ¨æ€è·¯ç”±æƒ…å†µä¸‹çš„é“¾è·¯ä¿æŠ¤ã€‚ åè¯è§£é‡Š VRRPè·¯ç”±å™¨ï¼šè¿è¡ŒVRRPçš„è®¾å¤‡ï¼Œå®ƒå¯èƒ½å±äºä¸€ä¸ªæˆ–å¤šä¸ªè™šæ‹Ÿè·¯ç”±å™¨ã€‚ è™šæ‹Ÿè·¯ç”±å™¨(å¤‡ä»½ç»„):åŒä¸€ä¸ªå¹¿æ’­åŸŸçš„ä¸€ç»„è·¯ç”±å™¨ç»„ç»‡æˆä¸€ä¸ªè™šæ‹Ÿè·¯ç”±å™¨ï¼Œå¤‡ä»½ç»„ä¸­çš„æ‰€æœ‰è·¯ç”±å™¨ä¸€èµ·ï¼Œå…±åŒæä¾›ä¸€ä¸ªè™šæ‹ŸIPåœ°å€ï¼Œä½œä¸ºå†…éƒ¨ç½‘ç»œçš„ç½‘å…³åœ°å€ã€‚ è™šæ‹ŸIPåœ°å€ï¼šè™šæ‹Ÿè·¯ç”±å™¨çš„IPåœ°å€ï¼Œä¸€ä¸ªè™šæ‹Ÿè·¯ç”±å™¨å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªIPåœ°å€ï¼Œç”±ç”¨æˆ·é…ç½®ã€‚ IPåœ°æ‹¥æœ‰è€…:å¦‚æœä¸€ä¸ªVRRPè·¯ç”±å™¨å°†è™šæ‹Ÿè·¯ç”±å™¨çš„IPåœ°å€ä½œä¸ºçœŸå®çš„æ¥å£åœ°å€ï¼Œåˆ™è¯¥è®¾å¤‡æ˜¯IPåœ°å€æ‹¥æœ‰è€…ã€‚ è™šæ‹ŸMACåœ°å€ï¼šæ˜¯è™šæ‹Ÿè·¯ç”±å™¨æ ¹æ®è™šæ‹Ÿè·¯ç”±å™¨IDç”Ÿæˆçš„MACåœ°å€ã€‚ å½“è™šæ‹Ÿè·¯ç”±å™¨å›åº”ARPè¯·æ±‚æ—¶ï¼Œä½¿ç”¨è™šæ‹ŸMACåœ°å€ï¼Œè€Œä¸æ˜¯æ¥å£çš„çœŸå®MACåœ°å€ã€‚ ä¸»IPåœ°å€ï¼šä»æ¥å£çš„çœŸå®IPåœ°å€ä¸­é€‰å‡ºæ¥çš„ä¸€ä¸ªä¸»ç”¨IPåœ°å€ï¼Œé€šå¸¸é€‰æ‹©é…ç½®çš„ç¬¬ä¸€ä¸ªIPåœ°å€ã€‚VRRPå¹¿æ’­æŠ¥æ–‡ä½¿ç”¨ä¸»IPåœ°å€ä½œä¸ºIPæŠ¥æ–‡çš„æºåœ°å€ã€‚ ä¸»ï¼ˆMasterï¼‰è·¯ç”±å™¨ï¼šåœ¨åŒä¸€ä¸ªå¤‡ä»½ç»„ä¸­çš„å¤šä¸ªè·¯ç”±å™¨ä¸­ï¼Œåªæœ‰ä¸€å°å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œåªæœ‰ä¸»è·¯ç”±å™¨èƒ½è½¬å‘ä»¥è™šæ‹ŸIPåœ°å€ä½œä¸ºä¸‹ä¸€è·³çš„æŠ¥æ–‡ã€‚ å¤‡ä»½ï¼ˆBackupï¼‰è·¯ç”±å™¨ï¼šåœ¨åŒä¸€ä¸ªå¤‡ä»½ç»„ä¸­çš„å¤šä¸ªè·¯ç”±å™¨ä¸­ï¼Œé™¤ä¸»è·¯ç”±å™¨å¤–ï¼Œå…¶ä»–è·¯ç”±å™¨å‡ä¸ºå¤‡ä»½è·¯ç”±å™¨ï¼Œå¤„äºå¤‡ä»½çŠ¶æ€ã€‚ çŠ¶æ€æœº VRRPæœ‰ä¸‰ç§çŠ¶æ€ï¼šåˆå§‹çŠ¶æ€ã€æ´»åŠ¨çŠ¶æ€ã€å¤‡ä»½çŠ¶æ€.å…¶çŠ¶æ€åˆ‡æ¢è¿‡ç¨‹å¦‚ä¸‹ï¼š åè®®æŠ¥æ–‡ vrrpåªæœ‰ä¸€ç§æŠ¥æ–‡ï¼šAdvertisementæŠ¥æ–‡ï¼›å…¶ç›®çš„IPåœ°å€æ˜¯224.0.0.18ï¼ˆç»„æ’­åœ°å€ï¼‰ï¼Œç›®çš„MACåœ°å€æ˜¯01-00-5e-00-00-12ï¼Œåè®®å·æ˜¯112 ä¸‹é¢ä»‹ç»vrrpçš„ä¸¤ç§ä¸»è¦çš„å·¥ä½œæ¨¡å¼ï¼šä¸»å¤‡å¤‡ä»½å’Œè´Ÿè½½åˆ†æ‹… VRRPä¸»å¤‡å¤‡ä»½è¿‡ç¨‹é€‰ä¸¾masteré€‰ä¸¾è§„åˆ™ï¼š1. æ¯”è¾ƒä¼˜å…ˆçº§ 2. ä¼˜å…ˆçº§ç›¸åŒçš„æ—¶å€™ï¼Œå­˜åœ¨masteråˆ™ä¿æŒmasterçŠ¶æ€ 3. æ²¡æœ‰masteråˆ™æ¯”è¾ƒæ¥å£IPåœ°å€ï¼Œå¤§çš„å½“é€‰master å¤‡ä»½ç»„çŠ¶æ€ç»´æŒ masterå‘¨æœŸæ€§å‘é€vrrpé€šå‘ŠæŠ¥æ–‡ç»™ç»„å†…è®¾å¤‡ï¼Œä»è€Œé€šçŸ¥è‡ªå·±å¤„äºæ­£å¸¸çŠ¶æ€ ä¸»å¤‡åˆ‡æ¢ æ¡ä»¶ï¼š1. masterä¸»åŠ¨æ”¾å¼ƒï¼Œå‘é€ä¼˜å…ˆçº§ä¸º0çš„é€šå‘ŠæŠ¥æ–‡ 2. masteræ•…éšœï¼Œç­‰å¾…Master_Down_Intervalå®šæ—¶å™¨è¶…æ—¶ï¼Œé€‰ä¸¾äº§ç”Ÿmasterã€‚è¿™ä¸ª åˆ‡æ¢æ—¶é—´å«Skew_Timeï¼Œè®¡ç®—æ–¹å¼ï¼ˆ256ï¼Backupè®¾å¤‡çš„ä¼˜å…ˆçº§ï¼‰/256ï¼ˆå•ä½ç§’ï¼‰ Master_Down_Intervalå®šæ—¶å™¨å–å€¼ï¼š3Ã—Advertisement_Intervalï¼‹Skew_Timeï¼ˆå•ä½ç§’ï¼‰ã€‚ ä¸»å¤‡å›åˆ‡ å¦‚æœåŸæ•…éšœmasterè·¯ç”±å™¨æ¢å¤ï¼Œå‘ç°æ”¶åˆ°RouterBçš„VRRPæŠ¥æ–‡ä¸­çš„ä¼˜å…ˆçº§æ¯”è‡ªå·±ä½ï¼ŒRouterAç«‹å³æŠ¢å æˆä¸ºMasterã€‚ æŠ¢å æ¨¡å¼ï¼š é»˜è®¤é«˜ä¼˜å…ˆçº§backupè·¯ç”±å™¨å¯ä»¥æŠ¢å ä½ä¼˜å…ˆçº§masterè·¯ç”±å™¨ä½ç½®ï¼Œä½†æ˜¯å¦‚æœIPåœ°å€æ‹¥æœ‰è€…æ˜¯å¯ç”¨çš„ï¼Œåˆ™å®ƒæ€»æ˜¯å¤„äºæŠ¢å çš„çŠ¶æ€ï¼Œå¹¶æˆä¸ºMasterè®¾å¤‡ æ³¨æ„æŠ¢å å»¶æ—¶ï¼Œé»˜è®¤ä¸º0ï¼Œä½†æ˜¯ä¸ºäº†é˜²æ­¢åœ¨ç½‘ç»œä¸ç¨³å®šçš„æƒ…å†µä¸‹é¢‘ç¹åˆ‡æ¢å¯¼è‡´æµé‡ä¸­æ–­ï¼Œå¯ä»¥è®¾ç½®å»¶æ—¶æ—¶é—´ç¨é•¿ æ³¨æ„ï¼šå¦‚æœVRRPçš„ä¸Šè¡Œé“¾è·¯æ•…éšœï¼Œç”±äºä¸»å¤‡é€šå‘Šæ­£å¸¸ï¼Œå°†æ— æ³•å¼•èµ·ä¸»å¤‡åˆ‡æ¢ è§£å†³æ–¹æ³•ï¼šåˆ©ç”¨VRRPçš„è”åŠ¨åŠŸèƒ½ç›‘è§†ä¸Šè¡Œæ¥å£æˆ–é“¾è·¯æ•…éšœï¼Œä¸»åŠ¨è¿›è¡Œä¸»å¤‡åˆ‡æ¢ã€‚ VRRPè´Ÿè½½åˆ†æ‹… è´Ÿè½½åˆ†æ‹…æ˜¯æŒ‡å¤šä¸ªVRRPå¤‡ä»½ç»„åŒæ—¶æ‰¿æ‹…ä¸šåŠ¡è½¬å‘,ä»è€Œè§£å†³æµé‡åˆ†æ‹…ä¸å‡ï¼Œmasterè´Ÿæ‹…è¿‡é‡çš„æƒ…å†µ è´Ÿè½½åˆ†æ‹…æ–¹å¼éœ€è¦å»ºç«‹å¤šä¸ªVRRPå¤‡ä»½ç»„ï¼Œå„å¤‡ä»½ç»„çš„Masterè®¾å¤‡åˆ†æ‹…åœ¨ä¸åŒè®¾å¤‡ä¸Šï¼›å•å°è®¾å¤‡å¯ä»¥åŠ å…¥å¤šä¸ªå¤‡ä»½ç»„ï¼Œåœ¨ä¸åŒçš„å¤‡ä»½ç»„ä¸­æ‰®æ¼”ä¸åŒçš„è§’è‰²ã€‚ VGMPç®€ä»‹VRRPè™½ç„¶å¯ä»¥è§£å†³å•ç‚¹æ•…éšœï¼Œå®ç°ä¸»å¤‡å¤‡ä»½ï¼Œä½†æ˜¯åœ¨é…ç½®é˜²ç«å¢™çš„æ—¶å€™ï¼Œç”±äºé˜²ç«å¢™åŠŸèƒ½çš„ç‰¹æ®Šæ€§ï¼Œåœ¨å¯¹å…¶è¿›è¡Œä¸»å¤‡å¤‡ä»½æ—¶ï¼Œä¼ ç»ŸVRRPæ–¹å¼æ— æ³•å®ç°ä¸»ã€å¤‡ç”¨é˜²ç«å¢™çŠ¶æ€çš„ä¸€è‡´æ€§ã€‚æ— æ³•å®ç°VRRPçŠ¶æ€ä¸€è‡´æ€§ä»¥åŠä¼šè¯è¡¨çŠ¶æ€çš„å¤‡ä»½ æ­¤æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥VGMPï¼ˆVRRP Group Management Protocolï¼‰ VGMPæå‡ºVRRPç®¡ç†ç»„çš„æ¦‚å¿µï¼Œå°†åŒä¸€å°é˜²ç«å¢™ä¸Šçš„å¤šä¸ªVRRPå¤‡ä»½ç»„éƒ½åŠ å…¥åˆ°ä¸€ä¸ªVRRPç®¡ç†ç»„ï¼Œç”±ç®¡ç†ç»„ç»Ÿä¸€ç®¡ç†æ‰€æœ‰VRRPå¤‡ä»½ç»„ã€‚é€šè¿‡ç»Ÿä¸€æ§åˆ¶å„VRRPå¤‡ä»½ç»„çŠ¶æ€çš„åˆ‡æ¢ï¼Œæ¥ä¿è¯ç®¡ç†ç»„å†…çš„æ‰€æœ‰VRRPå¤‡ä»½ç»„çŠ¶æ€éƒ½æ˜¯ä¸€è‡´çš„ã€‚ åŸºæœ¬åŸç† å½“é˜²ç«å¢™ä¸Šçš„VGMPä¸ºActive/StandbyçŠ¶æ€æ—¶ï¼Œç»„å†…æ‰€æœ‰VRRPå¤‡ä»½ç»„çš„çŠ¶æ€ç»Ÿä¸€ä¸ºActive/StandbyçŠ¶æ€ã€‚ çŠ¶æ€ä¸ºActiveçš„VGMPä¹Ÿä¼šå®šæœŸå‘å¯¹ç«¯å‘é€HELLOæŠ¥æ–‡ï¼Œé€šçŸ¥Standbyç«¯æœ¬èº«çš„è¿è¡ŒçŠ¶æ€ï¼ˆåŒ…æ‹¬ä¼˜å…ˆçº§ã€VRRPæˆå‘˜çŠ¶æ€ç­‰ï¼‰ VGMP HELLOæŠ¥æ–‡å‘é€å‘¨æœŸç¼ºçœä¸º1ç§’ã€‚å½“Standbyç«¯ä¸‰ä¸ªHELLOæŠ¥æ–‡å‘¨æœŸæ²¡æœ‰æ”¶åˆ°å¯¹ç«¯å‘é€çš„HELLOæŠ¥ æ–‡æ—¶ï¼Œä¼šè®¤ä¸ºå¯¹ç«¯å‡ºç°æ•…éšœï¼Œä»è€Œå°†è‡ªå·±åˆ‡æ¢åˆ°ActiveçŠ¶æ€ã€‚ VGMPç®¡ç†æœºåˆ¶çŠ¶æ€ä¸€è‡´æ€§ç®¡ç† VGMPç®¡ç†ç»„æ§åˆ¶æ‰€æœ‰çš„VRRPå¤‡ä»½ç»„ç»Ÿä¸€åˆ‡æ¢ã€‚ æŠ¢å ç®¡ç† å½“åŸæ¥å‡ºç°æ•…éšœçš„ä¸»è®¾å¤‡æ•…éšœæ¢å¤æ—¶ï¼Œå…¶ä¼˜å…ˆçº§ä¹Ÿä¼šæ¢å¤ï¼Œæ­¤æ—¶å¯ä»¥é‡æ–°å°†è‡ªå·±çš„çŠ¶æ€æŠ¢å ä¸ºä¸»ã€‚ ç”¨VGMPå®ç°é˜²ç«å¢™çš„å¤‡ä»½ä»¥åŠæ•…éšœè‡ªåŠ¨è¿ç§»ä»è€Œä¿è¯ä¸šåŠ¡è¿ç»­æ€§çš„æ–¹æ³•ä¹Ÿå±äºé˜²ç«å¢™çš„åŒæœºçƒ­å¤‡æŠ€æœ¯çš„ä¸€éƒ¨åˆ†ï¼Œå› ä¸ºç¯‡å¹…æœ‰é™ï¼Œè¿™é‡Œä¸å†å±•å¼€ã€‚ å°ç»“ä»Šå¤©æˆ‘ä»¬ä»ç°å®ä¸€ä¸ªé—®é¢˜ä½œä¸ºåˆ‡å…¥ç‚¹ï¼Œç®€å•ä»‹ç»äº†åˆ©ç”¨VRRPåšè·¯ç”±å†—ä½™å¤‡ä»½ï¼ŒåŒæ—¶é’ˆå¯¹é˜²ç«å¢™çš„ç‰¹æ€§ï¼Œå¼•ç”³å‡ºVGMPçš„æ¦‚å¿µï¼Œä¹Ÿç®—æ˜¯æ­å¼€äº†é˜²ç«å¢™ç¥ç§˜é¢çº±çš„ä¸€è§’ã€‚ç½‘ç»œå®‰å…¨è¶Šæ¥è¶Šæˆä¸ºæˆ‘ä»¬ç”Ÿæ´»ä¸­ä¸å¯å¿½è§†çš„ä¸€éƒ¨åˆ†ï¼Œå¯¹äºå®‰å…¨æ–¹é¢çŸ¥è¯†ï¼Œä¸‹æ¬¡æœ‰æœºä¼šæˆ‘ä»¬å†ç»§ç»­è®²è¿°å§ã€‚]]></content>
      <categories>
        <category>å­¦ä¹ ç¬”è®°</category>
      </categories>
      <tags>
        <tag>ICT</tag>
        <tag>å®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hexoå…¥é—¨æ­å»º]]></title>
    <url>%2F2019%2F09%2F18%2Fhexofirst%2F</url>
    <content type="text"><![CDATA[å‰è¨€èŠ±äº†å¤§æ¦‚ä¸‰å¤©çš„æ—¶é—´ï¼Œæ€»ç®—å¤§è‡´æŠŠåšå®¢çš„é›å½¢æå®šäº†ã€‚è™½ç„¶è¯´å¾ˆå¤šä¸œè¥¿æœ€ç»ˆéƒ½ä¸æ˜¯æˆ‘è‡ªå·±å®Œæˆçš„ï¼Œåªæ˜¯åœ¨åˆ«äººçš„åŸºç¡€ä¸Šåœ¨è¡¨é¢è¿›è¡Œæ•²æ•²æ‰“æ‰“ï¼ˆåæ‚”è‡ªå·±å­¦ä¹ äº†åç«¯ï¼Œå›§Orzï¼‰ä½†ä¸ç®¡æ€æ ·ï¼Œæ²¡æœ‰æ–‡ç« çš„åšå®¢ç»ˆå½’åªæ˜¯æ²¡æœ‰çµé­‚çš„èº¯å£³ï¼Œå°½ç®¡è‡ªå·±çš„æ°´å¹³æœ‰é™ï¼Œä½†æ˜¯è¿˜æ˜¯å¸Œæœ›èƒ½é€šè¿‡ä¹¦å†™è‡ªå·±çš„ä¸€ç‚¹ä¸€æ»´æ¥è§è¯è‡ªå·±çš„æˆé•¿å§ï¼ ç°åœ¨å°±å¼€å§‹æˆ‘ä»¬ä»Šå¤©çš„å†…å®¹â€”â€”hexoåšå®¢çš„æ­å»º åˆè¯†Hexoå…ˆè®©æˆ‘ä»¬äº†è§£ä¸€ä¸‹hexoï¼š Hexo æ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€æ´ä¸”é«˜æ•ˆçš„åšå®¢æ¡†æ¶ã€‚Hexo ä½¿ç”¨ Markdownï¼ˆæˆ–å…¶ä»–æ¸²æŸ“å¼•æ“ï¼‰è§£ææ–‡ç« ï¼Œåœ¨å‡ ç§’å†…ï¼Œå³å¯åˆ©ç”¨é“ä¸½çš„ä¸»é¢˜ç”Ÿæˆé™æ€ç½‘é¡µã€‚ æ¯”èµ·å®ƒçš„å‰è¾ˆwordpressï¼Œhexoæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯ä½¿ç”¨markdownç¼–å†™æ–‡ç« ï¼ŒåŒæ—¶ä»¥node.jsä½œä¸ºè¿è¡Œç¯å¢ƒï¼Œä½ åªéœ€è¦åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…å¥½node.jsç¯å¢ƒï¼Œå°±å¯ä»¥è½»æ¾å®‰è£…hexoï¼Œè¿™æ—¶ä½ å†å›å¤´çœ‹çœ‹wordpressçš„LAMPç¯å¢ƒï¼Œæ˜¯ä¸æ˜¯è§‰å¾—ç¹çåˆç¬¨é‡å‘¢ï¼Ÿï¼ˆhhå…¶å®hexoè¿˜æ˜¯wordpresséƒ½æ˜¯éå¸¸ä¸»æµçš„åšå®¢æ¡†æ¶ï¼Œä¸¤è€…çš„ä¼˜åŠ£æˆ‘ä»¬ä¹‹åæœ‰æ—¶é—´æˆ–è®¸å¯ä»¥å†è®¨è®ºï¼‰ HexoåŸºæœ¬æ­å»ºçŸ¥è¯†å‰æ å®‰è£…hexoå‰ä½ æœ€å¥½äº†è§£çš„åŸºæœ¬çŸ¥è¯† markdownè¯­æ³•åŸºç¡€ node.jsåŸºæœ¬è®¤è¯†ï¼ˆå…¶å®ç”¨ä¸åˆ°å¤šå°‘ï¼Œä½†æ˜¯æœ€å¥½èƒ½äº†è§£ä¸€ç‚¹è¯­æ³•åŸºç¡€ï¼‰ htmlã€cssåŸºç¡€ï¼ˆä¸ºä½ ä¸ªæ€§åŒ–åšå®¢å¾ˆæœ‰å¸®åŠ©ï¼‰ githubç›¸å…³çŸ¥è¯†ï¼ˆç¨‹åºçŒ¿å¿…å¤‡ï¼‰ åŸºç¡€ç¯å¢ƒ æœ¬äººç”¨çš„Win10 æ­å»ºçš„åŸºæœ¬æµç¨‹ ç¯å¢ƒé…ç½®-&gt;æœ¬åœ°è°ƒè¯•-&gt;æœåŠ¡å™¨éƒ¨ç½² ç¯å¢ƒé…ç½®å®‰è£…git bash é¦–å…ˆæœ¬åœ°å®‰è£…Gitï¼Œå…·ä½“å¯ä»¥è‡ªè¡Œç™¾åº¦ã€‚ å®‰è£…å®Œåå†ä»»æ„ç›®å½•ä¸‹ç‚¹å‡»å³é”® è¿›å…¥git bashï¼Œä¹‹åæˆ‘ä»¬çš„æ“ä½œéƒ½å°†åœ¨è¿™é‡Œè¿›è¡Œ ï¼ˆPSï¼šå®æµ‹cmdä¹Ÿå¯ä»¥ï¼Œå¦‚æœé‡åˆ°ä¸€äº›æ“ä½œåœ¨git bashé‡Œå¾—ä¸åˆ°å“åº”å¯ä»¥åœ¨cmdä¸­å°è¯•è¿›è¡Œï¼Œæ³¨æ„è¦åœ¨ç›¸åŒçš„è·¯å¾„ä¸‹é¢ï¼‰ å®‰è£…node.js é¦–å…ˆå®‰è£…å¥½node.jsç¯å¢ƒï¼Œç›´æ¥å®˜ç½‘ä¸‹è½½å°±è¡Œäº† å®‰è£…å¥½åæŸ¥çœ‹ç‰ˆæœ¬ æ­£å¸¸æ— è¯¯å³å¯ å®‰è£…hexo è¿›å…¥gitbashï¼Œä½¿ç”¨node.jsçš„åŒ…ç®¡ç†å™¨npmï¼Œè¾“å…¥ 1npm install -g hexo ç­‰å¾…å®‰è£…å®Œæˆå³å¯ æœ¬åœ°è°ƒè¯•å®‰è£…å®Œæˆååœ¨è‡ªå·±æƒ³è¦æ”¾åšå®¢çš„æ–‡ä»¶å¤¹æ ¹ç›®å½•ä¸‹ï¼Œè¾“å…¥ å¯ä»¥çœ‹åˆ°hexoç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ node_modulesï¼ˆé¡¹ç›®ä¾èµ–åŒ…ï¼‰ publicï¼ˆå­˜æ”¾ç”Ÿæˆé¡µé¢ï¼‰ scaffoldsï¼šå‘½ä»¤ç”Ÿæˆæ–‡ç« ç­‰çš„æ¨¡æ¿ sourceï¼šèµ„æºåº“ï¼Œæ”¾ç½®æ¯”å¦‚æ–‡ç« ã€è·³è½¬é¡µé¢ç­‰ themesï¼šä¸»é¢˜ _config.ymlï¼šæ•´ä¸ªåšå®¢çš„é…ç½® package.jsonï¼šé¡¹ç›®æ‰€éœ€æ¨¡å—é¡¹ç›®çš„é…ç½®ä¿¡æ¯ è¿™æ—¶ä½ å·²ç»å¯ä»¥å¯åŠ¨ä½ çš„åšå®¢äº†ï¼Œè¾“å…¥ 123hexo clean //æ¸…é™¤ä¹‹å‰çš„é…ç½®ï¼Œé˜²æ­¢åšå®¢é…ç½®å‡ºé”™çš„å¿…è¦æ“ä½œ hexo generate //å¯ç¼©å†™ä¸ºhexo g åˆ›å»ºèµ„æºæ–‡ä»¶ hexo server //å¯ç¼©å†™ä¸ºhexo s å¯åŠ¨serveræœåŠ¡å™¨ å½“æ˜¾ç¤ºä¸‹é¢ä»£ç æ—¶è¯´æ˜å¯åŠ¨æˆåŠŸ 12$INFO Start processing$INFO Hexo is running at http://localhost:4000/. Press Ctrl+C to stop æŒ‰æµç¨‹è¾“å…¥localhost:4000å½“ä½ çœ‹åˆ°ä¸‹å›¾è¯´æ˜åŸºæœ¬é…ç½®æˆåŠŸäº† 3.æœåŠ¡å™¨éƒ¨ç½²ç°åœ¨æˆ‘ä»¬å°±è¦åœ¨å…¬ç½‘ä¸Šéƒ¨ç½²hexoäº† è¿™é‡Œæˆ‘ç”¨çš„æ˜¯Github Pageå¯¹åšå®¢è¿›è¡Œæ‰˜ç®¡ï¼Œæœ‰æ¡ä»¶çš„åŒå­¦ä¹Ÿå¯ä»¥è‡ªå·±éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šï¼Œè¿™æ˜¯æš‚æ—¶ä¸æ é¦–å…ˆéœ€è¦åœ¨GitHubä¸Šæ–°å»ºä¸€ä¸ªä»“åº“ï¼Œå‘½åå½¢å¼ä¸ºyourusername.github.ioï¼ˆyourusernameæ˜¯ä½ çš„gitè´¦æˆ·,é‡è¦) ç„¶åè¿›å…¥settingæŸ¥çœ‹æ˜¯å¦å¼€å¯ æ¥ç€åˆ›å»ºsshå¯†é’¥å¯¹ï¼Œå°†å…¬é’¥æ”¾åœ¨GitHubä¸Š åœ¨å…¨å±€setting-&gt;SSH and GPG keys-&gt;new SSH keysæ·»åŠ  å¦‚ä½•æœ¬åœ°åˆ›å»ºSSHå¯†é’¥å¯¹ï¼Œè¯·æŸ¥ 123$git config --global user.name "Your Name"$git config --global user.email "email@example.com"$ssh-keygen -t rsa -C "youremail@example.com" æ¥ç€æ‰“å¼€åšå®¢æ–‡ä»¶å¤¹æ ¹ç›®å½•ï¼Œå‰å¾€_config.ymlæ–‡ä»¶ï¼Œæ‰¾åˆ°å¦‚ä¸‹å­—æ®µï¼Œä¿®æ”¹è‡ªå·±çš„repo 1deploy: type: git repo: git@github.com:yourusername/yourusername.github.io.git branch: master ç„¶ååœ¨gitbashè¾“å…¥ 1$npm install hexo-deployer-git --save ä¾æ¬¡æ‰§è¡Œ 123hexo cleanhexo generate //å¯ç¼©å†™ä¸ºhexo ghexo deploy //å¯ç¼©å†™ä¸ºhexo d éƒ¨ç½²hexo æ‰“å¼€https://yourgithubname.github.ioï¼Œçœ‹åˆ°ä¸ä¸Šä¸€æ­¥ç›¸åŒçš„é¡µé¢ï¼Œè¯æ˜åšå®¢æ­å»ºå®Œæˆ è‡³æ­¤ï¼Œåšå®¢çš„åŸºæœ¬æ­å»ºåŸºæœ¬å®Œæˆã€‚ æ¥ç€å¦‚æœéœ€è¦ä¹¦å†™åšå®¢ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ 1hexo new &lt;layout&gt; &quot;title&quot; è¿™é‡Œçš„å¯¹åº”æˆ‘ä»¬è¦æ·»åŠ çš„å†…å®¹ï¼Œå¦‚æœæ˜¯postså°±æ˜¯æ·»åŠ æ–°çš„æ–‡ç« ï¼Œå¦‚æœæ˜¯pageå°±æ˜¯æ·»åŠ æ–°çš„é¡µé¢ã€‚ 1hexo publish &lt;layout&gt; &lt;filename&gt; å‘å¸ƒå†…å®¹ï¼Œå®é™…ä¸Šæ˜¯å°†å†…å®¹ä»draftsï¼ˆè‰ç¨¿ï¼‰æ–‡ä»¶å¤¹ç§»åˆ°postsï¼ˆæ–‡ç« ï¼‰æ–‡ä»¶å¤¹ã€‚ æ¥ç€é‡å¯å°±è¡Œ hexoä¼˜åŒ–é…ç½®è™½ç„¶æ­å»ºäº†åŸºæœ¬çš„åšå®¢ï¼Œä½†æ˜¯æ¯æ¬¡åˆå§‹åŒ–æ—¶éƒ½è¦èŠ±å¾ˆå¤šæ—¶é—´ï¼ˆå¯ä»¥ä½†æ²¡å¿…è¦ï¼‰ å› æ­¤æˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªè„šæœ¬è‡ªåŠ¨å®Œæˆå›ºå®šå‘½ä»¤çš„æ‰§è¡Œ æ–°å»ºä¸€ä¸ªtxtæ–‡ä»¶ï¼Œè¾“å…¥ 1 2 3 hexo clean hexo g hexo d ä¿å­˜åå°†åç¼€åæ”¹æˆ.batå°±å¯ä»¥ç‚¹å‡»æ‰§è¡Œäº† ä¸ªæ€§åŒ–ä½ çš„Hexo åšå®¢çœŸæ­£è®©äººå……æ»¡æ¿€æƒ…çš„åœ°æ–¹åœ¨äºå®ƒå¯ä»¥è®©ä½ ä¸ªæ€§åŒ–ï¼ŒçœŸæ­£æŠŠåšå®¢ä½œä¸ºä½ è‡ªå·±çš„å°å¤©åœ°ï¼Œè¿™æ¬¡æˆ‘å°±ç»“åˆè‡ªå·±æ­å»ºåšå®¢çš„å®ä¾‹åˆ†æä¸€ä¸‹å¦‚ä½•ä¸ªæ€§åŒ–è‡ªå·±çš„åšå®¢å§ æ·»åŠ ä¸»é¢˜NEXTæ·»åŠ RSSèœå•å›¾æ ‡é€‰æ‹©å¦‚ä½•é€‰æ‹©åšå®¢ä¸Šä¸°å¯Œçš„å›¾æ ‡ï¼Ÿéš¾é“è¦ä¸‹è½½åˆ°æœ¬åœ°ï¼Ÿä¸ºäº†æå‡åšå®¢çš„æ‰“å¼€é€Ÿåº¦ï¼Œå»ºè®®æ‰€æœ‰çš„é™æ€èµ„æºèƒ½é€šè¿‡HTTPä¸‹è½½å°±HTTPä¸‹è½½ï¼Œå› ä¸ºéƒ¨ç½²åšå®¢çš„æœåŠ¡å™¨å¸¦å®½ç»ˆç©¶æœ‰é™ï¼Œå¦‚æœå› ä¸ºåŠ è½½é™æ€èµ„æºè€Œå ç”¨å¸¦å®½ï¼Œä¼šé™ä½åšå®¢çš„é˜…è¯»ä½“éªŒ è¿™é‡Œé‚£awesome iconä¸¾ä¾‹ åœ¨é¦–é¡µå¯»æ‰¾è‡ªå·±æƒ³è¦çš„å›¾æ ‡ï¼Œç„¶åå†ä¸»é¢˜é…ç½®æ–‡ä»¶çš„èœå•å›¾æ ‡é¡¹å¡«&lt;! class=&quot;fa fa-fw fa-envelope&gt;&lt;/i&gt;å³å¯ å¼•å…¥è¯„è®ºæ’ä»¶gitalkgitalkæ’ä»¶å°†GitHubä½œä¸ºä½ çš„æ•°æ®åº“ï¼Œè¯„è®ºç”¨æˆ·é€šè¿‡GitHubè´¦å·ç™»å½•å¹¶å‘è¡¨è¯„è®ºï¼Œéå¸¸é€‚åˆå›½å†…çš„å¼€å‘è€…è¿›è¡ŒåŠäº¤æµè®¨è®º æ³¨å†Œoauth app ä¸‹è½½gitalkæ’ä»¶ é›†æˆGitalk å¼•å…¥Aplayerå¤–é“¾ç”Ÿæˆåœ°å€ è¸©å‘æœç´¢æ¨¡å— config.ymlæ²¡æœ‰æ³¨æ„ç©ºæ ¼ æ³¨æ„å¤‡ä»½ requireæ˜¯node.jsçš„è¯­æ³•ã€‚ã€‚ æ‰“åŒ…jsæ–‡ä»¶ å‡ºç°å„ç§éƒ½æ˜¯npmåŒ…çš„é—®é¢˜ json.packageæ˜¯ç”¨æ¥å¤„ç†ä¾èµ–é—®é¢˜çš„ï¼Œæœ‰äº†å®ƒï¼Œå°±ä¸ç”¨åƒè¿œå¤æ—¶ä»£é‚£æ ·ä¸€ä¸ªä¸ªinstallï¼ŒåŒæ—¶å†™å¥½webpack.comfig.jsæ‰å¯ä»¥æ‰“åŒ…æˆåŠŸ]]></content>
      <categories>
        <category>å­¦ä¹ ç¬”è®°</category>
      </categories>
      <tags>
        <tag>åšå®¢</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç”¨javaä¼˜é›…çˆ¬è™«â€”â€”Jsoup]]></title>
    <url>%2F2019%2F09%2F18%2Fjsoup%2F</url>
    <content type="text"><![CDATA[jsoupæ˜¯ä¸€ä¸ªç”¨äºå¤„ç†çœŸå®HTMLçš„Javaåº“ã€‚å®ƒæä¾›äº†ä¸€ä¸ªéå¸¸æ–¹ä¾¿çš„APIï¼Œç”¨äºæå–å’Œæ“ä½œæ•°æ®ï¼Œä½¿ç”¨æœ€å¥½çš„DOMï¼ŒCSSå’Œç±»ä¼¼jqueryçš„æ–¹æ³•ã€‚ ç›®å½• jsoupæ¦‚è¿° ä½¿ç”¨åœºæ™¯ DOMè§£æ CSSé€‰æ‹©å™¨ HTMLè¿‡æ»¤ é€»è¾‘åˆ†æ æ€»ç»“ jouspæ¦‚è¿°å®˜æ–¹è§£é‡Šï¼š jsoupæ˜¯ä¸€ä¸ªç”¨äºå¤„ç†çœŸå®HTMLçš„Javaåº“ã€‚å®ƒæä¾›äº†ä¸€ä¸ªéå¸¸æ–¹ä¾¿çš„APIï¼Œç”¨äºæå–å’Œæ“ä½œæ•°æ®ï¼Œä½¿ç”¨æœ€å¥½çš„DOMï¼ŒCSSå’Œç±»ä¼¼jqueryçš„æ–¹æ³•ã€‚ ä¸ªäººæ¥è§¦åˆ°Jsoupæ˜¯åœ¨ç”¨javaå†™çˆ¬è™«æ—¶ï¼Œè‹¦æ¼äºå¤§é‡ä½¿ç”¨æ­£åˆ™åŒ¹é…ä¸ä»…é™ä½äº†ä»£ç çš„å¯è¯»æ€§ï¼Œç›¸å¯¹ä¹Ÿæ¯”è¾ƒè´¹æ—¶è´¹åŠ›ã€‚è¿™æ—¶å€™ï¼Œä¸€æ¬¾çˆ¬è™«æ¡†æ¶çªç„¶æ˜ å…¥çœ¼å¸˜ï¼Œé‚£å°±æ˜¯jsoupã€‚ ä½œä¸ºä¸€æ¬¾è½»é‡ï¼ŒåŠŸèƒ½å¼ºå¤§çš„çˆ¬è™«æ¡†æ¶ï¼Œjsoupè®©ç®€å•æŠ“å–ç½‘é¡µä¿¡æ¯å˜å¾—ä¼˜é›…ï¼Œä¾¿æ·ã€‚ è™½ç„¶æ˜¯ä¸€ä¸ªjavaåº“ï¼Œä½†æ˜¯å®ƒçš„ä½¿ç”¨é€»è¾‘å´æ— æ¯”æ¥è¿‘äºjQueryï¼Œä»¥è‡³äºåªè¦æ˜¯ç†Ÿæ‚‰æˆ–æ˜¯äº†è§£JQueryçš„äººå¯ä»¥è½»è€Œæ˜“ä¸¾åœ°ä¸Šæ‰‹è¿™æ¬¾æ¡†æ¶ã€‚ ä½¿ç”¨åœºæ™¯DOMè§£æjsoupçš„domè§£æå¼‚å¸¸ç®€å•å—ï¼Œåªéœ€è¦newä¸€ä¸ªducumnetå¯¹è±¡å³å¯å®ç°è·å–è¿™ä¸ªç½‘é¡µå…ƒç´ ï¼Œæ¥ä¸‹æ¥ä»¥è§£æä¸€ä¸ªç½‘é¡µä¸ºä¾‹ã€‚å¯ä»¥çœ‹åˆ°ï¼Œå°†ç½‘é¡µè½¬åŒ–æˆducumentç±»ï¼Œä¹‹åçš„Elementç±»ä»¥åŠå…¶å­ç±»éƒ½å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªä¸ªèŠ‚ç‚¹ï¼Œé€šè¿‡è°ƒç”¨ç›¸å…³æ–¹æ³•å®ç°æ•´ä¸ªæ–‡ä»¶èŠ‚ç‚¹çš„éå†ã€‚åŒæ—¶ï¼ŒElementç±»çš„getElementByTagè®©äººå¾ˆå®¹æ˜“è”æƒ³åˆ°jsä¸­çš„ç›¸å…³æ–¹æ³•ï¼Œå› æ­¤åªè¦æœ‰ç‚¹JSåŸºç¡€å’ŒjavaåŸºç¡€çš„äººçœ‹è¿™æ®µä»£ç éƒ½ä¸ä¼šè§‰å¾—é™Œç”Ÿã€‚ è¿™é‡Œä»¥æŸ¥è¯¢å­¦ç”Ÿæˆç»©ä¿¡æ¯ä¸ºä¾‹ï¼š 1234567891011121314151617181920212223242526272829303132public class jsoupTest &#123; public String getGrade(String stu_num, String id_num) throws IOException &#123; String testURL = "http://jwc.cqupt.edu.cn/showS tuQmcj.php"; //ç›®æ ‡ç½‘é¡µ Connection con = Jsoup.connect(testURL); //è·å–è¿æ¥ con.data("xh", stu_num); //å¡«å†™å‚æ•° con.data("sfzh", id_num); Document document = con.post(); //é€‰æ‹©å‘é€æ–¹å¼,è·å–æ•´ä¸ªç½‘é¡µä¿¡æ¯ï¼Œå­˜åœ¨documnetç±»é‡Œ Element pTable = document.body().getElementsByClass("pTable").get(0); //é€šè¿‡classå±æ€§ ï¼Œè·å–å­ç±»å…ƒç´  Elements trs = pTable.getElementsByTag("tbody").get(0).children(); trs.forEach(tr -&gt; &#123; //éå†&lt;tr&gt;æ ‡ç­¾ if (!tr.children().isEmpty()) &#123; Element element = tr.getElementsByTag("td").get(0); if (!element.text().equals("è¯¾ç¨‹ç±»å‹")) &#123; GradeInfo gradeInfo = new GradeInfo(); gradeInfo.setProperty(tr.getElementsByTag("td").get(0).text()); String term = tr.getElementsByTag("td").get(1).text(); System.out.println(term); System.out.println(tr.getElementsByTag("td").get(2).text()); System.out.println(tr.getElementsByTag("td").get(5).text()); System.out.println(tr.getElementsByTag("td").get(6).text()); System.out.println(tr.getElementsByTag("td").get(7).text()); &#125; &#125; &#125;); return ""; &#125;&#125; ç»“æœï¼š åªéœ€è¦å‡ è¡Œå°±å¯ä»¥å®Œæˆå¯¹htmlçš„åŸºæœ¬è§£æï¼Œè€Œä¸”æ‰€æœ‰çš„æ“ä½œéƒ½å¯ä»¥ç”¨jsçš„é€»è¾‘è§£é‡Šã€‚æˆ–å¤šæˆ–å°‘æ¯”åŸç”Ÿæ­£åˆ™åŒ¹é…è¦å®ç”¨çš„å¤šã€‚ CSSé€‰æ‹©å™¨jsoupå†³å¿ƒæ˜¯æƒ³å‘å‰ç«¯é é½äº†ï¼Œé™¤äº†åŸºæœ¬çš„DOMè§£ææ“ä½œå¤–ï¼Œå®ƒåŒæ—¶åŠ å…¥äº†CSSé€‰æ‹©å™¨ï¼Œè¿™ä¸ªæ“ä½œä¹ä¸€çœ‹ä¼¼ä¹æ²¡ä»€ä¹ˆç”¨å¤„ï¼Œä½†æ˜¯å½“ä½ çœŸæ­£å»å­¦ä¹ å¦‚ä½•ä½¿ç”¨åä½ çš„å°±ä¼šå‘ç°è¿™æ˜¯å¤šå°‘å¥½ç”¨ã€‚åœ¨é’ˆå¯¹è¾ƒå¤æ‚åœ°è¯­å¥åŒ¹é…æ—¶ï¼Œä½¿ç”¨é€‰æ‹©å™¨å¯ä»¥è½»è€Œæ˜“ä¸¾åœ°ç­›é€‰å‡ºä½ æƒ³è¦çš„å…ƒç´ ï¼Œå¯ä»¥å¸®ä½ èŠ‚çœå¤§é‡ä»£ç ã€‚ ä½¿ç”¨æ–¹æ³•ï¼šå¯ä»¥ç”¨Element.select(String selector)å’ŒElement.select(String selector)å®ç°. 12345678910111213141516public void getBySelect() throws IOException &#123; String testURL = "&lt;html&gt;" + "&lt;head&gt;&lt;/head&gt;"+ "&lt;body&gt;"+"&lt;span id=\"grade\"&gt;æˆç»©&lt;/span&gt;"+"&lt;span id = \"subject\"&gt;è¯¾ç¨‹&lt;/span&gt;"+"&lt;span id = \"name\"&gt;å§“å&lt;/span&gt;"+"&lt;span id = \"stunum\"&gt;å­¦å·&lt;/span&gt;"+ "&lt;span class = \"score\"&gt;85&lt;/span &gt;"+"&lt;span class = \"class\"&gt;è¯­æ–‡&lt;/span&gt;"+"&lt;span class = \"stuname\"&gt;å°æ˜&lt;/span class = \"number\"&gt;"+"&lt;span&gt;201721001&lt;/span&gt;"+ "&lt;span id=\"grade\"&gt;80&lt;/span&gt;"+"&lt;span id = \"subject\"&gt;æ•°å­¦&lt;/span&gt;"+"&lt;span id = \"name\"&gt;å°æ˜&lt;/span&gt;"+"&lt;span id = \"stunum\"&gt;2017210001&lt;/span&gt;"+ "&lt;/body&gt;&lt;/html&gt;"; //åˆ©ç”¨å­—ç¬¦ä¸²æ‹¼æ¥å‡ºHTMLæ ‡ç­¾ //è·å–è¿æ¥ Document document = Jsoup.parse(testURL); //å°†HTMLè½¬åŒ–æˆå¯éå†åœ°documentç±» Elements elements = document.select("span:matchesOwn(^8)"); for (Element element: elements) &#123; System.out.println(elements.text()); &#125; &#125; ç»“æœï¼š CSSé€‰æ‹©å™¨ç±»ä¼¼äºJQueryå’ŒCSSä¸­ä½¿ç”¨çš„é€‰æ‹©å™¨ï¼Œå¯ä»¥é€šè¿‡ç‰¹å®šçš„é€‰æ‹©å™¨è¯­æ³•å°†å¯¹æŒ‡å®šå…ƒç´ è¿›è¡Œç­›é€‰ å¯¹äºé€‰æ‹©å™¨çš„ç­›é€‰ï¼Œè¿™é‡Œæ¨èä¸€ç¯‡æ–‡ç« ï¼šè¯¦è§£JSOUPçš„Selecté€‰æ‹©å™¨è¯­æ³• (é“¾æ¥å·²å¤±æ•ˆï¼‰ HTMLè¿‡æ»¤è¿™ä¸ªåŠŸèƒ½ä¹Ÿæ˜¯å¶ç„¶çœ‹è§çš„ï¼Œä¸è¿‡ç°åœ¨æƒ³æ¥ä¹Ÿç†æ‰€å½“ç„¶ï¼Œè¿‡æ»¤ç½‘é¡µä¿¡æ¯æœ¬èº«å°±æ˜¯Jsoupåˆ†å†…çš„äº‹ã€‚å½“æ—¶æ­£åœ¨çœ‹XSSæ”»å‡»æ–¹é¢çš„çŸ¥è¯†ï¼Œçªç„¶å‘ç°jsoupåœ¨å®‰å…¨æ–¹é¢å·²æ—©æœ‰è€ƒè™‘ï¼Œå·²æœ¬èº«ä¼˜ç§€çš„HTMLè§£æä¸ºåŸºç¡€ï¼ŒæŠµå¾¡XSSæ”»å‡»è‡ªç„¶ä¹Ÿæ˜¯ååˆ†ä¼˜ç§€ã€‚ XSSæ³¨å…¥æœ¬è´¨å°±æ˜¯åœ¨HTMLä¸­æ’å…¥ç‰¹å®šçš„æ ‡ç­¾æ”¹å˜åŸæ¥æ ‡ç­¾çš„å«ä¹‰ï¼Œå› æ­¤é˜²æ­¢XSSæ”»å‡»çš„æœ¬è´¨æ˜¯èƒ½åˆ†è¾¨å¹¶åŠæ—¶è¿‡æ»¤æ‰å¤šä½™æˆ–æ˜¯æ— æ•ˆçš„HTMLæ ‡ç­¾ã€‚å¯¹æ­¤ï¼Œjsoupæœ‰ä¸€ä¸ªç™½åå•æœºåˆ¶ï¼Œé€šè¿‡cleanæ–¹æ³•å¯ä»¥ä¸€æ­¥é€šè¿‡ç™½åå•è®¾ç½®çš„è¿‡æ»¤è§„åˆ™æ¸…ç†æ‰€æœ‰çš„æ ‡ç­¾ï¼ŒåŒæ—¶ä¹Ÿä¼šä¿ç•™é€‚å½“æ ‡ç­¾å’Œç¦æ­¢å›¾ç‰‡æ˜¾ç¤ºçš„åŠŸèƒ½ã€‚ 12345678910111213141516171819202122232425262728293031/** * xssè¿‡æ»¤ * */public class JsoupUtil &#123; /** * ä½¿ç”¨è‡ªå¸¦çš„basicWithImages ç™½åå• * å…è®¸çš„ä¾¿ç­¾æœ‰a,b,blockquote,br,cite,code,dd,dl,dt,em,i,li,ol,p,pre,q,small,span, * strike,strong,sub,sup,u,ul,img * ä»¥åŠaæ ‡ç­¾çš„href,imgæ ‡ç­¾çš„src,align,alt,height,width,titleå±æ€§ */ private static final Whitelist whitelist = Whitelist.basicWithImages(); /** é…ç½®è¿‡æ»¤åŒ–å‚æ•°,ä¸å¯¹ä»£ç è¿›è¡Œæ ¼å¼åŒ– */ private static final Document.OutputSettings outputSettings = new Document.OutputSettings().prettyPrint(false); static &#123; // å¯Œæ–‡æœ¬ç¼–è¾‘æ—¶ä¸€äº›æ ·å¼æ˜¯ä½¿ç”¨styleæ¥è¿›è¡Œå®ç°çš„ // æ¯”å¦‚çº¢è‰²å­—ä½“ style="color:red;" // æ‰€ä»¥éœ€è¦ç»™æ‰€æœ‰æ ‡ç­¾æ·»åŠ styleå±æ€§ whitelist.addAttributes(":all", "style"); &#125; public static String clean(String content) &#123; return Jsoup.clean(content, "", whitelist, outputSettings); &#125; public static void main(String[] args) throws FileNotFoundException, IOException &#123; String text = "&lt;a href=\"http://www.baidu.com/a\" onclick=\"alert(1);\"&gt;sss&lt;/a&gt;&lt;script&gt;alert(0);&lt;/script&gt;sss"; System.out.println(clean(text)); &#125;&#125; é€»è¾‘åˆ†æ jsoupä½œä¸ºä¸€æ¬¾è½»ä¾¿çš„çˆ¬è™«æ¡†æ¶ï¼Œå…¨éƒ¨ç”±Jonathan Hedleyç‹¬ç«‹å†™å‡ºï¼Œå› æ­¤ä»£ç ç›¸æ¯”å…¶ä»–ä¸€äº›ç¬¨é‡çš„æ¡†æ¶è¦ç®€æ´å¾ˆå¤šï¼Œæˆ‘é€šè¿‡ç½‘ä¸Šä¸€äº›è§£æjsoupæºç çš„åšå®¢ï¼ŒåŠ æ·±å¯¹jsoupçš„ç†è§£ã€‚åºŸè¯ä¸å¤šè¯´ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹jsoupçš„é­…åŠ›å§ï¼ å€Ÿç”¨åˆ«äººåšå®¢é‡Œæ•´ç†çš„å›¾ç‰‡ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè®©javaèƒ½åƒjsé‚£æ ·ä½¿ç”¨ç±»ä¼¼æ ‡ç­¾çš„åµŒå¥—å­˜å‚¨çš„æ–¹æ³•å°±æ˜¯åœ¨è¿™é‡Œå°±æ˜¯åˆ©ç”¨è‡ªå®šä¹‰çš„nodeæŠ½è±¡ç±»ï¼Œå°†å±æ€§å­˜å‚¨åœ¨ç±»ä¼¼æ ‘çŠ¶çš„ç»“æ„ä¸­è¿™ï¼Œè¿™æ ·åšä¸ä»…æœ‰åˆ©äºä¹‹åçš„DOMæ ‘è§£æï¼Œä¹Ÿå®¹æ˜“éå†ï¼Œæœ‰åˆ©äºæ€§èƒ½çš„æé«˜ã€‚ æˆ‘ä»¬å†çœ‹çœ‹CSSé€‰æ‹©å™¨çš„å®ç°é€»è¾‘ã€‚è¿™æ˜¯selectorçš„æºç åˆ—è¡¨ jsoupåœ¨å…³äºselectorçš„å®ç°å¤§è‡´æ˜¯åˆ©ç”¨EvaluatoræŠ½è±¡ç±»ï¼ŒSelectoré€‰æ‹©çš„è¡¨è¾¾å¼éƒ½ä¼šé€šè¿‡QueryParseræœ€ç»ˆç¼–è¯‘åˆ°å¯¹åº”çš„Evaluatorç±»ä¸Šï¼Œç„¶åæ­¤ç±»åˆæœ‰å¾ˆå¤šæ´¾ç”Ÿå­ç±»ï¼Œä»è€Œåˆ†åˆ«å®ç°ä¸åŒåŠŸèƒ½ã€‚é€»è¾‘æ€è·¯è¿˜ç®—ç®€å•ï¼Œä½†æ˜¯å…·ä½“ä»£ç æˆ‘è¿˜ä¸æ›¾ä»”ç»†ç ”è¯»ï¼Œå› æ­¤åœ¨æ­¤ä¹Ÿä¸å†èµ˜è¿°ã€‚ä¸è¿‡å…¶ä¸­è¿›è¡ŒåµŒå¥—å®ç°å¯¹è±¡çš„æ€è·¯è¿˜æ˜¯å€¼å¾—å€Ÿé‰´çš„ã€‚ åœ¨HTMLè¿‡æ»¤æ–¹é¢ï¼Œjsoupé˜²æ­¢XSSæ”»å‡»çš„å¤§è‡´ç­–ç•¥æ˜¯ å°†HTMlå­—ç¬¦ä¸²è§£ææˆdocumentå¯¹è±¡ï¼Œè¿™æ ·ä¿è¯äº†æ— æ³•é€šè¿‡æ³¨å…¥ä¸€æ®µæ— ç”¨çš„è„šæœ¬å’Œå­—ç¬¦ä¸²æ‹¼æ¥å¯¼è‡´ç½‘é¡µçš„åŠŸèƒ½å‘ç”Ÿäº†æ”¹å˜ å°†ä¸€äº›é«˜é¢‘å‡ºç°çš„å±é™©ç³»æ•°è¾ƒé«˜çš„æ ‡ç­¾åŠ å…¥ç™½åå•è¿›è¡Œæå‰è¿‡æ»¤ æ€»ç»“jsoupåœ¨æ“ä½œä¾¿æ·åº¦ä¸Šå·²ç»å±•ç°äº†å®ƒçš„å®åŠ›ï¼Œä½†æ˜¯åœ¨æ€§èƒ½ä¸Šï¼Œè€ƒè™‘åˆ°å®ƒçš„åº•å±‚è¿˜æ˜¯é€šè¿‡æ­£åˆ™è¿›è¡ŒåŒ¹é…ï¼Œå› æ­¤å¯¹äºä¸€äº›ä¸€äº›ç®€å•çš„HTMLè§£ææˆ–è®¸ç›´æ¥æ­£åˆ™çš„æœ€å¿«çš„ï¼›ä½†æ˜¯ï¼Œå½“HTMLé¡µé¢æ¯”è¾ƒå¤æ‚ï¼Œè¿™ä¾¿æ˜¯jsoupå¤§æ˜¾èº«æ‰‹çš„æ—¶å€™äº†ã€‚ ä½†æ˜¯jsoupè¿˜æ˜¯æœ‰å¾ˆå¤šä¸è¶³ï¼Œä¾‹å¦‚ åªèƒ½å¤„ç†é™æ€é¡µé¢ï¼Œå¯¹äºåŠ¨æ€æ˜¾ç¤ºæˆ–è€…åç«¯æ¸²æŸ“ååçš„é¡µé¢æ— æ³•æ­£å¸¸è¿›è¡Œçˆ¬å–ï¼Œè¿™æ—¶å°±éœ€è¦åˆ©ç”¨å…¶ä»–çš„å·¥å…·ä¾‹å¦‚httpunitè¿›è¡Œæ¨¡æ‹Ÿçš„ajaxè¯·æ±‚ã€‚ jsoupæ€»å½’è¿˜åªæ˜¯ä¸ªäººé¡¹ç›®ï¼Œåœ¨åæœŸçš„ç»´æŠ¤æ–¹é¢è¿˜æ˜¯å­˜åœ¨ä¸€å®šçš„ä¸ç¡®å®šæ€§ï¼Œå¦‚æœéœ€è¦ç”¨åº”ç”¨åœ¨ä¸€äº›å¤§å‹çš„é•¿ä¹…æ€§çš„é¡¹ç›®ä¸­è¿˜éœ€ä¸‰æ€ã€‚ jsoupçš„åº•å±‚å®ç°è¿˜æ˜¯æ­£åˆ™åŒ¹é…ï¼Œå°½ç®¡jsoupæœ¬èº«å¤Ÿè½»é‡ï¼Œä½†å®ƒä¾ç„¶éœ€è¦è§£ææ•´ä¸ªHTMLï¼Œå†è¿›è¡Œè¿›ä¸€æ­¥çš„æœç´¢ï¼Œå› æ­¤åœ¨ä¸€äº›ç®€å•çš„ç½‘é¡µè§£æä¸­ï¼Œè‚¯å®šè¿˜æ˜¯ç›´æ¥ä¸Šæ­£åˆ™æ¥çš„ç›´æ¥æ¥çš„æ–¹ä¾¿ã€‚ä½†æ˜¯å¦‚æœç½‘é¡µçš„ç»“æ„è¶³å¤Ÿå¤æ‚ï¼Œä½¿ç”¨æ­£åˆ™çš„çš„ä»£ç é‡å·¨å¤§ï¼Œé‚£ä¹ˆjsoupä¸å¤±ä¸ºä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ æ€»è€Œè¨€ä¹‹ï¼Œjsoupä½œä¸ºä¸€æ¬¾è½»é‡çš„çˆ¬è™«æ¡†æ¶ï¼Œåœ¨HTMLè§£ææ–¹é¢çš„è¡¨ç°è¿˜æ˜¯å¾ˆä¸é”™çš„ï¼Œå¦‚æœå¹³æ—¶å¸Œæœ›å·ç‚¹æ‡’ï¼ŒèŠ‚çœç‚¹æ—¶é—´å’Œä»£ç é‡ï¼Œå®Œå…¨æ¨èå¤§å®¶ä½¿ç”¨ã€‚]]></content>
      <categories>
        <category>æŠ€æœ¯æ¢ç´¢</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>å·¥å…·</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[markdownå¸¸ç”¨æ ¼å¼æµ‹è¯•]]></title>
    <url>%2F2019%2F09%2F18%2Ftest%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯å¯¹hexo æ¸²æŸ“çš„markdownæ¨¡æ¿çš„æµ‹è¯•ï¼ŒåŒæ—¶ä¹Ÿè´´ä¸€ä¸‹å¸¸ç”¨çš„markdownä¹¦å†™æ ¼å¼å’Œæ’ä»¶ä½¿ç”¨ï¼Œåšä¸€ä¸‹å¤‡å¿˜~ ä»¥ä¸‹æ‰€æœ‰ä»£ç åªéœ€è¦å¤åˆ¶åˆ°markdownç¼–è¾‘å™¨å³å¯ä½¿ç”¨ï¼ŒåŒæ—¶è¦æ³¨æ„ç¼–è¾‘å™¨çš„ç‰ˆæœ¬å’Œå…¼å®¹æ€§ï¼Œæ¯”å¦‚æˆ‘ä¹‹é—´ç”¨çš„typoraå°±æ€»æ˜¯ä¸èƒ½æ­£å¸¸æ˜¾ç¤ºhtmlæ ¼å¼ğŸ¤£ï¼Œè¿˜å¥½åšå®¢é‡å»ºå‰æ›´æ–°äº†ç‰ˆæœ¬åˆå¯ä»¥ç”¨äº†â€¦ æ’ä»¶æµ‹è¯•Aplayeræ’­æ”¾æµ‹è¯• var ap = new APlayer({ element: document.getElementById("aplayer-MkrCfcDb"), narrow: false, autoplay: false, showlrc: false, music: { title: "ä¸‰è½®å­¦", author: "Jeff Williams", url: "http://music.163.com/song/media/outer/url?id=5231510.mp3", pic: "", lrc: "" } }); window.aplayers || (window.aplayers = []); window.aplayers.push(ap); 12&#123;% aplayer "å¯ä»¥äº†" "é™ˆå¥•è¿…" "éŸ³ä¹åœ°å€" "å›¾ç‰‡åœ°å€" %&#125;å¤–é“¾åœ°å€http://music.163.com/song/media/outer/url?id=478384.mp3 Dplayeræ’­æ”¾æµ‹è¯•(function(){var player = new DPlayer({"container":document.getElementById("dplayer0"),"theme":"#FADFA3","loop":true,"video":{"url":"http://lc-dtfowewy.cn-n1.lcfile.com/e84e4b6519b04ed3c497/400%E7%B1%B3.mp4","pic":"http://devtest.qiniudn.com/è‹¥èƒ½ç»½æ”¾å…‰èŠ’.png"}});window.dplayers||(window.dplayers=[]);window.dplayers.push(player);})() 1&#123;% dplayer "url=è§†é¢‘åœ°å€" "pic=å›¾ç‰‡åœ°å€" "loop=yes" "theme=#FADFA3" "autoplay=false"%&#125; MARKDOWNæ ¼å¼æµ‹è¯•æˆ‘æ˜¯é»‘ä½“å­—(ä¸ï¼Œä½ æ˜¯é«˜äº®) æˆ‘æ˜¯å¾®è½¯é›…é»‘ æˆ‘æ˜¯åæ–‡å½©äº‘ æˆ‘æ˜¯çº¢è‰² æˆ‘æ˜¯ç»¿è‰² æˆ‘æ˜¯è“è‰² æˆ‘æ˜¯å°ºå¯¸ æˆ‘æ˜¯é»‘ä½“ï¼Œç»¿è‰²ï¼Œå°ºå¯¸ä¸º5 123456789101112131415&lt;mark&gt;æˆ‘æ˜¯é»‘ä½“å­—(ä¸ï¼Œä½ æ˜¯é«˜äº®)&lt;/mark&gt;&lt;font face="å¾®è½¯é›…é»‘"&gt;æˆ‘æ˜¯å¾®è½¯é›…é»‘&lt;/font&gt;&lt;font face="STCAIYUN"&gt;æˆ‘æ˜¯åæ–‡å½©äº‘&lt;/font&gt;&lt;font color=red&gt;æˆ‘æ˜¯çº¢è‰²&lt;/font&gt;&lt;font color=#008000&gt;æˆ‘æ˜¯ç»¿è‰²&lt;/font&gt;&lt;font color=Blue&gt;æˆ‘æ˜¯è“è‰²&lt;/font&gt;&lt;font size=5&gt;æˆ‘æ˜¯å°ºå¯¸&lt;/font&gt;&lt;font face="é»‘ä½“" color=green size=5&gt;æˆ‘æ˜¯é»‘ä½“ï¼Œç»¿è‰²ï¼Œå°ºå¯¸ä¸º5&lt;/font&gt; åšå®¢æ’ä»¶è®°å½•æˆ‘ç”¨çš„åšå®¢ä¸»é¢˜æ˜¯sagiriè¿™é‡Œæ„Ÿè°¢åŸä½œè€…çš„å’Œè¾›å‹¤åŠªåŠ›å’Œæ…·æ…¨å¼€æºï¼Œåœ¨éƒ¨ç½²çš„æ—¶å€™é‡åˆ°äº†ä¸€äº›æ’ä»¶ç¼ºå¤±çš„é—®é¢˜ï¼Œè¿™é‡Œç¨å¾®æä¸€ä¸‹ï¼Œåšä¸€ä¸‹å¤‡ä»½ 1234567891011121314151617181920212223242526window.FastClick = require('fastclick');require('lazyload');require('fancybox')(window.$);window.notie = require('corner-notie');require('./utils');require('./motion');require('./affix');require('./pisces')();require('./scrollspy');require('./post-details')();require('./bootstrap');require('./evanyou');require('./leancloud')();require('./share')();require('./scroll');require('./since');require('./title');require('./type');require('./kanban');require('./mix');require('./clipboard');require('./pjax');require('./online');require('./search');require('./cursor-effects');]]></content>
      <tags>
        <tag>æµ‹è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é«˜æ€§èƒ½mysqlå­¦ä¹ ç¬”è®°]]></title>
    <url>%2F2019%2F09%2F18%2Fmysql-h%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘åœ¨çœ‹ã€Šé«˜æ€§èƒ½MySqlã€‹ï¼Œæ„Ÿè§‰æœ‰äº›åœ°æ–¹ç¡®å®éœ€è¦åå¤å’€åš¼æ‰èƒ½çœŸæ­£é¢†ä¼šï¼Œç°åœ¨å°†å†…å®¹æ€»ç»“äº†ä¸€ä¸‹ï¼Œæ–¹ä¾¿ä»¥åäºŒæ¬¡é˜…è¯» æ•°æ®åº“ç´¢å¼•åŸç†åŠä¼˜åŒ– Mysqlæ¶æ„MVCCä¸ºMVCCæ˜¯è¡Œçº§é”çš„ä¸€ä¸ªå˜ç§ï¼Œä½†æ˜¯å®ƒåœ¨å¾ˆå¤šæƒ…å†µä¸‹é¿å…äº†åŠ é”æ“ä½œï¼Œå› æ­¤å¼€ é”€æ›´ä½ã€‚è™½ç„¶å®ç°æœºåˆ¶æœ‰æ‰€ä¸åŒï¼Œä½†å¤§éƒ½å®ç°äº†éé˜»å¡çš„è¯»æ“ä½œï¼Œå†™æ“ä½œä¹Ÿåªé”å®šå¿…è¦çš„è¡Œã€‚ MVCCçš„å®ç°,æ˜¯é€šè¿‡ä¿å­˜æ•°æ®åœ¨æŸä¸ªæ—¶é—´ç‚¹çš„å¿«ç…§æ¥å®ç°çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ç®¡éœ€è¦æ‰§è¡Œå¤šé•¿æ—¶é—´ï¼Œæ¯ä¸ªäº‹åŠ¡çœ‹åˆ°çš„æ•°æ®éƒ½æ˜¯ä¸€è‡´çš„ã€‚æ ¹æ®äº‹åŠ¡å¼€å§‹çš„æ—¶é—´ä¸åŒï¼Œæ¯ä¸ªäº‹åŠ¡å¯¹åŒä¸€å¼ è¡¨ï¼ŒåŒä¸€æ—¶åˆ»çœ‹åˆ°çš„æ•°æ®å¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ åˆ›å»ºé«˜æ€§èƒ½ç´¢å¼•åŸºç¡€ Mysqlåªèƒ½é«˜æ•ˆåœ°ä½¿ç”¨æœ€å·¦å‰ç¼€åˆ— ç´¢å¼•ç±»å‹ç´¢å¼•æ˜¯åœ¨å­˜å‚¨å±‚å®ç°çš„ï¼Œä¸æ˜¯åœ¨æœåŠ¡å™¨å±‚ B-Treeç´¢å¼•é»˜è®¤ç´¢å¼•ï¼Œé™¤äº†Archiveä¸æ”¯æŒä¹‹å¤– ä¸åŒå¼•æ“ä½¿ç”¨çš„å­˜å‚¨ç»“æ„ä¸åŒï¼ŒNDBé›†ç¾¤å­˜å‚¨å¼•æ“ä½¿ç”¨T-Treeç»“æ„ï¼ŒinnoDBä½¿ç”¨B+Treeç»“æ„ ä¸åŒå¼•æ“ä½¿ç”¨æ€§èƒ½ä¹Ÿä¸åŒï¼ŒMyISAMä½¿ç”¨å‰ç¼€å‹ç¼©æŠ€æœ¯ä½¿ç´¢å¼•æ›´å°ï¼Œé€šè¿‡æ•°æ®çš„ç‰©ç†ä½ç½®å¼•ç”¨è¢«ç´¢å¼•çš„åˆ—ï¼›InonDBæŒ‰ç…§åŸæ•°æ®æ ¼å¼å‹ç¼©å­˜å‚¨ï¼Œæ ¹æ®ä¸»é”®å¼•ç”¨è¢«ç´¢å¼•çš„åˆ— B-Treeè¡¨ç¤ºå€¼éƒ½æ˜¯æŒ‰é¡ºåºå­˜å‚¨ï¼Œæ¯ä¸€ä¸ªå¶å­åˆ°æ ¹çš„è·ç¦»ç›¸åŒ æŸ¥è¯¢ä»ç´¢å¼•çš„æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œæ ¹èŠ‚ç‚¹ä¸­å­˜æ”¾çš„æ˜¯æŒ‡å‘å¶å­èŠ‚ç‚¹çš„æŒ‡é’ˆ å¶å­èŠ‚ç‚¹çš„æŒ‡é’ˆæŒ‡å‘è¢«ç´¢å¼•æ•°æ® B-Treeç´¢å¼•é€‚ç”¨äºå…¨é”®å‹ã€é”®å€¼èŒƒå›´å’Œé”®å‰ç¼€æŸ¥æ‰¾ä¸­çš„æœ€å·¦å‰ç¼€æŸ¥æ‰¾ å…¨å€¼åŒ¹é… ä¸æ‰€æœ‰åˆ—è¿›è¡ŒåŒ¹é… æœ€å·¦å‰ç¼€åŒ¹é… åªä½¿ç”¨ç´¢å¼•çš„ç¬¬ä¸€åˆ— åˆ—å‰ç¼€åŒ¹é… æŸåˆ—çš„å¼€å¤´éƒ¨åˆ† èŒƒå›´å€¼åŒ¹é… ç²¾ç¡®åŒ¹é…æŸä¸€åˆ—å¹¶èŒƒå›´åŒ¹é…å¦å¤–ä¸€åˆ— åªè®¿é—®ç´¢å¼•çš„æŸ¥è¯¢ å³è¦†ç›–æŸ¥è¯¢ é¡ºåºæŸ¥è¯¢ï¼Œæ¯”å¦‚Order By ä½¿ç”¨é™åˆ¶ éæœ€å·¦åŒ¹é…æŸ¥è¯¢ ä¸èƒ½è·³è¿‡ç´¢å¼•çš„åˆ— å¦‚æœå­˜åœ¨æŸåˆ—çš„èŒƒå›´æŸ¥è¯¢ï¼Œå³è¾¹æ‰€æœ‰åˆ—éƒ½æ— æ³•ä½¿ç”¨ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢ å“ˆå¸Œç´¢å¼•åŸºäºhashè¡¨å®ç°ï¼Œå¿…é¡»ç²¾ç¡®åŒ¹é…æ‰æœ‰æ•ˆ åªæœ‰memoryå¼•æ“æ˜¾å¼æ”¯æŒä¸”é»˜è®¤æ”¯æŒ åˆ†ä¸ºSlotæ§½å’ŒValueå€¼ æŸ¥æ‰¾æ–¹æ³•ï¼šè®¡ç®—hashå€¼-&gt;æ‰¾åˆ°æŒ‡å‘æŒ‡é’ˆ-&gt;æŸ¥æ‰¾æ•°æ®è¡Œ é™åˆ¶ åªåŒ…å«hashå€¼å’ŒæŒ‡é’ˆï¼Œä¸å­˜å‚¨å­—æ®µå€¼ï¼Œæ‰€ä»¥å¿…é¡»è¯»å–æ•°æ®è¡Œã€‚ä¸è¿‡å†…å­˜è®¿é—®è¡Œé€Ÿåº¦è¾ƒå¿«ï¼Œå¯ä»¥ä¸è€ƒè™‘ ç´¢å¼•æ•°æ®ä¸æ˜¯æŒ‰ç…§ç´¢å¼•å€¼é¡ºåºå­˜å‚¨ï¼Œæ— æ³•åº”ç”¨äºæ’åº ä¸æ”¯æŒéƒ¨åˆ†åŒ¹é…ç´¢å¼• åªæ”¯æŒç­‰å€¼æŸ¥è¯¢ å­˜åœ¨å“ˆå¸Œå†²çªï¼Œå³ä¸åŒç´¢å¼•åˆ—å€¼å…·æœ‰ç›¸åŒçš„å“ˆå¸Œå€¼ï¼Œå½“å­˜åœ¨å“ˆå¸Œå†²çªçš„æ—¶å€™å¿…é¡»éå†é“¾è¡¨ä¸­çš„æ‰€æœ‰è¡ŒæŒ‡é’ˆï¼Œé€è¡Œæ¯”è¾ƒ ç´¢å¼•ç»´æŠ¤ä»£ä»·éšç€å“ˆå¸Œå†²çªçš„å¢åŠ è¶Šæ¥è¶Šå¤§ InnDBå­˜åœ¨è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ï¼Œå½“åˆ¤æ–­å‡ºæŸ¥æ‰¾é¢‘ç¹çš„ç´¢å¼•å€¼æ—¶ï¼Œåœ¨B-Treeçš„åŸºç¡€ä¸Šå†åˆ›å»ºä¸€ä¸ªHashç´¢å¼• å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰hashç´¢å¼•ï¼Œè¿›è¡Œä¼ªhashç´¢å¼•ï¼Œé’ˆå¯¹ç´¢å¼•å€¼è¾ƒå¤§æ—¶ï¼Œä½†æ˜¯å¿…é¡»ä¿è¯ç´¢å¼•å€¼çš„å”¯ä¸€æ€§ R-Treeç©ºé—´ç´¢å¼•MyISAMå¼•æ“æ”¯æŒç©ºé—´ç´¢å¼•ï¼Œç”¨ä½œåœ°ç†ä½ç½®å­˜å‚¨ å…¨æ–‡ç´¢å¼•æŸ¥æ‰¾æ–‡æœ¬ä¸­çš„å…³é”®å­— â€¦ ç´¢å¼•çš„ä¼˜ç‚¹ å‡å°‘æœåŠ¡å™¨æ‰«ææ•°æ®é‡ å¸®åŠ©æœåŠ¡å™¨é¿å…æ’åºå’Œä¸´æ—¶è¡¨ å°†éšæœºIOå˜æˆ3é¡ºåºIO ä¸‰æ˜ŸåŸåˆ™ ç´¢å¼•æ˜¯å¦å°†ç›¸å…³è®°å½•æ”¾åœ¨ä¸€èµ· ç´¢å¼•ä¸­çš„æ•°æ®é¡ºåºå’Œæ’åºé¡ºåºä¸€è‡´ åŒ…å«æŸ¥è¯¢ä¸­éœ€è¦çš„å…¨éƒ¨åˆ— é«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥ä½¿ç”¨ç‹¬ç«‹çš„åˆ—å°†ç´¢å¼•åˆ—å•ç‹¬æ”¾åœ¨æ¯”è¾ƒç¬¦å·çš„ä¸€ä¾§ å‰ç¼€ç´¢å¼•ä½¿ç”¨å‰ç¼€ç´¢å¼•ç´¢å¼•å¾ˆé•¿çš„å­—ç¬¦ä¸²ï¼Œèƒ½è®©ç´¢å¼•æ›´å°æ›´å¿«ä½†æ˜¯Mysqlæ— æ³•ä½¿ç”¨å‰ç¼€ç´¢å¼•åšORDER BYå’ŒGROUP BYï¼Œä¹Ÿæ— æ³•ä½¿ç”¨å‰ç¼€ç´¢å¼•åšè¦†ç›–æ‰«æ ç´¢å¼•çš„é€‰æ‹©æ€§ï¼šä¸é‡å¤çš„ç´¢å¼•å€¼å’Œæ•°æ®è¡¨çš„è®°å½•æ€»æ•°çš„æ¯”å€¼ï¼›å”¯ä¸€ç´¢å¼•çš„é€‰æ‹©æ€§æ˜¯1 å°½å¯èƒ½è¦è®©å‰ç¼€ç´¢å¼•çš„é€‰æ‹©æ€§å’Œå…¨å€¼ç´ é“¶çš„é€‰æ‹©æ€§ç›¸åŒ¹é… å¤šåˆ—ç´¢å¼•å‡ºç°åˆå¹¶ç´¢å¼•ï¼ˆUsing Unionï¼‰æ„å‘³ç€ç´¢å¼•å»ºç«‹ç³Ÿç³• å¤šä¸ªANDæ¡ä»¶å¯ä»¥ä½¿ç”¨ä¸€ä¸ªåŒ…å«æ‰€æœ‰åˆ—çš„å¤šåˆ—ç´¢å¼•ä»£æ›¿ å¤šä¸ªORæ¡ä»¶ä¼šæ¶ˆè€—å¤§é‡CPUå’Œå†…å­˜èµ„æº é€‰æ‹©åˆé€‚é¡ºåºä¸€èˆ¬æ€è·¯ï¼š å°†é€‰æ‹©æ€§æœ€é«˜çš„åˆ—æ”¾åœ¨ç´¢å¼•æœ€å‰åˆ—ï¼ˆä¸éœ€è¦è€ƒè™‘æ’åºæˆ–åˆ†ç»„æ—¶ï¼‰ è®¡ç®—é€‰æ‹©æ€§ï¼Œé€‰æ‹©æ€§ä½çš„æ”¾åœ¨æœ€å‰é¢ æ³¨æ„å…·ä½“æƒ…å†µï¼Œç•™å¿ƒWHEREå­—å¥ä¸­çš„æ’åºã€åˆ†ç»„å’ŒèŒƒå›´æ¡ä»¶ç­‰å› ç´ å¯¹æŸ¥è¯¢çš„å½±å“ èšç°‡ç´¢å¼•èšç°‡ç´¢å¼•æ˜¯ä¸€ç§æ•°æ®å­˜å‚¨æ–¹å¼ï¼Œä¸æ˜¯ç´¢å¼•ç±»å‹ InnoDBä¸­ç«–æ•°æ®è¡Œå­˜æ”¾åœ¨ç´¢å¼•çš„å¶å­é¡µä¸­ï¼Œèšç°‡å³æ•°æ®è¡Œå’Œç›¸é‚»é”®å€¼ç´§å‡‘å­˜å‚¨åœ¨ä¸€èµ· ä¼˜ç‚¹ æ•°æ®è®¿é—®æ›´å¿« ä½¿ç”¨è¦†ç›–ç´¢å¼•æ‰«æ‰«ææŸ¥è¯¢æ—¶å¯ä»¥ç›´æ¥ä½¿ç”¨ä¸»é”®å€¼ æ•°æ®ç›¸å…³ä¿å­˜ ç¼ºç‚¹ æ•°æ®æ”¾åœ¨å†…å­˜å°±æ²¡æœ‰ä¼˜åŠ¿äº† æ’å…¥é€Ÿåº¦ä¾èµ–äºæ’å…¥é¡ºåºï¼ŒæŒ‰ç…§ä¸»é”®æ’å…¥æœ€å¿« æ›´æ–°èšç°‡ç´¢å¼•åˆ—ä»£ä»·è¾ƒé«˜ æ›´æ–°æ—¶å­˜åœ¨åˆ—åˆ†è£‚çš„é—®é¢˜ï¼Œå³å½“é¡µé¢æ’æ»¡çš„æ—¶å€™ä¼šå°†è¯¥é¡µåˆ†è£‚å®¹ä¸‹è¯¥è¡Œï¼Œä»è€Œå ç”¨æ›´å¤šç£ç›˜ç©ºé—´ èšç°‡ç´¢å¼•å¯èƒ½å¯¼è‡´å…¨è¡¨æ‰«æå˜æ…¢ï¼Œå°¤å…¶æ˜¯è¡Œæ¯”è¾ƒç¨€ç–ï¼Œæˆ–è€…ç”±äºé¡µåˆ†è£‚å¯¼è‡´æ•°æ®å­˜å‚¨ä¸è¿ç»­çš„æ—¶å€™ äºŒçº§ç´¢å¼•ï¼ˆéèšç°‡ç´¢å¼•ï¼‰å¾ˆå¤§ äºŒçº§ç´¢å¼•è®¿é—®éœ€è¦ä¸¤æ¬¡ç´¢å¼•æŸ¥æ‰¾ï¼Œå› ä¸ºäºŒçº§ç´¢å¼•èŠ‚ç‚¹ä¿å­˜çš„æ˜¯è¡Œä¸»é”®å€¼è€Œä¸æ˜¯ç‰©ç†ä½ç½®æŒ‡å‘çš„æŒ‡é’ˆ InnoDBå’ŒMyISAMçš„æ•°æ®åˆ†å¸ƒ MyISAMæ›´åŠ ç®€å•ï¼ŒäºŒçº§ç´¢å¼•å­˜æ”¾çš„æ˜¯æŒ‡é’ˆï¼›InnoDBå­˜æ”¾çš„ç´¢å¼•çš„ä¸»é”®å€¼ è¦†ç›–ç´¢å¼• åªè¯»å–ç´¢å¼•å³å¯ä»¥è·å–æ•°æ®è¡Œï¼Œå‡å°‘æ•°æ®è®¿é—®é‡ï¼›ä¹Ÿæ›´å®¹æ˜“æ”¾å…¥å†…å­˜ä¸­ ç´¢å¼•æ˜¯é¡ºåºå­˜å‚¨çš„ï¼Œé€‚åˆIOå¯†é›†å‹ èšç°‡ç´¢å¼•+è¦†ç›–ç´¢å¼•æ¯”è¾ƒé«˜æ•ˆ æ— æ³•æ‰§è¡Œè¦†ç›–ç´¢å¼•çš„åŸå›  ç´¢å¼•å¿…é¡»å­˜ç´¢å¼•åˆ—çš„å€¼ï¼Œmysqlä¸­ä¸€èˆ¬åªç”¨B-Tree æ²¡æœ‰ä»»ä½•ç´¢å¼•èƒ½è¦†ç›–è¿™ä¸ªæŸ¥è¯¢ ä¸èƒ½ä½¿ç”¨LIKEæ“ä½œ æ”¹è‰¯æ–¹æ³• ä½¿ç”¨å»¶è¿Ÿå…³è” ç´¢å¼•æ‰«æä½œä¸ºæ’åºexplainä¸­typeå€¼ä¸ºâ€indexâ€è¯´æ˜ä½¿ç”¨ç´¢å¼•æ‰«æ å½“ç´¢å¼•çš„åˆ—é¡ºåºå’ŒORDERBYå­å¥é¡ºåºä¸€è‡´å¹¶ä¸”æ‰€ä»¥åˆ—çš„æ’åºæ–¹å‘ä¸€æ ·æ—¶ï¼Œmysqlæ‰èƒ½ä½¿ç”¨ç´¢å¼•åšç»“æœæ’åº å‹ç¼©ï¼ˆå‰ç¼€å‹ç¼©ï¼‰ç´¢å¼•MyISAMå¯ä»¥å‹ç¼©ç´¢å¼•å¤§å° æ–¹æ³• å…ˆä¿å­˜ç´¢å¼•å—çš„ç¬¬ä¸€ä¸ªå€¼ å…¶ä»–å€¼å’Œç¬¬ä¸€ä¸ªå€¼æ¯”è¾ƒå¾—åˆ°ç›¸åŒå‰ç¼€çš„å­—èŠ‚æ•°å’Œå‰©ä½™çš„ä¸é€šè¿‡åç¼€éƒ¨åˆ† ä¼˜åŠ¿ å ç”¨æ›´å°çš„ç©ºé—´ ç¼ºç‚¹ æ— æ³•ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ç­‰ï¼Œæœ‰äº›æ“ä½œå¦‚å€’åºæ“ä½œé€Ÿåº¦ä¸è¡Œ ä¸é€‚åˆCPUå¯†é›†å‹åº”ç”¨ å†—ä½™å’Œé‡å¤ç´¢å¼•æœç»é‡å¤ç´¢å¼• å†—ä½™ç´¢å¼•å‡ºç°æƒ…å†µ éœ€è¦æ‰©å±•ç´¢å¼•åˆè¦ä¿è¯åŸç´¢å¼•æ€§èƒ½ä¸è¢«å½±å“ æ³¨æ„ç´¢å¼•è¶Šå¤šç»´æŠ¤æˆæœ¬è¶Šé«˜ ç´¢å¼•å’Œé”ç´¢å¼•å¯ä»¥è®©æŸ»è¯¢é”å®šæ›´å°‘çš„è¡Œã€‚ InnoDBåœ¨äºŒçº§ç´¢å¼•ä¸Šä½¿ç”¨å…±äº«(è¯»ï¼‰é”ï¼Œä½†è®¿é—®ä¸»é”®ç´¢å¼•éœ€è¦æ’ä»–ï¼ˆå†™ï¼‰é”ã€‚è¿™æ¶ˆé™¤äº†ä½¿ç”¨è¦†ç›–ç´¢å¼•çš„å¯èƒ½æ€§ï¼Œå¹¶ä¸”ä½¿å¾—SELECT FOR UPDATEæ¯”LOCK IN SHARE MODEæˆ–éé”å®šæŸ»è¯¢è¦æ…¢å¾ˆå¤šã€‚ ç´¢å¼•æ¡ˆä¾‹æ”¯æŒå¤šç§è¿‡æ»¤æ¡ä»¶ å­—æ®µé€‰æ‹©å°‘çš„æ”¾åœ¨å‰é¢ èŒƒå›´æŸ¥æ‰¾çš„å­—æ®µæ”¾åœ¨åé¢ é¿å…å¤šä¸ªèŒƒå›´æŸ¥è¯¢èŒƒå›´åˆ—åé¢æ— æ³•ç´¢å¼• å¯ä»¥å°è¯•å°†ä¸€ä¸ªèŒƒå›´åˆ—å˜æˆç­‰å€¼åˆ—è¿›è¡Œæ¯”è¾ƒ ä¼˜åŒ–æ’åº ä½¿ç”¨å»¶è¿Ÿå…³è”ï¼Œé€šä½¿ç”¨è¦†ç›–ç´¢å¼•æŸ¥è¯¢è¿”å›éœ€è¦çš„ä¸»é”®ï¼Œå†æ ¹æ®è¿™äº›ä¸»é”®å…³è”åŸè¡¨è·å¾—éœ€è¦çš„è¡Œ ç»´æŠ¤ç´¢å¼•å’Œè¡¨ç»´æŠ¤ç›®çš„ æ‰¾åˆ°å¹¶ä¿®å¤æŸåçš„è¡¨ ç»´æŠ¤å‡†ç¡®è€Œçš„ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯ è¾ƒå°‘ç¢ç‰‡ æ›´æ–°ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯MySQLçš„æŸ¥è¯¢ä¼˜åŒ–å™¨æœ‰ä¸¤ä¸ªAPI records_in_range() InnoDBä¼ å…¥ä¸¤ä¸ªè¾¹ç•Œå€¼å¾—åˆ°ä¼°ç®—å€¼ info() è¿”å›ä¸ªå„ç§ç±»å‹æ•°æ® MySQLä¼˜åŒ–å™¨ä½¿ç”¨çš„æ˜¯åŸºäºæˆæœ¬çš„æ¨¡å‹ï¼Œè€Œè¡¡é‡æˆæœ¬çš„ä¸»è¦æŒ‡æ ‡å°±æ˜¯ä¸€ä¸ªæŸ¥è¯¢éœ€è¦æ‰«æå¤šå°‘è¡Œ ANALYZE TABLEï¼šé‡æ–°ç”Ÿæˆç»Ÿè®¡ä¿¡æ¯ å‡å°‘ç´¢å¼•å’Œæ•°æ®ç¢ç‰‡è¡Œç¢ç‰‡ è¿™ç§ç¢ç‰‡æŒ‡çš„æ˜¯æ•°æ®è¡Œè¢«å­˜å‚¨ä¸ºå¤šä¸ªåœ°æ–¹çš„å¤šä¸ªç‰‡æ®µä¸­ã€‚å³ä½¿æŸ»è¯¢åªä»ç´¢å¼•ä¸­è®¿é—®ä¸€è¡Œè®°å½•ï¼Œè¡Œç¢ç‰‡ä¹Ÿä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚ è¡Œé—´ç¢ç‰‡ è¡Œé—´ç¢ç‰‡æ˜¯æŒ‡é€»è¾‘ä¸Šé¡ºåºçš„é¡µï¼Œæˆ–è€…è¡Œåœ¨ç£ç›˜ä¸Šä¸æ˜¯é¡ºåºå­˜å‚¨çš„ã€‚è¡Œé—´ç¢ç‰‡å¯¹è¯¸å¦‚å…¨è¡¨æ‰«æå’Œèšç°‡ç´¢å¼•æ‰«æä¹‹ç±»çš„æ“ä½œæœ‰å¾ˆå¤§çš„å½±å“ï¼Œå› ä¸ºè¿™äº›æ“ä½œåŸæœ¬èƒ½å¤Ÿä»ç£ç›˜ä¸Šé¡ºåºå­˜å‚¨çš„æ•°æ®ä¸­è·ç›Šã€‚ å‰©ä½™ç©ºé—´ç¢ç‰‡ å‰©ä½™ç©ºé—´ç¢ç‰‡æ˜¯æŒ‡æ•°æ®é¡µä¸­æœ‰å¤§é‡çš„ç©ºä½™ç©ºé—´ã€‚è¿™ä¼šå¯¼è‡´æœåŠ¡å™¨è¯»å–å¤§é‡ä¸éœ€è¦çš„æ•°æ®ï¼Œä»è€Œé€ æˆæµªè´¹ã€‚ MylSAMè¡¨ï¼Œè¿™ä¸‰ç±»ç¢ç‰‡åŒ–éƒ½å¯èƒ½å‘ç”Ÿã€‚ä½†``InnoDBä¸ä¼šå‡ºç°çŸ­å°çš„è¡Œç¢ç‰‡ï¼›InnoDB`ä¼šç§»åŠ¨çŸ­å°çš„è¡Œå¹¶é‡å†™åˆ°ä¸€ä¸ªç‰‡æ®µä¸­ã€‚ è§£å†³æ–¹æ³• OPTIMIZE TABLEæˆ–è€…å¯¼å‡ºå†å¯¼å…¥çš„æ–¹å¼æ¥é‡æ–°æ•´ç†æ•°æ® MylSAMå¼•æ“ä»¥é€šè¿‡æ’åºç®—æ³•é‡å»ºç´¢å¼•çš„æ–¹å¼æ¥æ¶ˆé™¤ç¢ç‰‡ InnoDBå¯ä»¥å…ˆåˆ é™¤ï¼Œç„¶åå†é‡æ–°åˆ›å»ºç´¢å¼•çš„æ–¹å¼æ¥æ¶ˆé™¤ç´¢å¼•çš„ç¢ç‰‡åŒ–ã€‚ mysql&gt; ALTER TABLE &lt;table&gt; ENGINE=&lt;efigiwe&gt;; æ€»ç»“ æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–ä¸ºä»€ä¹ˆæŸ¥è¯¢é€Ÿåº¦ä¼šå˜æ…¢æŸ¥è¯¢çš„ç”Ÿå‘½å‘¨æœŸ æŸ¥è¯¢çš„æ—¶é—´èŠ±è´¹ ä¼˜åŒ–æ•°æ®è®¿é—®æŸ»è¯¢æ€§èƒ½ä½ä¸‹æœ€åŸºæœ¬çš„åŸå› æ˜¯è®¿é—®çš„æ•°æ®å¤ªå¤š ç¡®è®¤åº”ç”¨ç¨‹åºæ˜¯å¦åœ¨æ£€ç´¢å¤§é‡è¶…è¿‡éœ€è¦çš„æ•°æ®ã€‚è¿™é€šå¸¸æ„å‘³ç€è®¿é—®äº†å¤ªå¤šçš„è¡Œï¼Œä½†æœ‰æ—¶å€™ä¹Ÿå¯èƒ½æ˜¯è®¿é—®äº†å¤ªå¤šçš„åˆ—ã€‚ ç¡®è®¤MySQLæœåŠ¡å™¨å±‚æ˜¯å¦åœ¨åˆ†æå¤§é‡è¶…è¿‡éœ€è¦çš„æ•°æ®è¡Œã€‚ ä¸¾ä¾‹ æŸ¥è¯¢ä¸éœ€è¦è®°å½• ä½¿ç”¨LIMITé™åˆ¶æŸ¥è¯¢æ•°é‡ å¤šè¡¨å…³è”æ—¶è¿”å›å…¨éƒ¨åˆ— æ€»æ˜¯å–å‡ºå…¨éƒ¨åˆ— é‡å¤æŸ¥è¯¢ç›¸åŒçš„æ•°æ® æŸ¥çœ‹æ˜¯å¦æ‰«æé¢å¤–çš„è®°å½•å½±å“å¼€é”€çš„ä¸‰æŒ‡æ ‡ å“åº”æ—¶é—´ æ‰«æè¡Œæ•° è¿”å›è¡Œæ•° å“åº”æ—¶é—´ ç”±æœåŠ¡æ—¶é—´å’Œæ’é˜Ÿæ—¶é—´ç»„æˆ æ‰«æè¡Œæ•° ç†æƒ³æƒ…å†µåº”è¯¥å’Œè¿”å›è¡Œæ•°ç›¸åŒ è®¿é—®ç±»å‹ å…¨è¡¨æ‰«æ(æœ€æ…¢) ç´¢å¼•æ‰«æ èŒƒå›´æ‰«æ å”¯ä¸€ç´¢å¼•æŸ¥è¯¢ å¸¸æ•°å¼•ç”¨ï¼ˆæœ€å¿«ï¼‰ mysqlä½¿ç”¨whereçš„æ–¹å¼ åœ¨ç´¢å¼•ä¸­ä½¿ç”¨whereæ¡ä»¶æ¥è¿‡æ»¤ä¸åŒ¹é…çš„è®°å½•ã€‚ ä½¿ç”¨ç´¢å¼•è¦†ç›–æ‰«æè¿”å›è®°å½• ä»æ•°æ®è¡¨ä¸­è¿”å›æ•°æ®ï¼Œç„¶åè¿‡æ»¤ä¸æ»¡è¶³æ¡ä»¶çš„è®°å½• è§£å†³æ–¹æ¡ˆ ä½¿ç”¨ç´¢å¼•è¦†ç›–æ‰«æ æ”¹å˜åº“è¡¨ç»“æ„ é‡å†™æŸ¥è¯¢ é‡æ„æŸ¥è¯¢æ–¹å¼åˆ‡åˆ†æŸ¥è¯¢æŒ‰æ—¶æ¸…ç†æ•°æ® åˆ†è§£å…³è”æŸ¥è¯¢ ç¼“å­˜æ•ˆç‡æ›´é«˜ æ‰§è¡Œå•ä¸ªæŸ¥è¯¢æ—¶å‡å°‘é”çš„ç«äº‰ æ•°æ®åº“çš„é«˜æ€§èƒ½å’Œå¯æ‰©å±• æŸ¥è¯¢æ‰§è¡ŒæŸ¥è¯¢æ‰§è¡Œçš„è¿‡ç¨‹ å®¢æˆ·ç«¯å‘é€ä¸€æ¡æŸ»è¯¢ç»™æœåŠ¡å™¨ã€‚ æœåŠ¡å™¨å…ˆæ£€æŸ»æŸ»è¯¢ç¼“å­˜ï¼Œå¦‚æœå‘½ä¸­äº†ç¼“å­˜ï¼Œåˆ™ç«‹åˆ»è¿”å›å­˜å‚¨åœ¨ç¼“å­˜ä¸­çš„ç»“æœã€‚å¦åˆ™è¿›å…¥ä¸‹ä¸€é˜¶æ®µã€‚ æœåŠ¡å™¨ç«¯è¿›è¡ŒSQLè§£æã€é¢„å¤„ç†ï¼Œå†ç”±ä¼˜åŒ–å™¨ç”Ÿæˆå¯¹åº”çš„æ‰§è¡Œè®¡åˆ’ã€‚ MySQLæ ¹æ®ä¼˜åŒ–å™¨ç”Ÿæˆçš„æ‰§è¡Œè®¡åˆ’ï¼Œè°ƒç”¨å­˜å‚¨å¼•æ“çš„APIæ¥æ‰§è¡ŒæŸ»è¯¢ã€‚ å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚ MySQLå®¢æˆ·ç«¯/æœåŠ¡å™¨é€šä¿¡åè®®åŠåŒå·¥ï¼Œä¼˜ç‚¹ç®€å•å¿«é€Ÿï¼Œç¼ºç‚¹æ•°æ®åŒ…è¶Šé•¿æ€§èƒ½è¶Šä½ æŸ¥è¯¢çŠ¶æ€ Sleepçº¿ç¨‹æ­£åœ¨ç­‰å¾…å®¢æˆ·ç«¯å‘é€æ–°çš„è¯·æ±‚ã€‚Queryçº¿ç¨‹æ­£åœ¨æ‰§è¡ŒæŸ¥è¯¢æˆ–è€…æ­£åœ¨å°†ç»“æœå‘é€ç»™å®¢æˆ·ç«¯ã€‚Lockedåœ¨MySQLæœåŠ¡å™¨å±‚ï¼Œè¯¥çº¿ç¨‹æ­£åœ¨ç­‰å¾…è¡¨é”ã€‚åœ¨å­˜å‚¨å¼•æ“çº§åˆ«å®ç°çš„é”ï¼Œä¾‹å¦‚InnoDBçš„è¡Œé”ï¼Œå¹¶ä¸ä¼šä½“ç°åœ¨çº¿ç¨‹çŠ¶æ€ä¸­ã€‚å¯¹äºMylSAMæ¥è¯´è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå…¸å‹çš„çŠ¶æ€ï¼Œä½†åœ¨å…¶ä»–æ²¡æœ‰è¡Œé”çš„å¼•æ“ä¸­ä¹Ÿç»å¸¸ä¼šå‡ºç°ã€‚Analyzing and statisticsçº¿ç¨‹æ­£åœ¨æ”¶é›†å­˜å‚¨å¼•æ“çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œå¹¶ç”ŸæˆæŸ»è¯¢çš„æ‰§è¡Œè®¡åˆ’ã€‚Copying to tmp table [on disk]çº¿ç¨‹æ­£åœ¨æ‰§è¡ŒæŸ»è¯¢ï¼Œå¹¶ä¸”å°†å…¶ç»“æœé›†éƒ½å¤åˆ¶åˆ°ä¸€ä¸ªä¸´æ—¶è¡¨ä¸­ï¼Œè¿™ç§çŠ¶æ€ä¸€èˆ¬è¦ä¹ˆæ˜¯åœ¨åšGROUP BYæ“ä½œï¼Œè¦ä¹ˆæ˜¯æ–‡ä»¶æ’åºæ“ä½œï¼Œæˆ–è€…æ˜¯UNIONæ“ä½œã€‚å¦‚æœè¿™ä¸ªçŠ¶æ€åé¢è¿˜æœ‰ â€œon diskâ€æ ‡è®°ï¼Œé‚£è¡¨ç¤ºMySQLæ­£åœ¨å°†ä¸€ä¸ªå†…å­˜ä¸´æ—¶è¡¨æ”¾åˆ°ç£ç›˜ä¸Šã€‚Sorting resultçº¿ç¨‹æ­£åœ¨å¯¹ç»“æœé›†è¿›è¡Œæ’åºã€‚ Sending dataè¿™è¡¨ç¤ºå¤šç§æƒ…å†µï¼šçº¿ç¨‹å¯èƒ½åœ¨å¤šä¸ªçŠ¶æ€ä¹‹é—´ä¼ é€æ•°æ®ï¼Œæˆ–è€…åœ¨ç”Ÿæˆç»“æœé›†ï¼Œæˆ–è€…åœ¨å‘å®¢æˆ·ç«¯è¿”å›æ•°æ®ã€‚ æŸ¥è¯¢ä¼˜åŒ–å¤„ç†è§£æSQLã€é¢„å¤„ç†ã€ä¼˜åŒ–SQLæ‰§è¡Œè®¡åˆ’ è¯­æ³•è§£æå™¨å’Œé¢„å¤„ç† é€šè¿‡å…³é”®å­—è§£æSQLç”Ÿæˆä¸€æ£µè§£ææ ‘ï¼Œä½¿ç”¨mysqlçš„è¯­æ³•è§„åˆ™éªŒè¯å’Œè§£ææŸ¥è¯¢ é¢„å¤„ç†å™¨æ ¹æ®MySQLè§„åˆ™è¿›ä¸€æ­¥æ£€æŸ¥è§£ææ ‘æ˜¯å¦åˆæ³•ï¼Œä¸‹ä¸€æ­¥è¿˜ä¼šéªŒè¯æƒé™ æŸ¥è¯¢ä¼˜åŒ–å™¨ ä¼˜åŒ–å™¨å°†è¯­æ³•æ ‘è½¬åŒ–æˆæ‰§è¡Œè®¡åˆ’ï¼Œå…¶ä½œç”¨å°±æ˜¯æ‰¾åˆ°æœ€åˆé€‚çš„æ‰§è¡Œè®¡åˆ’ MySQLä½¿ç”¨åŸºäºæˆæœ¬çš„ä¼˜åŒ–ï¼Œä½¿ç”¨äº†å¤æ‚çš„ä¼˜åŒ–ç­–ç•¥ ä¼˜åŒ–ç­–ç•¥ é™æ€ä¼˜åŒ–ï¼šç›´æ¥å¯¹è§£ææ ‘åˆ†æï¼Œå®Œæˆä¼˜åŒ– åŠ¨æ€ä¼˜åŒ–ï¼šå°†WHEREè½¬åŒ– ï¼Œè¿è¡Œæ—¶ä¼˜åŒ–ï¼Œå’ŒæŸ¥è¯¢çš„ä¸Šä¸‹æ–‡æœ‰å…³ MySQLå¯¹æŸ¥è¯¢çš„é™æ€ä¼˜åŒ–åªåšä¸€æ¬¡ï¼Œä½†æ˜¯å¯¹åŠ¨æ€ä¼˜åŒ–åˆ™æ¯æ¬¡æ‰§è¡Œæ—¶éƒ½éœ€è¦é‡æ–°è¯„ä¼° èƒ½å¤„ç†çš„ä¼˜åŒ–ç±»å‹ é‡æ–°å®šä¹‰å…³è”è¡¨çš„é¡ºåº å¤–è¿æ¥è½¬åŒ–æˆå†…è¿æ¥ ä½¿ç”¨ç­‰ä»·å˜æ¢åŸåˆ™ ä¼˜åŒ–COUNT()ã€MIN()ã€MAX() é¢„ä¼°å¹¶è½¬åŒ–æˆå¸¸æ•°è¡¨è¾¾å¼ è¦†ç›–ç´¢å¼•æ‰«æ å­æŸ¥è¯¢ä¼˜åŒ– æå‰ç»ˆæ­¢æŸ¥è¯¢ ç­‰å€¼ä¼ æ’­ åˆ—è¡¨IN()çš„æ¯”è¾ƒ â€¦. æ•°æ®å’Œç´¢å¼•çš„ç»Ÿè®¡ä¿¡æ¯ ç»Ÿè®¡ä¿¡æ¯ç”±å­˜å‚¨å¼•æ“å®ç°ï¼ŒMySQLæŸ»è¯¢ä¼˜åŒ–å™¨åœ¨ç”ŸæˆæŸ»è¯¢çš„æ‰§è¡Œè®¡åˆ’æ—¶ï¼Œéœ€è¦å‘å­˜å‚¨å¼•æ“è·å–ç›¸åº”çš„ç»Ÿè®¡ä¿¡æ¯ æ‰§è¡Œè®¡åˆ’ mysqlæ˜¯ä¸€æ£µå·¦ä¾§æ·±åº¦ä¼˜å…ˆçš„æ ‘è€Œä¸æ˜¯å¹³è¡¡æ ‘ å…³è”æŸ¥è¯¢ä¼˜åŒ–å™¨ MySQLä¼šé€‰æ‹©åˆé€‚çš„å…³è”é¡ºåºè®©æŸ¥è¯¢æˆæœ¬äº¬å¯èƒ½é™ä½ ä½†æ˜¯ç­‰å…³è”è¡¨çš„ä¸ªæ•°å¢åŠ çš„æ—¶å€™ï¼Œæ‰§è¡Œè®¡åˆ’çš„æœç´¢ç©ºé—´(éœ€è¦æ£€æŸ¥çš„é˜¶ä¹˜ç§å…³è”é¡ºåº)å¢é•¿è¿…é€Ÿï¼Œæ­¤æ—¶ä¼˜åŒ–å™¨å°±ä¼šä½¿ç”¨è´ªå©ªæ¨¡å¼å¯»æ‰¾æœ€ä¼˜å…³è”é¡ºåº æ’åºä¼˜åŒ– ç´¢å¼•æ’åºä¸èµ·ä½œç”¨çš„æ—¶å€™MySQLéœ€è¦è‡ªå·±è¿›è¡Œæ’åºï¼Œå¦‚æœæ•°æ®é‡å°åˆ™åœ¨å†…å­˜ä¸­è¿›è¡Œï¼Œå¦‚æœæ•°æ®é‡å¤§åˆ™éœ€è¦ä½¿ç”¨ç£ç›˜ï¼Œè¿™ä¸ªè¿‡ç¨‹ç»Ÿä¸€ç§°ä¸ºæ–‡ä»¶æ’åº(filesort) æ’åºç®—æ³• ä¸¤æ¬¡ä¼ è¾“æ’åº è¯»å–è¡ŒæŒ‡é’ˆå’Œéœ€è¦æ’åºçš„å­—æ®µï¼Œå¯¹å…¶è¿›è¡Œæ’åºï¼Œç„¶åå†æ ¹æ®æ’åºç»“æœè¯»å–æ‰€éœ€è¦çš„æ•°æ®è¡Œã€‚ å•æ¬¡ä¼ è¾“æ’åº å…ˆè¯»å–æŸ»è¯¢æ‰€éœ€è¦çš„æ‰€æœ‰åˆ—ï¼Œç„¶åå†æ ¹æ®ç»™å®šåˆ—è¿›è¡Œæ’åºï¼Œæœ€åç›´æ¥è¿”å›æ’åºç»“æœ æŸ¥è¯¢æ‰§è¡Œå¼•æ“æŸ¥è¯¢ä¼˜åŒ–é˜¶æ®µæ¯ä¸€ä¸ªè¡¨åˆ›å»ºäº†ä¸€ä¸ªhandlerå®ä¾‹ï¼Œä¼˜åŒ–å™¨è°ƒç”¨å®ä¾‹æ¥å£ï¼ˆ``handler API`ï¼‰è·å–è¡¨ç›¸å…³ä¿¡æ¯ è¿”å›ç»“æœ å³ä½¿ä¸éœ€è¦è¿”å›ç»“æœé›†ï¼Œmysqlä»»ç„¶ä¼šè¿”æ²ªæŸ¥è¯¢çš„ä¸€äº›ä¿¡æ¯ æŸ¥è¯¢å¦‚æœå¯ä»¥åˆ«ç¼“å­˜ï¼Œmysqlä¹Ÿä¼šåœ¨è¿™ä¸ªé˜¶æ®µå°†ç»“æœå­˜æ”¾åˆ°æŸ¥è¯¢ç¼“å­˜ä¸­ è¿”å›æ˜¯ä¸€ä¸ªå¢é‡ã€é€æ­¥è¿”å›çš„è¿‡ç¨‹ï¼Œå¥½å¤„æ˜¯æœåŠ¡å™¨æ— éœ€å­˜å‚¨å¤§é‡æ´åæœï¼Œä¹Ÿä¸ä¼šå› ä¸ºè¦è¿”å›å¤ªå¤šæ¥è½¨è€Œæ¶ˆè€—å¤§é‡å†…å­˜ï¼›è€Œä¸”ï¼Œå®¢æˆ·ç«¯ä¹Ÿå‘¢ä¸ªç¬¬ä¸€æ—¶é—´è·å¾—è¿”å›çš„ç»“æœ æŸ¥è¯¢ä¼˜åŒ–å™¨çš„å±€é™æ€§å…³è”å­æŸ¥è¯¢ MySQLä¼šå°†ç›¸å…³çš„å¤–å±‚è¡¨å‹åˆ°å­æŸ»è¯¢ä¸­ï¼Œå®ƒè®¤ä¸ºè¿™æ ·å¯ä»¥æ›´é«˜æ•ˆç‡åœ°æŸ¥æ‰¾åˆ°æ•°æ®è¡Œ ä¼˜åŒ– ä½¿ç”¨å‡½æ•°GR0UP_C0NCAT()åœ¨IN()ä¸­æ„é€ ä¸€ä¸ªç”±é€—å·åˆ†éš”çš„åˆ—è¡¨(æ€§èƒ½ä¸ä½³) ç­‰æ•ˆæ”¹å†™ ä¸€èˆ¬ä½¿ç”¨å·¦å¤–è¿æ¥æ¯”å­æŸ¥è¯¢ç¨å¿« å»é‡æ—¶ä¼šäº§ç”Ÿä¸´æ—¶ä¸­é—´è¡¨ï¼Œæ­¤æ—¶å­æŸ¥è¯¢æ¯”å…³è”æ›´å¿« å…·ä½“é—®é¢˜å…·ä½“åˆ†æ UNIONé™åˆ¶æœ‰æ—¶ï¼ŒMySQLæ— æ³•å°†é™åˆ¶æ¡ä»¶ä»å¤–å±‚â€œä¸‹æ¨â€åˆ°å†…å±‚ï¼Œè¿™ä½¿å¾—åŸæœ¬èƒ½å¤Ÿé™åˆ¶éƒ¨åˆ†è¿”å›ç»“æœçš„æ¡ä»¶æ— æ³•åº”ç”¨åˆ°å†…å±‚æŸ»è¯¢çš„ä¼˜åŒ–ä¸Šã€‚ ç´¢å¼•åˆå¹¶ä¼˜åŒ–å½“WHEREå­å¥ä¸­åŒ…å«å¤šä¸ªå¤æ‚æ¡ä»¶çš„ æ—¶å€™ï¼ŒMySQLèƒ½å¤Ÿè®¿é—®å•ä¸ªè¡¨çš„å¤šä¸ªç´¢å¼•ä»¥åˆå¹¶å’Œäº¤å‰è¿‡æ»¤çš„æ–¹å¼æ¥å®šä½éœ€è¦æŸ»æ‰¾çš„è¡Œ ç­‰å€¼ä¼ é€’ä¾‹å¦‚ï¼Œæœ‰ä¸€ä¸ªéå¸¸å¤§çš„IN()åˆ—è¡¨ï¼Œè€ŒMySQLä¼˜åŒ–å™¨å‘ç°å­˜åœ¨WHEREã€ONæˆ–è€…USINGçš„å­å¥ï¼Œå°†è¿™ä¸ªåˆ—è¡¨çš„å€¼å’Œå¦ä¸€ä¸ªè¡¨çš„æŸä¸ªåˆ—ç›¸å…³è”ã€‚é‚£ä¹ˆä¼˜åŒ–å™¨ä¼šå°†IN()åˆ—è¡¨éƒ½å¤åˆ¶åº”ç”¨åˆ°å…³è”çš„å„ä¸ªè¡¨ä¸­ã€‚ å¹¶è¡Œæ‰§è¡ŒMySQLæ— æ³•å¹¶è¡Œæ‰§è¡ŒæŸ¥è¯¢ å“ˆå¸Œå…³è”mysqlä¸æ”¯æŒå“ˆå¸Œå…³è”ï¼Œæ‰€æœ‰å…³è”éƒ½æ˜¯åµŒå¥—å¾ªç¯å…³è” æ¾æ•£ç´¢å¼•æ‰«æMySQLä¸æ”¯æŒæ¾æ•£ç´¢å¼•æ‰«æï¼Œæ— æ³•æŒ‰ç…§ä¸è¿ç»­çš„æ–¹å¼æ‰«æä¸€ä¸ªç´¢å¼• æœ€å¤§å€¼å’Œæœ€å°å€¼ä¼˜åŒ–ä½¿ç”¨LIMITé‡å†™æŸ¥è¯¢ï¼Œä»è€Œä½¿å¾—æ‰«æè®°å½•æ•°å°½å¯èƒ½å°‘ åœ¨åŒä¸€å¼ è¡¨ä¸ŠæŸ¥è¯¢æ›´æ–°ä¸€èˆ¬iæƒ…å†µMySQLä¸å…è®¸å¯¹å“¦åŒä¸€å¼ è¡¨åŒæ—¶è¿›è¡ŒæŸ¥è¯¢å’Œæ›´æ–°ã€‚ ä½†æ˜¯å¯ä»¥é€šè¿‡ç”Ÿæˆè¡¨çš„å½¢å¼ç»•è¿‡é™åˆ¶ æŸ¥è¯¢ä¼˜åŒ–å™¨çš„æç¤ºç•¥ ä¼˜åŒ–ç‰¹å®šç±»å‹çš„æŸ¥è¯¢ä¼˜åŒ–COUNT()æŸ¥è¯¢COUNT()ï¼š å®ƒå¯ä»¥ç»Ÿè®¡æŸä¸ªåˆ—å€¼çš„æ•°é‡ï¼Œä¹Ÿå¯ä»¥ç»Ÿè®¡è¡Œæ•°ã€‚åœ¨ç»Ÿè®¡åˆ—å€¼æ—¶è¦æ±‚åˆ—å€¼æ˜¯éç©ºçš„ï¼ˆä¸ç»Ÿè®¡NULL)ã€‚å¦‚æœåœ¨C0UNT()çš„æ‹¬å·ä¸­æŒ‡å®šäº†åˆ—æˆ–è€…åˆ—çš„è¡¨è¾¾å¼ï¼Œåˆ™ç»Ÿè®¡çš„å°±æ˜¯è¿™ä¸ªè¡¨è¾¾å¼æœ‰å€¼çš„ç»“æœæ•° å¦ä¸€ä¸ªä½œç”¨æ˜¯ç»Ÿè®¡ç»“æœé›†çš„è¡Œæ•°ã€‚å½“MySQLç¡®è®¤æ‹¬å·å†…çš„è¡¨è¾¾å¼å€¼ä¸å¯èƒ½ä¸ºç©ºæ—¶ï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨ç»Ÿè®¡è¡Œæ•° MylSAMçš„C0UNTOå‡½æ•°æ€»æ˜¯éå¸¸å¿«ï¼Œä¸è¿‡è¿™æ˜¯æœ‰å‰ææ¡ä»¶çš„ï¼Œå³åªæœ‰æ²¡æœ‰ä»»ä½•WHEREæ¡ä»¶çš„COUNT(*)æ‰éå¸¸å¿« ä¼˜åŒ–ç­–ç•¥ ä½¿ç”¨è¿‘ä¼¼å€¼ ç´¢å¼•è¦†ç›–æ‰«æ ä¼˜åŒ–å…³è”æŸ¥è¯¢ ç¡®ä¿ONæˆ–è€…USINGå­å¥ä¸­çš„åˆ—ä¸Šæœ‰ç´¢å¼• ç¡®ä¿ä»»ä½•çš„GROUP BYå’ŒORDER BYä¸­çš„è¡¨è¾¾å¼åªæ¶‰åŠåˆ°ä¸€ä¸ªè¡¨ä¸­çš„åˆ—ï¼Œè¿™æ ·MySQLæ‰æœ‰å¯èƒ½ä½¿ç”¨ç´¢å¼•æ¥ä¼˜åŒ–è¿™ä¸ªè¿‡ç¨‹ã€‚ ä¼˜åŒ–GROUP BYå’ŒDISTINCTæ— æ³•ä½¿ç”¨ç´¢å¼•çš„æ—¶å€™ï¼ŒGroup BYä½¿ç”¨ä¸¤ç§ç­–ç•¥å®Œæˆ ä½¿ç”¨ä¸´æ—¶è¡¨ ä½¿ç”¨æ–‡ä»¶æ’åºè¿›è¡Œåˆ†ç»„ åœ¨åˆ†ç»„æŸ»è¯¢çš„SELECTä¸­ç›´æ¥ä½¿ç”¨éåˆ†ç»„åˆ—é€šå¸¸å¯¼è‡´ç»“æœæ˜¯ä¸å®šçš„ï¼Œå½“ç´¢å¼•æ”¹å˜ï¼Œæˆ–è€…ä¼˜åŒ–å™¨é€‰æ‹©ä¸åŒçš„ä¼˜åŒ–ç­–ç•¥æ—¶éƒ½å¯èƒ½å¯¼è‡´ç»“æœä¸ä¸€æ · å¦‚æœæ²¡æœ‰é€šè¿‡ORDER BYå­å¥æ˜¾å¼åœ°æŒ‡å®šæ’åºåˆ—ï¼Œå½“æŸ»è¯¢ä½¿ç”¨GROUP BYå­å¥çš„æ—¶å€™ï¼Œç»“æœé›†ä¼šè‡ªåŠ¨æŒ‰ç…§åˆ†ç»„çš„å­—æ®µè¿›è¡Œæ’åºã€‚å¦‚æœä¸å…³å¿ƒç»“æœé›†çš„é¡ºåºï¼Œè€Œè¿™ç§é»˜è®¤æ’åºåˆå¯¼è‡´äº†éœ€è¦æ–‡ä»¶æ’åºï¼Œåˆ™å¯ä»¥ä½¿ç”¨ORDER BY NULL,è®©MySQLä¸å†è¿›è¡Œæ–‡ä»¶æ’åºã€‚ä¹Ÿå¯ä»¥åœ¨GROUP BYå­å¥ä¸­ç›´æ¥ä½¿ç”¨DESCæˆ–è€…ASCå…³é”®å­—ï¼Œä½¿åˆ†ç»„çš„ç»“æœé›†æŒ‰éœ€è¦çš„æ–¹å‘æ’åº ä¼˜åŒ–GROUP BY WITH ROLLUPå°½å¯èƒ½å°†è¯¥åŠŸèƒ½è½¬ç§»åˆ°åº”ç”¨ç¨‹åºä¸­ ä¼˜åŒ–LIMITåˆ†é¡µ å°½å¯èƒ½åœ°ä½¿ç”¨ç´¢å¼•è¦†ç›–æ‰«æ åšä¸€æ¬¡å…³è”æ“ä½œå†è¿”å›æ‰€éœ€çš„åˆ—ï¼ˆå…³è”å»¶è¿Ÿï¼‰ åˆ©ç”¨offsetè®°å½•ä¸Šæ¬¡æŸ¥è¯¢ç‚¹ç›´æ¥å‘ä¸‹æŸ¥è¯¢ ä¼˜åŒ– SQL_CALC_FOUND_ROWSåˆ†é¡µçš„æ—¶å€™ï¼Œå¦ä¸€ä¸ªå¸¸ç”¨çš„æŠ€å·§æ˜¯åœ¨LIMFTè¯­å¥ä¸­åŠ ä¸Š``SQL_CALC_FOUND_ROWS`æç¤º(hint)ï¼Œè¿™æ ·å°±å¯ä»¥è·å¾—å»æ‰LIMITä»¥åæ»¡è¶³æ¡ä»¶çš„è¡Œæ•°ï¼Œå› æ­¤å¯ä»¥ä½œä¸ºåˆ†é¡µçš„æ€»æ•° å¦ä¸€ç§åšæ³•æ˜¯å…ˆè·å–å¹¶ç¼“å­˜è¾ƒå¤šçš„æ•°æ®ï¼Œç„¶åæ¯æ¬¡åˆ†é¡µä»ç¼“å­˜ä¸­è·å– ä¼˜åŒ–UNIONæŸ¥è¯¢å¦åˆ™å°±ä¸€å®šè¦ä½¿ç”¨UNION ALL,è¿™ä¸€ç‚¹å¾ˆé‡è¦ã€‚å¦‚æœæ²¡æœ‰ALLå…³é”®å­—ï¼ŒMySQLä¼šç»™ä¸´æ—¶è¡¨åŠ ä¸ŠDISTINCTé€‰é¡¹ï¼Œè¿™ä¼šå¯¼è‡´å¯¹æ•´ä¸ªä¸´æ—¶è¡¨çš„æ•°æ®åšå”¯ä¸€æ€§æ£€æŸ»ã€‚è¿™æ ·åšçš„ä»£ä»·éå¸¸é«˜ã€‚ é™æ€æŸ¥è¯¢åˆ†æä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰å˜é‡ä¸èƒ½ä½¿ç”¨çš„æƒ…å†µ ä½¿ç”¨è‡ªå®šä¹‰å˜é‡çš„æŸ»è¯¢ï¼Œæ— æ³•ä½¿ç”¨æŸ»è¯¢ç¼“å­˜ã€‚ ä¸èƒ½åœ¨ä½¿ç”¨å¸¸é‡æˆ–è€…æ ‡è¯†ç¬¦çš„åœ°æ–¹ä½¿ç”¨è‡ªå®šä¹‰å˜é‡,ä¾‹å¦‚è¡¨åã€åˆ—åå’ŒLIMITå­å¥ä¸­ã€‚ ç”¨æˆ·è‡ªå®šä¹‰å˜é‡çš„ç”Ÿå‘½å‘¨æœŸæ˜¯åœ¨ä¸€ä¸ªè¿æ¥ä¸­æœ‰æ•ˆï¼Œæ‰€ä»¥ä¸èƒ½ç”¨å®ƒä»¬æ¥åšè¿æ¥é—´çš„é€šä¿¡ã€‚ å¦‚æœä½¿ç”¨è¿æ¥æ± æˆ–è€…æŒä¹…åŒ–è¿æ¥ï¼Œè‡ªå®šä¹‰å˜é‡å¯èƒ½è®©çœ‹èµ·æ¥æ¯«æ— å…³ç³»çš„ä»£ç å‘ç”Ÿäº¤äº’ï¼ˆå¦‚æœæ˜¯è¿™æ ·ï¼Œé€šå¸¸æ˜¯ä»£ç bugæˆ–è€…è¿æ¥æ± bug,è¿™ç±»æƒ…å†µç¡®å®å¯èƒ½å‘ç”Ÿï¼‰ã€‚ åœ¨5.0ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œæ˜¯å¤§å°å†™æ•æ„Ÿçš„ï¼Œæ‰€ä»¥è¦æ³¨æ„ä»£ç åœ¨ä¸åŒMySQLç‰ˆæœ¬é—´çš„å…¼å®¹æ€§é—®é¢˜ã€‚ ä¸èƒ½æ˜¾å¼åœ°å£°æ˜è‡ªå®šä¹‰å˜é‡çš„ç±»å‹ã€‚ç¡®å®šæœªå®šä¹‰å˜é‡çš„å…·ä½“ç±»å‹çš„æ—¶æœºåœ¨ä¸åŒ MySQLç‰ˆæœ¬ä¸­ä¹Ÿå¯èƒ½ä¸ä¸€æ ·ã€‚å¦‚æœä½ å¸Œæœ›å˜é‡æ˜¯æ•´æ•°ç±»å‹ï¼Œé‚£ä¹ˆæœ€å¥½åœ¨åˆå§‹åŒ–çš„æ—¶å€™å°±èµ‹å€¼ä¸º0,å¦‚æœå¸Œæœ›æ˜¯æµ®ç‚¹å‹åˆ™èµ‹å€¼ä¸º0.0,å¦‚æœå¸Œæœ›æ˜¯å­—ç¬¦ä¸²åˆ™èµ‹å€¼ä¸ºâ€ï¼Œç”¨&lt;Mæˆ·è‡ªå®šä¹‰å˜é‡çš„ç±»å‹åœ¨èµ‹å€¼çš„æ—¶å€™ä¼šæ”¹å˜ã€‚MySQLçš„ç”¨æˆ·è‡ªå®šä¹‰å˜é‡æ˜¯ä¸€ä¸ªåŠ¨æ€ç±»å‹ã€‚ MySQLä¼˜åŒ–å™¨åœ¨æŸäº›åœºæ™¯ä¸‹å¯èƒ½ä¼šå°†è¿™äº›å˜é‡ä¼˜åŒ–æ‰ï¼Œè¿™å¯èƒ½å¯¼è‡´ä»£ç ä¸æŒ‰é¢„æƒ³çš„æ–¹å¼è¿è¡Œã€‚ èµ‹å€¼çš„é¡ºåºå’Œèµ‹å€¼çš„æ—¶é—´ç‚¹å¹¶ä¸æ€»æ˜¯å›ºå®šçš„ï¼Œè¿™ä¾èµ–äºä¼˜åŒ–å™¨çš„å†³å®šã€‚å®é™…æƒ…å†µå¯èƒ½å¾ˆè®©äººå›°æƒ‘ï¼Œåé¢æˆ‘ä»¬å°†çœ‹åˆ°è¿™ä¸€ç‚¹ã€‚ èµ‹å€¼ç¬¦å·ï¼š=çš„ä¼˜å…ˆçº§éå¸¸ä½ï¼Œæ‰€ä»¥éœ€è¦æ³¨æ„ï¼Œèµ‹å€¼è¡¨è¾¾å¼åº”è¯¥ä½¿ç”¨æ˜ç¡®çš„æ‹¬å·ã€‚ ä½¿ç”¨æœªå®šä¹‰å˜é‡ä¸ä¼šäº§ç”Ÿä»»ä½•è¯­æ³•é”™è¯¯ï¼Œå¦‚æœæ²¡æœ‰æ„è¯†åˆ°è¿™ä¸€ç‚¹ï¼Œéå¸¸å®¹æ˜“çŠ¯é”™ã€‚ æ¡ˆä¾‹é˜Ÿåˆ—è¡¨è®¡ç®—ä¸¤ç‚¹ä¹‹é—´è·ç¦»ä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰çš„å‡½æ•°æ€»ç»“]]></content>
      <categories>
        <category>å­¦ä¹ ç¬”è®°</category>
      </categories>
      <tags>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Listç±»çŸ¥è¯†ç‚¹æ€»ç»“]]></title>
    <url>%2F2019%2F09%2F10%2Fcollection2%2F</url>
    <content type="text"><![CDATA[Listç±»çŸ¥è¯†ç‚¹æ€»ç»“ LinkedListé“¾è¡¨é›†åˆï¼Œç»§æ‰¿AbstractSequentialListï¼Œå®ç°Dequeã€Cloneableã€Serializableã€‚ å®ç°Dequeï¼Œå¯ä»¥å½“ä½œåŒç«¯åºåˆ—ä½¿ç”¨ Cloneableï¼šå¯è¢«å…‹éš† Serializableï¼šå¯è¢«åºåˆ—åŒ– å±æ€§12345678transient int size = 0; // é•¿åº¦transient Node&lt;E&gt; first; // å¤´èŠ‚ç‚¹transient Node&lt;E&gt; last; // å°¾èŠ‚ç‚¹private static class Node&lt;E&gt; &#123; E item; // å…ƒç´  Node&lt;E&gt; next; // ä¸‹ä¸€èŠ‚ç‚¹ Node&lt;E&gt; prev; // ä¸Šä¸€èŠ‚ç‚¹&#125; å¯è§LinkedListå®ç°çš„æ˜¯åŒå‘é“¾è¡¨ æ„é€ 123456public LinkedList() &#123;&#125;public LinkedList(Collection&lt;? extends E&gt; c) &#123; this(); addAll(c);&#125; æ–¹æ³•æ–¹æ³•å¤§å…¨ 123456789101112131415161718192021222324252627282930313233343536373839404142434445// Queueæ¥å£çš„æ–¹æ³•boolean add(E e) // å°¾éƒ¨æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹E element() // è·å–å¤´èŠ‚ç‚¹å…ƒç´ boolean offer(E e) // å°¾éƒ¨æ·»åŠ å…ƒç´ E peek() // è·å–å¤´èŠ‚ç‚¹å…ƒç´ E poll() // è·å–å¤´èŠ‚ç‚¹å…ƒç´ å¹¶ç§»é™¤E remove() // è·å–å¤´èŠ‚ç‚¹å…ƒç´ å¹¶ç§»é™¤// Dequeæ¥å£çš„æ–¹æ³•void addFirst(E e) // æ·»åŠ å…ƒç´ è‡³å¤´èŠ‚ç‚¹void addLast(E e) // æ·»åŠ å…ƒç´ è‡³å°¾èŠ‚ç‚¹ListIterator&lt;E&gt; listIterator(int index) // è¿­ä»£å™¨Iterator&lt;E&gt; descendingIterator() // é€†åºè¿­ä»£å™¨E getFirst() // è·å–å¤´èŠ‚ç‚¹å…ƒç´ E getLast() // è·å–å°¾èŠ‚ç‚¹å…ƒç´ boolean offerFirst(E e) // å¤´éƒ¨æ·»åŠ å…ƒç´ boolean offerLast(E e) // å°¾éƒ¨æ·»åŠ å…ƒç´ E peekFirst() // è·å–å¤´èŠ‚ç‚¹å…ƒç´ ï¼Œç©ºé›†åˆè¿”å›nullE peekLast() // è·å–å°¾èŠ‚ç‚¹å…ƒç´ ï¼Œç©ºé›†åˆè¿”å›nullE pollFirst() // è·å–å¤´èŠ‚ç‚¹å…ƒç´ å¹¶ç§»é™¤ï¼Œç©ºé›†åˆè¿”å›nullE pollLast() // è·å–å°¾èŠ‚ç‚¹å…ƒç´ å¹¶ç§»é™¤ï¼Œç©ºé›†åˆè¿”å›nullE pop() // å‡ºæ ˆï¼Œå¼¹å‡ºé“¾è¡¨å¤´èŠ‚ç‚¹void push(E e) // å‹æ ˆï¼Œæ·»åŠ åœ¨é“¾è¡¨å¤´éƒ¨ï¼ˆä¸add()ç›¸åï¼‰boolean remove(Object o) // ç§»é™¤æŒ‡å®šèŠ‚ç‚¹å…ƒç´ E removeFirst() // è·å–å¤´èŠ‚ç‚¹å…ƒç´ å¹¶ç§»é™¤E removeLast() // è·å–å°¾èŠ‚ç‚¹å…ƒç´ å¹¶ç§»é™¤boolean removeFirstOccurrence(Object o) // ç§»é™¤æŒ‡å®šå…ƒç´ ï¼ˆå‡ºç°çš„ç¬¬ä¸€ä¸ªï¼‰boolean removeLastOccurrence(Object o) // ç§»é™¤æŒ‡å®šå…ƒç´ ï¼ˆå‡ºç°çš„æœ€åä¸€ä¸ªï¼‰// å…¶å®ƒvoid add(int index, E element) // æŒ‡å®šä½ç½®æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹boolean addAll(Collection&lt;? extends E&gt; c) // å°¾éƒ¨æ·»åŠ æŒ‡å®šé›†åˆä¸­æ‰€æœ‰å…ƒç´ boolean addAll(int index, Collection&lt;? extends E&gt; c) // æŒ‡å®šä½ç½®æ·»åŠ æŒ‡å®šé›†åˆä¸­æ‰€æœ‰å…ƒç´ E get(int index) // è·å–æŒ‡å®šä½ç½®èŠ‚ç‚¹å…ƒç´ E set(int index, E element) // æ›¿æ¢æŒ‡å®šä½ç½®å…ƒç´ E remove(int index) // è·å–æŒ‡å®šä½ç½®èŠ‚ç‚¹å…ƒç´ å¹¶ç§»é™¤int indexOf(Object o) // è·å–å…ƒç´ é¦–æ¬¡å‡ºç°çš„ä½ç½®int lastIndexOf(Object o) // é€†åºè·å–å…ƒç´ é¦–æ¬¡å‡ºç°çš„ä½ç½®void clear() // æ¸…é™¤æ‰€æœ‰å…ƒç´ boolean contains(Object o) // æ˜¯å¦åŒ…å«æŸå…ƒç´ int size() // å¤§å°Spliterator&lt;E&gt; spliterator() // spliteratorObject[] toArray() // å°†é›†åˆä»¥æ•°ç»„å½¢å¼è¿”å›&lt;T&gt; T[] toArray(T[] a) // å°†é›†åˆä»¥æ•°ç»„å½¢å¼è¿”å›ï¼Œç±»å‹ã€å¤§å°ç”±å‚æ•°å†³å®šï¼Œä¸è¶³è¿”å›nullObject clone() // æµ…å¤åˆ¶é›†åˆ add123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869public boolean add(E e) &#123; linkLast(e); return true;&#125;void linkLast(E e) &#123; final Node&lt;E&gt; l = last; // ä¿å­˜last final Node&lt;E&gt; newNode = new Node&lt;&gt;(l, e, null); // Node(pre, element, next)ï¼Œåˆ›å»ºæ–°èŠ‚ç‚¹ï¼Œnextä¸ºnull last = newNode; // lastä¸ºæ–°èŠ‚ç‚¹ if (l == null) first = newNode; // é“¾è¡¨ä¸ºç©ºæ—¶ï¼Œåˆå§‹åŒ–first else l.next = newNode; // é“¾è¡¨ä¸ä¸ºç©ºæ—¶ï¼Œä¸Šä¸€èŠ‚ç‚¹çš„nextæŒ‡å‘newNode size++; modCount++;&#125;public void add(int index, E element) &#123; checkPositionIndex(index); // æ£€æŸ¥index &gt;= 0 &amp;&amp; index &lt;= size if (index == size) // å°¾éƒ¨æ·»åŠ èŠ‚ç‚¹ linkLast(element); else linkBefore(element, node(index));&#125;void linkBefore(E e, Node&lt;E&gt; succ) &#123; final Node&lt;E&gt; pred = succ.prev; // ä¿å­˜åŸä½ç½®èŠ‚ç‚¹å‰ä¸€ä¸ªèŠ‚ç‚¹ final Node&lt;E&gt; newNode = new Node&lt;&gt;(pred, e, succ); // åˆ›å»ºæ–°èŠ‚ç‚¹ï¼Œè®¾ç½®preï¼Œnext succ.prev = newNode; // è®¾ç½®åŸä½ç½®èŠ‚ç‚¹çš„preä¸ºæ–°èŠ‚ç‚¹ if (pred == null) first = newNode; // åŸä½ç½®èŠ‚ç‚¹å‰ä¸€ä¸ªèŠ‚ç‚¹ä¸ºnullï¼Œè®¾ç½®æ–°èŠ‚ç‚¹ä¸ºå¤´èŠ‚ç‚¹ else pred.next = newNode; // åŸä½ç½®èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹çš„nextä¸ºæ–°èŠ‚ç‚¹ size++; modCount++;&#125;public boolean addAll(Collection&lt;? extends E&gt; c) &#123; return addAll(size, c); // è½¬ä¸ºaddAll(index, c)&#125;public boolean addAll(int index, Collection&lt;? extends E&gt; c) &#123; checkPositionIndex(index); // æ£€æŸ¥index &gt;= 0 &amp;&amp; index &lt;= size Object[] a = c.toArray(); // è½¬ä¸ºæ•°ç»„ int numNew = a.length; if (numNew == 0) return false; Node&lt;E&gt; pred, succ; if (index == size) &#123; succ = null; // æ’å…¥åˆ°å°¾éƒ¨ pred = last; &#125; else &#123; succ = node(index); // æ’å…¥åˆ°ä½ç½®iï¼ˆ0&lt;=i&lt;sizeï¼‰ pred = succ.prev; &#125; for (Object o : a) &#123; // éå†èŠ‚ç‚¹ï¼Œè¿›è¡Œæ’å…¥æ“ä½œ @SuppressWarnings("unchecked") E e = (E) o; Node&lt;E&gt; newNode = new Node&lt;&gt;(pred, e, null); // è®¾ç½®preï¼Œnext if (pred == null) first = newNode; // predä¸ºnullï¼Œé‡ç½®first else pred.next = newNode; // è®¾ç½®å‰ä¸€ä¸ªèŠ‚ç‚¹çš„next pred = newNode; // é‡ç½®pred &#125; if (succ == null) &#123; last = pred; // æ’å…¥åˆ°å°¾éƒ¨ï¼Œé‡ç½®last &#125; else &#123; pred.next = succ; // è®¾ç½®æ’å…¥çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„next succ.prev = pred; // è®¾ç½®åŸä½ç½®èŠ‚ç‚¹çš„prev &#125; size += numNew; modCount++; return true;&#125; è¿­ä»£æ–¹å¼ éšæœºè®¿é—®ï¼šlist.get(i)ï¼Œæ•ˆç‡è¶…çº§ä½ è¿­ä»£å™¨ï¼šlist.iterator()ï¼Œæ•ˆç‡æœ€é«˜ foreachï¼šfor(Object i: list)ï¼Œæ•ˆç‡å…¶æ¬¡ ArrayList åŠ¨æ€æ•°ç»„ï¼Œç»§æ‰¿AbstractListï¼Œå®ç°Listã€RandomAccessã€Cloneableã€Serializableã€‚ Qï¼šArrayListç»§æ‰¿äº†AbstractListï¼Œä¸ºä»€ä¹ˆè¿˜è¦å®ç°Listï¼Ÿ Aï¼šæ˜¾å¼è¡¨æ˜ArrayListå®ç°äº†Listï¼ŒAbstractListåªæ˜¯ä¸ºäº†æå‡Listå®ç°çš„ä»£ç é‡ç”¨ã€‚ RandomAccessï¼šæ ‡è®°æ¥å£ï¼Œè¡¨æ˜Listçš„æŸä¸ªå®ç°æ”¯æŒéšæœºè®¿é—®ã€‚ Cloneableï¼šå¯è¢«å…‹éš†`` Serializableï¼šå¯è¢«åºåˆ—åŒ– ä¸æ˜¯çº¿ç¨‹å®‰å…¨ï¼Œå¤šçº¿ç¨‹å¯ä»¥é€‰æ‹©Vectoræˆ–CopyOnWriteArrayListã€‚ å±æ€§1234// ä¿å­˜æ•°æ®çš„æ•°ç»„transient Object[] elementData;// ArrayListä¸­å®é™…æ•°æ®çš„æ•°é‡private int size; Qï¼šelementDataéœ€è¦åºåˆ—åŒ–ï¼Œä¸ºä»€ä¹ˆè¿˜è¦è¢«transientä¿®é¥°ï¼Œè¢«transientä¿®é¥°äº†ï¼Œä¸ºä»€ä¹ˆè¿˜èƒ½è¢«åºåˆ—åŒ–ï¼Ÿ Aï¼šelementDataæ˜¯ä¸€ä¸ªç¼“å­˜æ•°ç»„ï¼Œé€šå¸¸ä¼šé¢„ç•™å®¹é‡ï¼Œæ‰€ä»¥elementDataä¸­åªæœ‰å®é™…å­˜æ”¾çš„å…ƒç´ éœ€è¦è¢«åºåˆ—åŒ–ï¼Œæ•…è¢«transientä¿®é¥°é˜²æ­¢æ‰€æœ‰å…ƒç´ è¢«åºåˆ—åŒ–ï¼›ArrayListä¸­å…ƒç´ è¿˜èƒ½è¢«åºåˆ—åŒ–æ˜¯å› ä¸ºå®ƒé‡å†™äº†writeObject()æ–¹æ³•ï¼ˆdebugçœ‹åˆ°è¿™ä¸ªæ–¹æ³•æ˜¯è¢«åå°„è·å–è°ƒç”¨çš„ï¼‰ã€‚ 123456789101112private void writeObject(java.io.ObjectOutputStream s) throws java.io.IOException&#123; int expectedModCount = modCount; s.defaultWriteObject(); s.writeInt(size); for (int i=0; i&lt;size; i++) &#123; s.writeObject(elementData[i]); // åªåºåˆ—åŒ–sizeä¸ªå…ƒç´  &#125; if (modCount != expectedModCount) &#123; throw new ConcurrentModificationException(); &#125;&#125; æ„é€ 123456789101112131415161718192021222324252627282930// ä¸å¯å˜çš„ç©ºæ•°ç»„private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;;public ArrayList() &#123; this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;&#125;// åˆå§‹åŒ–æŒ‡å®šå¤§å°çš„æ•°ç»„public ArrayList(int initialCapacity) &#123; if (initialCapacity &gt; 0) &#123; this.elementData = new Object[initialCapacity]; &#125; else if (initialCapacity == 0) &#123; this.elementData = EMPTY_ELEMENTDATA; &#125; else &#123; throw new IllegalArgumentException("Illegal Capacity: " + initialCapacity); &#125;&#125; /** *æ„é€ åŒ…å«æŒ‡å®šcollectionå…ƒç´ çš„åˆ—è¡¨ï¼Œè¿™äº›å…ƒç´ åˆ©ç”¨è¯¥é›†åˆçš„è¿­ä»£å™¨æŒ‰é¡ºåºè¿”å› *å¦‚æœæŒ‡å®šçš„é›†åˆä¸ºnullï¼Œthrows NullPointerExceptionã€‚ */ public ArrayList(Collection&lt;? extends E&gt; c) &#123; elementData = c.toArray(); if ((size = elementData.length) != 0) &#123; // c.toArray might (incorrectly) not return Object[] (see 6260652) if (elementData.getClass() != Object[].class) elementData = Arrays.copyOf(elementData, size, Object[].class); &#125; else &#123; // replace with empty array. this.elementData = EMPTY_ELEMENTDATA; &#125; &#125; ç¬¬ä¸€ä¸ªæ„é€ å‡½æ•°ä¼šå°†elementDataåˆå§‹åŒ–ä¸ºç©ºæ•°ç»„ ç¬¬äºŒä¸ªæ„é€ å‡½æ•°ä¼šå°†elementDataåˆå§‹åŒ–ä¸ºæŒ‡å®šå¤§å°çš„æ•°ç»„ ç»†å¿ƒçš„åŒå­¦ä¸€å®šä¼šå‘ç° ï¼šä»¥æ— å‚æ•°æ„é€ æ–¹æ³•åˆ›å»º ArrayList æ—¶ï¼Œå®é™…ä¸Šåˆå§‹åŒ–èµ‹å€¼çš„æ˜¯ä¸€ä¸ªç©ºæ•°ç»„ã€‚å½“çœŸæ­£å¯¹æ•°ç»„è¿›è¡Œæ·»åŠ å…ƒç´ æ“ä½œæ—¶ï¼Œæ‰çœŸæ­£åˆ†é…å®¹é‡ã€‚å³å‘æ•°ç»„ä¸­æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œæ•°ç»„å®¹é‡æ‰©ä¸º10ã€‚ æ–¹æ³•æ–¹æ³•å¤§å…¨ 1234567891011121314151617181920212223242526272829303132333435boolean add(E e) // å°¾éƒ¨æ·»åŠ å…ƒç´ void add(int index, E element) // åœ¨æŒ‡å®šä½ç½®æ·»åŠ å…ƒç´ boolean addAll(Collection&lt;? extends E&gt; c) // å°¾éƒ¨æ·»åŠ é›†åˆä¸­æ‰€æœ‰å…ƒç´ boolean addAll(int index, Collection&lt;? extends E&gt; c) // æŒ‡å®šä½ç½®æ·»åŠ é›†åˆä¸­æ‰€æœ‰å…ƒç´ void clear() // æ¸…é™¤æ‰€æœ‰å…ƒç´ Object clone() // æµ…å¤åˆ¶é›†åˆboolean contains(Object o) // æ˜¯å¦åŒ…å«æŸå…ƒç´ void ensureCapacity(int minCapacity) // ç¡®ä¿ArrayListçš„å®¹å™¨èƒ½è£…ä¸‹minCapacityä¸ªå…ƒç´ void forEach(Consumer&lt;? super E&gt; action) // å¯¹æ¯ä¸ªå…ƒç´ æ‰§è¡Œactionæ“ä½œï¼ˆè¿­ä»£å™¨æ¨¡å¼ï¼‰E get(int index) // è·å–æŒ‡å®šä½ç½®å…ƒç´ int indexOf(Object o) // è·å–æŒ‡å®šå…ƒç´ ä½ç½®boolean isEmpty() // æ˜¯å¦ä¸ºç©ºé›†åˆIterator&lt;E&gt; iterator() // è·å–è¿­ä»£å™¨int lastIndexOf(Object o) // è·å–æŒ‡å®šä½ç½®ï¼Œå€’åºæŸ¥æ‰¾ListIterator&lt;E&gt; listIterator() // è¿”å›è¿­ä»£å™¨ListIteratorListIterator&lt;E&gt; listIterator(int index) // åœ¨æŒ‡å®šä½ç½®è¿”å›è¿­ä»£å™¨ListIteratorE remove(int index) // ç§»é™¤å¹¶è·å–æŒ‡å®šä½ç½®å…ƒç´ boolean remove(Object o) // ç§»é™¤å…ƒç´ ï¼Œä»…ç§»é™¤éå†åˆ°çš„ç¬¬ä¸€ä¸ªboolean removeAll(Collection&lt;?&gt; c) // ç§»é™¤æŒ‡å®šé›†åˆä¸­æ‰€æœ‰å…ƒç´ boolean removeIf(Predicate&lt;? super E&gt; filter) // ç§»é™¤æ»¡è¶³æ¡ä»¶çš„å…ƒç´ void replaceAll(UnaryOperator&lt;E&gt; operator) // æŒ‰ç…§operatoræ“ä½œæ›¿æ¢æ‰€æœ‰å…ƒç´ boolean retainAll(Collection&lt;?&gt; c) // åªä¿ç•™åŒ…å«åœ¨æŒ‡å®šé›†åˆä¸­çš„å…ƒç´ E set(int index, E element) // è®¾ç½®æŒ‡å®šä½ç½®çš„å…ƒç´ å€¼int size() // é›†åˆå¤§å°void sort(Comparator&lt;? super E&gt; c) // æ ¹æ®æŒ‡å®šæ¯”è¾ƒæ–¹å¼comparatoræ’åºSpliterator&lt;E&gt; spliterator() // è·å–é›†åˆçš„spliteratorï¼Œä¸ä¼šç”¨List&lt;E&gt; subList(int fromIndex, int toIndex) // è·å–fromIndex-toIndexçš„å­é›†åˆObject[] toArray() // è½¬åŒ–ä¸ºæ•°ç»„&lt;T&gt; T[] toArray(T[] a) // åˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„ä¼ å…¥ï¼Œè¿”å›æ–°æ•°ç»„ç±»å‹å…ƒç´ ï¼Œå…ƒç´ ä¸å¤Ÿç½®nullvoid trimToSize() // ç¼©å‡ArrayListå®¹å™¨çš„å¤§å°è‡³çœŸå®å­˜æ”¾å…ƒç´ çš„æ•°é‡ add/æ‰©å®¹æœºåˆ¶1234567891011121314151617181920212223242526272829303132333435363738public boolean add(E e) &#123; ensureCapacityInternal(size + 1); // ç¡®ä¿å®¹å™¨èƒ½è£…ä¸‹(size+1)ä¸ªå…ƒç´  elementData[size++] = e; return true;&#125;public void add(int index, E element) &#123; rangeCheckForAdd(index); // æ•°ç»„è¶Šç•Œæ£€æŸ¥ ensureCapacityInternal(size + 1); // arraycopy(src, srcPos, dest, destPos, length) å°†src[srcPos, srcPos+length]å¤åˆ¶åˆ°dest[destPos, destPos+length] System.arraycopy(elementData, index, elementData, index + 1, size - index); elementData[index] = element; size++;&#125;public boolean addAll(Collection&lt;? extends E&gt; c) &#123; Object[] a = c.toArray(); int numNew = a.length; ensureCapacityInternal(size + numNew); System.arraycopy(a, 0, elementData, size, numNew); size += numNew; return numNew != 0;&#125;public boolean addAll(int index, Collection&lt;? extends E&gt; c) &#123; rangeCheckForAdd(index); Object[] a = c.toArray(); int numNew = a.length; ensureCapacityInternal(size + numNew); int numMoved = size - index; if (numMoved &gt; 0) System.arraycopy(elementData, index, elementData, index + numNew, numMoved); System.arraycopy(a, 0, elementData, index, numNew); size += numNew; return numNew != 0;&#125;// æ•°ç»„è¶Šç•Œæ£€æŸ¥private void rangeCheckForAdd(int index) &#123; if (index &gt; size || index &lt; 0) throw new IndexOutOfBoundsException(outOfBoundsMsg(index)); // è¶Šç•ŒæŠ›å‡ºå¼‚å¸¸&#125; å½“æ·»åŠ å…ƒç´ æ—¶ï¼Œä¼šè°ƒç”¨å¦‚ä¸‹æ–¹æ³•ï¼Œè‹¥elementDataä¸ºç©ºæ•°ç»„ï¼Œåˆ™å°†å®ƒæ‰©å±•ä¸ºé»˜è®¤é•¿åº¦ï¼ˆ10ï¼‰çš„æ•°ç»„ï¼›è‹¥æ·»åŠ å…ƒç´ åelementDataé•¿åº¦ä¸å¤Ÿï¼Œå°†ä¼šå°†elementDataæ‰©å±•ä¸ºåŸæ¥çš„1.5å€ã€‚ 1234567891011121314151617181920212223242526272829303132333435// é»˜è®¤å®¹å™¨å¤§å°private static final int DEFAULT_CAPACITY = 10;private void ensureCapacityInternal(int minCapacity) &#123; //å½“è¦add è¿›ç¬¬1ä¸ªå…ƒç´ æ—¶ï¼ŒminCapacityä¸º1ï¼Œåœ¨Math.max()æ–¹æ³•æ¯”è¾ƒåï¼ŒminCapacity ä¸º10ã€‚ if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123; minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity); &#125; ensureExplicitCapacity(minCapacity);&#125;// ç¡®ä¿ArrayListèƒ½è£…ä¸‹minCapacityä¸ªå…ƒç´ private void ensureExplicitCapacity(int minCapacity) &#123; modCount++; if (minCapacity - elementData.length &gt; 0) grow(minCapacity);&#125; /** * ArrayListæ‰©å®¹çš„æ ¸å¿ƒæ–¹æ³•ã€‚ */private void grow(int minCapacity) &#123; // oldCapacityä¸ºæ—§å®¹é‡ï¼ŒnewCapacityä¸ºæ–°å®¹é‡ int oldCapacity = elementData.length; //å°†oldCapacity å³ç§»ä¸€ä½ï¼Œå…¶æ•ˆæœç›¸å½“äºoldCapacity /2ï¼Œ //æˆ‘ä»¬çŸ¥é“ä½è¿ç®—çš„é€Ÿåº¦è¿œè¿œå¿«äºæ•´é™¤è¿ç®—ï¼Œæ•´å¥è¿ç®—å¼çš„ç»“æœå°±æ˜¯å°†æ–°å®¹é‡æ›´æ–°ä¸ºæ—§å®¹é‡çš„1.5å€ï¼Œ int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1); //ç„¶åæ£€æŸ¥æ–°å®¹é‡æ˜¯å¦å¤§äºæœ€å°éœ€è¦å®¹é‡ï¼Œè‹¥è¿˜æ˜¯å°äºæœ€å°éœ€è¦å®¹é‡ï¼Œé‚£ä¹ˆå°±æŠŠæœ€å°éœ€è¦å®¹é‡å½“ä½œæ•°ç»„çš„æ–°å®¹é‡ï¼Œ if (newCapacity - minCapacity &lt; 0) newCapacity = minCapacity; // å¦‚æœæ–°å®¹é‡å¤§äº MAX_ARRAY_SIZE,è¿›å…¥(æ‰§è¡Œ) `hugeCapacity()` æ–¹æ³•æ¥æ¯”è¾ƒ minCapacity å’Œ MAX_ARRAY_SIZEï¼Œ //å¦‚æœminCapacityå¤§äºæœ€å¤§å®¹é‡ï¼Œåˆ™æ–°å®¹é‡åˆ™ä¸º`Integer.MAX_VALUE`ï¼Œå¦åˆ™ï¼Œæ–°å®¹é‡å¤§å°åˆ™ä¸º MAX_ARRAY_SIZE å³ä¸º `Integer.MAX_VALUE - 8`ã€‚ if (newCapacity - MAX_ARRAY_SIZE &gt; 0) newCapacity = hugeCapacity(minCapacity); // minCapacity is usually close to size, so this is a win: elementData = Arrays.copyOf(elementData, newCapacity); &#125; å…·ä½“é€»è¾‘ å¦‚æœé€šè¿‡å…ƒç´ å€¼æ·»åŠ ï¼Œç¡®ä¿å®¹å™¨èƒ½è£…ä¸‹ï¼›å¦‚æœé€šè¿‡ç´¢å¼•æ·»åŠ ï¼Œä¹‹å‰è¿˜éœ€è¦æ•°ç»„è¶Šç•Œæ£€æŸ¥ å½“æˆ‘ä»¬è¦ add è¿›ç¬¬1ä¸ªå…ƒç´ åˆ° ArrayList æ—¶ï¼ŒelementData.length ä¸º0 ï¼ˆå› ä¸ºè¿˜æ˜¯ä¸€ä¸ªç©ºçš„ listï¼‰ï¼Œå› ä¸ºæ‰§è¡Œäº† ensureCapacityInternal() æ–¹æ³• ï¼Œæ‰€ä»¥ minCapacity æ­¤æ—¶ä¸º10ã€‚æ­¤æ—¶ï¼ŒminCapacity - elementData.length &gt; 0æˆç«‹ï¼Œæ‰€ä»¥ä¼šè¿›å…¥ grow(minCapacity) æ–¹æ³•ã€‚ å½“addç¬¬2ä¸ªå…ƒç´ æ—¶ï¼ŒminCapacity ä¸º2ï¼Œæ­¤æ—¶e lementData.length(å®¹é‡)åœ¨æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ åæ‰©å®¹æˆ 10 äº†ã€‚æ­¤æ—¶ï¼ŒminCapacity - elementData.length &gt; 0ä¸æˆç«‹ï¼Œæ‰€ä»¥ä¸ä¼šè¿›å…¥ ï¼ˆæ‰§è¡Œï¼‰grow(minCapacity) æ–¹æ³•ã€‚ æ·»åŠ ç¬¬3ã€4Â·Â·Â·åˆ°ç¬¬10ä¸ªå…ƒç´ æ—¶ï¼Œä¾ç„¶ä¸ä¼šæ‰§è¡Œgrowæ–¹æ³•ï¼Œæ•°ç»„å®¹é‡éƒ½ä¸º10ã€‚ ç›´åˆ°æ·»åŠ ç¬¬11ä¸ªå…ƒç´ ï¼ŒminCapacity(ä¸º11)æ¯”elementData.lengthï¼ˆä¸º10ï¼‰è¦å¤§ã€‚è¿›å…¥growæ–¹æ³•è¿›è¡Œæ‰©å®¹ã€‚ åŒæ—¶æ³¨æ„ä¸€ä¸‹å¦‚æœéœ€è¦å®¹é‡å¤§äºMAX_ARRAY_SIZEä¼šè¿›å…¥hugeCapacity()æ–¹æ³•: 1234567891011private static int hugeCapacity(int minCapacity) &#123; if (minCapacity &lt; 0) // overflow throw new OutOfMemoryError(); //å¯¹minCapacityå’ŒMAX_ARRAY_SIZEè¿›è¡Œæ¯”è¾ƒ //è‹¥minCapacityå¤§ï¼Œå°†Integer.MAX_VALUEä½œä¸ºæ–°æ•°ç»„çš„å¤§å° //è‹¥MAX_ARRAY_SIZEå¤§ï¼Œå°†MAX_ARRAY_SIZEä½œä¸ºæ–°æ•°ç»„çš„å¤§å° //MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8; return (minCapacity &gt; MAX_ARRAY_SIZE) ? Integer.MAX_VALUE : MAX_ARRAY_SIZE; &#125; remove123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354public E remove(int index) &#123; rangeCheck(index); // è¶Šç•Œæ£€æŸ¥ modCount++; E oldValue = elementData(index); // å–å‡ºæ—§å€¼ï¼Œå¾…è¿”å› int numMoved = size - index - 1; // å¾…ç§»åŠ¨çš„ä¸ªæ•° if (numMoved &gt; 0) System.arraycopy(elementData, index+1, elementData, index, numMoved); // å‘å‰ç§»åŠ¨ä¸€ä¸ªä½ç½® elementData[--size] = null; // æœ€åä¸€ä¸ªå…ƒç´ ç½®null return oldValue;&#125;public boolean remove(Object o) &#123; if (o == null) &#123; for (int index = 0; index &lt; size; index++) if (elementData[index] == null) &#123; fastRemove(index); // æ‰€æœ‰å…ƒç´ å‘å‰ç§»åŠ¨ä¸€ä¸ªä½ç½® return true; &#125; &#125; else &#123; for (int index = 0; index &lt; size; index++) if (o.equals(elementData[index])) &#123; fastRemove(index); return true; &#125; &#125; return false;&#125;public boolean removeAll(Collection&lt;?&gt; c) &#123; Objects.requireNonNull(c); // éœ€è¦éç©ºå€¼ï¼ŒnullæŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸ return batchRemove(c, false);&#125;// æ‰¹é‡åˆ é™¤private boolean batchRemove(Collection&lt;?&gt; c, boolean complement) &#123; final Object[] elementData = this.elementData; int r = 0, w = 0; boolean modified = false; try &#123; for (; r &lt; size; r++) if (c.contains(elementData[r]) == complement) // complement=false elementData[w++] = elementData[r]; // åªä¿ç•™cä¸­ä¸å­˜åœ¨çš„å…ƒç´  &#125; finally &#123; if (r != size) &#123; // ä¸è§£ï¼Œä¸ºä»€ä¹ˆrå¯èƒ½!=size System.arraycopy(elementData, r, elementData, w, size - r); w += size - r; &#125; if (w != size) &#123; for (int i = w; i &lt; size; i++) // å‰©ä½™å…ƒç´ å…¨ç½®null elementData[i] = null; modCount += size - w; size = w; // é‡ç½®size modified = true; // ä¿®æ”¹flag &#125; &#125; return modified;&#125; set123456public E set(int index, E element) &#123; rangeCheck(index); // è¶Šç•Œæ£€æŸ¥ E oldValue = elementData(index); elementData[index] = element; // è®¾ç½®æ–°å€¼ return oldValue; // è¿”å›æ—§å€¼&#125; get12345678910111213141516171819202122232425262728293031public E get(int index) &#123; rangeCheck(index); return elementData(index); // elementData(int index)æ–¹æ³•ï¼Œç­‰åŒäºelementData[index]&#125;public int indexOf(Object o) &#123; if (o == null) &#123; for (int i = 0; i &lt; size; i++) if (elementData[i]==null) // è¿”å›éå†åˆ°çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä½ç½® return i; &#125; else &#123; for (int i = 0; i &lt; size; i++) if (o.equals(elementData[i])) return i; &#125; return -1; // ä¸å­˜åœ¨è¿”å›-1&#125;public boolean contains(Object o) &#123; return indexOf(o) &gt;= 0; // ä½¿ç”¨indexOf()æ–¹æ³•æ£€æµ‹æ˜¯å¦åŒ…å«&#125;public boolean containsAll(Collection&lt;?&gt; c) &#123; for (Object e : c) if (!contains(e)) // ä¸€æ—¦ä¸åŒ…å«æŸå…ƒç´ ï¼Œè¿”å›false return false; return true;&#125;public int size() &#123; return size;&#125;public boolean isEmpty() &#123; return size == 0;&#125; System.arraycopy()å’ŒArraya.copyOf()è”ç³»ï¼š çœ‹ä¸¤è€…æºä»£ç å¯ä»¥å‘ç° copyOf() å†…éƒ¨å®é™…è°ƒç”¨äº† System.arraycopy() æ–¹æ³• åŒºåˆ«ï¼š arraycopy() éœ€è¦ç›®æ ‡æ•°ç»„ï¼Œå°†åŸæ•°ç»„æ‹·è´åˆ°ä½ è‡ªå·±å®šä¹‰çš„æ•°ç»„é‡Œæˆ–è€…åŸæ•°ç»„ï¼Œè€Œä¸”å¯ä»¥é€‰æ‹©æ‹·è´çš„èµ·ç‚¹å’Œé•¿åº¦ä»¥åŠæ”¾å…¥æ–°æ•°ç»„ä¸­çš„ä½ç½® copyOf() æ˜¯ç³»ç»Ÿè‡ªåŠ¨åœ¨å†…éƒ¨æ–°å»ºä¸€ä¸ªæ•°ç»„ï¼Œå¹¶è¿”å›è¯¥æ•°ç»„ã€‚ ensureCapacity ArrayList æºç ä¸­æœ‰ä¸€ä¸ª ensureCapacity æ–¹æ³•ä¸çŸ¥é“å¤§å®¶æ³¨æ„åˆ°æ²¡æœ‰ï¼Œè¿™ä¸ªæ–¹æ³• ArrayList å†…éƒ¨æ²¡æœ‰è¢«è°ƒç”¨è¿‡ï¼Œæ‰€ä»¥å¾ˆæ˜¾ç„¶æ˜¯æä¾›ç»™ç”¨æˆ·è°ƒç”¨çš„ 1234567891011121314151617/** å¦‚æœ‰å¿…è¦ï¼Œå¢åŠ æ­¤ ArrayList å®ä¾‹çš„å®¹é‡ï¼Œä»¥ç¡®ä¿å®ƒè‡³å°‘å¯ä»¥å®¹çº³ç”±minimum capacityå‚æ•°æŒ‡å®šçš„å…ƒç´ æ•°ã€‚ * * @param minCapacity æ‰€éœ€çš„æœ€å°å®¹é‡ */ public void ensureCapacity(int minCapacity) &#123; int minExpand = (elementData != DEFAULTCAPACITY_EMPTY_ELEMENTDATA) // any size if not default element table ? 0 // larger than default for default empty table. It's already // supposed to be at default size. : DEFAULT_CAPACITY; if (minCapacity &gt; minExpand) &#123; ensureExplicitCapacity(minCapacity); &#125; &#125; æœ€å¥½åœ¨ add å¤§é‡å…ƒç´ ä¹‹å‰ç”¨ ensureCapacity æ–¹æ³•ï¼Œä»¥å‡å°‘å¢é‡é‡æ–°åˆ†é…çš„æ¬¡æ•° è¿­ä»£æ–¹å¼ éšæœºè®¿é—®ï¼šlist.get(i)ï¼Œæ•ˆç‡æœ€é«˜ è¿­ä»£å™¨ï¼šlist.iterator() foreachï¼šfor(Object i: list) Collectionså·¥å…·ç±»Collections å·¥å…·ç±»å¸¸ç”¨æ–¹æ³•: æ’åº æŸ¥æ‰¾,æ›¿æ¢æ“ä½œ åŒæ­¥æ§åˆ¶(ä¸æ¨èï¼Œéœ€è¦çº¿ç¨‹å®‰å…¨çš„é›†åˆç±»å‹æ—¶è¯·è€ƒè™‘ä½¿ç”¨ JUC åŒ…ä¸‹çš„å¹¶å‘é›†åˆ) æ’åºæ“ä½œ123456void reverse(List list)//åè½¬void shuffle(List list)//éšæœºæ’åºvoid sort(List list)//æŒ‰è‡ªç„¶æ’åºçš„å‡åºæ’åºvoid sort(List list, Comparator c)//å®šåˆ¶æ’åºï¼Œç”±Comparatoræ§åˆ¶æ’åºé€»è¾‘void swap(List list, int i , int j)//äº¤æ¢ä¸¤ä¸ªç´¢å¼•ä½ç½®çš„å…ƒç´ void rotate(List list, int distance)//æ—‹è½¬ã€‚å½“distanceä¸ºæ­£æ•°æ—¶ï¼Œå°†listådistanceä¸ªå…ƒç´ æ•´ä½“ç§»åˆ°å‰é¢ã€‚å½“distanceä¸ºè´Ÿæ•°æ—¶ï¼Œå°† listçš„å‰distanceä¸ªå…ƒç´ æ•´ä½“ç§»åˆ°åé¢ã€‚ æŸ¥æ‰¾æ›¿æ¢æ“ä½œ1234567int binarySearch(List list, Object key)//å¯¹Listè¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œè¿”å›ç´¢å¼•ï¼Œæ³¨æ„Listå¿…é¡»æ˜¯æœ‰åºçš„int max(Collection coll)//æ ¹æ®å…ƒç´ çš„è‡ªç„¶é¡ºåºï¼Œè¿”å›æœ€å¤§çš„å…ƒç´ ã€‚ ç±»æ¯”int min(Collection coll)int max(Collection coll, Comparator c)//æ ¹æ®å®šåˆ¶æ’åºï¼Œè¿”å›æœ€å¤§å…ƒç´ ï¼Œæ’åºè§„åˆ™ç”±Comparatatorç±»æ§åˆ¶ã€‚ç±»æ¯”int min(Collection coll, Comparator c)void fill(List list, Object obj)//ç”¨æŒ‡å®šçš„å…ƒç´ ä»£æ›¿æŒ‡å®šlistä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚int frequency(Collection c, Object o)//ç»Ÿè®¡å…ƒç´ å‡ºç°æ¬¡æ•°int indexOfSubList(List list, List target)//ç»Ÿè®¡targetåœ¨listä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ï¼Œæ‰¾ä¸åˆ°åˆ™è¿”å›-1ï¼Œç±»æ¯”int lastIndexOfSubList(List source, list target).boolean replaceAll(List list, Object oldVal, Object newVal), ç”¨æ–°å…ƒç´ æ›¿æ¢æ—§å…ƒç´  åŒæ­¥æ§åˆ¶Collectionsæä¾›äº†å¤šä¸ªsynchronizedXxx()æ–¹æ³•Â·ï¼Œè¯¥æ–¹æ³•å¯ä»¥å°†æŒ‡å®šé›†åˆåŒ…è£…æˆçº¿ç¨‹åŒæ­¥çš„é›†åˆï¼Œä»è€Œè§£å†³å¤šçº¿ç¨‹å¹¶å‘è®¿é—®é›†åˆæ—¶çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ æˆ‘ä»¬çŸ¥é“ HashSetï¼ŒTreeSetï¼ŒArrayList,LinkedList,HashMap,TreeMap éƒ½æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚Collectionsæä¾›äº†å¤šä¸ªé™æ€æ–¹æ³•å¯ä»¥æŠŠä»–ä»¬åŒ…è£…æˆçº¿ç¨‹åŒæ­¥çš„é›†åˆã€‚ Collectionsè¿˜å¯ä»¥è®¾ç½®ä¸å¯å˜é›†åˆï¼Œæä¾›äº†å¦‚ä¸‹ä¸‰ç±»æ–¹æ³•ï¼š 1234emptyXxx(): è¿”å›ä¸€ä¸ªç©ºçš„ã€ä¸å¯å˜çš„é›†åˆå¯¹è±¡ï¼Œæ­¤å¤„çš„é›†åˆæ—¢å¯ä»¥æ˜¯Listï¼Œä¹Ÿå¯ä»¥æ˜¯Setï¼Œè¿˜å¯ä»¥æ˜¯Mapã€‚singletonXxx(): è¿”å›ä¸€ä¸ªåªåŒ…å«æŒ‡å®šå¯¹è±¡ï¼ˆåªæœ‰ä¸€ä¸ªæˆ–ä¸€ä¸ªå…ƒç´ ï¼‰çš„ä¸å¯å˜çš„é›†åˆå¯¹è±¡ï¼Œæ­¤å¤„çš„é›†åˆå¯ä»¥æ˜¯ï¼šListï¼ŒSetï¼ŒMapã€‚unmodifiableXxx(): è¿”å›æŒ‡å®šé›†åˆå¯¹è±¡çš„ä¸å¯å˜è§†å›¾ï¼Œæ­¤å¤„çš„é›†åˆå¯ä»¥æ˜¯ï¼šListï¼ŒSetï¼ŒMapã€‚ä¸Šé¢ä¸‰ç±»æ–¹æ³•çš„å‚æ•°æ˜¯åŸæœ‰çš„é›†åˆå¯¹è±¡ï¼Œè¿”å›å€¼æ˜¯è¯¥é›†åˆçš„â€åªè¯»â€œç‰ˆæœ¬ã€‚ Arrayså¸¸è§æ“ä½œ æ’åº : sort() æŸ¥æ‰¾ : binarySearch() æ¯”è¾ƒ: equals() å¡«å…… : fill() è½¬åˆ—è¡¨: asList() è½¬å­—ç¬¦ä¸² : toString() å¤åˆ¶: copyOf() æ–¹æ³•sort12345678910111213141516171819202122232425262728293031323334353637383940// *************æ’åº sort**************** int a[] = &#123; 1, 3, 2, 7, 6, 5, 4, 9 &#125;; // sort(int[] a)æ–¹æ³•æŒ‰ç…§æ•°å­—é¡ºåºæ’åˆ—æŒ‡å®šçš„æ•°ç»„ã€‚ Arrays.sort(a); System.out.println("Arrays.sort(a):"); for (int i : a) &#123; System.out.print(i); &#125; // æ¢è¡Œ System.out.println(); // sort(int[] a,int fromIndex,int toIndex)æŒ‰å‡åºæ’åˆ—æ•°ç»„çš„æŒ‡å®šèŒƒå›´ int b[] = &#123; 1, 3, 2, 7, 6, 5, 4, 9 &#125;; Arrays.sort(b, 2, 6); System.out.println("Arrays.sort(b, 2, 6):"); for (int i : b) &#123; System.out.print(i); &#125; // æ¢è¡Œ System.out.println(); int c[] = &#123; 1, 3, 2, 7, 6, 5, 4, 9 &#125;; // parallelSort(int[] a) æŒ‰ç…§æ•°å­—é¡ºåºæ’åˆ—æŒ‡å®šçš„æ•°ç»„(å¹¶è¡Œçš„)ã€‚åŒsortæ–¹æ³•ä¸€æ ·ä¹Ÿæœ‰æŒ‰èŒƒå›´çš„æ’åº Arrays.parallelSort(c); System.out.println("Arrays.parallelSort(c)ï¼š"); for (int i : c) &#123; System.out.print(i); &#125; // æ¢è¡Œ System.out.println(); // parallelSortç»™å­—ç¬¦æ•°ç»„æ’åºï¼Œsortä¹Ÿå¯ä»¥ char d[] = &#123; 'a', 'f', 'b', 'c', 'e', 'A', 'C', 'B' &#125;; Arrays.parallelSort(d); System.out.println("Arrays.parallelSort(d)ï¼š"); for (char d2 : d) &#123; System.out.print(d2); &#125; // æ¢è¡Œ System.out.println(); binarySearch() 12345678// *************æŸ¥æ‰¾ binarySearch()****************char[] e = &#123; &apos;a&apos;, &apos;f&apos;, &apos;b&apos;, &apos;c&apos;, &apos;e&apos;, &apos;A&apos;, &apos;C&apos;, &apos;B&apos; &#125;;// æ’åºåå†è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œå¦åˆ™æ‰¾ä¸åˆ°Arrays.sort(e);System.out.println(&quot;Arrays.sort(e)&quot; + Arrays.toString(e));System.out.println(&quot;Arrays.binarySearch(e, &apos;c&apos;)ï¼š&quot;);int s = Arrays.binarySearch(e, &apos;c&apos;);System.out.println(&quot;å­—ç¬¦cåœ¨æ•°ç»„çš„ä½ç½®ï¼š&quot; + s);]]></content>
      <tags>
        <tag>java</tag>
        <tag>æºç </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hello World]]></title>
    <url>%2F2019%2F07%2F18%2Fhello-world%2F</url>
    <content type="text"><![CDATA[Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new "My New Post" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment]]></content>
  </entry>
</search>
